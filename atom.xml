<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>akaQin&#39;s Blog</title>
  
  <subtitle>é¢æœå¤§æµ·ï¼Œæ˜¥æš–èŠ±å¼€</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://akaqin.github.io/"/>
  <updated>2020-04-14T06:17:11.197Z</updated>
  <id>https://akaqin.github.io/</id>
  
  <author>
    <name>Aaron Qin</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>ç†è§£inode</title>
    <link href="https://akaqin.github.io/2020/04/14/%E7%90%86%E8%A7%A3inode/"/>
    <id>https://akaqin.github.io/2020/04/14/%E7%90%86%E8%A7%A3inode/</id>
    <published>2020-04-14T05:46:05.000Z</published>
    <updated>2020-04-14T06:17:11.197Z</updated>
    
    <content type="html"><![CDATA[<p>ä½œè€…ï¼šé˜®ä¸€å³°<br>è½¬è‡ªï¼š<a href="http://www.ruanyifeng.com/blog/2011/12/inode.html" target="_blank" rel="noopener">http://www.ruanyifeng.com/blog/2011/12/inode.html</a></p><p>inodeæ˜¯ä¸€ä¸ªé‡è¦æ¦‚å¿µï¼Œæ˜¯ç†è§£Unix/Linuxæ–‡ä»¶ç³»ç»Ÿå’Œç¡¬ç›˜å‚¨å­˜çš„åŸºç¡€ã€‚</p><p>æˆ‘è§‰å¾—ï¼Œç†è§£inodeï¼Œä¸ä»…æœ‰åŠ©äºæé«˜ç³»ç»Ÿæ“ä½œæ°´å¹³ï¼Œè¿˜æœ‰åŠ©äºä½“ä¼šUnixè®¾è®¡å“²å­¦ï¼Œå³å¦‚ä½•æŠŠåº•å±‚çš„å¤æ‚æ€§æŠ½è±¡æˆä¸€ä¸ªç®€å•æ¦‚å¿µï¼Œä»è€Œå¤§å¤§ç®€åŒ–ç”¨æˆ·æ¥å£ã€‚</p><p>ä¸‹é¢å°±æ˜¯æˆ‘çš„inodeå­¦ä¹ ç¬”è®°ï¼Œå°½é‡ä¿æŒç®€å•ã€‚</p><a id="more"></a><p>===================================</p><h3 id="ä¸€ã€inodeæ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#ä¸€ã€inodeæ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="ä¸€ã€inodeæ˜¯ä»€ä¹ˆï¼Ÿ"></a>ä¸€ã€inodeæ˜¯ä»€ä¹ˆï¼Ÿ</h3><p>ç†è§£inodeï¼Œè¦ä»æ–‡ä»¶å‚¨å­˜è¯´èµ·ã€‚</p><p>æ–‡ä»¶å‚¨å­˜åœ¨ç¡¬ç›˜ä¸Šï¼Œç¡¬ç›˜çš„æœ€å°å­˜å‚¨å•ä½å«åšâ€æ‰‡åŒºâ€ï¼ˆSectorï¼‰ã€‚æ¯ä¸ªæ‰‡åŒºå‚¨å­˜512å­—èŠ‚ï¼ˆç›¸å½“äº0.5KBï¼‰ã€‚</p><p>æ“ä½œç³»ç»Ÿè¯»å–ç¡¬ç›˜çš„æ—¶å€™ï¼Œä¸ä¼šä¸€ä¸ªä¸ªæ‰‡åŒºåœ°è¯»å–ï¼Œè¿™æ ·æ•ˆç‡å¤ªä½ï¼Œè€Œæ˜¯ä¸€æ¬¡æ€§è¿ç»­è¯»å–å¤šä¸ªæ‰‡åŒºï¼Œå³ä¸€æ¬¡æ€§è¯»å–ä¸€ä¸ªâ€å—â€ï¼ˆblockï¼‰ã€‚è¿™ç§ç”±å¤šä¸ªæ‰‡åŒºç»„æˆçš„â€å—â€ï¼Œæ˜¯æ–‡ä»¶å­˜å–çš„æœ€å°å•ä½ã€‚â€å—â€çš„å¤§å°ï¼Œæœ€å¸¸è§çš„æ˜¯4KBï¼Œå³è¿ç»­å…«ä¸ª sectorç»„æˆä¸€ä¸ª blockã€‚</p><p>æ–‡ä»¶æ•°æ®éƒ½å‚¨å­˜åœ¨â€å—â€ä¸­ï¼Œé‚£ä¹ˆå¾ˆæ˜¾ç„¶ï¼Œæˆ‘ä»¬è¿˜å¿…é¡»æ‰¾åˆ°ä¸€ä¸ªåœ°æ–¹å‚¨å­˜æ–‡ä»¶çš„å…ƒä¿¡æ¯ï¼Œæ¯”å¦‚æ–‡ä»¶çš„åˆ›å»ºè€…ã€æ–‡ä»¶çš„åˆ›å»ºæ—¥æœŸã€æ–‡ä»¶çš„å¤§å°ç­‰ç­‰ã€‚è¿™ç§å‚¨å­˜æ–‡ä»¶å…ƒä¿¡æ¯çš„åŒºåŸŸå°±å«åšinodeï¼Œä¸­æ–‡è¯‘åä¸ºâ€ç´¢å¼•èŠ‚ç‚¹â€ã€‚</p><p>æ¯ä¸€ä¸ªæ–‡ä»¶éƒ½æœ‰å¯¹åº”çš„inodeï¼Œé‡Œé¢åŒ…å«äº†ä¸è¯¥æ–‡ä»¶æœ‰å…³çš„ä¸€äº›ä¿¡æ¯ã€‚</p><h3 id="äºŒã€inodeçš„å†…å®¹"><a href="#äºŒã€inodeçš„å†…å®¹" class="headerlink" title="äºŒã€inodeçš„å†…å®¹"></a>äºŒã€inodeçš„å†…å®¹</h3><p>inodeåŒ…å«æ–‡ä»¶çš„å…ƒä¿¡æ¯ï¼Œå…·ä½“æ¥è¯´æœ‰ä»¥ä¸‹å†…å®¹ï¼š</p><p>ã€€ã€€* æ–‡ä»¶çš„å­—èŠ‚æ•°</p><p>ã€€ã€€* æ–‡ä»¶æ‹¥æœ‰è€…çš„User ID</p><p>ã€€ã€€* æ–‡ä»¶çš„Group ID</p><p>ã€€ã€€* æ–‡ä»¶çš„è¯»ã€å†™ã€æ‰§è¡Œæƒé™</p><p>ã€€ã€€* æ–‡ä»¶çš„æ—¶é—´æˆ³ï¼Œå…±æœ‰ä¸‰ä¸ªï¼šctimeæŒ‡inodeä¸Šä¸€æ¬¡å˜åŠ¨çš„æ—¶é—´ï¼ŒmtimeæŒ‡æ–‡ä»¶å†…å®¹ä¸Šä¸€æ¬¡å˜åŠ¨çš„æ—¶é—´ï¼ŒatimeæŒ‡æ–‡ä»¶ä¸Šä¸€æ¬¡æ‰“å¼€çš„æ—¶é—´ã€‚</p><p>ã€€ã€€* é“¾æ¥æ•°ï¼Œå³æœ‰å¤šå°‘æ–‡ä»¶åæŒ‡å‘è¿™ä¸ªinode</p><p>ã€€ã€€* æ–‡ä»¶æ•°æ®blockçš„ä½ç½®</p><p>å¯ä»¥ç”¨statå‘½ä»¤ï¼ŒæŸ¥çœ‹æŸä¸ªæ–‡ä»¶çš„inodeä¿¡æ¯ï¼š</p><p>ã€€ã€€stat example.txt</p><p><img src="http://www.ruanyifeng.com/blogimg/asset/201112/bg2011120402.png" alt=""></p><p>æ€»ä¹‹ï¼Œé™¤äº†æ–‡ä»¶åä»¥å¤–çš„æ‰€æœ‰æ–‡ä»¶ä¿¡æ¯ï¼Œéƒ½å­˜åœ¨inodeä¹‹ä¸­ã€‚è‡³äºä¸ºä»€ä¹ˆæ²¡æœ‰æ–‡ä»¶åï¼Œä¸‹æ–‡ä¼šæœ‰è¯¦ç»†è§£é‡Šã€‚</p><h3 id="ä¸‰ã€inodeçš„å¤§å°"><a href="#ä¸‰ã€inodeçš„å¤§å°" class="headerlink" title="ä¸‰ã€inodeçš„å¤§å°"></a>ä¸‰ã€inodeçš„å¤§å°</h3><p>inodeä¹Ÿä¼šæ¶ˆè€—ç¡¬ç›˜ç©ºé—´ï¼Œæ‰€ä»¥ç¡¬ç›˜æ ¼å¼åŒ–çš„æ—¶å€™ï¼Œæ“ä½œç³»ç»Ÿè‡ªåŠ¨å°†ç¡¬ç›˜åˆ†æˆä¸¤ä¸ªåŒºåŸŸã€‚ä¸€ä¸ªæ˜¯æ•°æ®åŒºï¼Œå­˜æ”¾æ–‡ä»¶æ•°æ®ï¼›å¦ä¸€ä¸ªæ˜¯inodeåŒºï¼ˆinode tableï¼‰ï¼Œå­˜æ”¾inodeæ‰€åŒ…å«çš„ä¿¡æ¯ã€‚</p><p>æ¯ä¸ªinodeèŠ‚ç‚¹çš„å¤§å°ï¼Œä¸€èˆ¬æ˜¯128å­—èŠ‚æˆ–256å­—èŠ‚ã€‚inodeèŠ‚ç‚¹çš„æ€»æ•°ï¼Œåœ¨æ ¼å¼åŒ–æ—¶å°±ç»™å®šï¼Œä¸€èˆ¬æ˜¯æ¯1KBæˆ–æ¯2KBå°±è®¾ç½®ä¸€ä¸ªinodeã€‚å‡å®šåœ¨ä¸€å—1GBçš„ç¡¬ç›˜ä¸­ï¼Œæ¯ä¸ªinodeèŠ‚ç‚¹çš„å¤§å°ä¸º128å­—èŠ‚ï¼Œæ¯1KBå°±è®¾ç½®ä¸€ä¸ªinodeï¼Œé‚£ä¹ˆinode tableçš„å¤§å°å°±ä¼šè¾¾åˆ°128MBï¼Œå æ•´å—ç¡¬ç›˜çš„12.8%ã€‚</p><p>æŸ¥çœ‹æ¯ä¸ªç¡¬ç›˜åˆ†åŒºçš„inodeæ€»æ•°å’Œå·²ç»ä½¿ç”¨çš„æ•°é‡ï¼Œå¯ä»¥ä½¿ç”¨dfå‘½ä»¤ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ã€€ã€€df -i</span><br></pre></td></tr></table></figure><p><img src="http://www.ruanyifeng.com/blogimg/asset/201112/bg2011120403.png" alt=""></p><p>æŸ¥çœ‹æ¯ä¸ªinodeèŠ‚ç‚¹çš„å¤§å°ï¼Œå¯ä»¥ç”¨å¦‚ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ã€€ã€€sudo dumpe2fs -h &#x2F;dev&#x2F;hda | grep &quot;Inode size&quot;</span><br></pre></td></tr></table></figure><p><img src="http://www.ruanyifeng.com/blogimg/asset/201112/bg2011120404.png" alt=""></p><p>ç”±äºæ¯ä¸ªæ–‡ä»¶éƒ½å¿…é¡»æœ‰ä¸€ä¸ªinodeï¼Œå› æ­¤æœ‰å¯èƒ½å‘ç”Ÿinodeå·²ç»ç”¨å…‰ï¼Œä½†æ˜¯ç¡¬ç›˜è¿˜æœªå­˜æ»¡çš„æƒ…å†µã€‚è¿™æ—¶ï¼Œå°±æ— æ³•åœ¨ç¡¬ç›˜ä¸Šåˆ›å»ºæ–°æ–‡ä»¶ã€‚</p><h3 id="å››ã€inodeå·ç "><a href="#å››ã€inodeå·ç " class="headerlink" title="å››ã€inodeå·ç "></a>å››ã€inodeå·ç </h3><p>æ¯ä¸ªinodeéƒ½æœ‰ä¸€ä¸ªå·ç ï¼Œæ“ä½œç³»ç»Ÿç”¨inodeå·ç æ¥è¯†åˆ«ä¸åŒçš„æ–‡ä»¶ã€‚</p><p>è¿™é‡Œå€¼å¾—é‡å¤ä¸€éï¼ŒUnix/Linuxç³»ç»Ÿå†…éƒ¨ä¸ä½¿ç”¨æ–‡ä»¶åï¼Œè€Œä½¿ç”¨inodeå·ç æ¥è¯†åˆ«æ–‡ä»¶ã€‚å¯¹äºç³»ç»Ÿæ¥è¯´ï¼Œæ–‡ä»¶ååªæ˜¯inodeå·ç ä¾¿äºè¯†åˆ«çš„åˆ«ç§°æˆ–è€…ç»°å·ã€‚</p><p>è¡¨é¢ä¸Šï¼Œç”¨æˆ·é€šè¿‡æ–‡ä»¶åï¼Œæ‰“å¼€æ–‡ä»¶ã€‚å®é™…ä¸Šï¼Œç³»ç»Ÿå†…éƒ¨è¿™ä¸ªè¿‡ç¨‹åˆ†æˆä¸‰æ­¥ï¼šé¦–å…ˆï¼Œç³»ç»Ÿæ‰¾åˆ°è¿™ä¸ªæ–‡ä»¶åå¯¹åº”çš„inodeå·ç ï¼›å…¶æ¬¡ï¼Œé€šè¿‡inodeå·ç ï¼Œè·å–inodeä¿¡æ¯ï¼›æœ€åï¼Œæ ¹æ®inodeä¿¡æ¯ï¼Œæ‰¾åˆ°æ–‡ä»¶æ•°æ®æ‰€åœ¨çš„blockï¼Œè¯»å‡ºæ•°æ®ã€‚</p><p>ä½¿ç”¨ls -iå‘½ä»¤ï¼Œå¯ä»¥çœ‹åˆ°æ–‡ä»¶åå¯¹åº”çš„inodeå·ç ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ã€€ã€€ls -i example.txt</span><br></pre></td></tr></table></figure><p><img src="http://www.ruanyifeng.com/blogimg/asset/201112/bg2011120405.png" alt=""></p><h3 id="äº”ã€ç›®å½•æ–‡ä»¶"><a href="#äº”ã€ç›®å½•æ–‡ä»¶" class="headerlink" title="äº”ã€ç›®å½•æ–‡ä»¶"></a>äº”ã€ç›®å½•æ–‡ä»¶</h3><p>Unix/Linuxç³»ç»Ÿä¸­ï¼Œç›®å½•ï¼ˆdirectoryï¼‰ä¹Ÿæ˜¯ä¸€ç§æ–‡ä»¶ã€‚æ‰“å¼€ç›®å½•ï¼Œå®é™…ä¸Šå°±æ˜¯æ‰“å¼€ç›®å½•æ–‡ä»¶ã€‚</p><p>ç›®å½•æ–‡ä»¶çš„ç»“æ„éå¸¸ç®€å•ï¼Œå°±æ˜¯ä¸€ç³»åˆ—ç›®å½•é¡¹ï¼ˆdirentï¼‰çš„åˆ—è¡¨ã€‚æ¯ä¸ªç›®å½•é¡¹ï¼Œç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼šæ‰€åŒ…å«æ–‡ä»¶çš„æ–‡ä»¶åï¼Œä»¥åŠè¯¥æ–‡ä»¶åå¯¹åº”çš„inodeå·ç ã€‚</p><p>lså‘½ä»¤åªåˆ—å‡ºç›®å½•æ–‡ä»¶ä¸­çš„æ‰€æœ‰æ–‡ä»¶åï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ã€€ã€€ls &#x2F;etc</span><br></pre></td></tr></table></figure><p><img src="http://www.ruanyifeng.com/blogimg/asset/201112/bg2011120406.png" alt=""></p><p>ls -iå‘½ä»¤åˆ—å‡ºæ•´ä¸ªç›®å½•æ–‡ä»¶ï¼Œå³æ–‡ä»¶åå’Œinodeå·ç ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ã€€ã€€ls -i &#x2F;etc</span><br></pre></td></tr></table></figure><p><img src="http://www.ruanyifeng.com/blogimg/asset/201112/bg2011120407.png" alt=""></p><p>å¦‚æœè¦æŸ¥çœ‹æ–‡ä»¶çš„è¯¦ç»†ä¿¡æ¯ï¼Œå°±å¿…é¡»æ ¹æ®inodeå·ç ï¼Œè®¿é—®inodeèŠ‚ç‚¹ï¼Œè¯»å–ä¿¡æ¯ã€‚ls -lå‘½ä»¤åˆ—å‡ºæ–‡ä»¶çš„è¯¦ç»†ä¿¡æ¯ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ã€€ã€€ls -l &#x2F;etc</span><br></pre></td></tr></table></figure><p><img src="http://www.ruanyifeng.com/blogimg/asset/201112/bg2011120408.png" alt=""></p><p>ç†è§£äº†ä¸Šé¢è¿™äº›çŸ¥è¯†ï¼Œå°±èƒ½ç†è§£ç›®å½•çš„æƒé™ã€‚ç›®å½•æ–‡ä»¶çš„è¯»æƒé™ï¼ˆrï¼‰å’Œå†™æƒé™ï¼ˆwï¼‰ï¼Œéƒ½æ˜¯é’ˆå¯¹ç›®å½•æ–‡ä»¶æœ¬èº«ã€‚ç”±äºç›®å½•æ–‡ä»¶å†…åªæœ‰æ–‡ä»¶åå’Œinodeå·ç ï¼Œæ‰€ä»¥å¦‚æœåªæœ‰è¯»æƒé™ï¼Œåªèƒ½è·å–æ–‡ä»¶åï¼Œæ— æ³•è·å–å…¶ä»–ä¿¡æ¯ï¼Œå› ä¸ºå…¶ä»–ä¿¡æ¯éƒ½å‚¨å­˜åœ¨inodeèŠ‚ç‚¹ä¸­ï¼Œè€Œè¯»å–inodeèŠ‚ç‚¹å†…çš„ä¿¡æ¯éœ€è¦ç›®å½•æ–‡ä»¶çš„æ‰§è¡Œæƒé™ï¼ˆxï¼‰ã€‚</p><h3 id="å…­ã€ç¡¬é“¾æ¥"><a href="#å…­ã€ç¡¬é“¾æ¥" class="headerlink" title="å…­ã€ç¡¬é“¾æ¥"></a>å…­ã€ç¡¬é“¾æ¥</h3><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæ–‡ä»¶åå’Œinodeå·ç æ˜¯â€ä¸€ä¸€å¯¹åº”â€å…³ç³»ï¼Œæ¯ä¸ªinodeå·ç å¯¹åº”ä¸€ä¸ªæ–‡ä»¶åã€‚ä½†æ˜¯ï¼ŒUnix/Linuxç³»ç»Ÿå…è®¸ï¼Œå¤šä¸ªæ–‡ä»¶åæŒ‡å‘åŒä¸€ä¸ªinodeå·ç ã€‚</p><p>è¿™æ„å‘³ç€ï¼Œå¯ä»¥ç”¨ä¸åŒçš„æ–‡ä»¶åè®¿é—®åŒæ ·çš„å†…å®¹ï¼›å¯¹æ–‡ä»¶å†…å®¹è¿›è¡Œä¿®æ”¹ï¼Œä¼šå½±å“åˆ°æ‰€æœ‰æ–‡ä»¶åï¼›ä½†æ˜¯ï¼Œåˆ é™¤ä¸€ä¸ªæ–‡ä»¶åï¼Œä¸å½±å“å¦ä¸€ä¸ªæ–‡ä»¶åçš„è®¿é—®ã€‚è¿™ç§æƒ…å†µå°±è¢«ç§°ä¸ºâ€ç¡¬é“¾æ¥â€ï¼ˆhard linkï¼‰ã€‚</p><p>lnå‘½ä»¤å¯ä»¥åˆ›å»ºç¡¬é“¾æ¥ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ã€€ã€€ln æºæ–‡ä»¶ ç›®æ ‡æ–‡ä»¶</span><br></pre></td></tr></table></figure><p><img src="http://www.ruanyifeng.com/blogimg/asset/201112/bg2011120409.png" alt=""></p><p>è¿è¡Œä¸Šé¢è¿™æ¡å‘½ä»¤ä»¥åï¼Œæºæ–‡ä»¶ä¸ç›®æ ‡æ–‡ä»¶çš„inodeå·ç ç›¸åŒï¼Œéƒ½æŒ‡å‘åŒä¸€ä¸ªinodeã€‚inodeä¿¡æ¯ä¸­æœ‰ä¸€é¡¹å«åšâ€é“¾æ¥æ•°â€ï¼Œè®°å½•æŒ‡å‘è¯¥inodeçš„æ–‡ä»¶åæ€»æ•°ï¼Œè¿™æ—¶å°±ä¼šå¢åŠ 1ã€‚</p><p>åè¿‡æ¥ï¼Œåˆ é™¤ä¸€ä¸ªæ–‡ä»¶åï¼Œå°±ä¼šä½¿å¾—inodeèŠ‚ç‚¹ä¸­çš„â€é“¾æ¥æ•°â€å‡1ã€‚å½“è¿™ä¸ªå€¼å‡åˆ°0ï¼Œè¡¨æ˜æ²¡æœ‰æ–‡ä»¶åæŒ‡å‘è¿™ä¸ªinodeï¼Œç³»ç»Ÿå°±ä¼šå›æ”¶è¿™ä¸ªinodeå·ç ï¼Œä»¥åŠå…¶æ‰€å¯¹åº”blockåŒºåŸŸã€‚</p><p>è¿™é‡Œé¡ºä¾¿è¯´ä¸€ä¸‹ç›®å½•æ–‡ä»¶çš„â€é“¾æ¥æ•°â€ã€‚åˆ›å»ºç›®å½•æ—¶ï¼Œé»˜è®¤ä¼šç”Ÿæˆä¸¤ä¸ªç›®å½•é¡¹ï¼šâ€.â€å’Œâ€..â€ã€‚å‰è€…çš„inodeå·ç å°±æ˜¯å½“å‰ç›®å½•çš„inodeå·ç ï¼Œç­‰åŒäºå½“å‰ç›®å½•çš„â€ç¡¬é“¾æ¥â€ï¼›åè€…çš„inodeå·ç å°±æ˜¯å½“å‰ç›®å½•çš„çˆ¶ç›®å½•çš„inodeå·ç ï¼Œç­‰åŒäºçˆ¶ç›®å½•çš„â€ç¡¬é“¾æ¥â€ã€‚æ‰€ä»¥ï¼Œä»»ä½•ä¸€ä¸ªç›®å½•çš„â€ç¡¬é“¾æ¥â€æ€»æ•°ï¼Œæ€»æ˜¯ç­‰äº2åŠ ä¸Šå®ƒçš„å­ç›®å½•æ€»æ•°ï¼ˆå«éšè—ç›®å½•ï¼‰ã€‚</p><h3 id="ä¸ƒã€è½¯é“¾æ¥"><a href="#ä¸ƒã€è½¯é“¾æ¥" class="headerlink" title="ä¸ƒã€è½¯é“¾æ¥"></a>ä¸ƒã€è½¯é“¾æ¥</h3><p>é™¤äº†ç¡¬é“¾æ¥ä»¥å¤–ï¼Œè¿˜æœ‰ä¸€ç§ç‰¹æ®Šæƒ…å†µã€‚</p><p>æ–‡ä»¶Aå’Œæ–‡ä»¶Bçš„inodeå·ç è™½ç„¶ä¸ä¸€æ ·ï¼Œä½†æ˜¯æ–‡ä»¶Açš„å†…å®¹æ˜¯æ–‡ä»¶Bçš„è·¯å¾„ã€‚è¯»å–æ–‡ä»¶Aæ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å°†è®¿é—®è€…å¯¼å‘æ–‡ä»¶Bã€‚å› æ­¤ï¼Œæ— è®ºæ‰“å¼€å“ªä¸€ä¸ªæ–‡ä»¶ï¼Œæœ€ç»ˆè¯»å–çš„éƒ½æ˜¯æ–‡ä»¶Bã€‚è¿™æ—¶ï¼Œæ–‡ä»¶Aå°±ç§°ä¸ºæ–‡ä»¶Bçš„â€è½¯é“¾æ¥â€ï¼ˆsoft linkï¼‰æˆ–è€…â€ç¬¦å·é“¾æ¥ï¼ˆsymbolic linkï¼‰ã€‚</p><p>è¿™æ„å‘³ç€ï¼Œæ–‡ä»¶Aä¾èµ–äºæ–‡ä»¶Bè€Œå­˜åœ¨ï¼Œå¦‚æœåˆ é™¤äº†æ–‡ä»¶Bï¼Œæ‰“å¼€æ–‡ä»¶Aå°±ä¼šæŠ¥é”™ï¼šâ€No such file or directoryâ€ã€‚è¿™æ˜¯è½¯é“¾æ¥ä¸ç¡¬é“¾æ¥æœ€å¤§çš„ä¸åŒï¼šæ–‡ä»¶AæŒ‡å‘æ–‡ä»¶Bçš„æ–‡ä»¶åï¼Œè€Œä¸æ˜¯æ–‡ä»¶Bçš„inodeå·ç ï¼Œæ–‡ä»¶Bçš„inodeâ€é“¾æ¥æ•°â€ä¸ä¼šå› æ­¤å‘ç”Ÿå˜åŒ–ã€‚</p><p>ln -så‘½ä»¤å¯ä»¥åˆ›å»ºè½¯é“¾æ¥ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ã€€ã€€ln -s æºæ–‡æ–‡ä»¶æˆ–ç›®å½• ç›®æ ‡æ–‡ä»¶æˆ–ç›®å½•</span><br></pre></td></tr></table></figure><p><img src="http://www.ruanyifeng.com/blogimg/asset/201112/bg2011120410.png" alt=""></p><h3 id="å…«ã€inodeçš„ç‰¹æ®Šä½œç”¨"><a href="#å…«ã€inodeçš„ç‰¹æ®Šä½œç”¨" class="headerlink" title="å…«ã€inodeçš„ç‰¹æ®Šä½œç”¨"></a>å…«ã€inodeçš„ç‰¹æ®Šä½œç”¨</h3><p>ç”±äºinodeå·ç ä¸æ–‡ä»¶ååˆ†ç¦»ï¼Œè¿™ç§æœºåˆ¶å¯¼è‡´äº†ä¸€äº›Unix/Linuxç³»ç»Ÿç‰¹æœ‰çš„ç°è±¡ã€‚</p><p>ã€€ã€€1. æœ‰æ—¶ï¼Œæ–‡ä»¶ååŒ…å«ç‰¹æ®Šå­—ç¬¦ï¼Œæ— æ³•æ­£å¸¸åˆ é™¤ã€‚è¿™æ—¶ï¼Œç›´æ¥åˆ é™¤inodeèŠ‚ç‚¹ï¼Œå°±èƒ½èµ·åˆ°åˆ é™¤æ–‡ä»¶çš„ä½œç”¨ã€‚</p><p>ã€€ã€€2. ç§»åŠ¨æ–‡ä»¶æˆ–é‡å‘½åæ–‡ä»¶ï¼Œåªæ˜¯æ”¹å˜æ–‡ä»¶åï¼Œä¸å½±å“inodeå·ç ã€‚</p><p>ã€€ã€€3. æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ä»¥åï¼Œç³»ç»Ÿå°±ä»¥inodeå·ç æ¥è¯†åˆ«è¿™ä¸ªæ–‡ä»¶ï¼Œä¸å†è€ƒè™‘æ–‡ä»¶åã€‚å› æ­¤ï¼Œé€šå¸¸æ¥è¯´ï¼Œç³»ç»Ÿæ— æ³•ä»inodeå·ç å¾—çŸ¥æ–‡ä»¶åã€‚</p><p>ç¬¬3ç‚¹ä½¿å¾—è½¯ä»¶æ›´æ–°å˜å¾—ç®€å•ï¼Œå¯ä»¥åœ¨ä¸å…³é—­è½¯ä»¶çš„æƒ…å†µä¸‹è¿›è¡Œæ›´æ–°ï¼Œä¸éœ€è¦é‡å¯ã€‚å› ä¸ºç³»ç»Ÿé€šè¿‡inodeå·ç ï¼Œè¯†åˆ«è¿è¡Œä¸­çš„æ–‡ä»¶ï¼Œä¸é€šè¿‡æ–‡ä»¶åã€‚æ›´æ–°çš„æ—¶å€™ï¼Œæ–°ç‰ˆæ–‡ä»¶ä»¥åŒæ ·çš„æ–‡ä»¶åï¼Œç”Ÿæˆä¸€ä¸ªæ–°çš„inodeï¼Œä¸ä¼šå½±å“åˆ°è¿è¡Œä¸­çš„æ–‡ä»¶ã€‚ç­‰åˆ°ä¸‹ä¸€æ¬¡è¿è¡Œè¿™ä¸ªè½¯ä»¶çš„æ—¶å€™ï¼Œæ–‡ä»¶åå°±è‡ªåŠ¨æŒ‡å‘æ–°ç‰ˆæ–‡ä»¶ï¼Œæ—§ç‰ˆæ–‡ä»¶çš„inodeåˆ™è¢«å›æ”¶ã€‚</p><p>ï¼ˆå®Œï¼‰</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ä½œè€…ï¼šé˜®ä¸€å³°&lt;br&gt;è½¬è‡ªï¼š&lt;a href=&quot;http://www.ruanyifeng.com/blog/2011/12/inode.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;http://www.ruanyifeng.com/blog/2011/12/inode.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;inodeæ˜¯ä¸€ä¸ªé‡è¦æ¦‚å¿µï¼Œæ˜¯ç†è§£Unix/Linuxæ–‡ä»¶ç³»ç»Ÿå’Œç¡¬ç›˜å‚¨å­˜çš„åŸºç¡€ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘è§‰å¾—ï¼Œç†è§£inodeï¼Œä¸ä»…æœ‰åŠ©äºæé«˜ç³»ç»Ÿæ“ä½œæ°´å¹³ï¼Œè¿˜æœ‰åŠ©äºä½“ä¼šUnixè®¾è®¡å“²å­¦ï¼Œå³å¦‚ä½•æŠŠåº•å±‚çš„å¤æ‚æ€§æŠ½è±¡æˆä¸€ä¸ªç®€å•æ¦‚å¿µï¼Œä»è€Œå¤§å¤§ç®€åŒ–ç”¨æˆ·æ¥å£ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢å°±æ˜¯æˆ‘çš„inodeå­¦ä¹ ç¬”è®°ï¼Œå°½é‡ä¿æŒç®€å•ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="è½¬è½½" scheme="https://akaqin.github.io/categories/%E8%BD%AC%E8%BD%BD/"/>
    
    
      <category term="inode" scheme="https://akaqin.github.io/tags/inode/"/>
    
  </entry>
  
  <entry>
    <title>ã€ŠUNIXç¯å¢ƒé«˜çº§ç¼–ç¨‹ã€‹ç¬¬4ç« â€”â€”æ–‡ä»¶å’Œç›®å½•</title>
    <link href="https://akaqin.github.io/2020/04/14/%E3%80%8AUNIX%E7%8E%AF%E5%A2%83%E9%AB%98%E7%BA%A7%E7%BC%96%E7%A8%8B%E3%80%8B%E7%AC%AC4%E7%AB%A0%E2%80%94%E2%80%94%E6%96%87%E4%BB%B6%E5%92%8C%E7%9B%AE%E5%BD%95/"/>
    <id>https://akaqin.github.io/2020/04/14/%E3%80%8AUNIX%E7%8E%AF%E5%A2%83%E9%AB%98%E7%BA%A7%E7%BC%96%E7%A8%8B%E3%80%8B%E7%AC%AC4%E7%AB%A0%E2%80%94%E2%80%94%E6%96%87%E4%BB%B6%E5%92%8C%E7%9B%AE%E5%BD%95/</id>
    <published>2020-04-14T01:54:37.000Z</published>
    <updated>2020-04-14T12:50:50.068Z</updated>
    
    <content type="html"><![CDATA[<h2 id="æ–‡ä»¶å±æ€§"><a href="#æ–‡ä»¶å±æ€§" class="headerlink" title="æ–‡ä»¶å±æ€§"></a>æ–‡ä»¶å±æ€§</h2><h3 id="æ–‡ä»¶ç»“æ„-stat"><a href="#æ–‡ä»¶ç»“æ„-stat" class="headerlink" title="æ–‡ä»¶ç»“æ„ stat"></a>æ–‡ä»¶ç»“æ„ stat</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">stat</span> &#123;</span></span><br><span class="line">  <span class="keyword">mode_t</span>            st_mode;    <span class="comment">// file type &amp; mode (permisssions)</span></span><br><span class="line">  <span class="keyword">ino_t</span>             st_ino;     <span class="comment">// i-node number (serial number)</span></span><br><span class="line">  <span class="keyword">dev_t</span>             st_dev;     <span class="comment">// device number (file system)</span></span><br><span class="line">  <span class="keyword">dev_t</span>             st_rdev;    <span class="comment">// device number for special files</span></span><br><span class="line">  <span class="keyword">nlink_t</span>           st_link;    <span class="comment">// number of links</span></span><br><span class="line">  <span class="keyword">uid_t</span>             st_uid;     <span class="comment">// user ID of owner</span></span><br><span class="line">  <span class="keyword">gid_t</span>             st_gid;     <span class="comment">// group ID of owner</span></span><br><span class="line">  <span class="keyword">off_t</span>             st_size;    <span class="comment">// size in bytes, for regular files</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">timespec</span>   <span class="title">st_atime</span>;</span>   <span class="comment">// time of last access</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">timespec</span>   <span class="title">st_mtime</span>;</span>   <span class="comment">// time of last modification</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">timespec</span>   <span class="title">st_ctime</span>;</span>   <span class="comment">// time of last file status change</span></span><br><span class="line">  <span class="keyword">blksize_t</span>         st_blksize; <span class="comment">// best I/O block size å¯¹æ–‡ä»¶I/Oè¾ƒé€‚åˆçš„å—é•¿åº¦</span></span><br><span class="line">  <span class="keyword">blkcnt_t</span>          st_blocks;  <span class="comment">// number of disk blocks allocated æ‰€åˆ†é…çš„å®é™…512å­—èŠ‚å—å—æ•°</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><a id="more"></a><p>ç›¸å…³å‡½æ•°ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/stat.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//è·å–æ–‡ä»¶ä¿¡æ¯ç»“æ„</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">stat</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *<span class="keyword">restrict</span> pathname, struct stat *<span class="keyword">restrict</span> buf)</span></span>;</span><br><span class="line"><span class="comment">//æ ¹æ®æè¿°ç¬¦è·å–</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">fstat</span><span class="params">(<span class="keyword">int</span> fd, struct stat *buf)</span></span>;</span><br><span class="line"><span class="comment">//è·å–ä¸ç¬¦å·é“¾æ¥ç›¸å…³çš„</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">lstat</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *<span class="keyword">restrict</span> pathname, struct stat *<span class="keyword">restrict</span> buf)</span></span>;</span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">fstatat</span><span class="params">(<span class="keyword">int</span> fd, <span class="keyword">const</span> <span class="keyword">char</span> *<span class="keyword">restrict</span> pathname, struct stat *<span class="keyword">restrict</span> buf, <span class="keyword">int</span> flag)</span></span>;</span><br></pre></td></tr></table></figure><h3 id="æ–‡ä»¶ç±»å‹"><a href="#æ–‡ä»¶ç±»å‹" class="headerlink" title="æ–‡ä»¶ç±»å‹"></a>æ–‡ä»¶ç±»å‹</h3><ul><li>æ™®é€šæ–‡ä»¶ï¼ˆregular file)</li><li>ç›®å½•æ–‡ä»¶ï¼ˆdirectory fileï¼‰</li><li>å—ç‰¹æ®Šæ–‡ä»¶ï¼ˆblock special fileï¼‰<br>è¿™ç§ç±»å‹çš„æ–‡ä»¶æä¾›å¯¹è®¾å¤‡ï¼ˆå¦‚ç£ç›˜ï¼‰å¸¦ç¼“å†²çš„è®¿é—®ï¼Œæ¯æ¬¡è®¿é—®ä»¥å›ºå®šå•ä½é•¿åº¦è¿›è¡Œã€‚</li><li>å­—ç‰¹æ®Šæ–‡ä»¶ï¼ˆcharacter special fileï¼‰<br>è¿™ç§ç±»å‹çš„æ–‡ä»¶æä¾›å¯¹è®¾å¤‡ä¸å¸¦ç¼“å†²çš„è®¿é—®ï¼Œæ¯æ¬¡è®¿é—®é•¿åº¦å¯å˜ã€‚ç³»ç»Ÿä¸­æ‰€æœ‰è®¾å¤‡è¦ä¹ˆæ˜¯å­—ç‰¹æ®Šæ–‡ä»¶ï¼Œè¦ä¹ˆæ˜¯å—ç‰¹æ®Šæ–‡ä»¶ã€‚</li><li>FIFO<br>è¿™ç§ç±»å‹çš„æ–‡ä»¶ç”¨äºè¿›ç¨‹é—´é€šä¿¡ï¼Œä¹Ÿç§°ä¸ºå‘½åç®¡é“ï¼ˆnamed pipeï¼‰ã€‚</li><li>å¥—æ¥å­—ï¼ˆsocketï¼‰<br>è¿™ç§ç±»å‹çš„æ–‡ä»¶ç”¨äºè¿›ç¨‹é—´çš„ç½‘ç»œé€šä¿¡ï¼Œä¹Ÿå¯ç”¨äºä¸€å°å®¿ä¸»æœºä¸Šè¿›ç¨‹ä¹‹é—´çš„éç½‘ç»œé€šä¿¡ã€‚</li><li>ç¬¦å·é“¾æ¥ï¼ˆsymbolic linkï¼‰<br>è¿™ç§ç±»å‹çš„æ–‡ä»¶æŒ‡å‘å¦ä¸€ä¸ªæ–‡ä»¶ã€‚</li></ul><h3 id="æ–‡ä»¶é•¿åº¦"><a href="#æ–‡ä»¶é•¿åº¦" class="headerlink" title="æ–‡ä»¶é•¿åº¦"></a>æ–‡ä»¶é•¿åº¦</h3><p>st_sizeè¡¨ç¤ºä»¥å­—èŠ‚ä¸ºå•ä½çš„æ–‡ä»¶é•¿åº¦ã€‚æ­¤å­—æ®µåªå¯¹æ™®é€šæ–‡ä»¶ã€ç›®å½•æ–‡ä»¶å’Œç¬¦å·é“¾æ¥æœ‰æ„ä¹‰ã€‚</p><ul><li>å¯¹äºæ™®é€šæ–‡ä»¶ï¼Œé•¿åº¦å¯ä»¥æ˜¯0ã€‚</li><li>å¯¹äºç›®å½•ï¼Œé•¿åº¦é€šå¸¸æ˜¯ä¸€ä¸ªæ•°ï¼ˆ16æˆ–512ï¼‰çš„æ•´æ•°å€ã€‚</li><li>å¯¹äºç¬¦å·é“¾æ¥ï¼Œå°è¯•æ˜¯æ–‡ä»¶åä¸­çš„å­—èŠ‚æ•°ã€‚</li></ul><h4 id="æ–‡ä»¶ç©ºæ´"><a href="#æ–‡ä»¶ç©ºæ´" class="headerlink" title="æ–‡ä»¶ç©ºæ´"></a>æ–‡ä»¶ç©ºæ´</h4><p>æ–‡ä»¶ç©ºæ´æ˜¯ç”±æ‰€è®¾ç½®çš„åç§»é‡è¶…è¿‡æ–‡ä»¶å°¾ç«¯ï¼Œå¹¶å†™å…¥äº†æ•°æ®åé€ æˆçš„ã€‚</p><h3 id="æ–‡ä»¶ç³»ç»Ÿ"><a href="#æ–‡ä»¶ç³»ç»Ÿ" class="headerlink" title="æ–‡ä»¶ç³»ç»Ÿ"></a>æ–‡ä»¶ç³»ç»Ÿ</h3><p>UNIXæ–‡ä»¶ç³»ç»Ÿæœ‰å¾ˆå¤šç§å®ç°ï¼Œè¿™é‡Œè®¨è®ºUFSæ–‡ä»¶ç³»ç»Ÿã€‚<br><img src="4-13.png" alt=""><br><img src="4-14.png" alt=""></p><ul><li>æ¯ä¸ªièŠ‚ç‚¹éƒ½æœ‰ä¸€ä¸ªé“¾æ¥è®¡æ•°ï¼Œå…¶å€¼æŒ‡å‘ièŠ‚ç‚¹çš„ç›®å½•é¡¹æ•°ã€‚åªæœ‰è®¡æ•°å‡å°‘åˆ°0æ—¶ï¼Œæ‰å¯åˆ é™¤æ–‡ä»¶ï¼ˆä¹Ÿå°±æ˜¯é‡Šæ”¾è¯¥æ–‡ä»¶å ç”¨çš„æ•°æ®å—ï¼‰ã€‚é“¾æ¥è®¡æ•°åŒ…å«åœ¨statç»“æ„é‡Œçš„st_nlinkå­—æ®µä¸­ï¼Œè¿™ç§é“¾æ¥ç±»å‹ç§°ä¸ºç¡¬é“¾æ¥ã€‚</li><li>å¦ä¸€ç§é“¾æ¥ç±»å‹ä¸ºç¬¦å·é“¾æ¥ï¼ˆsymbolic linkï¼‰ã€‚ç¬¦å·é“¾æ¥æ–‡ä»¶çš„å®é™…å†…å®¹åŒ…å«äº†è¯¥ç¬¦å·é“¾æ¥æ‰€æŒ‡å‘çš„æ–‡ä»¶çš„åå­—ã€‚</li><li>ièŠ‚ç‚¹åŒ…å«äº†æ–‡ä»¶æœ‰å…³çš„æ‰€æœ‰ä¿¡æ¯ï¼šæ–‡ä»¶ç±»å‹ã€æ–‡ä»¶è®¿é—®æƒé™ä½ã€æ–‡ä»¶é•¿åº¦å’ŒæŒ‡å‘æ–‡ä»¶æ•°æ®å—çš„æŒ‡é’ˆç­‰ã€‚statç»“æ„ä¸­å¤§å¤šæ•°ä¿¡æ¯éƒ½å–è‡ªièŠ‚ç‚¹ï¼Œé™¤äº†æ–‡ä»¶åå’ŒièŠ‚ç‚¹ç¼–å·ã€‚</li><li>ç›®å½•é¡¹ä¸­çš„ièŠ‚ç‚¹ç¼–å·æŒ‡å‘åŒä¸€æ–‡ä»¶ç³»ç»Ÿä¸­çš„ièŠ‚ç‚¹ã€‚</li><li>åœ¨ä¸æ›´æ¢æ–‡ä»¶ç³»ç»Ÿçš„æƒ…å†µä¸‹ï¼Œé‡å‘½åæ–‡ä»¶å¹¶ä¸ä¼šè®©æ–‡ä»¶çš„å®é™…å†…å®¹å˜åŠ¨ï¼Œåªéœ€è¦æ„é€ ä¸€ä¸ªæŒ‡å‘ç°æœ‰iå‡ ç‚¹çš„æ–°ç›®å½•é¡¹ï¼Œå¹¶åˆ é™¤è€çš„ç›®å½•é¡¹ï¼Œé“¾æ¥æ•°ä¸å˜ã€‚</li></ul><p><img src="4-15.png" alt=""></p><ul><li>æ¯ä¸ªå¶ç›®å½•çš„é“¾æ¥è®¡æ•°æ€»æ˜¯2ï¼ˆæ¥è‡ª è¯¥ç›®å½•å å’Œ<code>.</code>ï¼‰ã€‚</li><li>çˆ¶ç›®å½•ä¸­çš„æ¯ä¸€ä¸ªå­ç›®å½•éƒ½ä½¿è¯¥çˆ¶ç›®å½•çš„é“¾æ¥è®¡æ•°åŠ 1ï¼ˆå­ç›®å½•ä¸­çš„<code>..</code>é¡¹æŒ‡å‘çˆ¶ç›®å½•ï¼‰</li></ul><h3 id="linkã€linkatã€unlinkã€unlinkatå’Œremove"><a href="#linkã€linkatã€unlinkã€unlinkatå’Œremove" class="headerlink" title="linkã€linkatã€unlinkã€unlinkatå’Œremove"></a>linkã€linkatã€unlinkã€unlinkatå’Œremove</h3><p>ä»»ä½•ä¸€ä¸ªæ–‡ä»¶å¯ä»¥æœ‰å¤šä¸ªç›®å½•é¡¹æŒ‡å‘å…¶ièŠ‚ç‚¹ã€‚åˆ›å»ºä¸€ä¸ªæŒ‡å‘ç°æœ‰æ–‡ä»¶çš„é“¾æ¥çš„æ–¹æ³•æ˜¯ä½¿ç”¨linkæˆ–linkatå‡½æ•°ã€‚<br>åˆ é™¤ä¸€ä¸ªç›®å½•é¡¹ä½¿ç”¨unlinkå‡½æ•°ï¼Œåªæœ‰é“¾æ¥è®¡æ•°è¾¾åˆ°0æ—¶ï¼Œè¯¥æ–‡ä»¶å†…å®¹æ‰å¯è¢«åˆ é™¤ã€‚<br>removeæ—¢èƒ½åˆ æ–‡ä»¶ï¼ˆç­‰åŒäºunlinkï¼‰ä¹Ÿèƒ½åˆ ç›®å½•ï¼ˆç­‰åŒäºrmdirï¼‰ã€‚</p><h3 id="rename-å’Œ-renameat"><a href="#rename-å’Œ-renameat" class="headerlink" title="rename å’Œ renameat"></a>rename å’Œ renameat</h3><p>ç”¨æ¥å¯¹æ–‡ä»¶é‡å‘½åã€‚</p><h3 id="ç¬¦å·é“¾æ¥"><a href="#ç¬¦å·é“¾æ¥" class="headerlink" title="ç¬¦å·é“¾æ¥"></a>ç¬¦å·é“¾æ¥</h3><p>ç¬¦å·é“¾æ¥æ˜¯å¯¹ä¸€ä¸ªæ–‡ä»¶çš„é—´æ¥æŒ‡é’ˆï¼Œç¡¬é“¾æ¥ç›´æ¥æŒ‡å‘æ–‡ä»¶çš„ièŠ‚ç‚¹ã€‚<br>ä½¿ç”¨symlinkæˆ–syslinkatå‡½æ•°åˆ›å»ºä¸€ä¸ªç¬¦å·é“¾æ¥ã€‚</p><h3 id="æ–‡ä»¶æ—¶é—´"><a href="#æ–‡ä»¶æ—¶é—´" class="headerlink" title="æ–‡ä»¶æ—¶é—´"></a>æ–‡ä»¶æ—¶é—´</h3><ul><li>st_atime æ–‡ä»¶æ•°æ®çš„æœ€åè®¿é—®æ—¶é—´</li><li>st_mtime æ–‡ä»¶æ•°æ®çš„æœ€åä¿®æ”¹æ—¶é—´</li><li>st_ctime ièŠ‚ç‚¹çŠ¶æ€çš„æœ€åæ›´æ”¹æ—¶é—´</li></ul><p>æ“ä½œå‡½æ•°ï¼š</p><ul><li>futimens</li><li>utimensat</li><li>utimes</li></ul><h2 id="æƒé™åŠå±ç»„"><a href="#æƒé™åŠå±ç»„" class="headerlink" title="æƒé™åŠå±ç»„"></a>æƒé™åŠå±ç»„</h2><h3 id="ç”¨æˆ·IDå’Œç»„ID"><a href="#ç”¨æˆ·IDå’Œç»„ID" class="headerlink" title="ç”¨æˆ·IDå’Œç»„ID"></a>ç”¨æˆ·IDå’Œç»„ID</h3><p>ä¸ä¸€ä¸ªè¿›ç¨‹ç›¸å…³è”çš„IDï¼š<br><img src="4-5.png" alt=""></p><ul><li>å®é™…ç”¨æˆ·IDå’Œå®é™…ç»„IDæ ‡è¯†æˆ‘ä»¬ç©¶ç«Ÿæ˜¯è°ã€‚è¿™ä¸¤ä¸ªå­—æ®µåœ¨ç™»å½•æ—¶å–è‡ªå£ä»¤æ–‡ä»¶ä¸­çš„ç™»å½•é¡¹ã€‚</li><li>æœ‰æ•ˆç”¨æˆ·IDã€æœ‰æ•ˆç»„IDä»¥åŠé™„å±ç»„IDå†³å®šäº†æˆ‘ä»¬çš„æ–‡ä»¶è®¿é—®æƒé™ã€‚</li><li>ä¿å­˜çš„è®¾ç½®ç”¨æˆ·IDå’Œä¿å­˜çš„è®¾ç½®ç»„IDåœ¨æ‰§è¡Œä¸€ä¸ªç¨‹åºæ—¶åŒ…å«äº†æœ‰æ•ˆç”¨æˆ·IDå’Œæœ‰æ•ˆç»„IDçš„ä¸€ä¸ªå‰¯æœ¬ã€‚</li></ul><p>æ‰§è¡Œä¸€ä¸ªç¨‹åºæ–‡ä»¶æ—¶ï¼Œè¿›ç¨‹çš„æœ‰æ•ˆç”¨æˆ·IDå°±æ˜¯å®é™…ç”¨æˆ·IDï¼Œæœ‰æ•ˆç»„IDå°±æ˜¯å®é™…ç»„IDã€‚ä½†å¯ä»¥åœ¨æ–‡ä»¶æ¨¡å¼å­—ï¼ˆst_modeï¼‰ä¸­è®¾ç½®ä¸€ä¸ªç‰¹æ®Šæ ‡å¿—ï¼Œå°†æ‰§è¡Œæ­¤æ–‡ä»¶æ—¶çš„æœ‰æ•ˆç”¨æˆ·IDè®¾ç½®ä¸ºæ–‡ä»¶æ‰€æœ‰è€…çš„ç”¨æˆ·IDï¼›æˆ–å°†æœ‰æ•ˆç»„IDè®¾ç½®ä¸ºæ–‡ä»¶çš„ç»„æ‰€æœ‰è€…IDã€‚</p><h3 id="æ–‡ä»¶è®¿é—®æƒé™"><a href="#æ–‡ä»¶è®¿é—®æƒé™" class="headerlink" title="æ–‡ä»¶è®¿é—®æƒé™"></a>æ–‡ä»¶è®¿é—®æƒé™</h3><p>st_modeå€¼ä¹ŸåŒ…å«äº†å¯¹æ–‡ä»¶çš„è®¿é—®æƒé™ä½ã€‚<br><img src="4-6.png" alt=""></p><ul><li>è¯»æƒé™å†³å®šäº†æˆ‘ä»¬èƒ½å¦æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶è¿›è¡Œè¯»æ“ä½œï¼ŒåŒ…æ‹¬è¯»ç›®å½•ä¸­çš„å†…å®¹ã€‚</li><li>å†™æƒé™å†³å®šäº†æˆ‘ä»¬èƒ½å¦æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶è¿›è¡Œå†™æ“ä½œã€‚</li><li>æ‰“å¼€ä»»ä¸€æ–‡ä»¶æ—¶è¦å¯¹å®ƒçš„æ¯ä¸€çº§çˆ¶ç›®å½•ï¼ˆåŒ…æ‹¬å½“å‰ç›®å½•ï¼‰æœ‰æ‰§è¡Œæƒé™ã€‚</li><li>åœ¨ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶éœ€è¦å¯¹è¯¥ç›®å½•æœ‰å†™å’Œæ‰§è¡Œæƒé™ã€‚</li><li>åˆ é™¤ä¸€ä¸ªç°æœ‰æ–‡ä»¶ï¼Œéœ€è¦å¯¹åŒ…å«è¯¥æ–‡ä»¶çš„ç›®å½•å…·æœ‰å†™å’Œæ‰§è¡Œæƒé™ï¼Œå¯¹è¯¥æ–‡ä»¶æœ¬èº«ä¸éœ€è¦æœ‰è¯»ã€å†™æƒé™ã€‚</li></ul><p><strong>ç›®å½•æ–‡ä»¶çš„è¯»æƒé™ï¼ˆrï¼‰å’Œå†™æƒé™ï¼ˆwï¼‰ï¼Œéƒ½æ˜¯é’ˆå¯¹ç›®å½•æ–‡ä»¶æœ¬èº«ã€‚ç”±äºç›®å½•æ–‡ä»¶å†…åªæœ‰æ–‡ä»¶åå’Œinodeå·ç ï¼Œæ‰€ä»¥å¦‚æœåªæœ‰è¯»æƒé™ï¼Œåªèƒ½è·å–æ–‡ä»¶åï¼Œæ— æ³•è·å–å…¶ä»–ä¿¡æ¯ï¼Œå› ä¸ºå…¶ä»–ä¿¡æ¯éƒ½å‚¨å­˜åœ¨inodeèŠ‚ç‚¹ä¸­ï¼Œè€Œè¯»å–inodeèŠ‚ç‚¹å†…çš„ä¿¡æ¯éœ€è¦ç›®å½•æ–‡ä»¶çš„æ‰§è¡Œæƒé™ï¼ˆxï¼‰ã€‚</strong></p><h3 id="æ–°æ–‡ä»¶å’Œç›®å½•çš„æ‰€æœ‰æƒ"><a href="#æ–°æ–‡ä»¶å’Œç›®å½•çš„æ‰€æœ‰æƒ" class="headerlink" title="æ–°æ–‡ä»¶å’Œç›®å½•çš„æ‰€æœ‰æƒ"></a>æ–°æ–‡ä»¶å’Œç›®å½•çš„æ‰€æœ‰æƒ</h3><ul><li>æ–°æ–‡ä»¶çš„ç”¨æˆ·IDè®¾ç½®ä¸ºè¿›ç¨‹çš„æœ‰æ•ˆç”¨æˆ·IDã€‚</li><li>æ–°æ–‡ä»¶çš„ç»„IDå¯ä»¥æ˜¯è¿›ç¨‹çš„æœ‰æ•ˆç»„IDä¹Ÿå¯ä»¥æ˜¯å®ƒæ‰€åœ¨çš„ç›®å½•çš„ç»„IDã€‚</li></ul><h3 id="access-å’Œ-faccessat"><a href="#access-å’Œ-faccessat" class="headerlink" title="access å’Œ faccessat"></a>access å’Œ faccessat</h3><p>ç”¨<code>open</code>å‡½æ•°æ‰“å¼€æ–‡ä»¶æ—¶ï¼Œå†…æ ¸ä»¥è¿›ç¨‹çš„æœ‰æ•ˆç”¨æˆ·IDå’Œæœ‰æ•ˆç»„IDåšè®¿é—®æƒé™æµ‹è¯•ï¼Œ<code>access</code>å’Œ<code>faccessat</code>å‡½æ•°æŒ‰å®é™…ç”¨æˆ·IDå’Œå®é™…ç»„IDè¿›è¡Œæµ‹è¯•ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">access</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *pathname, <span class="keyword">int</span> mode)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">faccess</span><span class="params">(<span class="keyword">int</span> fd, <span class="keyword">const</span> <span class="keyword">char</span> *pathname, <span class="keyword">int</span> mode ,<span class="keyword">int</span> flag)</span></span>;</span><br></pre></td></tr></table></figure><h3 id="umask"><a href="#umask" class="headerlink" title="umask"></a>umask</h3><p><code>umask</code>å‡½æ•°ä¸ºè¿›ç¨‹è®¾ç½®æ–‡ä»¶è†œåˆ›å»ºå±è”½å­—ï¼Œå¹¶è¿”å›ä¹‹å‰çš„å€¼ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/stat.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">mode_t</span> <span class="title">umask</span><span class="params">(<span class="keyword">mode_t</span> cmask)</span></span>;</span><br></pre></td></tr></table></figure><p><img src="4-10.png" alt=""></p><h3 id="chmodã€fchmodå’Œfchmodat"><a href="#chmodã€fchmodå’Œfchmodat" class="headerlink" title="chmodã€fchmodå’Œfchmodat"></a>chmodã€fchmodå’Œfchmodat</h3><p>è¿™ä¸‰ä¸ªå‡½æ•°ä½¿æˆ‘ä»¬æ›´æ”¹ç°æœ‰æ–‡ä»¶çš„è®¿é—®æƒé™ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/stat.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">chmod</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *pathname, <span class="keyword">mode_t</span> mode)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">fchmod</span><span class="params">(<span class="keyword">int</span> fd, <span class="keyword">mode_t</span> mode)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">fchmodat</span><span class="params">(<span class="keyword">int</span> fd, <span class="keyword">const</span> <span class="keyword">char</span> *pathname, <span class="keyword">mode_t</span> mode, <span class="keyword">int</span> flag)</span></span>;</span><br></pre></td></tr></table></figure><p><img src="4-11.png" alt=""></p><h3 id="ç²˜ç€ä½"><a href="#ç²˜ç€ä½" class="headerlink" title="ç²˜ç€ä½"></a>ç²˜ç€ä½</h3><p>UNIXæ—©æœŸç‰ˆæœ¬ä¸­ï¼ŒS_ISVTXä½è¢«ç§°ä¸º<code>ç²˜ç€ä½(sticky bit)</code>ã€‚å¦‚æœä¸€ä¸ªå¯æ‰§è¡Œç¨‹åºæ–‡ä»¶çš„è¿™ä¸€ä½è¢«è®¾ç½®äº†ï¼Œé‚£ä¹ˆå½“è¯¥ç¨‹åºç¬¬ä¸€æ¬¡è¢«æ‰§è¡Œï¼Œåœ¨å…¶ç»ˆæ­¢æ—¶ï¼Œç¨‹åºæ­£æ–‡éƒ¨åˆ†ï¼ˆæœºå™¨æŒ‡ä»¤ï¼‰çš„ä¸€ä¸ªå‰¯æœ¬ä»è¢«ä¿å­˜åœ¨äº¤æ¢åŒºã€‚è¿™ä½¿å¾—ä¸‹æ¬¡æ‰§è¡Œè¯¥ç¨‹åºæ—¶èƒ½è¾ƒå¿«çš„å°†å…¶è½½å…¥å†…å­˜ã€‚</p><h4 id="Linuxä¸­çš„äº¤æ¢åŒº"><a href="#Linuxä¸­çš„äº¤æ¢åŒº" class="headerlink" title="Linuxä¸­çš„äº¤æ¢åŒº"></a>Linuxä¸­çš„äº¤æ¢åŒº</h4><blockquote><p>Linuxä¸­Swapï¼ˆå³ï¼šäº¤æ¢åˆ†åŒºï¼‰ï¼Œç±»ä¼¼äºWindowsçš„è™šæ‹Ÿå†…å­˜ï¼Œå°±æ˜¯å½“å†…å­˜ä¸è¶³çš„æ—¶å€™ï¼ŒæŠŠä¸€éƒ¨åˆ†ç¡¬ç›˜ç©ºé—´è™šæ‹Ÿæˆå†…å­˜ä½¿ç”¨,ä»è€Œè§£å†³å†…å­˜å®¹é‡ä¸è¶³çš„æƒ…å†µã€‚Androidæ˜¯åŸºäºLinuxçš„æ“ä½œç³»ç»Ÿï¼Œæ‰€ä»¥ä¹Ÿå¯ä»¥ä½¿ç”¨Swapåˆ†åŒºæ¥æå‡ç³»ç»Ÿè¿è¡Œæ•ˆç‡ ã€‚</p></blockquote><p>ç°ä»Šäº¤å¿ƒçš„UNIXç³»ç»Ÿå¤§å¤šé…ç½®äº†è™šæ‹Ÿå­˜å‚¨ç³»ç»Ÿä»¥åŠå¿«é€Ÿæ–‡ä»¶ç³»ç»Ÿï¼Œä¸å†éœ€è¦è¿™ç§æŠ€æœ¯ã€‚<br>SUSå…è®¸é’ˆå¯¹ç›®å½•è®¾ç½®ç²˜ç€ä½ï¼Œç›®å½•/tmpå’Œ/var/tmpæ˜¯è®¾ç½®ç²˜ç€ä½çš„å…¸å‹å€™é€‰è€…â€”â€”ä»»ä½•ç”¨æˆ·éƒ½å¯åœ¨è¿™ä¸¤ä¸ªç›®å½•ä¸­åˆ›å»ºæ–‡ä»¶ï¼›ä»»ä¸€ç”¨æˆ·å¯¹è¿™ä¸¤ä¸ªç›®å½•çš„æƒé™é€šå¸¸éƒ½æ˜¯è¯»ã€å†™ã€æ‰§è¡Œã€‚</p><h3 id="chownã€fchownã€fchownatå’Œlchown"><a href="#chownã€fchownã€fchownatå’Œlchown" class="headerlink" title="chownã€fchownã€fchownatå’Œlchown"></a>chownã€fchownã€fchownatå’Œlchown</h3><p>è¿™å‡ ä¸ªå‡½æ•°æ›´æ”¹æ–‡ä»¶çš„ç”¨æˆ·IDå’Œç»„IDã€‚</p><h2 id="ç›®å½•"><a href="#ç›®å½•" class="headerlink" title="ç›®å½•"></a>ç›®å½•</h2><p>ç›®å½•ç”±DIRç»“æ„è¡¨ç¤ºï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line"><span class="keyword">int</span>__dd_fd;<span class="comment">// file descriptor associated with directory</span></span><br><span class="line"><span class="keyword">long</span>__dd_loc;<span class="comment">// offset in current buffer</span></span><br><span class="line"><span class="keyword">long</span>__dd_size;<span class="comment">// amount of data returned</span></span><br><span class="line"><span class="keyword">char</span>*__dd_buf;<span class="comment">// data buffer</span></span><br><span class="line"><span class="keyword">int</span>__dd_len;<span class="comment">// size of data buffer</span></span><br><span class="line"><span class="keyword">long</span>__dd_seek;<span class="comment">// magic cookie returned</span></span><br><span class="line">__unused <span class="keyword">long</span>__padding; <span class="comment">// (__dd_rewind space left for bincompat)</span></span><br><span class="line"><span class="keyword">int</span>__dd_flags;<span class="comment">// flags for readdir</span></span><br><span class="line"><span class="keyword">__darwin_pthread_mutex_t</span> __dd_lock; <span class="comment">// for thread locking</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> _<span class="title">telldir</span> *__<span class="title">dd_td</span>;</span> <span class="comment">// telldir position recording</span></span><br><span class="line">&#125; DIR;</span><br></pre></td></tr></table></figure><p>ç›®å½•é¡¹ direntç»“æ„ä¸å®ç°æœ‰å…³ï¼Œè‡³å°‘åŒ…å«ä¸‹åˆ—ä¸¤ä¸ªæˆå‘˜ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ino_t</span> d_ino; <span class="comment">//i-node number</span></span><br><span class="line"><span class="keyword">char</span> d_name[]; <span class="comment">//null-terminated filename</span></span><br></pre></td></tr></table></figure><p>è§†é¢‘ä¸­æåŠçš„ä¸€äº›ç½‘ç«™ğŸ”—</p><p>ç”µå­ä¹¦ä¸‹è½½ğŸ“–<br>Library Genesis:  gen.lib.rus.ec<br>Z library: zh.booksc.org<br>é¸ æ‘©æœä¹¦ï¼šjiumodiary.com<br>å­åˆä¹¦ç®€ï¼š5kindle.com</p><p>æ‚å¿—ä¸‹è½½ğŸ—<br>tianfateng.cn</p><p>è§†é¢‘åˆ¶ä½œåŠå‰ªè¾‘<br>Keynote/ Lumafusion</p><ul><li><code>mkdir</code>/<code>mkdirat</code> åˆ›å»ºç›®å½•</li><li><code>rmdir</code> åˆ é™¤ç›®å½•</li><li><code>opendir</code>/<code>fdopendir</code> æ‰“å¼€ç›®å½•</li><li><code>readdir</code> è¯»ä¸€ä¸ªç›®å½•é¡¹</li><li><code>rewinddir</code> å°†åç§»é‡é‡åˆ¶</li><li><code>closedir</code> å…³é—­æ–‡ä»¶</li><li><code>telldir</code> è·å–åç§»é‡</li><li><code>seekdir</code> æ›´æ”¹åç§»é‡</li></ul><p><strong>æœ‰æƒé™çš„ç”¨æˆ·éƒ½å¯ä»¥è¯»ç›®å½•ï¼Œä½†åªæœ‰å†…æ ¸æ‰å¯ä»¥å†™ç›®å½•ã€‚</strong></p><h3 id="å½“å‰å·¥ä½œç›®å½•"><a href="#å½“å‰å·¥ä½œç›®å½•" class="headerlink" title="å½“å‰å·¥ä½œç›®å½•"></a>å½“å‰å·¥ä½œç›®å½•</h3><p>æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰ä¸€ä¸ªå½“å‰å·¥ä½œç›®å½•ï¼Œå®ƒæ˜¯æœç´¢æ‰€æœ‰ç›¸å¯¹è·¯å¾„åçš„èµ·ç‚¹ã€‚</p><ul><li><code>chdir</code>/<code>fchdir</code> æŒ‡å®šæ–°çš„å½“å‰å·¥ä½œç›®å½•</li><li><code>getcwd</code> è·å–å½“å‰å·¥ä½œç›®å½•</li></ul>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;æ–‡ä»¶å±æ€§&quot;&gt;&lt;a href=&quot;#æ–‡ä»¶å±æ€§&quot; class=&quot;headerlink&quot; title=&quot;æ–‡ä»¶å±æ€§&quot;&gt;&lt;/a&gt;æ–‡ä»¶å±æ€§&lt;/h2&gt;&lt;h3 id=&quot;æ–‡ä»¶ç»“æ„-stat&quot;&gt;&lt;a href=&quot;#æ–‡ä»¶ç»“æ„-stat&quot; class=&quot;headerlink&quot; title=&quot;æ–‡ä»¶ç»“æ„ stat&quot;&gt;&lt;/a&gt;æ–‡ä»¶ç»“æ„ stat&lt;/h3&gt;&lt;figure class=&quot;highlight c&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;stat&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;mode_t&lt;/span&gt;            st_mode;    &lt;span class=&quot;comment&quot;&gt;// file type &amp;amp; mode (permisssions)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;ino_t&lt;/span&gt;             st_ino;     &lt;span class=&quot;comment&quot;&gt;// i-node number (serial number)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;dev_t&lt;/span&gt;             st_dev;     &lt;span class=&quot;comment&quot;&gt;// device number (file system)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;dev_t&lt;/span&gt;             st_rdev;    &lt;span class=&quot;comment&quot;&gt;// device number for special files&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;nlink_t&lt;/span&gt;           st_link;    &lt;span class=&quot;comment&quot;&gt;// number of links&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;uid_t&lt;/span&gt;             st_uid;     &lt;span class=&quot;comment&quot;&gt;// user ID of owner&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;gid_t&lt;/span&gt;             st_gid;     &lt;span class=&quot;comment&quot;&gt;// group ID of owner&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;off_t&lt;/span&gt;             st_size;    &lt;span class=&quot;comment&quot;&gt;// size in bytes, for regular files&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;timespec&lt;/span&gt;   &lt;span class=&quot;title&quot;&gt;st_atime&lt;/span&gt;;&lt;/span&gt;   &lt;span class=&quot;comment&quot;&gt;// time of last access&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;timespec&lt;/span&gt;   &lt;span class=&quot;title&quot;&gt;st_mtime&lt;/span&gt;;&lt;/span&gt;   &lt;span class=&quot;comment&quot;&gt;// time of last modification&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;timespec&lt;/span&gt;   &lt;span class=&quot;title&quot;&gt;st_ctime&lt;/span&gt;;&lt;/span&gt;   &lt;span class=&quot;comment&quot;&gt;// time of last file status change&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;blksize_t&lt;/span&gt;         st_blksize; &lt;span class=&quot;comment&quot;&gt;// best I/O block size å¯¹æ–‡ä»¶I/Oè¾ƒé€‚åˆçš„å—é•¿åº¦&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;blkcnt_t&lt;/span&gt;          st_blocks;  &lt;span class=&quot;comment&quot;&gt;// number of disk blocks allocated æ‰€åˆ†é…çš„å®é™…512å­—èŠ‚å—å—æ•°&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
      <category term="ã€ŠAPUEã€‹ç¬”è®°" scheme="https://akaqin.github.io/categories/%E3%80%8AAPUE%E3%80%8B%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="æ–‡ä»¶" scheme="https://akaqin.github.io/tags/%E6%96%87%E4%BB%B6/"/>
    
      <category term="ç›®å½•" scheme="https://akaqin.github.io/tags/%E7%9B%AE%E5%BD%95/"/>
    
  </entry>
  
  <entry>
    <title>ã€ŠUNIXç¯å¢ƒé«˜çº§ç¼–ç¨‹ã€‹ç¬¬2ç« â€”â€”UNIXæ ‡å‡†åŠå®ç°</title>
    <link href="https://akaqin.github.io/2020/04/14/%E3%80%8AUNIX%E7%8E%AF%E5%A2%83%E9%AB%98%E7%BA%A7%E7%BC%96%E7%A8%8B%E3%80%8B%E7%AC%AC2%E7%AB%A0%E2%80%94%E2%80%94UNIX%E6%A0%87%E5%87%86%E5%8F%8A%E5%AE%9E%E7%8E%B0/"/>
    <id>https://akaqin.github.io/2020/04/14/%E3%80%8AUNIX%E7%8E%AF%E5%A2%83%E9%AB%98%E7%BA%A7%E7%BC%96%E7%A8%8B%E3%80%8B%E7%AC%AC2%E7%AB%A0%E2%80%94%E2%80%94UNIX%E6%A0%87%E5%87%86%E5%8F%8A%E5%AE%9E%E7%8E%B0/</id>
    <published>2020-04-14T00:41:33.000Z</published>
    <updated>2020-04-14T01:26:49.096Z</updated>
    
    <content type="html"><![CDATA[<h2 id="UNIXæ ‡å‡†åŒ–"><a href="#UNIXæ ‡å‡†åŒ–" class="headerlink" title="UNIXæ ‡å‡†åŒ–"></a>UNIXæ ‡å‡†åŒ–</h2><h3 id="ISO-C"><a href="#ISO-C" class="headerlink" title="ISO C"></a>ISO C</h3><p>ISOï¼ˆå›½é™…æ ‡å‡†åŒ–ç»„ç»‡ï¼‰ Cæ ‡å‡†çš„æ„å›¾æ˜¯æä¾›Cç¨‹åºçš„å¯ç§»æ¤æ€§ï¼Œä½¿å…¶èƒ½é€‚åˆäºå¤§é‡ä¸åŒçš„æ“ä½œç³»ç»Ÿï¼Œè€Œä¸åªæ˜¯é€‚åˆUNIXç³»ç»Ÿã€‚æ­¤æ ‡å‡†ä¸ä»…å®šäº†Cç¨‹åºè®¾è®¡è¯­è¨€çš„è¯­æ³•å’Œè¯­ä¹‰ï¼Œè¿˜å®šä¹‰äº†å…¶æ ‡å‡†åº“ã€‚</p><h3 id="IEEE-POSIX"><a href="#IEEE-POSIX" class="headerlink" title="IEEE POSIX"></a>IEEE POSIX</h3><p>POSIXæ˜¯ç”±IEEEï¼ˆç”µæ°”å’Œç”µå­å·¥ç¨‹å¸ˆå­¦ä¼šï¼‰æŒ‡å®šçš„æ ‡å‡†æ—ã€‚POSIXæŒ‡çš„æ˜¯å¯ç§»æ¤æ“ä½œç³»ç»Ÿæ¥å£ã€‚</p><h3 id="Single-UNIX-Specification"><a href="#Single-UNIX-Specification" class="headerlink" title="Single UNIX Specification"></a>Single UNIX Specification</h3><p>Single UNIX Specificationï¼ˆSUSï¼Œå•ä¸€UNIXè§„èŒƒï¼‰æ˜¯POSIX.1æ ‡å‡†çš„ä¸€ä¸ªè¶…é›†ï¼Œå®ƒå®šä¹‰äº†ä¸€äº›é™„åŠ æ¥å£æ‰©å±•äº†POSIX.1è§„èŒƒæä¾›çš„åŠŸèƒ½ã€‚POSIX.1ç›¸å½“äºSingle UNIX Specificationä¸­çš„åŸºæœ¬è§„èŒƒéƒ¨åˆ†ã€‚</p><a id="more"></a><h2 id="UNIX-ç³»ç»Ÿå®ç°"><a href="#UNIX-ç³»ç»Ÿå®ç°" class="headerlink" title="UNIX ç³»ç»Ÿå®ç°"></a>UNIX ç³»ç»Ÿå®ç°</h2><h3 id="SVR4"><a href="#SVR4" class="headerlink" title="SVR4"></a>SVR4</h3><h3 id="4-4BSD"><a href="#4-4BSD" class="headerlink" title="4.4BSD"></a>4.4BSD</h3><h3 id="FreeBSD"><a href="#FreeBSD" class="headerlink" title="FreeBSD"></a>FreeBSD</h3><h3 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h3><h3 id="Mac-OS-X"><a href="#Mac-OS-X" class="headerlink" title="Mac OS X"></a>Mac OS X</h3><h3 id="Solaris"><a href="#Solaris" class="headerlink" title="Solaris"></a>Solaris</h3><h2 id="æ ‡å‡†å’Œå®ç°çš„å…³ç³»"><a href="#æ ‡å‡†å’Œå®ç°çš„å…³ç³»" class="headerlink" title="æ ‡å‡†å’Œå®ç°çš„å…³ç³»"></a>æ ‡å‡†å’Œå®ç°çš„å…³ç³»</h2><h2 id="é™åˆ¶"><a href="#é™åˆ¶" class="headerlink" title="é™åˆ¶"></a>é™åˆ¶</h2><p>ä»¥ä¸‹ä¸¤ç±»çš„é™åˆ¶æ˜¯å¿…é¡»çš„ï¼š</p><ul><li>ç¼–è¯‘æ—¶é™åˆ¶ï¼ˆä¾‹å¦‚ï¼ŒçŸ­æ•´å‹çš„æœ€å¤§å€¼æ˜¯ä»€ä¹ˆï¼‰</li><li>è¿è¡Œæ—¶é™åˆ¶ï¼ˆä¾‹å¦‚ï¼Œæ–‡ä»¶åæœ‰å¤šå°‘ä¸ªå­—ç¬¦ï¼‰</li></ul><p>ä¸ºäº†è§£å†³è¿™ç±»é—®é¢˜ï¼Œæä¾›äº†ä»¥ä¸‹3ç§é™åˆ¶ï¼š</p><ul><li>ç¼–è¯‘æ—¶é™åˆ¶ï¼ˆå¤´æ–‡ä»¶ï¼‰</li><li>ä¸æ–‡ä»¶æˆ–ç›®å½•æ— å…³çš„è¿è¡Œæ—¶é™åˆ¶ï¼ˆsysconfå‡½æ•°ï¼‰</li><li>ä¸æ–‡ä»¶æˆ–ç›®å½•æœ‰å…³çš„è¿è¡Œæ—¶é™åˆ¶ï¼ˆpathconfå’Œfpathconfå‡½æ•°ï¼‰</li></ul><h3 id="ISO-Cé™åˆ¶"><a href="#ISO-Cé™åˆ¶" class="headerlink" title="ISO Cé™åˆ¶"></a>ISO Cé™åˆ¶</h3><p><img src="2-6.png" alt=""><br><img src="2-7.png" alt=""></p><h3 id="POSIX-é™åˆ¶"><a href="#POSIX-é™åˆ¶" class="headerlink" title="POSIX é™åˆ¶"></a>POSIX é™åˆ¶</h3><p><img src="2-8.png" alt=""><br><img src="2-9.png" alt=""></p><h3 id="sysconfã€pathconfå’Œfpathconf"><a href="#sysconfã€pathconfå’Œfpathconf" class="headerlink" title="sysconfã€pathconfå’Œfpathconf"></a>sysconfã€pathconfå’Œfpathconf</h3><p>è¿è¡Œæ—¶é™åˆ¶å¯ä»¥è°ƒç”¨è¿™ä¸‰ä¸ªå‡½æ•°ä¹‹ä¸€è·å¾—</p><h2 id="åŸºæœ¬ç³»ç»Ÿæ•°æ®ç±»å‹"><a href="#åŸºæœ¬ç³»ç»Ÿæ•°æ®ç±»å‹" class="headerlink" title="åŸºæœ¬ç³»ç»Ÿæ•°æ®ç±»å‹"></a>åŸºæœ¬ç³»ç»Ÿæ•°æ®ç±»å‹</h2><p><img src="2-21.png" alt=""></p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;UNIXæ ‡å‡†åŒ–&quot;&gt;&lt;a href=&quot;#UNIXæ ‡å‡†åŒ–&quot; class=&quot;headerlink&quot; title=&quot;UNIXæ ‡å‡†åŒ–&quot;&gt;&lt;/a&gt;UNIXæ ‡å‡†åŒ–&lt;/h2&gt;&lt;h3 id=&quot;ISO-C&quot;&gt;&lt;a href=&quot;#ISO-C&quot; class=&quot;headerlink&quot; title=&quot;ISO C&quot;&gt;&lt;/a&gt;ISO C&lt;/h3&gt;&lt;p&gt;ISOï¼ˆå›½é™…æ ‡å‡†åŒ–ç»„ç»‡ï¼‰ Cæ ‡å‡†çš„æ„å›¾æ˜¯æä¾›Cç¨‹åºçš„å¯ç§»æ¤æ€§ï¼Œä½¿å…¶èƒ½é€‚åˆäºå¤§é‡ä¸åŒçš„æ“ä½œç³»ç»Ÿï¼Œè€Œä¸åªæ˜¯é€‚åˆUNIXç³»ç»Ÿã€‚æ­¤æ ‡å‡†ä¸ä»…å®šäº†Cç¨‹åºè®¾è®¡è¯­è¨€çš„è¯­æ³•å’Œè¯­ä¹‰ï¼Œè¿˜å®šä¹‰äº†å…¶æ ‡å‡†åº“ã€‚&lt;/p&gt;
&lt;h3 id=&quot;IEEE-POSIX&quot;&gt;&lt;a href=&quot;#IEEE-POSIX&quot; class=&quot;headerlink&quot; title=&quot;IEEE POSIX&quot;&gt;&lt;/a&gt;IEEE POSIX&lt;/h3&gt;&lt;p&gt;POSIXæ˜¯ç”±IEEEï¼ˆç”µæ°”å’Œç”µå­å·¥ç¨‹å¸ˆå­¦ä¼šï¼‰æŒ‡å®šçš„æ ‡å‡†æ—ã€‚POSIXæŒ‡çš„æ˜¯å¯ç§»æ¤æ“ä½œç³»ç»Ÿæ¥å£ã€‚&lt;/p&gt;
&lt;h3 id=&quot;Single-UNIX-Specification&quot;&gt;&lt;a href=&quot;#Single-UNIX-Specification&quot; class=&quot;headerlink&quot; title=&quot;Single UNIX Specification&quot;&gt;&lt;/a&gt;Single UNIX Specification&lt;/h3&gt;&lt;p&gt;Single UNIX Specificationï¼ˆSUSï¼Œå•ä¸€UNIXè§„èŒƒï¼‰æ˜¯POSIX.1æ ‡å‡†çš„ä¸€ä¸ªè¶…é›†ï¼Œå®ƒå®šä¹‰äº†ä¸€äº›é™„åŠ æ¥å£æ‰©å±•äº†POSIX.1è§„èŒƒæä¾›çš„åŠŸèƒ½ã€‚POSIX.1ç›¸å½“äºSingle UNIX Specificationä¸­çš„åŸºæœ¬è§„èŒƒéƒ¨åˆ†ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="ã€ŠAPUEã€‹ç¬”è®°" scheme="https://akaqin.github.io/categories/%E3%80%8AAPUE%E3%80%8B%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="UNIX" scheme="https://akaqin.github.io/tags/UNIX/"/>
    
  </entry>
  
  <entry>
    <title>ã€ŠUNIXç¯å¢ƒé«˜çº§ç¼–ç¨‹ã€‹ç¬¬1ç« â€”â€”UNIXåŸºç¡€çŸ¥è¯†</title>
    <link href="https://akaqin.github.io/2020/04/13/%E3%80%8AUNIX%E7%8E%AF%E5%A2%83%E9%AB%98%E7%BA%A7%E7%BC%96%E7%A8%8B%E3%80%8B%E7%AC%AC1%E7%AB%A0%E2%80%94%E2%80%94UNIX%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/"/>
    <id>https://akaqin.github.io/2020/04/13/%E3%80%8AUNIX%E7%8E%AF%E5%A2%83%E9%AB%98%E7%BA%A7%E7%BC%96%E7%A8%8B%E3%80%8B%E7%AC%AC1%E7%AB%A0%E2%80%94%E2%80%94UNIX%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/</id>
    <published>2020-04-13T13:57:59.000Z</published>
    <updated>2020-04-14T01:36:39.357Z</updated>
    
    <content type="html"><![CDATA[<h2 id="UNIX-ä½“ç³»ç»“æ„"><a href="#UNIX-ä½“ç³»ç»“æ„" class="headerlink" title="UNIX ä½“ç³»ç»“æ„"></a>UNIX ä½“ç³»ç»“æ„</h2><p>ä¸¥æ ¼æ„ä¹‰ä¸Šè¯´ï¼Œå¯å°†æ“ä½œç³»ç»Ÿå®šä¹‰ä¸ºä¸€ç§è½¯ä»¶ï¼Œå®ƒæ§åˆ¶è®¡ç®—æœºç¡¬ä»¶èµ„æºï¼Œæä¾›ç¨‹åºè¿è¡Œç¯å¢ƒã€‚æˆ‘ä»¬ç§°è¿™ç§è½¯ä»¶ä¸ºå†…æ ¸ï¼Œå†…æ ¸çš„æ¥å£è¢«ç§°ä¸º <strong>ç³»ç»Ÿè°ƒç”¨ï¼ˆsystem callï¼‰</strong>ã€‚<br>å¹¿ä¹‰ä¸Šè¯´ï¼Œæ“ä½œç³»ç»ŸåŒ…æ‹¬äº†å†…æ ¸å’Œä¸€äº›å…¶ä»–è½¯ä»¶ï¼Œè¿™äº›è½¯ä»¶ä½¿å¾—è®¡ç®—æœºèƒ½å¤Ÿå‘æŒ¥ä½œç”¨ï¼Œä½¿å…¶å…·æœ‰è‡ªå·±çš„ç‰¹æ€§ã€‚è¿™é‡Œè¯´çš„è½¯ä»¶åŒ…æ‹¬ç³»ç»Ÿå®ç”¨ç¨‹åºã€åº”ç”¨ç¨‹åºã€shellä»¥åŠå…¬ç”¨å‡½æ•°åº“ç­‰ã€‚<br>ä¾‹å¦‚ï¼ŒLinuxæ˜¯GNUæ“ä½œç³»ç»Ÿä½¿ç”¨çš„å†…æ ¸ã€‚<br><img src="1-1.png" alt=""></p><a id="more"></a><h2 id="ç™»å½•"><a href="#ç™»å½•" class="headerlink" title="ç™»å½•"></a>ç™»å½•</h2><h3 id="ç™»å½•å"><a href="#ç™»å½•å" class="headerlink" title="ç™»å½•å"></a>ç™»å½•å</h3><h3 id="shell"><a href="#shell" class="headerlink" title="shell"></a>shell</h3><h2 id="æ–‡ä»¶å’Œç›®å½•"><a href="#æ–‡ä»¶å’Œç›®å½•" class="headerlink" title="æ–‡ä»¶å’Œç›®å½•"></a>æ–‡ä»¶å’Œç›®å½•</h2><h3 id="æ–‡ä»¶ç³»ç»Ÿ"><a href="#æ–‡ä»¶ç³»ç»Ÿ" class="headerlink" title="æ–‡ä»¶ç³»ç»Ÿ"></a>æ–‡ä»¶ç³»ç»Ÿ</h3><h3 id="æ–‡ä»¶å"><a href="#æ–‡ä»¶å" class="headerlink" title="æ–‡ä»¶å"></a>æ–‡ä»¶å</h3><h3 id="ç›®å½•å"><a href="#ç›®å½•å" class="headerlink" title="ç›®å½•å"></a>ç›®å½•å</h3><h3 id="å·¥ä½œç›®å½•"><a href="#å·¥ä½œç›®å½•" class="headerlink" title="å·¥ä½œç›®å½•"></a>å·¥ä½œç›®å½•</h3><h3 id="èµ·å§‹ç›®å½•"><a href="#èµ·å§‹ç›®å½•" class="headerlink" title="èµ·å§‹ç›®å½•"></a>èµ·å§‹ç›®å½•</h3><h2 id="è¾“å…¥å’Œè¾“å‡º"><a href="#è¾“å…¥å’Œè¾“å‡º" class="headerlink" title="è¾“å…¥å’Œè¾“å‡º"></a>è¾“å…¥å’Œè¾“å‡º</h2><h3 id="æ–‡ä»¶æè¿°ç¬¦"><a href="#æ–‡ä»¶æè¿°ç¬¦" class="headerlink" title="æ–‡ä»¶æè¿°ç¬¦"></a>æ–‡ä»¶æè¿°ç¬¦</h3><h3 id="æ ‡å‡†è¾“å…¥ã€æ ‡å‡†è¾“å‡ºå’Œæ ‡å‡†é”™è¯¯"><a href="#æ ‡å‡†è¾“å…¥ã€æ ‡å‡†è¾“å‡ºå’Œæ ‡å‡†é”™è¯¯" class="headerlink" title="æ ‡å‡†è¾“å…¥ã€æ ‡å‡†è¾“å‡ºå’Œæ ‡å‡†é”™è¯¯"></a>æ ‡å‡†è¾“å…¥ã€æ ‡å‡†è¾“å‡ºå’Œæ ‡å‡†é”™è¯¯</h3><h3 id="ä¸å¸¦ç¼“å­˜çš„I-O"><a href="#ä¸å¸¦ç¼“å­˜çš„I-O" class="headerlink" title="ä¸å¸¦ç¼“å­˜çš„I/O"></a>ä¸å¸¦ç¼“å­˜çš„I/O</h3><p><code>open</code>ã€<code>read</code>ã€<code>write</code>ã€<code>lseek</code>ã€<code>close</code></p><h3 id="æ ‡å‡†I-O"><a href="#æ ‡å‡†I-O" class="headerlink" title="æ ‡å‡†I/O"></a>æ ‡å‡†I/O</h3><h2 id="ç¨‹åºå’Œè¿›ç¨‹"><a href="#ç¨‹åºå’Œè¿›ç¨‹" class="headerlink" title="ç¨‹åºå’Œè¿›ç¨‹"></a>ç¨‹åºå’Œè¿›ç¨‹</h2><h3 id="ç¨‹åº"><a href="#ç¨‹åº" class="headerlink" title="ç¨‹åº"></a>ç¨‹åº</h3><p>å­˜å‚¨åœ¨ç£ç›˜ä¸ŠæŸä¸ªç›®å½•ä¸­çš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚å†…æ ¸ä½¿ç”¨execå‡½æ•°å°†ç¨‹åºè¯»å…¥å†…å­˜ï¼Œå¹¶æ‰§è¡Œç¨‹åºã€‚</p><h3 id="è¿›ç¨‹å’Œè¿›ç¨‹ID"><a href="#è¿›ç¨‹å’Œè¿›ç¨‹ID" class="headerlink" title="è¿›ç¨‹å’Œè¿›ç¨‹ID"></a>è¿›ç¨‹å’Œè¿›ç¨‹ID</h3><p>ç¨‹åºçš„æ‰§è¡Œå®ä¾‹å«åšè¿›ç¨‹ã€‚</p><h3 id="è¿›ç¨‹æ§åˆ¶"><a href="#è¿›ç¨‹æ§åˆ¶" class="headerlink" title="è¿›ç¨‹æ§åˆ¶"></a>è¿›ç¨‹æ§åˆ¶</h3><p>3ä¸ªä¸»è¦çš„æ§åˆ¶å‡½æ•°ï¼š<code>fork</code>ã€<code>exec</code>å’Œ<code>waitpid</code></p><h3 id="çº¿ç¨‹å’Œçº¿ç¨‹ID"><a href="#çº¿ç¨‹å’Œçº¿ç¨‹ID" class="headerlink" title="çº¿ç¨‹å’Œçº¿ç¨‹ID"></a>çº¿ç¨‹å’Œçº¿ç¨‹ID</h3><h2 id="å‡ºé”™å¤„ç†"><a href="#å‡ºé”™å¤„ç†" class="headerlink" title="å‡ºé”™å¤„ç†"></a>å‡ºé”™å¤„ç†</h2><p>UNIXå‡½æ•°å‡ºé”™æ—¶ï¼Œé€šå¸¸è¿”å›ä¸€ä¸ªè´Ÿå€¼ï¼Œè€Œä¸”æ•´å‹å˜é‡errnoé€šå¸¸è¢«è®¾ç½®ä¸ºç‰¹å®šçš„å€¼ã€‚</p><h3 id="å‡ºé”™æ¢å¤"><a href="#å‡ºé”™æ¢å¤" class="headerlink" title="å‡ºé”™æ¢å¤"></a>å‡ºé”™æ¢å¤</h3><p>è‡´å‘½æ€§é”™è¯¯æ— æ³•æ¢å¤ï¼›éè‡´å‘½æ€§é”™è¯¯å¯ä»¥æ¢å¤ã€‚</p><h2 id="ç”¨æˆ·æ ‡è¯†"><a href="#ç”¨æˆ·æ ‡è¯†" class="headerlink" title="ç”¨æˆ·æ ‡è¯†"></a>ç”¨æˆ·æ ‡è¯†</h2><h3 id="ç”¨æˆ·ID"><a href="#ç”¨æˆ·ID" class="headerlink" title="ç”¨æˆ·ID"></a>ç”¨æˆ·ID</h3><h3 id="ç»„ID"><a href="#ç»„ID" class="headerlink" title="ç»„ID"></a>ç»„ID</h3><h3 id="é™„å±ç»„ID"><a href="#é™„å±ç»„ID" class="headerlink" title="é™„å±ç»„ID"></a>é™„å±ç»„ID</h3><h2 id="ä¿¡å·"><a href="#ä¿¡å·" class="headerlink" title="ä¿¡å·"></a>ä¿¡å·</h2><h2 id="æ—¶é—´å€¼"><a href="#æ—¶é—´å€¼" class="headerlink" title="æ—¶é—´å€¼"></a>æ—¶é—´å€¼</h2><p>UNIXä½¿ç”¨è¿‡ä¸¤ç§ä¸åŒçš„æ—¶é—´å€¼ï¼š</p><ul><li>æ—¥å†æ—¶é—´ï¼Œtime_t</li><li>è¿›ç¨‹æ—¶é—´/CPUæ—¶é—´ï¼Œä»¥æ—¶é’Ÿæ»´ç­”è®¡ç®—ï¼Œclock_t</li></ul><p>åº¦é‡ä¸€ä¸ªè¿›ç¨‹çš„æ‰§è¡Œæ—¶é—´æ—¶ï¼ŒUNIXç³»ç»Ÿä¸ºè¿›ç¨‹ç»´æŠ¤äº†3ä¸ªè¿›ç¨‹æ—¶é—´å€¼ï¼š</p><ul><li>æ—¶é’Ÿæ—¶é—´/å¢™ä¸Šæ—¶é’Ÿæ—¶é—´</li><li>ç”¨æˆ·CPUæ—¶é—´</li><li>ç³»ç»ŸCPUæ—¶é—´</li></ul><p>ç”¨æˆ·CPUæ—¶é—´ + ç³»ç»ŸCPUæ—¶é—´ = CPUæ—¶é—´</p><h2 id="ç³»ç»Ÿè°ƒç”¨å’Œåº“å‡½æ•°"><a href="#ç³»ç»Ÿè°ƒç”¨å’Œåº“å‡½æ•°" class="headerlink" title="ç³»ç»Ÿè°ƒç”¨å’Œåº“å‡½æ•°"></a>ç³»ç»Ÿè°ƒç”¨å’Œåº“å‡½æ•°</h2><p><img src="1-11.png" alt=""></p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;UNIX-ä½“ç³»ç»“æ„&quot;&gt;&lt;a href=&quot;#UNIX-ä½“ç³»ç»“æ„&quot; class=&quot;headerlink&quot; title=&quot;UNIX ä½“ç³»ç»“æ„&quot;&gt;&lt;/a&gt;UNIX ä½“ç³»ç»“æ„&lt;/h2&gt;&lt;p&gt;ä¸¥æ ¼æ„ä¹‰ä¸Šè¯´ï¼Œå¯å°†æ“ä½œç³»ç»Ÿå®šä¹‰ä¸ºä¸€ç§è½¯ä»¶ï¼Œå®ƒæ§åˆ¶è®¡ç®—æœºç¡¬ä»¶èµ„æºï¼Œæä¾›ç¨‹åºè¿è¡Œç¯å¢ƒã€‚æˆ‘ä»¬ç§°è¿™ç§è½¯ä»¶ä¸ºå†…æ ¸ï¼Œå†…æ ¸çš„æ¥å£è¢«ç§°ä¸º &lt;strong&gt;ç³»ç»Ÿè°ƒç”¨ï¼ˆsystem callï¼‰&lt;/strong&gt;ã€‚&lt;br&gt;å¹¿ä¹‰ä¸Šè¯´ï¼Œæ“ä½œç³»ç»ŸåŒ…æ‹¬äº†å†…æ ¸å’Œä¸€äº›å…¶ä»–è½¯ä»¶ï¼Œè¿™äº›è½¯ä»¶ä½¿å¾—è®¡ç®—æœºèƒ½å¤Ÿå‘æŒ¥ä½œç”¨ï¼Œä½¿å…¶å…·æœ‰è‡ªå·±çš„ç‰¹æ€§ã€‚è¿™é‡Œè¯´çš„è½¯ä»¶åŒ…æ‹¬ç³»ç»Ÿå®ç”¨ç¨‹åºã€åº”ç”¨ç¨‹åºã€shellä»¥åŠå…¬ç”¨å‡½æ•°åº“ç­‰ã€‚&lt;br&gt;ä¾‹å¦‚ï¼ŒLinuxæ˜¯GNUæ“ä½œç³»ç»Ÿä½¿ç”¨çš„å†…æ ¸ã€‚&lt;br&gt;&lt;img src=&quot;1-1.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="ã€ŠAPUEã€‹ç¬”è®°" scheme="https://akaqin.github.io/categories/%E3%80%8AAPUE%E3%80%8B%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="UNIX" scheme="https://akaqin.github.io/tags/UNIX/"/>
    
  </entry>
  
  <entry>
    <title>ã€ŠUNIXç¯å¢ƒé«˜çº§ç¼–ç¨‹ã€‹ç¬¬14ç« â€”â€”é«˜çº§I/O</title>
    <link href="https://akaqin.github.io/2020/04/11/%E3%80%8AUNIX%E7%8E%AF%E5%A2%83%E9%AB%98%E7%BA%A7%E7%BC%96%E7%A8%8B%E3%80%8B%E7%AC%AC14%E7%AB%A0%E2%80%94%E2%80%94%E9%AB%98%E7%BA%A7I-O/"/>
    <id>https://akaqin.github.io/2020/04/11/%E3%80%8AUNIX%E7%8E%AF%E5%A2%83%E9%AB%98%E7%BA%A7%E7%BC%96%E7%A8%8B%E3%80%8B%E7%AC%AC14%E7%AB%A0%E2%80%94%E2%80%94%E9%AB%98%E7%BA%A7I-O/</id>
    <published>2020-04-11T06:01:11.000Z</published>
    <updated>2020-04-14T12:52:47.026Z</updated>
    
    <content type="html"><![CDATA[<h2 id="åŸºç¡€æ¦‚å¿µ"><a href="#åŸºç¡€æ¦‚å¿µ" class="headerlink" title="åŸºç¡€æ¦‚å¿µ"></a>åŸºç¡€æ¦‚å¿µ</h2><h3 id="åŒæ­¥ï¼Œå¼‚æ­¥ï¼Œé˜»å¡ï¼Œéé˜»å¡"><a href="#åŒæ­¥ï¼Œå¼‚æ­¥ï¼Œé˜»å¡ï¼Œéé˜»å¡" class="headerlink" title="åŒæ­¥ï¼Œå¼‚æ­¥ï¼Œé˜»å¡ï¼Œéé˜»å¡"></a>åŒæ­¥ï¼Œå¼‚æ­¥ï¼Œé˜»å¡ï¼Œéé˜»å¡</h3><p><strong>åŒæ­¥ä¸å¼‚æ­¥</strong><br>åŒæ­¥æ˜¯æŒ‡ä»£ç è°ƒç”¨IOæ“ä½œæ—¶ï¼Œå¿…é¡»ç­‰å¾…IOæ“ä½œå®Œæˆæ‰è¿”å›çš„è°ƒç”¨æ–¹å¼ã€‚<br>å¼‚æ­¥æ˜¯æŒ‡ä»£ç è°ƒç”¨IOæ“ä½œæ—¶ï¼Œä¸å¿…ç­‰IOæ“ä½œå®Œæˆå°±è¿”å›çš„è°ƒç”¨æ–¹å¼ã€‚</p><p>åŒæ­¥æ˜¯æœ€åŸå§‹çš„è°ƒç”¨æ–¹å¼ã€‚<br>å¼‚æ­¥åˆ™éœ€è¦å¤šçº¿ç¨‹ï¼Œå¤šCPUæˆ–è€…éé˜»å¡IOçš„æ”¯æŒã€‚<br><strong>é˜»å¡ä¸éé˜»å¡</strong><br>é˜»å¡æ˜¯æŒ‡è°ƒç”¨çº¿ç¨‹æˆ–è€…è¿›ç¨‹è¢«æ“ä½œç³»ç»ŸæŒ‚èµ·ã€‚<br>éé˜»å¡æ˜¯æŒ‡è°ƒç”¨çº¿ç¨‹æˆ–è€…è¿›ç¨‹ä¸ä¼šè¢«æ“ä½œç³»ç»ŸæŒ‚èµ·ã€‚</p><p>æ²¡æœ‰IOæ“ä½œï¼Œæ‰€æœ‰çš„ä»£ç åŸºæœ¬éƒ½æ˜¯åŒæ­¥çš„<br>æœ‰äº†IOæ“ä½œåï¼Œå¦‚æœæ²¡æœ‰å¤šè¿›ç¨‹å¤šçº¿ç¨‹ï¼Œæ‰€æœ‰ä»£ç è¿˜æ˜¯åŒæ­¥çš„<br>æœ‰äº†IOæ“ä½œï¼Œæœ‰äº†å¤šè¿›ç¨‹å¤šçº¿ç¨‹ï¼Œä»£ç æ‰æœ‰äº†å¼‚æ­¥çš„å¯èƒ½æ€§ï¼ŒåŒæ—¶ä¹Ÿäº§ç”Ÿäº†é˜»å¡ä¸éé˜»å¡</p><a id="more"></a><h3 id="â€ä½é€Ÿâ€œç³»ç»Ÿè°ƒç”¨ï¼ˆé˜»å¡çš„åŸå› ï¼‰"><a href="#â€ä½é€Ÿâ€œç³»ç»Ÿè°ƒç”¨ï¼ˆé˜»å¡çš„åŸå› ï¼‰" class="headerlink" title="â€ä½é€Ÿâ€œç³»ç»Ÿè°ƒç”¨ï¼ˆé˜»å¡çš„åŸå› ï¼‰"></a>â€ä½é€Ÿâ€œç³»ç»Ÿè°ƒç”¨ï¼ˆé˜»å¡çš„åŸå› ï¼‰</h3><p>ç³»ç»Ÿè°ƒç”¨åˆ†ä¸ºä¸¤ç±»ï¼šâ€œä½é€Ÿâ€ç³»ç»Ÿè°ƒç”¨å’Œå…¶ä»–ã€‚<br>ä½é€Ÿç³»ç»Ÿè°ƒç”¨æ˜¯å¯èƒ½ä¼šä½¿è¿›ç¨‹æ°¸è¿œé˜»å¡çš„ä¸€ç±»ç³»ç»Ÿè°ƒç”¨ï¼ŒåŒ…æ‹¬ï¼š</p><ul><li>å¦‚æœæŸäº›æ–‡ä»¶ç±»å‹ï¼ˆå¦‚è¯»ç®¡é“ã€ç»ˆç«¯è®¾å¤‡å’Œç½‘ç»œè®¾å¤‡ï¼‰çš„æ•°æ®å¹¶ä¸å­˜åœ¨ï¼Œè¯»æ“ä½œå¯èƒ½ä¼šä½¿è°ƒç”¨è€…æ°¸è¿œé˜»å¡ï¼›</li><li>å¦‚æœæ•°æ®ä¸èƒ½è¢«ç›¸åŒçš„æ–‡ä»¶ç±»å‹ç«‹å³æ¥å—ï¼ˆå¦‚ç®¡é“ä¸­æ— ç©ºé—´ã€ç½‘ç»œæµæ§åˆ¶ï¼‰ï¼Œå†™æ“ä½œå¯èƒ½ä¼šä½¿è°ƒç”¨è€…æ°¸è¿œé˜»å¡ï¼›</li><li>åœ¨æŸç§æ¡ä»¶å‘ç”Ÿä¹‹å‰æ‰“å¼€æŸäº›æ–‡ä»¶ç±»å‹å¯èƒ½ä¼šå‘ç”Ÿé˜»å¡ï¼ˆå¦‚æ‰“å¼€ä¸€ä¸ªç»ˆç«¯è®¾å¤‡ï¼Œéœ€è¦å…ˆç­‰å¾…ä¸ä¹‹è¿æ¥çš„è°ƒåˆ¶è§£è°ƒå™¨åº”ç­”ï¼‰</li><li>å¯¹å·²ç»åŠ ä¸Šå¼ºåˆ¶æ€§è®°å½•é”çš„æ–‡ä»¶è¿›è¡Œè¯»å†™ï¼›</li><li>æŸäº›ioctlæ“ä½œï¼›</li><li>æŸäº›è¿›ç¨‹é—´é€šä¿¡å‡½æ•°ï¼›</li></ul><p><strong>è™½ç„¶è¯»å†™ç£ç›˜æ–‡ä»¶ä¼šæš‚æ—¶é˜»å¡è°ƒç”¨è€…ï¼Œä½†å¹¶ä¸èƒ½å°†ä¸ç£ç›˜I/Oæœ‰å…³çš„ç³»ç»Ÿè°ƒç”¨è§†ä¸ºâ€ä½é€Ÿâ€œ</strong></p><h2 id="é˜»å¡I-O"><a href="#é˜»å¡I-O" class="headerlink" title="é˜»å¡I/O"></a>é˜»å¡I/O</h2><p>é˜»å¡I/Oåˆ°å¤„å¯è§ï¼Œæ¯”å¦‚ä»ä¸€ä¸ªæè¿°ç¬¦è¯»ï¼Œç„¶ååˆå†™åˆ°å¦ä¸€ä¸ªæè¿°ç¬¦ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> (n=<span class="built_in">read</span>(STDIN_FILENO, buf, BUFSIZE)) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">write</span>(STDOUT_FILENO, buf, n) != n) &#123;</span><br><span class="line">    err_sys(<span class="string">"write error"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="éé˜»å¡I-O"><a href="#éé˜»å¡I-O" class="headerlink" title="éé˜»å¡I/O"></a>éé˜»å¡I/O</h2><p>éé˜»å¡I/Oæ˜¯æˆ‘ä»¬å¯ä»¥å‘å‡º openã€read å’Œ write è¿™æ ·çš„I/Oæ“ä½œï¼Œå¹¶ä½¿è¿™äº›æ“ä½œä¸ä¼šæ°¸è¿œé˜»å¡ã€‚å¦‚æœè¿™ç§æ“ä½œä¸èƒ½å®Œæˆï¼Œåˆ™è°ƒç”¨ç«‹å³å‡ºé”™è¿”å›ï¼Œè¡¨ç¤ºè¯¥æ“ä½œå¦‚ç»§ç»­æ‰§è¡Œå°†é˜»å¡ã€‚<br>å¯¹äºä¸€ä¸ªç»™å®šçš„æè¿°ç¬¦ï¼Œæœ‰ä¸¤ç§ä¸ºå…¶æŒ‡å®šéé˜»å¡I/Oçš„æ–¹æ³•ï¼š</p><ul><li>å¦‚æœè°ƒç”¨ open è·å¾—æè¿°ç¬¦ï¼Œå¯æŒ‡å®š O_NONBLOCK æ ‡å¿—ã€‚</li><li>å¯¹äºå·²ç»æ‰“å¼€çš„æè¿°ç¬¦ï¼Œåˆ™å¯è°ƒç”¨ fcntl æ‰“å¼€ O_NONBLOCK æ–‡ä»¶çŠ¶æ€æ ‡å¿—ã€‚</li></ul><h2 id="è®°å½•é”"><a href="#è®°å½•é”" class="headerlink" title="è®°å½•é”"></a>è®°å½•é”</h2><p>è®°å½•é”çš„åŠŸèƒ½æ˜¯ï¼šå½“ç¬¬ä¸€ä¸ªè¿›ç¨‹æ­£åœ¨è¯»æˆ–ä¿®æ”¹æ–‡ä»¶çš„æŸä¸ªéƒ¨åˆ†æ—¶ï¼Œä½¿ç”¨è®°å½•é”å¯ä»¥é˜»æ­¢å…¶ä»–è¿›ç¨‹ä¿®æ”¹åŒä¸€æ–‡ä»¶åŒºã€‚å®ƒé”å®šçš„åªæ˜¯æ–‡ä»¶ä¸­çš„ä¸€ä¸ªåŒºåŸŸï¼ˆä¹Ÿå¯èƒ½æ˜¯æ•´ä¸ªæ–‡ä»¶ï¼‰ã€‚<br>è®°å½•é”åœ¨å„ç§ç³»ç»Ÿç§æœ‰ä¸åŒçš„å½¢å¼ï¼ŒPOSIXã€‚1æ ‡å‡†çš„åŸºç¡€æ˜¯fcntlæ–¹æ³•ã€‚<br><img src="14-2.png" alt=""></p><h3 id="fcntl-è®°å½•é”"><a href="#fcntl-è®°å½•é”" class="headerlink" title="fcntl è®°å½•é”"></a>fcntl è®°å½•é”</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">fcntl</span><span class="params">(<span class="keyword">int</span> fd, <span class="keyword">int</span> cmd, ...<span class="comment">/* struct flock *flockptr */</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">flock</span> &#123;</span></span><br><span class="line">  short l_type;   <span class="comment">/* é”ç±»å‹ï¼ŒF_RDLOCKï¼ˆå…±äº«è¯»é”ï¼‰ã€F_WRLCKï¼ˆç‹¬å å†™é”ï¼‰æˆ– F_UNLCK ï¼ˆè§£é”ä¸€ä¸ªåŒºåŸŸï¼‰ */</span></span><br><span class="line">  short l_whence; <span class="comment">/* æ ¹æºï¼ˆä»ä»€ä¹ˆåœ°æ–¹å¼€å§‹)ï¼šSEEK_SETã€SEEK_CUR or SEEK_END */</span></span><br><span class="line">  <span class="keyword">off_t</span> l_start;  <span class="comment">/* å’Œ l_whence å…±åŒç»„æˆè¦åŠ é”/è§£é”åŒºåŸŸçš„å…¶å®å­—èŠ‚åç§»é‡ */</span></span><br><span class="line">  <span class="keyword">off_t</span> l_len;    <span class="comment">/* åŠ é”/è§£é”åŒºåŸŸçš„å­—èŠ‚é•¿åº¦ */</span></span><br><span class="line">  <span class="keyword">off_t</span> l_pid;    <span class="comment">/* è¿›ç¨‹çš„IDï¼ˆl_pidï¼‰æŒæœ‰çš„é”èƒ½é˜»å¡å½“å‰è¿›ç¨‹ï¼ˆä»…ç”± F_GETLK è¿”å›ï¼‰ */</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>å…±äº«è¯»é”ï¼ˆL_RDLCKï¼‰å’Œç‹¬å æ€§å†™é”ï¼ˆL_WRLCKï¼‰ã€‚ä»»æ„å¤šä¸ªè¿›ç¨‹åœ¨ä¸€ä¸ªç»™å®šçš„å­—èŠ‚ä¸Šå¯ä»¥å„è‡ªæœ‰ä¸€æŠŠå…±äº«çš„è¯»é”ï¼Œä½†æ˜¯åœ¨ä¸€ä¸ªç»™å®šå­—èŠ‚ä¸Šåªèƒ½æœ‰ä¸€ä¸ªè¿›ç¨‹æœ‰ä¸€æŠŠç‹¬å å†™é”ã€‚<br>è¿›ä¸€æ­¥è€Œè¨€ï¼Œå¦‚æœåœ¨ä¸€ä¸ªç»™å®šå­—èŠ‚ä¸Šå·²ç»æœ‰ä¸€æŠŠæˆ–å¤šæŠŠè¯»é”ï¼Œåˆ™ä¸èƒ½åœ¨è¯¥å­—èŠ‚ä¸Šå†åŠ å†™é”ï¼›å¦‚æœä¸€ä¸ªå­—èŠ‚ä¸Šå·²ç»æœ‰ä¸€æŠŠç‹¬å å†™é”ï¼Œåˆ™ä¸èƒ½å†å¯¹å®ƒåŠ ä»»ä½•é”ã€‚<br>å•ä¸ªè¿›ç¨‹æå‡ºå¤šä¸ªé”è¯·æ±‚æ—¶ï¼Œæ–°é”å°†æ›¿æ¢å°±é”ã€‚<br><img src="14-3.png" alt=""><br>åŠ è¯»é”æ—¶ï¼Œæè¿°ç¬¦å¿…é¡»æ˜¯è¯»æ‰“å¼€ï¼›åŠ å†™é”æ—¶ï¼Œæè¿°ç¬¦å¿…é¡»æ˜¯å†™æ‰“å¼€ï¼›<br><strong>é¢‘ç¹çš„åŠ è¯»é”å¯èƒ½ä¼šæŠŠè¯·æ±‚å†™é”çš„è¿›ç¨‹ç»™é¥¿æ­»</strong><br>é”ä¼šè‡ªåŠ¨çš„åˆ†è£‚å’Œç»„åˆï¼š<br><img src="14-4.png" alt=""></p><h4 id="æ­»é”"><a href="#æ­»é”" class="headerlink" title="æ­»é”"></a>æ­»é”</h4><p>å¦‚æœä¸¤ä¸ªè¿›ç¨‹ç›¸äº’ç­‰å¾…å¯¹æ–¹æŒæœ‰çš„é”å¹¶åˆ‡ä¸é‡Šæ”¾è‡ªå·±æŒæœ‰çš„é”æ—¶ï¼Œè¿™ä¸¤ä¸ªè¿›ç¨‹å°±è¿›å…¥äº†æ­»é”çš„çŠ¶æ€ã€‚</p><h3 id="é”çš„éšå«ç»§æ‰¿å’Œé‡Šæ”¾"><a href="#é”çš„éšå«ç»§æ‰¿å’Œé‡Šæ”¾" class="headerlink" title="é”çš„éšå«ç»§æ‰¿å’Œé‡Šæ”¾"></a>é”çš„éšå«ç»§æ‰¿å’Œé‡Šæ”¾</h3><ul><li>é”ä¸è¿›ç¨‹å’Œæ–‡ä»¶ä¸¤è€…ç›¸å…³è”ï¼š<ol><li>å½“ä¸€ä¸ªè¿›ç¨‹ç»ˆæ­¢æ—¶ï¼Œå®ƒæ‰€å»ºç«‹çš„é”å…¨éƒ¨é‡Šæ”¾ï¼›</li><li>æ— è®ºä¸€ä¸ªæè¿°ç¬¦åˆé€‚å…³é—­ï¼Œè¯¥è¿›ç¨‹é€šè¿‡è¿™ä¸€æè¿°ç¬¦å¼•ç”¨çš„æ–‡ä»¶ä¸Šçš„ä»»ä½•ä¸€æŠŠé”éƒ½ä¼šé‡Šæ”¾ã€‚</li></ol></li><li>ç”± fork äº§ç”Ÿçš„å­è¿›ç¨‹ä¸ç»§æ‰¿çˆ¶è¿›ç¨‹æ‰€è®¾ç½®çš„é”ã€‚å› ä¸ºé”çš„ä½œç”¨æ˜¯é˜»æ­¢å¤šä¸ªè¿›ç¨‹åŒæ—¶å†™åŒä¸€ä¸ªæ–‡ä»¶ã€‚</li><li>åœ¨æ‰§è¡Œ exec åï¼Œæ–°ç¨‹åºå¯ä»¥ç»§æ‰¿åŸæ‰§è¡Œç¨‹åºçš„é”ã€‚</li></ul><h3 id="FreeBSD-å®ç°"><a href="#FreeBSD-å®ç°" class="headerlink" title="FreeBSD å®ç°"></a>FreeBSD å®ç°</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">fd1 = <span class="built_in">open</span>(pathname, ...);</span><br><span class="line">write_lock(fd1, <span class="number">0</span>, SEEK_SET, <span class="number">1</span>);  <span class="comment">/* parent write locks byte 0 */</span></span><br><span class="line"><span class="keyword">if</span> ((pid = fork()) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">  fd2 = dump(fd1);</span><br><span class="line">  fd3 = <span class="built_in">open</span>(pathname, ...);</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (pid == <span class="number">0</span>) &#123;</span><br><span class="line">  read_lock(fd1, <span class="number">1</span>, SEEK_SET, <span class="number">1</span>);  <span class="comment">/* child read locks byte 1 * /</span></span><br><span class="line"><span class="comment">&#125;</span></span><br></pre></td></tr></table></figure><p><img src="14-8.png" alt=""><br><strong>é”ç»“æ„çš„æŒ‡é’ˆæ”¾åœ¨äº†vèŠ‚ç‚¹ï¼ˆLinuxé‡Œæ˜¯ié€šç”¨èŠ‚ç‚¹ï¼‰ç»“æ„é‡Œã€‚</strong><br>åœ¨çˆ¶è¿›ç¨‹ä¸­ï¼Œå…³é—­ fd1ã€fd2 æˆ– fd3 ä¸­çš„ä»»æ„ä¸€ä¸ªéƒ½å°†é‡Šæ”¾ç”±çˆ¶è¿›ç¨‹è®¾ç½®çš„å†™é”ã€‚åœ¨å…³é—­è¿™ä¸‰ä¸ªä¸­çš„ä»»æ„ä¸€ä¸ªhæ—¶ï¼Œå†…æ ¸ä¼šä»è¯¥æè¿°ç¬¦é”å…³è”çš„ièŠ‚ç‚¹å¼€å§‹ï¼Œé€ä¸ªæ£€æŸ¥ lockf é“¾æ¥è¡¨ä¸­çš„å„é¡¹ï¼Œå¹¶é‡Šæ”¾ç”±è°ƒç”¨è¿›ç¨‹æŒæœ‰çš„å„æŠŠé”ã€‚å†…æ ¸å¹¶ä¸æ¸…æ¥šï¼ˆä¹Ÿä¸å…³å¿ƒï¼‰çˆ¶è¿›ç¨‹æ˜¯ç”¨è¿™ä¸‰ä¸ªä¸­çš„å“ªä¸ªæè¿°ç¬¦æ¥è®¾ç½®è¿™æŠŠé”çš„ã€‚</p><h3 id="å»ºè®®é”å’Œå¼ºåˆ¶é”"><a href="#å»ºè®®é”å’Œå¼ºåˆ¶é”" class="headerlink" title="å»ºè®®é”å’Œå¼ºåˆ¶é”"></a>å»ºè®®é”å’Œå¼ºåˆ¶é”</h3><p>è€ƒè™‘æ•°æ®åº“è®¿é—®ä¾‹ç¨‹åº“ã€‚å¦‚æœè¯¥åº“ä¸­æ‰€æœ‰å‡½æ•°éƒ½ä»¥ä¸€è‡´çš„æ–¹æ³•å¤„ç†è®°å½•é”ï¼Œåˆ™ç§°ä½¿ç”¨è¿™äº›å‡½æ•°è®¿é—®æ•°æ®åº“çš„è¿›ç¨‹é›†ä¸º<code>åˆä½œè¿›ç¨‹ï¼ˆcooperating processï¼‰</code>ã€‚å¦‚æœè¿™äº›å‡½æ•°æ˜¯å”¯ä¸€åœ°ç”¨æ¥è®¿é—®æ•°æ®åº“çš„å‡½æ•°ï¼Œé‚£ä¹ˆå®ƒä»¬ä½¿ç”¨å»ºè®®é”æ˜¯å¯è¡Œçš„ã€‚ä½†å»ºè®®é”ä¸èƒ½é˜»æ­¢å¯¹æ•°æ®åº“æ–‡ä»¶æœ‰å†™æƒé™çš„ä»»ä½•å…¶ä»–è¿›ç¨‹å†™è¿™ä¸ªæ•°æ®åº“æ–‡ä»¶ã€‚ä¸å®ç”¨æ•°æ®åº“è®¿é—®ä¾‹ç¨‹åº“ååŒä¸€è‡´çš„æ–¹æ³•æ¥è®¿é—®æ•°æ®åº“çš„è¿›ç¨‹æ˜¯éåˆä½œè¿›ç¨‹ã€‚<br>å¼ºåˆ¶é”ä¼šè®©å†…æ ¸æ£€æŸ¥æ¯ä¸€ä¸ª openã€read å’Œ writeï¼ŒéªŒè¯è°ƒç”¨è¿›ç¨‹æ˜¯å¦è¿èƒŒäº†æ­£åœ¨è®¿é—®çš„æ–‡ä»¶ä¸Šçš„ä¸€æŠŠé”ã€‚å¼ºåˆ¶æ€§é”ä¹Ÿè¢«æˆä¸ºå¼ºè¿«æ–¹å¼é”ã€‚</p><h4 id="å½“ä¸¤ä¸ªäººåŒæ—¶ç¼–è¾‘åŒä¸€ä¸ªæ–‡ä»¶æ—¶ä¼šæ€æ ·ï¼Ÿ"><a href="#å½“ä¸¤ä¸ªäººåŒæ—¶ç¼–è¾‘åŒä¸€ä¸ªæ–‡ä»¶æ—¶ä¼šæ€æ ·ï¼Ÿ" class="headerlink" title="å½“ä¸¤ä¸ªäººåŒæ—¶ç¼–è¾‘åŒä¸€ä¸ªæ–‡ä»¶æ—¶ä¼šæ€æ ·ï¼Ÿ"></a>å½“ä¸¤ä¸ªäººåŒæ—¶ç¼–è¾‘åŒä¸€ä¸ªæ–‡ä»¶æ—¶ä¼šæ€æ ·ï¼Ÿ</h4><p><strong>ä¸€èˆ¬çš„UNIXç³»ç»Ÿæ–‡æœ¬ç¼–è¾‘å™¨å¹¶ä¸ä½¿ç”¨è®°å½•é”ï¼Œæ‰€ä»¥è¯¥æ–‡ä»¶çš„æœ€åç»“æœå–å†³äºå†™è¯¥æ–‡ä»¶çš„æœ€åä¸€ä¸ªè¿›ç¨‹ã€‚</strong></p><h4 id="å®ˆæŠ¤è¿›ç¨‹å¯ä»¥ç”¨ä¸€æŠŠæ–‡ä»¶æ‰€ä¿è¯å®ˆæŠ¤è¿›ç¨‹çš„å”¯ä¸€å‰¯æœ¬åœ¨è¿è¡Œã€‚"><a href="#å®ˆæŠ¤è¿›ç¨‹å¯ä»¥ç”¨ä¸€æŠŠæ–‡ä»¶æ‰€ä¿è¯å®ˆæŠ¤è¿›ç¨‹çš„å”¯ä¸€å‰¯æœ¬åœ¨è¿è¡Œã€‚" class="headerlink" title="å®ˆæŠ¤è¿›ç¨‹å¯ä»¥ç”¨ä¸€æŠŠæ–‡ä»¶æ‰€ä¿è¯å®ˆæŠ¤è¿›ç¨‹çš„å”¯ä¸€å‰¯æœ¬åœ¨è¿è¡Œã€‚"></a>å®ˆæŠ¤è¿›ç¨‹å¯ä»¥ç”¨ä¸€æŠŠæ–‡ä»¶æ‰€ä¿è¯å®ˆæŠ¤è¿›ç¨‹çš„å”¯ä¸€å‰¯æœ¬åœ¨è¿è¡Œã€‚</h4><h2 id="å¤„ç†å¤šä¸ªæè¿°ç¬¦"><a href="#å¤„ç†å¤šä¸ªæè¿°ç¬¦" class="headerlink" title="å¤„ç†å¤šä¸ªæè¿°ç¬¦"></a>å¤„ç†å¤šä¸ªæè¿°ç¬¦</h2><p>å¤„ç†å¤šä¸ªæè¿°ç¬¦çš„I/Oæ“ä½œæ—¶ï¼Œæˆ‘ä»¬ä¸èƒ½åœ¨ä»»ä½•ä¸€ä¸ªæè¿°ç¬¦ä¸Šè¿›è¡Œé˜»å¡I/Oï¼Œå¦åˆ™å¯èƒ½ä¼šå› ä¸ºè¢«é˜»å¡åœ¨ä¸€ä¸ªæè¿°ç¬¦çš„I/Oæ“ä½œä¸Šè€Œå¯¼è‡´å¦ä¸€ä¸ªæè¿°ç¬¦å³ä½¿å¯ä»¥è¿›è¡ŒI/Oä¹Ÿæ— æ³•å¤„ç†ã€‚å¦‚telnetå‘½ä»¤ï¼š<br><img src="14-13.png" alt=""><br>å¤„ç†è¿™ç±»é—®é¢˜æœ‰å‡ ä¸ªæ–¹æ³•ï¼š</p><ul><li><strong>å¤šè¿›ç¨‹</strong><br>çˆ¶è¿›ç¨‹é˜»å¡è¯»ç»ˆç«¯æ•°æ®ï¼Œå­è¿›ç¨‹é˜»å¡è¯»telnetdæ•°æ®ã€‚ä½†ä¹Ÿäº§ç”Ÿäº†é—®é¢˜ï¼šæ“ä½œä»€ä¹ˆæ—¶å€™ç»ˆæ­¢ï¼Ÿçˆ¶/å­è¿›ç¨‹å…¶ä¸­ä¸€ä¸ªç»ˆæ­¢æ—¶éœ€è¦ä½¿ç”¨ä¿¡å·é€šçŸ¥å¦ä¸€ä¸ªè¿›ç¨‹ç»ˆæ­¢ï¼Œè¿™ä½¿ç¨‹åºå˜å¾—å¤æ‚ã€‚</li><li><strong>å¤šçº¿ç¨‹</strong><br>è¿™é¿å…äº†ç»ˆæ­¢çš„å¤æ‚æ€§ï¼Œä½†å´è¦æ±‚å¤„ç†ä¸¤ä¸ªçº¿ç¨‹ä¹‹é—´çš„åŒæ­¥ï¼Œåœ¨å¤æ‚æ€§æ–¹é¢å¾—ä¸å¿å¤±ã€‚</li><li><strong>å•çº¿ç¨‹è½®è¯¢</strong><br>å°†ä¸¤ä¸ªè¾“å…¥æè¿°ç¬¦éƒ½è®¾ç½®ä¸ºéé˜»å¡ï¼Œå¯¹ç¬¬ä¸€ä¸ªæè¿°ç¬¦å‘ä¸€ä¸ªreadï¼Œè‹¥æœ‰æ•°æ®åˆ™å¤„ç†ï¼Œè‹¥æ²¡æ•°æ®å¯è¯»ï¼Œåˆ™ç«‹å³è¿”å›ã€‚ç„¶åå¯¹ç¬¬äºŒä¸ªæè¿°ç¬¦åŒæ ·å¤„ç†ã€‚ç­‰å¾…ä¸€å®šæ—¶é—´åå†æ¬¡å¾ªç¯ã€‚<br>è¿™ç§æ–¹æ³•çš„å¼Šç«¯æ˜¯æµªè´¹CPUæ—¶é—´ã€‚å¤§å¤šæ•°æ—¶é—´æ˜¯æ— æ•°æ®å¯è¯»çš„ï¼Œå› æ­¤æ‰§è¡Œreadç³»ç»Ÿè°ƒç”¨æµªè´¹äº†æ—¶é—´ï¼Œè€Œä¸”éœ€è¦ç­‰å¾…å¤šä¹…å¾ˆéš¾ç¡®å®šã€‚åœ¨å¤šä»»åŠ¡ç³»ç»Ÿä¸­åº”å½“é¿å…ä½¿ç”¨è¿™ç§æ–¹æ³•ã€‚</li><li><strong>å¼‚æ­¥I/O</strong><br>è¿›ç¨‹å‘Šè¯‰å†…æ ¸ï¼šå½“æè¿°ç¬¦å‡†å¤‡å¥½å¯ä»¥è¿›è¡ŒI/Oæ—¶ï¼Œç”¨ä¸€ä¸ªä¿¡å·é€šçŸ¥å®ƒã€‚è¿™ç§æŠ€æœ¯æœ‰ä¸¤ä¸ªé—®é¢˜ï¼š</li></ul><ol><li>å¯ç§»æ¤æ€§ã€‚æ¯ä¸ªç³»ç»Ÿæä¾›äº†å„è‡ªçš„å—é™å½¢å¼çš„å¼‚æ­¥I/Oï¼Œä½†POSIXé‡‡çº³äº†å¦å¤–ä¸€å¥—æ ‡å‡†åŒ–æ¥å£ã€‚</li><li>è¿™ç§ä¿¡å·å¯¹æ¯ä¸ªè¿›ç¨‹è€Œè¨€åªæœ‰ä¸€ä¸ªï¼ˆSIGPOLLæˆ–SIGIOï¼‰ã€‚å¦‚æœä½¿è¯¥ä¿¡å·å¯¹ä¸¤ä¸ªæè¿°ç¬¦éƒ½èµ·ä½œç”¨ï¼Œé‚£ä¹ˆè¿›ç¨‹åœ¨æ¥åˆ°æ­¤ä¿¡å·æ—¶å°±æ— æ³•åˆ¤åˆ«æ˜¯å“ªä¸€ä¸ªæè¿°ç¬¦å‡†å¤‡å¥½äº†ï¼Œä»éœ€å°†ä¸¤ä¸ªæè¿°ç¬¦éƒ½è®¾ç½®ä¸ºéé˜»å¡ï¼Œç„¶åé¡ºåºå°è¯•æ‰§è¡ŒI/Oã€‚</li></ol><ul><li><strong>I/Oå¤šè·¯è½¬æ¥</strong><br>å…ˆæ„é€ ä¸€ä¸ªæˆ‘ä»¬æ„Ÿå…´è¶£çš„æè¿°ç¬¦åˆ—è¡¨ï¼Œç„¶åè°ƒç”¨å‡½æ•°ï¼ˆselect/pselect/pollï¼‰ï¼Œç›´åˆ°è¿™äº›æè¿°ç¬¦ä¸­çš„ä¸€ä¸ªå·²ç»å‡†å¤‡å¥½è¿›è¡ŒI/Oæ—¶ï¼Œè¯¥å‡½æ•°æ‰è¿”å›ã€‚</li></ul><h2 id="I-Oå¤šè·¯è½¬æ¥"><a href="#I-Oå¤šè·¯è½¬æ¥" class="headerlink" title="I/Oå¤šè·¯è½¬æ¥"></a>I/Oå¤šè·¯è½¬æ¥</h2><h3 id="select-å’Œ-pselect"><a href="#select-å’Œ-pselect" class="headerlink" title="select å’Œ pselect"></a>select å’Œ pselect</h3><p>ä¼ ç»™selectçš„å‚æ•°å‘Šè¯‰å†…æ ¸ï¼š</p><ul><li>æˆ‘ä»¬æ‰€å…³å¿ƒçš„æè¿°ç¬¦</li><li>å¯¹äºæ¯ä¸ªæè¿°ç¬¦æˆ‘ä»¬æ‰€å…³å¿ƒçš„æ¡ä»¶ï¼ˆæ˜¯å¦ä»ä¸€ä¸ªç»™å®šçš„æè¿°ç¬¦è¯»ã€æ˜¯å¦å†™ä¸€ä¸ªç‰¹å®šçš„æè¿°ç¬¦ã€æ˜¯å¦å…³å¿ƒä¸€ä¸ªç‰¹å®šæè¿°ç¬¦çš„å¼‚å¸¸æ¡ä»¶ï¼‰</li><li>æ„¿æ„ç­‰å¾…å¤šé•¿æ—¶é—´ï¼ˆæ°¸è¿œç­‰å¾…ã€ç­‰å¾…å›ºå®šæ—¶é—´æˆ–ä¸ç­‰å¾…ï¼‰<br>ä»selectè¿”å›æ—¶ï¼Œå†…æ ¸å‘Šè¯‰æˆ‘ä»¬ï¼š</li><li>å·²å‡†å¤‡å¥½çš„æè¿°ç¬¦æ€»æ•°é‡</li><li>å¯¹äºè¯»ã€å†™æˆ–å¼‚å¸¸è¿™ä¸‰ä¸ªæ¡ä»¶ä¸­çš„æ¯ä¸€ä¸ªï¼Œå“ªäº›æè¿°ç¬¦å·²å‡†å¤‡å¥½<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">select</span><span class="params">(<span class="keyword">int</span> maxfdp1,</span></span></span><br><span class="line"><span class="function"><span class="params">    fd_set *<span class="keyword">restrict</span> readfds,</span></span></span><br><span class="line"><span class="function"><span class="params">    fd_set *<span class="keyword">restrict</span> writefds,</span></span></span><br><span class="line"><span class="function"><span class="params">    fd_set *<span class="keyword">restrict</span> exceptfds,</span></span></span><br><span class="line"><span class="function"><span class="params">    struct timeval *<span class="keyword">restrict</span> tvptr</span></span></span><br><span class="line"><span class="function"><span class="params">)</span></span>;</span><br></pre></td></tr></table></figure>å¯¹äºâ€œå‡†å¤‡å¥½â€çš„å«ä¹‰å…·ä½“è¯´æ˜ï¼š</li><li>è‹¥å¯¹è¯»é›†ä¸­çš„ä¸€ä¸ªæè¿°ç¬¦è¿›è¡Œçš„readæ“ä½œä¸ä¼šé˜»å¡ï¼Œåˆ™è®¤ä¸ºæ­¤æè¿°ç¬¦æ˜¯å‡†å¤‡å¥½çš„ã€‚</li><li>è‹¥å¯¹å†™é›†ä¸­çš„ä¸€ä¸ªæè¿°ç¬¦è¿›è¡Œçš„writeæ“ä½œä¸ä¼šé˜»å¡ï¼Œåˆ™è®¤ä¸ºæ­¤æè¿°ç¬¦æ˜¯å‡†å¤‡å¥½çš„ã€‚</li><li>è‹¥å¯¹å¼‚å¸¸æ¡ä»¶é›†ä¸­çš„ä¸€ä¸ªæè¿°ç¬¦æœ‰ä¸€ä¸ªæœªå†³å¼‚å¸¸æ¡ä»¶ï¼Œåˆ™è®¤ä¸ºæ­¤æè¿°ç¬¦æ˜¯å‡†å¤‡å¥½çš„ã€‚åŒ…æ‹¬ï¼šåœ¨ç½‘ç»œè¿æ¥ä¸Šåˆ°è¾¾å¸¦å¤–æ•°æ®ï¼Œæˆ–è€…åœ¨å¤„äºæ•°æ®åŒ…æ¨¡å¼çš„ä¼ªç»ˆç«¯ä¸Šå‘ç”Ÿäº†æŸäº›æ¡ä»¶ã€‚</li><li><strong>å¯¹äºè¯»ã€å†™å’Œå¼‚å¸¸æ¡ä»¶ï¼Œæ™®é€šæ–‡ä»¶çš„æè¿°ç¬¦æ€»æ˜¯å‡†å¤‡å¥½çš„</strong></li></ul><p><strong>ä¸€ä¸ªæè¿°ç¬¦é˜»å¡ä¸å¦å¹¶ä¸å½±å“selectæ˜¯å¦é˜»å¡ã€‚</strong></p><h4 id="selectå’Œpselectçš„åŒºåˆ«"><a href="#selectå’Œpselectçš„åŒºåˆ«" class="headerlink" title="selectå’Œpselectçš„åŒºåˆ«"></a>selectå’Œpselectçš„åŒºåˆ«</h4><ul><li>selectçš„è¶…æ—¶å€¼ç”¨timevalç»“æ„æŒ‡å®šï¼ˆç§’å’Œå¾®ç§’ï¼‰ï¼›pselectä½¿ç”¨timespecç»“æ„ï¼ˆç§’å’Œçº³ç§’ï¼‰ï¼Œæ›´ç²¾å‡†</li><li>pselectçš„è¶…æ—¶å€¼è¢«å£°æ˜ä¸ºconstï¼Œè¿™ä¿è¯äº†è°ƒç”¨pselectä¸ä¼šæ”¹å˜æ­¤å€¼</li><li>pselectå¯ä½¿ç”¨å¯é€‰ä¿¡å·å±è”½å­—</li></ul><h3 id="poll"><a href="#poll" class="headerlink" title="poll"></a>poll</h3><p>pollç±»ä¼¼äºselectï¼Œä½†ç¨‹åºå‘˜æ¥å£æœ‰æ‰€ä¸åŒã€‚pollæ„é€ ä¸€ä¸ªpollfdç»“æ„çš„æ•°ç»„ï¼Œæ¯ä¸ªæ•°ç»„å…ƒç´ æŒ‡å®šä¸€ä¸ªæè¿°ç¬¦ç¼–å·ä»¥åŠæˆ‘ä»¬å¯¹è¯¥æè¿°ç¬¦æ„Ÿå…´è¶£çš„æ¡ä»¶ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">poll</span><span class="params">(struct pollfd fdarray[], <span class="keyword">nfds_t</span> nfds, <span class="keyword">int</span> timeout)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">pollfd</span> &#123;</span></span><br><span class="line">  <span class="keyword">int</span> fd; <span class="comment">/*è¦æ£€æµ‹çš„æè¿°ç¬¦*/</span></span><br><span class="line">  short events; <span class="comment">/*è¦æ£€æµ‹çš„äº‹ä»¶*/</span></span><br><span class="line">  short revents; <span class="comment">/*å‘ç”Ÿäº†çš„äº‹ä»¶*/</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å‰4è¡Œå¯è¯»æ€§ï¼Œæ¥ä¸‹æ¥3è¡Œæ˜¯å¯å†™æ€§ï¼Œæœ€å3è¡Œæ˜¯ç”±å†…æ ¸åœ¨è¿”å›æ—¶è®¾ç½®çš„ã€‚<br><img src="14-18.png" alt=""><br>å¦‚æœæˆ‘ä»¬æ­£ä»ç»ˆç«¯è¾“å…¥æ•°æ®ï¼Œå¹¶é”®å…¥æ–‡ä»¶ç»“æŸç¬¦ï¼Œé‚£ä¼šæ‰“å¼€POLLINï¼Œäºæ˜¯æˆ‘ä»¬å°±å¯ä»¥è¯»æ–‡ä»¶ç»“æŸæŒ‡ç¤ºã€‚revertnsä¸­çš„POLLHUPæ²¡æœ‰æ‰“å¼€ã€‚å¦‚æœæ­£åœ¨è¯»è°ƒåˆ¶è§£è°ƒå™¨ï¼Œå¹¶ä¸”ç”µè¯çº¿å·²æŒ‚æ–­ï¼Œæˆ‘ä»¬å°†æ¥åˆ°POLLHUPé€šçŸ¥ã€‚</p><h2 id="å¼‚æ­¥I-O"><a href="#å¼‚æ­¥I-O" class="headerlink" title="å¼‚æ­¥I/O"></a>å¼‚æ­¥I/O</h2><p>ä½¿ç”¨ POSIX å¼‚æ­¥I/Oæ¥å£ï¼Œä¼šå¸¦æ¥ä¸€äº›éº»çƒ¦ï¼š</p><ul><li>æ¯ä¸ªå¼‚æ­¥æ“ä½œæœ‰3å¤„å¯èƒ½äº§ç”Ÿé”™è¯¯çš„åœ°æ–¹ï¼šæ“ä½œæäº¤çš„éƒ¨åˆ†ï¼›æ“ä½œæœ¬èº«çš„ç»“æœï¼›ç”¨äºå†³å®šå¼‚æ­¥æ“ä½œçŠ¶æ€çš„å‡½æ•°ä¸­ã€‚</li><li>ä¸POSIXå¼‚æ­¥I/Oæ¥å£çš„ä¼ ç»Ÿæ–¹æ³•ç›¸æ¯”ï¼Œå®ƒä»¬æœ¬èº«æ¶‰åŠå¤§é‡çš„é¢å¤–è®¾ç½®å’Œå¤„ç†è§„åˆ™ã€‚</li><li>ä»é”™è¯¯ä¸­æ¢å¤å¯èƒ½ä¼šæ¯”è¾ƒå›°éš¾ã€‚</li></ul><h3 id="BSDå¼‚æ­¥I-O"><a href="#BSDå¼‚æ­¥I-O" class="headerlink" title="BSDå¼‚æ­¥I/O"></a>BSDå¼‚æ­¥I/O</h3><p>åœ¨BSDæ´¾ç”Ÿçš„ç³»ç»Ÿä¸­ï¼Œå¼‚æ­¥I/Oæ˜¯ä¿¡å·SIGIOå’ŒSIGURGçš„ç»„åˆã€‚SIGIOæ˜¯é€šç”¨å¼‚æ­¥I/Oä¿¡å·ï¼ŒSIGURGåˆ™åªç”¨æ¥é€šçŸ¥è¿›ç¨‹ç½‘ç»œè¿æ¥ä¸Šçš„å¸¦å¤–æ•°æ®å·²åˆ°è¾¾ã€‚<br>æ¥æ”¶SIGIOä¿¡å·åˆ†ä¸‰æ­¥ï¼š</p><ol><li>è°ƒç”¨signalæˆ–sigactionä¸ºSIGIOä¿¡å·å»ºç«‹ä¿¡å·å¤„ç†ç¨‹åºã€‚</li><li>ä»¥å‘½ä»¤F_SETOWNè°ƒç”¨fcntlæ¥è®¾ç½®è¿›ç¨‹IDæˆ–è¿›ç¨‹ç»„IDï¼Œç”¨äºæ¥æ”¶å¯¹äºè¯¥æè¿°ç¬¦çš„ä¿¡å·ã€‚</li><li>ä»¥å‘½ä»¤F_SETFLè°ƒç”¨fcntlè®¾ç½®O_ASYNCæ–‡ä»¶çŠ¶æ€æ ‡å¿—ï¼Œä½¿åœ¨è¯¥æè¿°ç¬¦ä¸Šå¯ä»¥è¿›è¡Œå¼‚æ­¥I/Oã€‚</li></ol><h3 id="POSIX-å¼‚æ­¥I-O"><a href="#POSIX-å¼‚æ­¥I-O" class="headerlink" title="POSIX å¼‚æ­¥I/O"></a>POSIX å¼‚æ­¥I/O</h3><p>POSIXå¼‚æ­¥I/Oæ¥å£ä¸ºå¯¹ä¸åŒç±»å‹çš„æ–‡ä»¶è¿›è¡Œå¼‚æ­¥I/Oæä¾›äº†ä¸€å¥—ä¸€è‡´çš„æ–¹æ³•ã€‚<br>è¿™äº›å¼‚æ­¥I/Oæ¥å£ä½¿ç”¨AIOæ§åˆ¶å—æ¥æè¿°I/Oæ“ä½œã€‚aiocbç»“æ„å®šä¹‰äº†AIOæ§åˆ¶å—ï¼Œåœ¨è¿›è¡Œå¼‚æ­¥I/Oä¹‹å‰éœ€è¦å…ˆåˆå§‹åŒ–AIOæ¨¡å—ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">aiocb</span> &#123;</span></span><br><span class="line"><span class="keyword">int</span>             aio_fildes;             <span class="comment">/*ç”¨æ¥è¯»/å†™çš„æ–‡ä»¶æè¿°ç¬¦*/</span></span><br><span class="line"><span class="keyword">off_t</span>           aio_offset;             <span class="comment">/*èµ·å§‹çš„åç§»é‡*/</span></span><br><span class="line"><span class="keyword">volatile</span> <span class="keyword">void</span>   *aio_buf;               <span class="comment">/*ç¼“å†²åŒºåœ°å€*/</span></span><br><span class="line"><span class="keyword">size_t</span>          aio_nbytes;             <span class="comment">/*è¦è¯»/å†™çš„é•¿åº¦*/</span></span><br><span class="line"><span class="keyword">int</span>             aio_reqprio;            <span class="comment">/*è¯·æ±‚ä¼˜å…ˆçº§ï¼Œæ’åºç”¨*/</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">sigevent</span> <span class="title">aio_sigevent</span>;</span>           <span class="comment">/*I/Oå®Œæˆåé€šçŸ¥åº”ç”¨ç¨‹åºçš„æ–¹å¼*/</span></span><br><span class="line"><span class="keyword">int</span>             aio_lio_opcode;         <span class="comment">/*Operation to be performed*/</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">sigevent</span> &#123;</span></span><br><span class="line"><span class="keyword">int</span>            sigev_notify;                   <span class="comment">/*é€šçŸ¥ç±»å‹ï¼šä¸é€šçŸ¥/sigev_signoä¿¡å·é€šçŸ¥/åˆ†ç¦»çŠ¶æ€ä¸‹çš„å•çº¿ç¨‹æ‰§è¡Œsigev_notify_function*/</span></span><br><span class="line"><span class="keyword">int</span>            sigev_signo;                    <span class="comment">/*æŒ‡å®šé€šçŸ¥ä¿¡å·*/</span></span><br><span class="line"><span class="keyword">union</span> sigval   sigev_value;                    <span class="comment">/*ä¿¡å·ç»“æ„é‡Œçš„è‡ªå®šä¹‰å‚æ•°*/</span></span><br><span class="line"><span class="keyword">void</span> (*sigev_notify_function)(<span class="keyword">union</span> sigval);   <span class="comment">/*é€šçŸ¥æ–¹æ³•*/</span></span><br><span class="line"><span class="keyword">pthread_attr_t</span> *sigev_notify_attributes;       <span class="comment">/*é€šçŸ¥å±æ€§*/</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>å¼‚æ­¥I/Oè¯·æ±‚ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">aio_read</span><span class="params">(struct aiocb *aiocbp)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">aio_write</span><span class="params">(struct aiocb *aiocbp)</span></span>;</span><br></pre></td></tr></table></figure><p>å†²æ´—æ•°æ®ï¼Œå¼ºåˆ¶æ‰€æœ‰ç­‰å¾…ä¸­çš„å¼‚æ­¥æ“ä½œä¸ç­‰å¾…è€Œå†™å…¥æŒä¹…åŒ–å­˜å‚¨ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">aio_fsync</span><span class="params">(<span class="keyword">int</span> op, struct aiocb *aiocbp)</span></span>;</span><br></pre></td></tr></table></figure><p>è·å–ä¸€ä¸ªå¼‚æ­¥I/Oæ“ä½œçš„å®ŒæˆçŠ¶æ€ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">aio_error</span><span class="params">(<span class="keyword">const</span> struct aiocb *aiocbp)</span></span>;</span><br></pre></td></tr></table></figure><p>å¦‚æœæ“ä½œæˆåŠŸï¼Œå¯ä»¥è°ƒç”¨aio_returnå‡½æ•°è·å–å¼‚æ­¥æ“ä½œçš„è¿”å›å€¼ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">ssize_t</span> <span class="title">aio_return</span><span class="params">(<span class="keyword">const</span> struct aiocb *aiocbp)</span></span>;</span><br></pre></td></tr></table></figure><p>å¦‚æœå®Œæˆäº†æ‰€æœ‰äº‹åŠ¡æ—¶ï¼Œè¿˜æœ‰å¼‚æ­¥æ“ä½œæœªå®Œæˆæ—¶ï¼Œå¯ä»¥è°ƒç”¨aio_suspendå‡½æ•°æ¥é˜»å¡è¿›ç¨‹ï¼Œç›´åˆ°æ“ä½œå®Œæˆï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">aio_suspend</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">  <span class="keyword">const</span> struct aiocb *<span class="keyword">const</span> <span class="built_in">list</span>[],</span></span></span><br><span class="line"><span class="function"><span class="params">  <span class="keyword">int</span> nent,</span></span></span><br><span class="line"><span class="function"><span class="params">  <span class="keyword">const</span> struct timespec *timeout</span></span></span><br><span class="line"><span class="function"><span class="params">)</span></span>;</span><br></pre></td></tr></table></figure><p>ä¸æƒ³å†ç­‰å¾…æœªå®Œæˆçš„å¼‚æ­¥I/Oæ“ä½œæ—¶ï¼Œè°ƒç”¨aio_cancel:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">aio_cancel</span><span class="params">(<span class="keyword">int</span> ofd, struct aiocb *aiocbp)</span></span>;</span><br></pre></td></tr></table></figure><p>æ‰¹é‡I/Oï¼Œå¯å¼‚æ­¥ï¼Œå¯åŒæ­¥ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">lio_listio</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">int</span> mode,</span></span></span><br><span class="line"><span class="function"><span class="params">    struct aiocb *<span class="keyword">const</span> aiocblist[],</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">int</span> nent,</span></span></span><br><span class="line"><span class="function"><span class="params">    struct sigevent *sigp</span></span></span><br><span class="line"><span class="function"><span class="params">)</span></span>;</span><br></pre></td></tr></table></figure><h2 id="readv-å’Œ-writev"><a href="#readv-å’Œ-writev" class="headerlink" title="readv å’Œ writev"></a>readv å’Œ writev</h2><p>ç”¨äºåœ¨ä¸€æ¬¡å‡½æ•°è°ƒç”¨ä¸­è¯»ã€å†™é”å“¥éè¿ç»­ç¼“å†²åŒºã€‚ä¹Ÿæˆä¸ºæ•£å¸ƒè¯»ï¼ˆscatter readï¼‰å’Œèšé›†å†™ï¼ˆgather writeï¼‰ã€‚</p><h2 id="readn-å’Œ-writen"><a href="#readn-å’Œ-writen" class="headerlink" title="readn å’Œ writen"></a>readn å’Œ writen</h2><p>ç®¡é“ã€FIFOä»¥åŠæŸäº›è®¾å¤‡ï¼ˆç»ˆç«¯å’Œç½‘ç»œï¼‰æœ‰ä¸‹åˆ—æ€§è´¨ï¼š</p><ul><li>ä¸€æ¬¡readæ“ä½œçš„è¿”å›å€¼å¯èƒ½å°‘äºæ‰€æœ‰æ±‚çš„æ•°æ®ï¼Œå³ä½¿è¿˜æ²¡åˆ°è¾¾æ–‡ä»¶å°¾ç«¯ï¼Œä¹Ÿå¯èƒ½æ˜¯è¿™æ ·ï¼Œè¿™ä¸æ˜¯é”™è¯¯ï¼Œåº”å½“ç»§ç»­è¯»è¯¥è®¾å¤‡ã€‚</li><li>ä¸€æ¬¡writeæ“ä½œçš„è¿”å›å€¼å¯èƒ½å°‘äºæŒ‡å®šå­—èŠ‚æ•°ã€‚è¿™æ˜¯æŸäº›åŸå› é€ æˆçš„ï¼Œå¦‚å†…æ ¸è¾“å‡ºç¼“å†²åŒºå˜æ»¡ã€‚è¿™ä¹Ÿä¸æ˜¯é”™è¯¯ï¼Œåº”å½“ç»§ç»­å†™ä½™ä¸‹æ•°æ®ã€‚</li></ul><p>readnå’Œwritençš„åŠŸèƒ½æ˜¯æŒ‡å®šè¯»/å†™nå­—èŠ‚æ•°æ®ï¼Œå¹¶å¤„ç†è¿”å›å€¼å¯èƒ½å°äºè¦æ±‚å€¼çš„æƒ…å†µã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;åŸºç¡€æ¦‚å¿µ&quot;&gt;&lt;a href=&quot;#åŸºç¡€æ¦‚å¿µ&quot; class=&quot;headerlink&quot; title=&quot;åŸºç¡€æ¦‚å¿µ&quot;&gt;&lt;/a&gt;åŸºç¡€æ¦‚å¿µ&lt;/h2&gt;&lt;h3 id=&quot;åŒæ­¥ï¼Œå¼‚æ­¥ï¼Œé˜»å¡ï¼Œéé˜»å¡&quot;&gt;&lt;a href=&quot;#åŒæ­¥ï¼Œå¼‚æ­¥ï¼Œé˜»å¡ï¼Œéé˜»å¡&quot; class=&quot;headerlink&quot; title=&quot;åŒæ­¥ï¼Œå¼‚æ­¥ï¼Œé˜»å¡ï¼Œéé˜»å¡&quot;&gt;&lt;/a&gt;åŒæ­¥ï¼Œå¼‚æ­¥ï¼Œé˜»å¡ï¼Œéé˜»å¡&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;åŒæ­¥ä¸å¼‚æ­¥&lt;/strong&gt;&lt;br&gt;åŒæ­¥æ˜¯æŒ‡ä»£ç è°ƒç”¨IOæ“ä½œæ—¶ï¼Œå¿…é¡»ç­‰å¾…IOæ“ä½œå®Œæˆæ‰è¿”å›çš„è°ƒç”¨æ–¹å¼ã€‚&lt;br&gt;å¼‚æ­¥æ˜¯æŒ‡ä»£ç è°ƒç”¨IOæ“ä½œæ—¶ï¼Œä¸å¿…ç­‰IOæ“ä½œå®Œæˆå°±è¿”å›çš„è°ƒç”¨æ–¹å¼ã€‚&lt;/p&gt;
&lt;p&gt;åŒæ­¥æ˜¯æœ€åŸå§‹çš„è°ƒç”¨æ–¹å¼ã€‚&lt;br&gt;å¼‚æ­¥åˆ™éœ€è¦å¤šçº¿ç¨‹ï¼Œå¤šCPUæˆ–è€…éé˜»å¡IOçš„æ”¯æŒã€‚&lt;br&gt;&lt;strong&gt;é˜»å¡ä¸éé˜»å¡&lt;/strong&gt;&lt;br&gt;é˜»å¡æ˜¯æŒ‡è°ƒç”¨çº¿ç¨‹æˆ–è€…è¿›ç¨‹è¢«æ“ä½œç³»ç»ŸæŒ‚èµ·ã€‚&lt;br&gt;éé˜»å¡æ˜¯æŒ‡è°ƒç”¨çº¿ç¨‹æˆ–è€…è¿›ç¨‹ä¸ä¼šè¢«æ“ä½œç³»ç»ŸæŒ‚èµ·ã€‚&lt;/p&gt;
&lt;p&gt;æ²¡æœ‰IOæ“ä½œï¼Œæ‰€æœ‰çš„ä»£ç åŸºæœ¬éƒ½æ˜¯åŒæ­¥çš„&lt;br&gt;æœ‰äº†IOæ“ä½œåï¼Œå¦‚æœæ²¡æœ‰å¤šè¿›ç¨‹å¤šçº¿ç¨‹ï¼Œæ‰€æœ‰ä»£ç è¿˜æ˜¯åŒæ­¥çš„&lt;br&gt;æœ‰äº†IOæ“ä½œï¼Œæœ‰äº†å¤šè¿›ç¨‹å¤šçº¿ç¨‹ï¼Œä»£ç æ‰æœ‰äº†å¼‚æ­¥çš„å¯èƒ½æ€§ï¼ŒåŒæ—¶ä¹Ÿäº§ç”Ÿäº†é˜»å¡ä¸éé˜»å¡&lt;/p&gt;
    
    </summary>
    
    
      <category term="ã€ŠAPUEã€‹ç¬”è®°" scheme="https://akaqin.github.io/categories/%E3%80%8AAPUE%E3%80%8B%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="I/O" scheme="https://akaqin.github.io/tags/I-O/"/>
    
  </entry>
  
  <entry>
    <title>ã€ŠUNIXç¯å¢ƒé«˜çº§ç¼–ç¨‹ã€‹ç¬¬3ç« â€”â€”æ–‡ä»¶I/O</title>
    <link href="https://akaqin.github.io/2020/04/10/%E3%80%8AUNIX%E7%8E%AF%E5%A2%83%E9%AB%98%E7%BA%A7%E7%BC%96%E7%A8%8B%E3%80%8B%E7%AC%AC3%E7%AB%A0%E2%80%94%E2%80%94%E6%96%87%E4%BB%B6I-O/"/>
    <id>https://akaqin.github.io/2020/04/10/%E3%80%8AUNIX%E7%8E%AF%E5%A2%83%E9%AB%98%E7%BA%A7%E7%BC%96%E7%A8%8B%E3%80%8B%E7%AC%AC3%E7%AB%A0%E2%80%94%E2%80%94%E6%96%87%E4%BB%B6I-O/</id>
    <published>2020-04-10T05:11:54.000Z</published>
    <updated>2020-04-14T01:54:58.290Z</updated>
    
    <content type="html"><![CDATA[<h2 id="æ–‡ä»¶æè¿°ç¬¦"><a href="#æ–‡ä»¶æè¿°ç¬¦" class="headerlink" title="æ–‡ä»¶æè¿°ç¬¦"></a>æ–‡ä»¶æè¿°ç¬¦</h2><p>å¯¹äºå†…æ ¸è€Œè¨€ï¼Œæ‰€æœ‰æ‰“å¼€çš„æ–‡ä»¶éƒ½é€šè¿‡æ–‡ä»¶æè¿°ç¬¦å¼•ç”¨ã€‚æ–‡ä»¶æè¿°ç¬¦æ˜¯ä¸€ä¸ªéè´Ÿæ•´æ•°ã€‚å½“æ‰“å¼€ä¸€ä¸ªç°æœ‰æ–‡ä»¶æˆ–åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶æ—¶ï¼Œå†…æ ¸å‘è¿›ç¨‹è¿”å›ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ã€‚</p><ul><li>0 - STDIN_FILENO - æ ‡å‡†è¾“å…¥</li><li>1 - STDOUT_FILENO - æ ‡å‡†è¾“å‡º</li><li>2 - STDERR_FILENO - æ ‡å‡†é”™è¯¯</li></ul><h2 id="ä¸å¸¦ç¼“å†²çš„I-Oå‡½æ•°"><a href="#ä¸å¸¦ç¼“å†²çš„I-Oå‡½æ•°" class="headerlink" title="ä¸å¸¦ç¼“å†²çš„I/Oå‡½æ•°"></a>ä¸å¸¦ç¼“å†²çš„I/Oå‡½æ•°</h2><ul><li>open(openat) æ‰“å¼€æˆ–åˆ›å»ºä¸€ä¸ªæ–‡ä»¶</li><li>creat åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶</li><li>close å…³é—­ä¸€ä¸ªæ‰“å¼€æ–‡ä»¶</li><li>lseek è®¾ç½®åç§»é‡ï¼ˆlseekä»…å°†å½“å‰æ–‡ä»¶åç§»é‡è®°å½•åœ¨å†…æ ¸ä¸­ï¼Œä¸å¼•èµ·ä»»ä½•I/Oæ“ä½œï¼‰</li><li>read ä»æ‰“å¼€æ–‡ä»¶ä¸­è¯»æ•°æ®</li><li>write å‘æ‰“å¼€æ–‡ä»¶å†™æ•°æ®</li></ul><a id="more"></a><h3 id="å¸¦ç¼“å†²ä¸ä¸å¸¦ç¼“å†²çš„åŒºåˆ«"><a href="#å¸¦ç¼“å†²ä¸ä¸å¸¦ç¼“å†²çš„åŒºåˆ«" class="headerlink" title="å¸¦ç¼“å†²ä¸ä¸å¸¦ç¼“å†²çš„åŒºåˆ«"></a>å¸¦ç¼“å†²ä¸ä¸å¸¦ç¼“å†²çš„åŒºåˆ«</h3><p>æ‰€è°“ä¸å¸¦ç¼“å†²ï¼Œå¹¶ä¸æ˜¯æŒ‡å†…æ ¸ä¸æä¾›ç¼“å†²ï¼Œè€Œæ˜¯åªå•çº¯çš„ç³»ç»Ÿè°ƒç”¨ï¼Œä¸æ˜¯å‡½æ•°åº“çš„è°ƒç”¨ã€‚ç³»ç»Ÿå†…æ ¸å¯¹ç£ç›˜çš„è¯»å†™éƒ½ä¼šæä¾›ä¸€ä¸ªå—ç¼“å†²ï¼ˆåœ¨æœ‰äº›åœ°æ–¹ä¹Ÿè¢«ç§°ä¸ºå†…æ ¸é«˜é€Ÿç¼“å­˜ï¼‰ï¼Œå½“ç”¨writeå‡½æ•°å¯¹å…¶å†™æ•°æ®æ—¶ï¼Œç›´æ¥è°ƒç”¨ç³»ç»Ÿè°ƒç”¨ï¼Œå°†æ•°æ®å†™å…¥åˆ°å—ç¼“å†²è¿›è¡Œæ’é˜Ÿï¼Œå½“å—ç¼“å†²è¾¾åˆ°ä¸€å®šçš„é‡æ—¶ï¼Œæ‰ä¼šæŠŠæ•°æ®å†™å…¥ç£ç›˜ã€‚å› æ­¤æ‰€è°“çš„ä¸å¸¦ç¼“å†²çš„I/Oæ˜¯æŒ‡è¿›ç¨‹ä¸æä¾›ç¼“å†²åŠŸèƒ½ï¼ˆä½†å†…æ ¸è¿˜æ˜¯æä¾›ç¼“å†²çš„ï¼‰ã€‚æ¯è°ƒç”¨ä¸€æ¬¡writeæˆ–readå‡½æ•°ï¼Œç›´æ¥ç³»ç»Ÿè°ƒç”¨ã€‚<br>è€Œå¸¦ç¼“å†²çš„I/Oæ˜¯æŒ‡è¿›ç¨‹å¯¹è¾“å…¥è¾“å‡ºæµè¿›è¡Œäº†æ”¹è¿›ï¼Œæä¾›äº†ä¸€ä¸ªæµç¼“å†²ï¼Œå½“ç”¨fwriteå‡½æ•°ç½‘ç£ç›˜å†™æ•°æ®æ—¶ï¼Œå…ˆæŠŠæ•°æ®å†™å…¥æµç¼“å†²åŒºä¸­ï¼Œå½“è¾¾åˆ°ä¸€å®šæ¡ä»¶ï¼Œæ¯”å¦‚æµç¼“å†²åŒºæ»¡äº†ï¼Œæˆ–åˆ·æ–°æµç¼“å†²ï¼Œè¿™æ—¶å€™æ‰ä¼šæŠŠæ•°æ®ä¸€æ¬¡é€å¾€å†…æ ¸æä¾›çš„å—ç¼“å†²ï¼Œå†ç»å—ç¼“å†²å†™å…¥ç£ç›˜ã€‚ï¼ˆåŒé‡ç¼“å†²ï¼‰<br>å› æ­¤ï¼Œå¸¦ç¼“å†²çš„I/Oåœ¨å¾€ç£ç›˜å†™å…¥ç›¸åŒçš„æ•°æ®é‡æ—¶ï¼Œä¼šæ¯”ä¸å¸¦ç¼“å†²çš„I/Oè°ƒç”¨ç³»ç»Ÿè°ƒç”¨çš„æ¬¡æ•°è¦å°‘ã€‚<br>æ— ç¼“å­˜IOæ“ä½œæ•°æ®æµå‘è·¯å¾„ï¼š<strong>æ•°æ®â€”â€”å†…æ ¸ç¼“å­˜åŒºâ€”â€”ç£ç›˜</strong><br>æ ‡å‡†IOæ“ä½œæ•°æ®æµå‘è·¯å¾„ï¼š<strong>æ•°æ®â€”â€”æµç¼“å­˜åŒºâ€”â€”å†…æ ¸ç¼“å­˜åŒºâ€”â€”ç£ç›˜</strong></p><h3 id="é¢„è¯»"><a href="#é¢„è¯»" class="headerlink" title="é¢„è¯»"></a>é¢„è¯»</h3><p>å¤§å¤šæ•°æ–‡ä»¶ç³»ç»Ÿä¸ºæ”¹å–„æ€§èƒ½éƒ½é‡‡ç”¨æŸç§é¢„è¯»ï¼ˆread aheadï¼‰æŠ€æœ¯ã€‚å½“æ£€æµ‹åˆ°æ­£è¿›è¡Œé¡ºåºè¯»å–æ—¶ï¼Œç³»ç»Ÿå°±è¯•å›¾è¯»å…¥æ¯”åº”ç”¨æ‰€è¦æ±‚çš„æ›´å¤šæ•°æ®ï¼Œå¹¶å‡æƒ³åº”ç”¨å¾ˆå¿«å°±ä¼šè¯»è¿™äº›æ•°æ®ã€‚</p><h3 id="å»¶è¿Ÿå†™"><a href="#å»¶è¿Ÿå†™" class="headerlink" title="å»¶è¿Ÿå†™"></a>å»¶è¿Ÿå†™</h3><p>ä¼ ç»Ÿçš„UNIXç³»ç»Ÿå®ç°åœ¨å†…æ ¸ä¸­è®¾æœ‰ç¼“å†²åŒºé«˜é€Ÿç¼“å­˜æˆ–é¡µé«˜é€Ÿç¼“å­˜ï¼Œå¤§å¤šæ•°ç£ç›˜I/Oéƒ½é€šè¿‡ç¼“å†²åŒºè¿›è¡Œã€‚å½“æˆ‘ä»¬å‘æ–‡ä»¶å†™å…¥æ•°æ®æ—¶ï¼Œå†…æ ¸é€šå¸¸å…ˆå°†æ•°æ®å¤åˆ¶åˆ°ç¼“å†²åŒºä¸­ï¼Œç„¶åæ’å…¥é˜Ÿåˆ—ï¼Œæ™šäº›æ—¶å€™å†å†™å…¥ç£ç›˜ã€‚è¿™ç§æ–¹å¼è¢«æˆä¸ºå»¶è¿Ÿå†™ï¼ˆdelayed writeï¼‰ã€‚</p><h3 id="I-Oä¸ç£ç›˜äº¤äº’æµç¨‹"><a href="#I-Oä¸ç£ç›˜äº¤äº’æµç¨‹" class="headerlink" title="I/Oä¸ç£ç›˜äº¤äº’æµç¨‹"></a>I/Oä¸ç£ç›˜äº¤äº’æµç¨‹</h3><p>å½“åº”ç”¨ç¨‹åºå°è¯•è¯»å–æŸå—æ•°æ®çš„æ—¶å€™ï¼Œå¦‚æœè¿™å—æ•°æ®å·²ç»å­˜æ”¾åœ¨é¡µç¼“å­˜ä¸­ï¼Œé‚£ä¹ˆè¿™å—æ•°æ®å°±å¯ä»¥ç«‹å³è¿”å›ç»™åº”ç”¨ç¨‹åºï¼Œè€Œä¸éœ€è¦ç»è¿‡å®é™…çš„ç‰©ç†è¯»ç›˜æ“ä½œã€‚å½“ç„¶ï¼Œå¦‚æœæ•°æ®åœ¨åº”ç”¨ç¨‹åºè¯»å–ä¹‹å‰å¹¶æœªè¢«å­˜æ”¾åœ¨é¡µç¼“å­˜ä¸­ï¼ˆä¹Ÿå°±æ˜¯ä¸Šé¢æåˆ°çš„å†…æ ¸é«˜é€Ÿç¼“å­˜ï¼‰ï¼Œé‚£ä¹ˆå°±éœ€è¦å…ˆå°†æ•°æ®ä»ç£ç›˜è¯»åˆ°é¡µç¼“å­˜ä¸­å»(è¿™ä¸ªè¿‡ç¨‹è§¦å‘ç¼ºé¡µå¼‚å¸¸)ã€‚å¯¹äºå†™æ“ä½œæ¥è¯´ï¼Œåº”ç”¨ç¨‹åºä¹Ÿä¼šå°†æ•°æ®å…ˆå†™åˆ°é¡µç¼“å­˜ä¸­å»ï¼ˆè¿™é‡Œæ‰€è¯´çš„å†™åˆ°é¡µç¼“å­˜ä¸­ï¼Œå¦‚æœæ˜¯è°ƒç”¨æ ‡å‡†åº“I/Oè¿›è¡Œå†™ï¼Œé‚£ä¹ˆé¦–å…ˆæ˜¯å†™åˆ°æ ‡å‡†åº“çš„ç¼“å†²åŒºå†…ï¼Œå¦‚æœæ ‡å‡†åº“çš„ç¼“å†²åŒºå†™æ»¡ä»¥åï¼Œåœ¨å†™åˆ°é¡µç¼“å†²å†…ï¼›å¦‚æœæ˜¯ç³»ç»Ÿè°ƒç”¨ï¼Œé‚£ä¹ˆç›´æ¥å†™åˆ°é¡µç¼“å†²å†…ï¼‰ï¼Œæ•°æ®æ˜¯å¦è¢«ç«‹å³å†™åˆ°ç£ç›˜ä¸Šå»å–å†³äºåº”ç”¨ç¨‹åºæ‰€é‡‡ç”¨çš„å†™æ“ä½œæœºåˆ¶ï¼šå¦‚æœç”¨æˆ·é‡‡ç”¨çš„æ˜¯åŒæ­¥å†™æœºåˆ¶,é‚£ä¹ˆæ•°æ®ä¼šç«‹å³è¢«å†™å›åˆ°ç£ç›˜ä¸Šï¼Œåº”ç”¨ç¨‹åºä¼šä¸€ç›´ç­‰åˆ°æ•°æ®è¢«å†™å®Œä¸ºæ­¢ï¼›å¦‚æœç”¨æˆ·é‡‡ç”¨çš„æ˜¯å»¶è¿Ÿå†™æœºåˆ¶ï¼Œé‚£ä¹ˆåº”ç”¨ç¨‹åºå°±å®Œå…¨ä¸éœ€è¦ç­‰åˆ°æ•°æ®å…¨éƒ¨è¢« å†™å›åˆ°ç£ç›˜ï¼Œæ•°æ®åªè¦è¢«å†™åˆ°é¡µç¼“å­˜ä¸­å»å°±å¯ä»¥äº†ã€‚åœ¨å»¶è¿Ÿå†™æœºåˆ¶çš„æƒ…å†µä¸‹ï¼Œæ“ä½œç³»ç»Ÿä¼šå®šæœŸåœ°å°†æ”¾åœ¨é¡µç¼“å­˜ä¸­çš„æ•°æ®åˆ·åˆ°ç£ç›˜ä¸Šã€‚ä¸å¼‚æ­¥å†™æœºåˆ¶ä¸åŒçš„æ˜¯ï¼Œå»¶è¿Ÿå†™æœºåˆ¶åœ¨æ•°æ®å®Œå…¨å†™åˆ°ç£ç›˜ä¸Šå¾—æ—¶å€™ä¸ä¼šé€šçŸ¥åº”ç”¨ç¨‹åºï¼Œè€Œå¼‚æ­¥å†™æœºåˆ¶åœ¨æ•°æ®å®Œå…¨å†™åˆ°ç£ç›˜ä¸Šå¾—æ—¶å€™æ˜¯ä¼šè¿”å›ç»™åº”ç”¨ç¨‹åºçš„ã€‚æ‰€ä»¥å»¶è¿Ÿå†™æœºåˆ¶æœ¬çœæ˜¯å­˜åœ¨æ•°æ®ä¸¢å¤±çš„é£é™©çš„ï¼Œè€Œå¼‚æ­¥å†™æœºåˆ¶åˆ™ä¸ä¼šæœ‰è¿™æ–¹é¢çš„æ‹…å¿ƒã€‚</p><h2 id="æ–‡ä»¶å…±äº«"><a href="#æ–‡ä»¶å…±äº«" class="headerlink" title="æ–‡ä»¶å…±äº«"></a>æ–‡ä»¶å…±äº«</h2><p>å†…æ ¸ä½¿ç”¨4ç§æ•°æ®ç»“æ„è¡¨ç¤ºæ‰“å¼€æ–‡ä»¶ï¼Œå®ƒä»¬ä¹‹é—´çš„å…³ç³»å†³å®šäº†åœ¨æ–‡ä»¶å…±äº«æ–¹é¢ä¸€ä¸ªè¿›ç¨‹å¯¹å¦ä¸€ä¸ªè¿›ç¨‹å¯èƒ½äº§ç”Ÿçš„å½±å“ã€‚</p><ul><li><code>è¿›ç¨‹è¡¨</code>ã€‚æ¯ä¸ªè¿›ç¨‹åœ¨è¿›ç¨‹è¡¨ä¸­éƒ½æœ‰ä¸€ä¸ªè®°å½•é¡¹ï¼Œè®°å½•é¡¹ä¸­åŒ…å«ä¸€å¼ æ‰“å¼€æ–‡ä»¶æè¿°ç¬¦è¡¨ï¼Œå¯å°†å…¶è§†ä¸ºä¸€ä¸ªçŸ¢é‡ï¼Œæ¯ä¸ªæè¿°ç¬¦å ç”¨ä¸€é¡¹ã€‚ä¸æ¯ä¸ªæ–‡ä»¶æè¿°ç¬¦ç›¸å…³è”çš„æ˜¯ï¼š<ol><li>æ–‡ä»¶æè¿°ç¬¦æ ‡å¿—ï¼ˆclose_on_execï¼‰</li><li>æŒ‡å‘ä¸€ä¸ªæ–‡ä»¶è¡¨é¡¹çš„æŒ‡é’ˆ</li></ol></li><li><code>æ–‡ä»¶è¡¨</code>ã€‚å†…æ ¸ä¸ºæ‰€ä»¥æ‰“å¼€æ–‡ä»¶ç»´æŒä¸€å¼ æ–‡ä»¶è¡¨ï¼ˆå…¨å±€å”¯ä¸€ï¼Œæ‰€æœ‰è¿›ç¨‹å…±äº«ä¸€ä¸ªæ–‡ä»¶è¡¨ï¼‰ã€‚å…¶ä¸­çš„æ¯ä¸ªæ–‡ä»¶è¡¨é¡¹å¯¹åº”ä¸€ä¸ªè¿›ç¨‹ä¸­æ‰“å¼€çš„æ–‡ä»¶ï¼Œå®ƒåŒ…å«ï¼š<ol><li>æ–‡ä»¶çŠ¶æ€æ ‡å¿—ï¼ˆåªè¯»ã€åªå†™ã€è¯»å†™ã€è¿½åŠ å†™ã€åŒæ­¥/å¼‚æ­¥ã€é˜»å¡/éé˜»å¡ç­‰ï¼‰</li><li>å½“å‰æ–‡ä»¶åç§»é‡</li><li>æŒ‡å‘è¯¥æ–‡ä»¶vèŠ‚ç‚¹è¡¨é¡¹çš„æŒ‡é’ˆ</li></ol></li><li><code>vèŠ‚ç‚¹</code>ã€‚æ¯ä¸ªæ‰“å¼€æ–‡ä»¶ï¼ˆæˆ–è®¾å¤‡ï¼‰éƒ½æœ‰ä¸€ä¸ªvèŠ‚ç‚¹ï¼ˆv-nodeï¼‰ç»“æ„ã€‚vèŠ‚ç‚¹åŒ…å«äº†æ–‡ä»¶ç±»å‹å’Œå¯¹æ­¤æ–‡ä»¶è¿›è¡Œå„ç§æ“ä½œå‡½æ•°çš„æŒ‡é’ˆã€‚å¯¹äºå¤§å¤šæ•°æ–‡ä»¶ï¼ŒvèŠ‚ç‚¹è¿˜åŒ…å«äº†è¯¥æ–‡ä»¶çš„ièŠ‚ç‚¹æŒ‡é’ˆã€‚</li><li><code>ièŠ‚ç‚¹</code>ã€‚ièŠ‚ç‚¹åŒ…å«äº†æ–‡ä»¶çš„æ‰€æœ‰è€…ã€æ–‡ä»¶é•¿åº¦ã€æŒ‡å‘æ–‡ä»¶å®é™…æ•°æ®å—åœ¨ç£ç›˜æ‰€åœ¨ä½ç½®çš„æŒ‡é’ˆç­‰ã€‚</li></ul><blockquote><p>Linuxæ²¡æœ‰ä½¿ç”¨vèŠ‚ç‚¹ï¼Œè€Œæ˜¯ä½¿ç”¨äº†é€šç”¨ièŠ‚ç‚¹ç»“æ„ï¼ˆä¸€ä¸ªä¸æ–‡ä»¶ç³»ç»Ÿç›¸å…³çš„ièŠ‚ç‚¹ï¼Œä¸€ä¸ªä¸æ–‡ä»¶ç³»ç»Ÿæ— å…³çš„ièŠ‚ç‚¹ï¼‰ã€‚è™½ç„¶å®ç°ä¸åŒï¼Œä½†åœ¨æ¦‚å¿µä¸Šï¼ŒvèŠ‚ç‚¹ä¸ièŠ‚ç‚¹æ˜¯ä¸€æ ·çš„ï¼Œä¸¤è€…éƒ½æŒ‡å‘æ–‡ä»¶ç³»ç»Ÿç‰¹æœ‰çš„ièŠ‚ç‚¹ç»“æ„ã€‚</p></blockquote><p><img src="3-7.png" alt=""><br><img src="3-8.png" alt=""></p><p>æ‰“å¼€è¯¥æ–‡ä»¶çš„æ¯ä¸ªè¿›ç¨‹éƒ½èƒ½è·å¾—å„è‡ªçš„ä¸€ä¸ªæ–‡ä»¶è¡¨é¡¹ï¼Œä½†å¯¹ä¸€ä¸ªç»™çš„æ–‡ä»¶åªæœ‰ä¸€ä¸ªvèŠ‚ç‚¹è¡¨é¡¹ã€‚è¿™æ ·æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰å®ƒè‡ªå·±å¯¹è¯¥æ–‡ä»¶åç§»é‡ä»¥åŠæ‰“å¼€æ–¹å¼ã€‚<br>å¯èƒ½æœ‰å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦æŒ‡å‘åŒä¸€æ–‡ä»¶è¡¨é¡¹çš„æƒ…å†µï¼Œå¦‚dupå’Œforkå‡½æ•°ã€‚</p><h3 id="æ–‡ä»¶æè¿°ç¬¦æ ‡å¿—ä¸æ–‡ä»¶çŠ¶æ€æ ‡å¿—çš„åŒºåˆ«"><a href="#æ–‡ä»¶æè¿°ç¬¦æ ‡å¿—ä¸æ–‡ä»¶çŠ¶æ€æ ‡å¿—çš„åŒºåˆ«" class="headerlink" title="æ–‡ä»¶æè¿°ç¬¦æ ‡å¿—ä¸æ–‡ä»¶çŠ¶æ€æ ‡å¿—çš„åŒºåˆ«"></a>æ–‡ä»¶æè¿°ç¬¦æ ‡å¿—ä¸æ–‡ä»¶çŠ¶æ€æ ‡å¿—çš„åŒºåˆ«</h3><p><strong>å‰è€…åªç”¨äºä¸€ä¸ªè¿›ç¨‹çš„ä¸€ä¸ªæè¿°ç¬¦ï¼Œåè€…åˆ™åº”ç”¨äºæŒ‡å‘è¯¥ç»™å®šæ–‡ä»¶è¡¨é¡¹çš„ä»»ä½•è¿›ç¨‹ä¸­çš„æ‰€æœ‰æè¿°ç¬¦ã€‚</strong></p><h2 id="åŸå­æ“ä½œ"><a href="#åŸå­æ“ä½œ" class="headerlink" title="åŸå­æ“ä½œ"></a>åŸå­æ“ä½œ</h2><p><code>åŸå­æ“ä½œï¼ˆatomic operationï¼‰</code>æŒ‡çš„æ˜¯ç”±å¤šæ­¥ç»„æˆçš„ä¸€ä¸ªæ“ä½œã€‚å¦‚æœè¯¥æ“ä½œåŸå­çš„æ‰§è¡Œï¼Œè¦ä¹ˆæ‰§è¡Œå®Œæ‰€æœ‰æ­¥éª¤ï¼Œè¦ä¹ˆä¸€æ­¥ä¹Ÿä¸æ‰§è¡Œï¼Œä¸å¯èƒ½åªæ‰§è¡Œæ‰€æœ‰æ­¥éª¤çš„ä¸€ä¸ªå­é›†ã€‚ä»»ä½•è¦æ±‚å¤šäºä¸€ä¸ªå‡½æ•°è°ƒç”¨çš„æ“ä½œéƒ½ä¸æ˜¯åŸå­æ“ä½œï¼Œå› ä¸ºåœ¨ä¸¤ä¸ªå‡½æ•°è°ƒç”¨ä¹‹é—´ï¼Œå†…æ ¸æœ‰å¯èƒ½ä¼šä¸´æ—¶æŒ‚èµ·è¿›ç¨‹ã€‚<br>æˆ‘ä»¬ç”¨<code>pread</code>å’Œ<code>pwrite</code>å‡½æ•°è¿›è¡ŒI/Oæ¥ä¿è¯<code>lseek</code>å’Œ<code>read</code>/<code>write</code>æ„æˆåŸå­æ“ä½œã€‚</p><h2 id="å…¶ä»–I-Oå‡½æ•°"><a href="#å…¶ä»–I-Oå‡½æ•°" class="headerlink" title="å…¶ä»–I/Oå‡½æ•°"></a>å…¶ä»–I/Oå‡½æ•°</h2><h3 id="dupï¼ˆdup2ï¼‰"><a href="#dupï¼ˆdup2ï¼‰" class="headerlink" title="dupï¼ˆdup2ï¼‰"></a>dupï¼ˆdup2ï¼‰</h3><p>ç”¨æ¥å¤åˆ¶ä¸€ä¸ªç°æœ‰çš„æ–‡ä»¶æè¿°ç¬¦ã€‚å¤åˆ¶åæ¯ä¸ªæ–‡ä»¶æè¿°ç¬¦éƒ½æœ‰å®ƒè‡ªå·±çš„ä¸€å¥—æ–‡ä»¶æè¿°ç¬¦æ ‡å¿—ã€‚ä¸¤ä¸ªæè¿°ç¬¦æŒ‡å‘åŒä¸€æ–‡ä»¶è¡¨é¡¹ï¼Œæ‰€ä»¥å®ƒä»¬å…±äº«åŒä¸€æ–‡ä»¶çŠ¶æ€æ ‡å¿—ï¼ˆè¯»ã€å†™ã€è¿½åŠ å†™ç­‰ï¼‰<br><img src="3-9.png" alt=""></p><h3 id="syncã€fsyncå’Œfdatasync"><a href="#syncã€fsyncå’Œfdatasync" class="headerlink" title="syncã€fsyncå’Œfdatasync"></a><code>sync</code>ã€<code>fsync</code>å’Œ<code>fdatasync</code></h3><p>ç”¨äºä¿è¯ç£ç›˜ä¸Šå®é™…æ–‡ä»¶ç³»ç»Ÿä¸ç¼“å†²åŒºä¸­å†…å®¹çš„ä¸€è‡´æ€§ã€‚</p><ul><li><code>sync</code>åªæ˜¯å°†æ‰€æœ‰ä¿®æ”¹è¿‡çš„å—ç¼“å†²åŒºæ’å…¥å†™é˜Ÿåˆ—å°±è¿”å›ï¼Œå®ƒä¸ç­‰å¾…å®é™…å†™ç£ç›˜æ“ä½œç»“æŸã€‚é€šå¸¸ç§°ä¸ºupdateçš„ç³»ç»Ÿå®ˆæŠ¤è¿›ç¨‹å‘¨æœŸæ€§åœ°ï¼ˆä¸€èˆ¬ä¸º30ç§’ï¼‰è°ƒç”¨syncå‡½æ•°ï¼Œè¿™å°±ä¿è¯äº†å®šæœŸå†²æ´—ï¼ˆflushï¼‰å†…æ ¸çš„å—ç¼“å†²åŒºã€‚</li><li><code>fsync</code>åªå¯¹ç”±fdæŒ‡å®šçš„ä¸€ä¸ªæ–‡ä»¶èµ·ä½œç”¨ï¼Œå¹¶ç­‰å¾…å†™ç£ç›˜æ“ä½œç»“æŸæ‰è¿”å›ã€‚</li><li><code>fdatasync</code>ç±»ä¼¼äº<code>fsync</code>ï¼Œä½†å½±å“æ–‡ä»¶çš„æ•°æ®éƒ¨åˆ†</li></ul><h3 id="fcntl"><a href="#fcntl" class="headerlink" title="fcntl"></a>fcntl</h3><p>ç”¨äºæ”¹å˜å·²ç»æ‰“å¼€æ–‡ä»¶çš„å±æ€§ï¼Œä¸»è¦ç”±ä»¥ä¸‹5ç§åŠŸèƒ½ï¼š</p><ol><li>å¤åˆ¶ä¸€ä¸ªå·²æœ‰çš„æè¿°ç¬¦(cmd = F_DUPFD æˆ– F_DUPFD_CLOEXEC)</li><li>è·å–/è®¾ç½®æ–‡ä»¶æè¿°ç¬¦æ ‡å¿—(cmd = F_GETFD æˆ– F_SETFD)</li><li>è·å–/è®¾ç½®æ–‡ä»¶çŠ¶æ€æ ‡å¿—(cmd = F_GETFL æˆ– F_SETFL)</li><li>è·å–/è®¾ç½®å¼‚æ­¥I/Oæ‰€æœ‰æƒ(cmd = F_GETONW æˆ– F_SETOWN)</li><li>è·å–/è®¾ç½®è®°å½•é”(cmd = F_GETLK ã€ F_SETLK æˆ– F_SETLKWï¼ˆé˜»å¡ç‰ˆæœ¬ï¼‰)</li></ol><h3 id="ioctl"><a href="#ioctl" class="headerlink" title="ioctl"></a>ioctl</h3><p>I/Oæ“ä½œçš„æ‚ç‰©ç®±ï¼Œæœªæ€»ç»“çš„å…¶ä»–I/Oæ“ä½œéƒ½åœ¨é‡Œé¢ã€‚</p><h2 id="dev-fd"><a href="#dev-fd" class="headerlink" title="/dev/fd"></a>/dev/fd</h2><p>è¾ƒæ–°çš„ç³»ç»Ÿéƒ½æä¾›/dev/fdç›®å½•ï¼Œå…¶ç›®å½•é¡¹æ˜¯åä¸º0ã€1ã€2ç­‰æ–‡ä»¶ï¼Œæ‰“å¼€æ–‡ä»¶/dev/fd/n ç­‰æ•ˆäº å¤åˆ¶æè¿°ç¬¦nï¼ˆå‡å®šæè¿°ç¬¦næ˜¯æ‰“å¼€çš„ï¼‰ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;æ–‡ä»¶æè¿°ç¬¦&quot;&gt;&lt;a href=&quot;#æ–‡ä»¶æè¿°ç¬¦&quot; class=&quot;headerlink&quot; title=&quot;æ–‡ä»¶æè¿°ç¬¦&quot;&gt;&lt;/a&gt;æ–‡ä»¶æè¿°ç¬¦&lt;/h2&gt;&lt;p&gt;å¯¹äºå†…æ ¸è€Œè¨€ï¼Œæ‰€æœ‰æ‰“å¼€çš„æ–‡ä»¶éƒ½é€šè¿‡æ–‡ä»¶æè¿°ç¬¦å¼•ç”¨ã€‚æ–‡ä»¶æè¿°ç¬¦æ˜¯ä¸€ä¸ªéè´Ÿæ•´æ•°ã€‚å½“æ‰“å¼€ä¸€ä¸ªç°æœ‰æ–‡ä»¶æˆ–åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶æ—¶ï¼Œå†…æ ¸å‘è¿›ç¨‹è¿”å›ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;0 - STDIN_FILENO - æ ‡å‡†è¾“å…¥&lt;/li&gt;
&lt;li&gt;1 - STDOUT_FILENO - æ ‡å‡†è¾“å‡º&lt;/li&gt;
&lt;li&gt;2 - STDERR_FILENO - æ ‡å‡†é”™è¯¯&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;ä¸å¸¦ç¼“å†²çš„I-Oå‡½æ•°&quot;&gt;&lt;a href=&quot;#ä¸å¸¦ç¼“å†²çš„I-Oå‡½æ•°&quot; class=&quot;headerlink&quot; title=&quot;ä¸å¸¦ç¼“å†²çš„I/Oå‡½æ•°&quot;&gt;&lt;/a&gt;ä¸å¸¦ç¼“å†²çš„I/Oå‡½æ•°&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;open(openat) æ‰“å¼€æˆ–åˆ›å»ºä¸€ä¸ªæ–‡ä»¶&lt;/li&gt;
&lt;li&gt;creat åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶&lt;/li&gt;
&lt;li&gt;close å…³é—­ä¸€ä¸ªæ‰“å¼€æ–‡ä»¶&lt;/li&gt;
&lt;li&gt;lseek è®¾ç½®åç§»é‡ï¼ˆlseekä»…å°†å½“å‰æ–‡ä»¶åç§»é‡è®°å½•åœ¨å†…æ ¸ä¸­ï¼Œä¸å¼•èµ·ä»»ä½•I/Oæ“ä½œï¼‰&lt;/li&gt;
&lt;li&gt;read ä»æ‰“å¼€æ–‡ä»¶ä¸­è¯»æ•°æ®&lt;/li&gt;
&lt;li&gt;write å‘æ‰“å¼€æ–‡ä»¶å†™æ•°æ®&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
    
      <category term="ã€ŠAPUEã€‹ç¬”è®°" scheme="https://akaqin.github.io/categories/%E3%80%8AAPUE%E3%80%8B%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="I/O" scheme="https://akaqin.github.io/tags/I-O/"/>
    
      <category term="æ–‡ä»¶" scheme="https://akaqin.github.io/tags/%E6%96%87%E4%BB%B6/"/>
    
  </entry>
  
  <entry>
    <title>ã€ŠUNIXç¯å¢ƒé«˜çº§ç¼–ç¨‹ã€‹ç¬¬13ç« â€”â€”å®ˆæŠ¤è¿›ç¨‹</title>
    <link href="https://akaqin.github.io/2020/04/09/%E3%80%8AUNIX%E7%8E%AF%E5%A2%83%E9%AB%98%E7%BA%A7%E7%BC%96%E7%A8%8B%E3%80%8B%E7%AC%AC13%E7%AB%A0%E2%80%94%E2%80%94%E5%AE%88%E6%8A%A4%E8%BF%9B%E7%A8%8B/"/>
    <id>https://akaqin.github.io/2020/04/09/%E3%80%8AUNIX%E7%8E%AF%E5%A2%83%E9%AB%98%E7%BA%A7%E7%BC%96%E7%A8%8B%E3%80%8B%E7%AC%AC13%E7%AB%A0%E2%80%94%E2%80%94%E5%AE%88%E6%8A%A4%E8%BF%9B%E7%A8%8B/</id>
    <published>2020-04-09T13:39:09.000Z</published>
    <updated>2020-04-14T01:23:51.597Z</updated>
    
    <content type="html"><![CDATA[<p>å®ˆæŠ¤è¿›ç¨‹ï¼ˆdaemonï¼‰æ˜¯ç”Ÿå­˜æœŸé•¿çš„ä¸€ç§è¿›ç¨‹ã€‚å®ƒä»¬å¸¸å¸¸åœ¨ç³»ç»Ÿå¼•å¯¼è£…å…¥æ—¶å¯åŠ¨ï¼Œä»…åœ¨ç³»ç»Ÿå…³é—­æ—¶æ‰ç»ˆæ­¢ã€‚å®ˆæŠ¤è¿›ç¨‹æ²¡æœ‰æ§åˆ¶ç»ˆç«¯ï¼Œç»ˆç«¯åä¸ºé—®å·ã€‚åå°è¿è¡Œï¼Œå¤§å¤šæ•°éƒ½ä»¥è¶…çº§ç”¨æˆ·ï¼ˆrootï¼‰ç‰¹æƒè¿è¡Œã€‚ç”¨æˆ·å±‚å®ˆæŠ¤è¿›ç¨‹çš„çˆ¶è¿›ç¨‹æ˜¯initã€‚</p><h2 id="ç¼–ç¨‹è§„åˆ™"><a href="#ç¼–ç¨‹è§„åˆ™" class="headerlink" title="ç¼–ç¨‹è§„åˆ™"></a>ç¼–ç¨‹è§„åˆ™</h2><ol><li>è°ƒç”¨umaskå°†æ–‡ä»¶æ¨¡å¼åˆ›å»ºå±è”½å­—è®¾ç½®ä¸ºä¸€ä¸ªå·²çŸ¥å€¼ï¼ˆé€šå¸¸æ˜¯0ï¼‰ã€‚</li><li>è°ƒç”¨forkï¼Œç„¶åä½¿çˆ¶è¿›ç¨‹exitã€‚</li><li>è°ƒç”¨setsidåˆ›å»ºä¸€ä¸ªæ–°ä¼šè¯ã€‚ä½¿è°ƒç”¨è¿›ç¨‹ï¼šï¼ˆaï¼‰æˆä¸ºæ–°ä¼šè¯çš„é¦–è¿›ç¨‹ï¼Œï¼ˆbï¼‰æˆä¸ºä¸€ä¸ªæ–°è¿›ç¨‹ç»„çš„ç»„é•¿è¿›ç¨‹ï¼Œï¼ˆcï¼‰æ²¡æœ‰æ§åˆ¶ç»ˆç«¯ã€‚</li><li>å°†å½“å‰å·¥ä½œç›®å½•æ›´æ”¹ä¸ºæ ¹ç›®å½•ã€‚é¿å…æ–‡ä»¶ç³»ç»Ÿè¢«å¸è½½ã€‚</li><li>å…³é—­ä¸å†éœ€è¦çš„æ–‡ä»¶æè¿°ç¬¦ã€‚</li><li>æŸäº›å®ˆæŠ¤è¿›ç¨‹æ‰“å¼€/dev/nullä½¿å…¶å…·æœ‰æ–‡ä»¶æè¿°ç¬¦0ã€1ã€2ï¼Œè¿™æ ·ä»»ä½•ä¸€ä¸ªè¯•å›¾è¯»/å†™æ ‡å‡†è¾“å…¥/è¾“å‡º/é”™è¯¯çš„åº“ä¾‹ç¨‹éƒ½ä¸ä¼šäº§ç”Ÿä»»ä½•æ•ˆæœã€‚</li></ol><a id="more"></a><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"../apue.3e/include/apue.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;syslog.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/resource.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dameonize</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *cmd)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i, pid, fd0, fd1, fd2;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">rlimit</span> <span class="title">rl</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">sigaction</span> <span class="title">sa</span>;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//1 å…³é—­å±è”½å­—</span></span><br><span class="line">    umask(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2 è·å–æœ€å¤§æè¿°ç¬¦é™åˆ¶</span></span><br><span class="line">    <span class="keyword">if</span> (getrlimit(RLIMIT_NOFILE, &amp;rl) != <span class="number">0</span>) &#123;</span><br><span class="line">        err_quit(<span class="string">"%s: can't get file limit"</span>, cmd);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//3 forkï¼Œçˆ¶è¿›ç¨‹é€€å‡º</span></span><br><span class="line">    <span class="keyword">if</span> ((pid = fork()) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        err_quit(<span class="string">"%s: can't fork"</span>, cmd);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (pid &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//4 å»ºç«‹æ–°ä¼šè¯</span></span><br><span class="line">    setsid();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//5 Ensure future opens won't allocate controlling TTYs.</span></span><br><span class="line">    sa.sa_handler = SIG_IGN;</span><br><span class="line">    sigemptyset(&amp;sa.sa_mask);</span><br><span class="line">    sa.sa_flags = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (sigaction(SIGHUP, &amp;sa, <span class="literal">NULL</span>) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        err_quit(<span class="string">"%s: can't ignore SIGHUP"</span>, cmd);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ((pid = fork()) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        err_quit(<span class="string">"%s: can't fork"</span>, cmd);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (pid &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 6 Change the current working directory to the root so</span></span><br><span class="line">    <span class="comment">// we won't prevent file systems from being unmounted.</span></span><br><span class="line">    <span class="keyword">if</span> (chdir(<span class="string">"/"</span>) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        err_quit(<span class="string">"%s: can't change directory to /"</span>, cmd);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Close all open file descriptors.</span></span><br><span class="line">    <span class="keyword">if</span> (rl.rlim_max == RLIM_INFINITY) &#123;</span><br><span class="line">        rl.rlim_max = <span class="number">1024</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; rl.rlim_max; i++) &#123;</span><br><span class="line">        <span class="built_in">close</span>(i);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Attach file descriptors 0, 1, and 2 to /dev/null.</span></span><br><span class="line">    fd0 = <span class="built_in">open</span>(<span class="string">"/dev/null"</span>, O_RDWR);</span><br><span class="line">    fd1 = dup(<span class="number">0</span>);</span><br><span class="line">    fd2 = dup(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Initialize the log file.</span></span><br><span class="line">    openlog(cmd, LOG_CONS, LOG_DAEMON);</span><br><span class="line">    <span class="keyword">if</span> (fd0 != <span class="number">0</span> || fd1 != <span class="number">1</span> || fd2 != <span class="number">2</span>) &#123;</span><br><span class="line">        syslog(LOG_ERR, <span class="string">"unexpected file descriptors %d %d %d"</span>, fd0, fd1, fd2);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å‡ºé”™è®°å½•"><a href="#å‡ºé”™è®°å½•" class="headerlink" title="å‡ºé”™è®°å½•"></a>å‡ºé”™è®°å½•</h2><p>syslog æ˜¯ä¸€ä¸ªç”¨äºé›†ä¸­è®°å½•æ‰€æœ‰å®ˆæŠ¤è¿›ç¨‹å‡ºé”™è®°å½•çš„è®¾æ–½ï¼Œå®ƒè‡ªèº«çš„å®ˆæŠ¤è¿›ç¨‹æ˜¯syslogdï¼Œè¯¥è®¾æ–½çš„æ¥å£æ˜¯syslogå‡½æ•°ã€‚<br><img src="13-2.png" alt=""><br>æœ‰3ç§æ–¹æ³•äº§ç”Ÿæ—¥å¿—æ¶ˆæ¯ï¼Œsyslogdå®ˆæŠ¤è¿›ç¨‹è¯»å–æ‰€æœ‰3ç§æ ¼å¼çš„æ—¥å¿—æ¶ˆæ¯ï¼š</p><ol><li>å†…æ ¸ä¾‹ç¨‹è°ƒç”¨logå‡½æ•°ã€‚</li><li>å¤§å¤šæ•°ç”¨æˆ·è¿›ç¨‹ï¼ˆå®ˆæŠ¤è¿›ç¨‹ï¼‰è°ƒç”¨syslogå‡½æ•°äº§ç”Ÿæ—¥å¿—æ¶ˆæ¯ã€‚è¿™ä½¿æ¶ˆæ¯è¢«å‘é€è‡³UNIXåŸŸæ•°æ®æŠ¥å¥—æ¥å­—/dev/logã€‚</li><li>æ— è®ºç”¨æˆ·è¿›ç¨‹åœ¨æ­¤ä¸»æœºä¸Šè¿˜æ˜¯é€šè¿‡TCP/IPç½‘ç»œè¿æ¥çš„å…¶ä»–ä¸»æœºä¸Šï¼Œéƒ½å¯å°†æ—¥å¿—æ¶ˆæ¯å‘å‘UDPç«¯å£514.</li></ol><h2 id="å•ä¾‹å®ˆæŠ¤è¿›ç¨‹"><a href="#å•ä¾‹å®ˆæŠ¤è¿›ç¨‹" class="headerlink" title="å•ä¾‹å®ˆæŠ¤è¿›ç¨‹"></a>å•ä¾‹å®ˆæŠ¤è¿›ç¨‹</h2><p>æ–‡ä»¶å’Œè®°å½•é”æä¾›äº†ä¸€ç§æ–¹ä¾¿çš„äº’æ–¥æœºåˆ¶ç”¨äºå®ç°å•ä¾‹.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LOCKFILE <span class="meta-string">"/var/run/daemon.pid"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LOCKMODE (S_IRUSR|S_IWUSR|S_IRGRP|S_IROTH)</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">extern</span> <span class="keyword">int</span> <span class="title">lockfile</span><span class="params">(<span class="keyword">int</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">already_running</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">int</span>fd;</span><br><span class="line"><span class="keyword">char</span>buf[<span class="number">16</span>];</span><br><span class="line"></span><br><span class="line">fd = <span class="built_in">open</span>(LOCKFILE, O_RDWR|O_CREAT, LOCKMODE);</span><br><span class="line"><span class="keyword">if</span> (fd &lt; <span class="number">0</span>) &#123;</span><br><span class="line">syslog(LOG_ERR, <span class="string">"can't open %s: %s"</span>, LOCKFILE, strerror(errno));</span><br><span class="line"><span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (lockfile(fd) &lt; <span class="number">0</span>) &#123;</span><br><span class="line"><span class="keyword">if</span> (errno == EACCES || errno == EAGAIN) &#123;</span><br><span class="line"><span class="built_in">close</span>(fd);</span><br><span class="line"><span class="keyword">return</span>(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line">syslog(LOG_ERR, <span class="string">"can't lock %s: %s"</span>, LOCKFILE, strerror(errno));</span><br><span class="line"><span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line">ftruncate(fd, <span class="number">0</span>);</span><br><span class="line"><span class="built_in">sprintf</span>(buf, <span class="string">"%ld"</span>, (<span class="keyword">long</span>)getpid());</span><br><span class="line"><span class="built_in">write</span>(fd, buf, <span class="built_in">strlen</span>(buf)+<span class="number">1</span>);</span><br><span class="line"><span class="keyword">return</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å®ˆæŠ¤è¿›ç¨‹çš„æƒ¯ä¾‹"><a href="#å®ˆæŠ¤è¿›ç¨‹çš„æƒ¯ä¾‹" class="headerlink" title="å®ˆæŠ¤è¿›ç¨‹çš„æƒ¯ä¾‹"></a>å®ˆæŠ¤è¿›ç¨‹çš„æƒ¯ä¾‹</h2><ul><li>è‹¥å®ˆæŠ¤è¿›ç¨‹ä½¿ç”¨é”æ–‡ä»¶ï¼Œé‚£ä¹ˆè¯¥æ–‡ä»¶é€šå¸¸å­˜å‚¨åœ¨/var/runç›®å½•ä¸­ã€‚</li><li>è‹¥å®ˆæŠ¤è¿›ç¨‹æ”¯æŒé…ç½®é€‰é¡¹ï¼Œé‚£ä¹ˆé…ç½®æ–‡ä»¶é€šå¸¸å­˜æ”¾åœ¨/etcç›®å½•ä¸­ã€‚</li><li>å®ˆæŠ¤è¿›ç¨‹å¯ä»¥å‘½ä»¤è¡Œå¯åŠ¨ï¼Œä½†å®ƒä»¬é€šå¸¸æ˜¯ç³»ç”±ç³»ç»Ÿåˆå§‹åŒ–è„šæœ¬ä¹‹ä¸€å¯åŠ¨çš„ã€‚</li><li>è‹¥ä¸€ä¸ªé¦–è¿›ç¨‹æœ‰ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œé‚£ä¹ˆå½“è¯¥å®ˆæŠ¤è¿›ç¨‹å¯åŠ¨æ—¶ä¼šè¯»è¯¥æ–‡ä»¶ï¼Œä¹‹åä¸å†æŸ¥çœ‹ã€‚è‹¥æƒ³reloadå¯ä»¥ä½¿ç”¨SIGHUPä¿¡å·ã€‚</li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å®ˆæŠ¤è¿›ç¨‹ï¼ˆdaemonï¼‰æ˜¯ç”Ÿå­˜æœŸé•¿çš„ä¸€ç§è¿›ç¨‹ã€‚å®ƒä»¬å¸¸å¸¸åœ¨ç³»ç»Ÿå¼•å¯¼è£…å…¥æ—¶å¯åŠ¨ï¼Œä»…åœ¨ç³»ç»Ÿå…³é—­æ—¶æ‰ç»ˆæ­¢ã€‚å®ˆæŠ¤è¿›ç¨‹æ²¡æœ‰æ§åˆ¶ç»ˆç«¯ï¼Œç»ˆç«¯åä¸ºé—®å·ã€‚åå°è¿è¡Œï¼Œå¤§å¤šæ•°éƒ½ä»¥è¶…çº§ç”¨æˆ·ï¼ˆrootï¼‰ç‰¹æƒè¿è¡Œã€‚ç”¨æˆ·å±‚å®ˆæŠ¤è¿›ç¨‹çš„çˆ¶è¿›ç¨‹æ˜¯initã€‚&lt;/p&gt;
&lt;h2 id=&quot;ç¼–ç¨‹è§„åˆ™&quot;&gt;&lt;a href=&quot;#ç¼–ç¨‹è§„åˆ™&quot; class=&quot;headerlink&quot; title=&quot;ç¼–ç¨‹è§„åˆ™&quot;&gt;&lt;/a&gt;ç¼–ç¨‹è§„åˆ™&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;è°ƒç”¨umaskå°†æ–‡ä»¶æ¨¡å¼åˆ›å»ºå±è”½å­—è®¾ç½®ä¸ºä¸€ä¸ªå·²çŸ¥å€¼ï¼ˆé€šå¸¸æ˜¯0ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;è°ƒç”¨forkï¼Œç„¶åä½¿çˆ¶è¿›ç¨‹exitã€‚&lt;/li&gt;
&lt;li&gt;è°ƒç”¨setsidåˆ›å»ºä¸€ä¸ªæ–°ä¼šè¯ã€‚ä½¿è°ƒç”¨è¿›ç¨‹ï¼šï¼ˆaï¼‰æˆä¸ºæ–°ä¼šè¯çš„é¦–è¿›ç¨‹ï¼Œï¼ˆbï¼‰æˆä¸ºä¸€ä¸ªæ–°è¿›ç¨‹ç»„çš„ç»„é•¿è¿›ç¨‹ï¼Œï¼ˆcï¼‰æ²¡æœ‰æ§åˆ¶ç»ˆç«¯ã€‚&lt;/li&gt;
&lt;li&gt;å°†å½“å‰å·¥ä½œç›®å½•æ›´æ”¹ä¸ºæ ¹ç›®å½•ã€‚é¿å…æ–‡ä»¶ç³»ç»Ÿè¢«å¸è½½ã€‚&lt;/li&gt;
&lt;li&gt;å…³é—­ä¸å†éœ€è¦çš„æ–‡ä»¶æè¿°ç¬¦ã€‚&lt;/li&gt;
&lt;li&gt;æŸäº›å®ˆæŠ¤è¿›ç¨‹æ‰“å¼€/dev/nullä½¿å…¶å…·æœ‰æ–‡ä»¶æè¿°ç¬¦0ã€1ã€2ï¼Œè¿™æ ·ä»»ä½•ä¸€ä¸ªè¯•å›¾è¯»/å†™æ ‡å‡†è¾“å…¥/è¾“å‡º/é”™è¯¯çš„åº“ä¾‹ç¨‹éƒ½ä¸ä¼šäº§ç”Ÿä»»ä½•æ•ˆæœã€‚&lt;/li&gt;
&lt;/ol&gt;
    
    </summary>
    
    
      <category term="ã€ŠAPUEã€‹ç¬”è®°" scheme="https://akaqin.github.io/categories/%E3%80%8AAPUE%E3%80%8B%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="daemon" scheme="https://akaqin.github.io/tags/daemon/"/>
    
  </entry>
  
  <entry>
    <title>ã€ŠUNIXç¯å¢ƒé«˜çº§ç¼–ç¨‹ã€‹ç¬¬12ç« â€”â€”çº¿ç¨‹æ§åˆ¶</title>
    <link href="https://akaqin.github.io/2020/04/07/%E3%80%8AUNIX%E7%8E%AF%E5%A2%83%E9%AB%98%E7%BA%A7%E7%BC%96%E7%A8%8B%E3%80%8B%E7%AC%AC12%E7%AB%A0%E2%80%94%E2%80%94%E7%BA%BF%E7%A8%8B%E6%8E%A7%E5%88%B6/"/>
    <id>https://akaqin.github.io/2020/04/07/%E3%80%8AUNIX%E7%8E%AF%E5%A2%83%E9%AB%98%E7%BA%A7%E7%BC%96%E7%A8%8B%E3%80%8B%E7%AC%AC12%E7%AB%A0%E2%80%94%E2%80%94%E7%BA%BF%E7%A8%8B%E6%8E%A7%E5%88%B6/</id>
    <published>2020-04-07T02:53:02.000Z</published>
    <updated>2020-04-14T01:27:58.533Z</updated>
    
    <content type="html"><![CDATA[<h2 id="çº¿ç¨‹é™åˆ¶"><a href="#çº¿ç¨‹é™åˆ¶" class="headerlink" title="çº¿ç¨‹é™åˆ¶"></a>çº¿ç¨‹é™åˆ¶</h2><p>Single UNIX Specificationå®šä¹‰äº†ä¸€äº›ä¸çº¿ç¨‹æ“ä½œæœ‰å…³çš„é™åˆ¶ï¼š</p><ul><li>çº¿ç¨‹é€€å‡ºæ—¶æ“ä½œç³»ç»Ÿè¯•å›¾é”€æ¯ç‰¹å®šæ•°æ®çš„æœ€å¤§æ¬¡æ•°</li><li>è¿›ç¨‹å¯åˆ›å»ºçš„é”®çš„æœ€å¤§æ•°ç›®</li><li>ä¸€ä¸ªçº¿ç¨‹çš„æ ˆå¯ç”¨çš„æœ€å°å­—èŠ‚æ•°</li><li>è¿›ç¨‹å¯åˆ›å»ºçš„æœ€å¤§çº¿ç¨‹æ•°</li></ul><h2 id="çº¿ç¨‹å±æ€§"><a href="#çº¿ç¨‹å±æ€§" class="headerlink" title="çº¿ç¨‹å±æ€§"></a>çº¿ç¨‹å±æ€§</h2><ul><li>å±æ€§ç±»å‹ä¸º pthread_attr_t</li><li>é€šè¿‡ pthread_attr_init åˆå§‹åŒ–</li><li>é€šè¿‡ pthread_attr_destroy ååˆå§‹åŒ–</li><li>å¦‚æœå¯¹çº¿ç¨‹çš„ç»ˆæ­¢çŠ¶æ€ä¸æ„Ÿå…´è¶£ï¼Œå¯ä»¥ä½¿ç”¨pthread_detachå‡½æ•°è®©æ“ä½œç³»ç»Ÿåœ¨çº¿ç¨‹é€€å‡ºæ—¶å›æ”¶å®ƒæ‰€å ç”¨çš„èµ„æºã€‚</li><li>åˆ›å»ºçº¿ç¨‹å‰å¯ä»¥é€šè¿‡pthread_attr_getdetachstate å’Œ pthread_attr_setdetachstateè®¾ç½®çº¿ç¨‹çš„åˆ†ç¦»çŠ¶æ€</li><li>é€šè¿‡pthread_attr_getstack å’Œ pthread_attr_setstack è®¾ç½®æ ˆå¸§</li></ul><a id="more"></a><p><strong>å¯¹äºè¿›ç¨‹æ¥è¯´ï¼Œè™šæ‹Ÿåœ°å€çš„ç©ºé—´å¤§å°æ˜¯å›ºå®šçš„ï¼Œå› ä¸ºè¿›ç¨‹ä¸­åªæœ‰ä¸€ä¸ªæ ˆï¼Œæ‰€ä»¥å¤§å°é€šå¸¸ä¸æ˜¯é—®é¢˜ã€‚ä½†å¯¹äºçº¿ç¨‹æ¥è¯´ï¼ŒåŒæ ·å¤§å°çš„è™šæ‹Ÿåœ°å€ç©ºé—´å¿…é¡»è¢«æ‰€æœ‰çº¿ç¨‹å…±äº«ã€‚å¦‚æœåº”ç”¨ç¨‹åºä½¿ç”¨äº†è®¸å¤šçº¿ç¨‹ï¼Œä»¥è‡´è¿™äº›çº¿ç¨‹çš„ç´¯è®¡å¤§å°è¶…è¿‡äº†å¯ç”¨çš„è™šæ‹Ÿåœ°å€ç©ºé—´ï¼Œå°±éœ€è¦å‡å°‘é»˜è®¤çš„çº¿ç¨‹æ ˆå¤§å°ã€‚å¦ä¸€æ–¹é¢ï¼Œå¦‚æœçº¿ç¨‹è°ƒç”¨çš„å‡½æ•°åˆ†é…äº†å¤§é‡çš„è‡ªåŠ¨å˜é‡ï¼Œæˆ–è€…è°ƒç”¨çš„å‡½æ•°æ¶‰åŠè®¸å¤šå¾ˆæ·±çš„æ ˆå¸§ï¼Œé‚£ä¹ˆéœ€è¦çš„æ ˆå¤§å°å¯èƒ½è¦æ¯”é»˜è®¤çš„å¤§</strong><br>å¦‚æœçº¿ç¨‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´éƒ½ç”¨å®Œäº†ï¼Œå¯ä»¥ä½¿ç”¨mallocæˆ–è€…mmapæ¥ä¸ºå¯æ›¿ä»£çš„æ ˆåˆ†é…ç©ºé—´ï¼Œå¹¶ä½¿ç”¨pthread_attr_setstackå‡½æ•°æ¥æ”¹å˜æ–°å»ºçº¿ç¨‹çš„æ ˆä½ç½®ã€‚</p><!--more--><h2 id="åŒæ­¥å±æ€§"><a href="#åŒæ­¥å±æ€§" class="headerlink" title="åŒæ­¥å±æ€§"></a>åŒæ­¥å±æ€§</h2><h3 id="äº’æ–¥é‡å±æ€§"><a href="#äº’æ–¥é‡å±æ€§" class="headerlink" title="äº’æ–¥é‡å±æ€§"></a>äº’æ–¥é‡å±æ€§</h3><p>ç”¨ pthread_mutex_attr ç»“æ„è¡¨ç¤ºï¼Œå€¼å¾—æ³¨æ„çš„ä¸‰ä¸ªå±æ€§æ˜¯ï¼š</p><ol><li><p>è¿›ç¨‹å…±äº«å±æ€§ï¼šå…è®¸ç›¸äº’ç‹¬ç«‹çš„å¤šä¸ªè¿›ç¨‹æŠŠåŒä¸€ä¸ªå†…å­˜æ•°æ®å—æ˜ å°„åˆ°å®ƒä»¬å„è‡ªç‹¬ç«‹çš„åœ°å€ç©ºé—´ä¸­ã€‚å°±åƒå¤šä¸ªçº¿ç¨‹è®¿é—®å…±äº«æ•°æ®ä¸€æ ·ï¼Œå¤šä¸ªè¿›ç¨‹è®¿é—®å…±äº«æ•°æ®é€šå¸¸ä¹Ÿéœ€è¦åŒæ­¥ã€‚å¦‚æœè¿›ç¨‹å…±äº«äº’æ–¥é‡å±æ€§è®¾ç½®ä¸º PTHREAD_PROCESS_SHAREDï¼Œä»å¤šä¸ªè¿›ç¨‹å½¼æ­¤ä¹‹é—´å…±äº«çš„å†…å­˜æ•°æ®å—ä¸­åˆ†é…çš„äº’æ–¥é‡å°±å¯ä»¥ç”¨äºè¿™äº›è¿›ç¨‹çš„åŒæ­¥ï¼›è®¾ç½®ä¸º PTHREAD_PROCESS_PRIVATEæ—¶ï¼Œå…è®¸pthreadçº¿ç¨‹åº“æä¾›æ›´æœ‰æ•ˆçš„äº’æ–¥é‡å®ç°ï¼Œè¿™åœ¨å¤šçº¿ç¨‹åº”ç”¨ç¨‹åºä¸­æ˜¯é»˜è®¤æƒ…å†µã€‚</p></li><li><p>å¥å£®å±æ€§ï¼šä¸å¤šä¸ªè¿›ç¨‹å…±äº«çš„äº’æ–¥é‡æœ‰å…³ã€‚å½“æŒæœ‰äº’æ–¥é‡çš„è¿›ç¨‹ç»ˆæ­¢æ—¶ï¼Œéœ€è¦è§£å†³äº’æ–¥é‡çŠ¶æ€ä¿®å¤çš„é—®é¢˜ã€‚å¥å£®å±æ€§é»˜è®¤å€¼æ˜¯ PTHREAD_MUTEX_STALLEDï¼Œè¿™æ„å‘³ç€æŒæœ‰äº’æ–¥é‡çš„è¿›ç¨‹ç»ˆæ­¢æ—¶ä¸éœ€è¦é‡‡å–ç‰¹åˆ«çš„åŠ¨ä½œï¼Œè€Œç­‰å¾…äº’æ–¥é‡çš„åº”ç”¨ç¨‹åºä¼šè¢«æœ‰æ•ˆçš„â€œæ‹–ä½â€ã€‚å¦ä¸€ä¸ªå–å€¼æ˜¯ PTHREAD_MUTEX_ROBUSTï¼Œè¿™ä¸ªå€¼å°†å¯¼è‡´çº¿ç¨‹è°ƒç”¨ pthread_mutex_lockè·å–é”ï¼Œè€Œè¯¥é”è¢«å¦ä¸€ä¸ªè¿›ç¨‹æŒæœ‰ï¼Œä½†å®ƒç»ˆæ­¢æ—¶æ²¡æœ‰è¿›è¡Œè§£é”ï¼Œæ­¤æ—¶çº¿ç¨‹ä¼šé˜»å¡ï¼Œä»pthread_mutex_lock è¿”å›çš„å€¼ä¸º EONWERDEAD è€Œä¸æ˜¯0ã€‚</p></li><li><p>ç±»å‹å±æ€§ï¼šPOSIX.1å®šä¹‰äº†4ç§ç±»å‹</p><ul><li>PTHREAD_MUTEX_NORMAL ä¸€ç§æ ‡å‡†äº’æ–¥é‡ç±»å‹ï¼Œä¸åšä»»ä½•ç‰¹æ®Šçš„é”™è¯¯æ£€æŸ¥æˆ–æ­»é”æ£€æµ‹ã€‚</li><li>PTHREAD_MUTEX_ERRORCHECK æ­¤äº’æ–¥é‡ç±»å‹æä¾›é”™è¯¯æ£€æŸ¥</li><li>PTHREAD_MUTEX_RECURSIVE æ­¤ç±»å‹å…è®¸å¤šæ¬¡åŠ é”ï¼Œé€’å½’ç»´æŠ¤é”è®¡æ•°ï¼Œè§£é”æ¬¡æ•°å’ŒåŠ é”æ¬¡æ•°ä¸ä¸€è‡´æ—¶ï¼Œé”ä¸ä¼šé‡Šæ”¾ã€‚</li><li>PTHREAD_MUTEX_DEFAULT ä¸Šè¿°ä¸‰ç§ç±»å‹ä¹‹ä¸€</li></ul></li></ol><h3 id="è¯»å†™é”å±æ€§"><a href="#è¯»å†™é”å±æ€§" class="headerlink" title="è¯»å†™é”å±æ€§"></a>è¯»å†™é”å±æ€§</h3><ul><li>è¿›ç¨‹å…±äº«å±æ€§ï¼ˆåŒä¸Šï¼‰</li></ul><h3 id="æ¡ä»¶å˜é‡å±æ€§"><a href="#æ¡ä»¶å˜é‡å±æ€§" class="headerlink" title="æ¡ä»¶å˜é‡å±æ€§"></a>æ¡ä»¶å˜é‡å±æ€§</h3><ul><li>è¿›ç¨‹å…±äº«å±æ€§ï¼ˆåŒä¸Šï¼‰</li><li>æ—¶é’Ÿå±æ€§ï¼šæ§åˆ¶è®¡ç®— pthread_cond_timewait å‡½æ•°çš„è¶…æ—¶å‚æ•°ï¼ˆtsptrï¼‰æ—¶é‡‡ç”¨çš„æ˜¯å“ªä¸ªæ—¶é’Ÿã€‚</li></ul><h3 id="å±éšœå±æ€§"><a href="#å±éšœå±æ€§" class="headerlink" title="å±éšœå±æ€§"></a>å±éšœå±æ€§</h3><ul><li>è¿›ç¨‹å…±äº«å±æ€§ï¼ˆåŒä¸Šï¼‰</li></ul><h2 id="é‡å…¥"><a href="#é‡å…¥" class="headerlink" title="é‡å…¥"></a>é‡å…¥</h2><p>çº¿ç¨‹åœ¨é‡åˆ°é‡å…¥é—®é¢˜æ—¶ä¸ä¿¡å·å¤„ç†ç¨‹åºæ˜¯ç±»ä¼¼çš„ã€‚åœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹ï¼Œå¤šä¸ªæ§åˆ¶çº¿ç¨‹åœ¨ç›¸åŒæ—¶é—´æœ‰å¯èƒ½è°ƒç”¨ç›¸åŒçš„å‡½æ•°ã€‚<br><strong>å¦‚æœä¸€ä¸ªå‡½æ•°åœ¨ç›¸åŒçš„æ—¶é—´ç‚¹å¯ä»¥è¢«å¤šä¸ªçº¿ç¨‹å®‰å…¨åœ°è°ƒç”¨ï¼Œå°±ç§°è¯¥å‡½æ•°æ˜¯<code>çº¿ç¨‹å®‰å…¨</code>çš„ã€‚</strong><br>å¾ˆå¤šå‡½æ•°ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå› ä¸ºå®ƒä»¬è¿”å›çš„æ•°æ®å­˜æ”¾åœ¨é™æ€çš„å†…å®¹ç¼“å†²åŒºä¸­ã€‚é€šè¿‡ä¿®æ”¹æ¥å£ï¼Œè¦æ±‚è°ƒç”¨è€…è‡ªå·±æä¾›ç¼“å†²åŒºå¯ä»¥ä½¿å‡½æ•°å˜ä¸ºçº¿ç¨‹å®‰å…¨çš„ã€‚<br><strong>å¦‚æœä¸€ä¸ªå‡½æ•°å¯¹å¤šä¸ªçº¿ç¨‹æ¥è¯´æ˜¯å¯é‡å…¥çš„ï¼Œå°±æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä½†å¹¶ä¸èƒ½è¯´æ˜å¯¹ä¿¡å·å¤„ç†ç¨‹åºä¹Ÿæ˜¯å¯é‡å…¥çš„ã€‚å¦‚æœå¯¹ä¿¡å·å¤„ç†ç¨‹åºä¹Ÿå¯é‡å…¥ï¼Œé‚£å°±å¯ä»¥è¯´å‡½æ•°æ˜¯<code>å¼‚æ­¥ä¿¡å·å®‰å…¨</code>çš„ã€‚</strong></p><h2 id="çº¿ç¨‹ç‰¹å®šæ•°æ®"><a href="#çº¿ç¨‹ç‰¹å®šæ•°æ®" class="headerlink" title="çº¿ç¨‹ç‰¹å®šæ•°æ®"></a>çº¿ç¨‹ç‰¹å®šæ•°æ®</h2><p>ä¹Ÿç§°çº¿ç¨‹ç§æœ‰æ•°æ®ï¼Œæ˜¯å­˜å‚¨å’ŒæŸ¥è¯¢æŸä¸ªç‰¹å®šçº¿ç¨‹ç›¸å…³æ•°æ®çš„ä¸€ç§æœºåˆ¶ã€‚ä¸€ä¸ªè¿›ç¨‹ä¸­çš„æ‰€æœ‰çº¿ç¨‹å¯ä»¥è®¿é—®è¿™ä¸ªè¿›ç¨‹çš„æ•´ä¸ªåœ°å€ç©ºé—´ã€‚é™¤äº†ä½¿ç”¨å¯„å­˜å™¨ä»¥å¤–ï¼Œä¸€ä¸ªçº¿ç¨‹æ²¡æœ‰åŠæ³•é˜»æ­¢å¦ä¸€ä¸ªçº¿ç¨‹è®¿é—®å®ƒçš„æ•°æ®ã€‚çº¿ç¨‹ç‰¹å®šæ•°æ®ä¹Ÿä¸ä¾‹å¤–ã€‚ä½†ä½¿ç”¨ç‰¹å®šæ•°æ®å¯ä»¥æé«˜çº¿ç¨‹ç©ºé—´çš„æ•°æ®ç‹¬ç«‹æ€§ï¼Œä½¿å¾—çº¿ç¨‹ä¸å¤ªå®¹æ˜“è®¿é—®åˆ°å…¶ä»–çº¿ç¨‹çš„ç‰¹å®šæ•°æ®</p><ul><li>pthread_key_create åˆ›å»ºä¸ç‰¹å®šæ•°æ®å…³è”çš„keyï¼Œè¿™ä¸ªé”®å¯ä»¥è¢«è¿›ç¨‹ä¸­çš„æ‰€æœ‰çº¿ç¨‹ä½¿ç”¨ï¼Œä½†æ¯ä¸ªçº¿ç¨‹æŠŠè¿™ä¸ªé”®ä¸ä¸åŒçš„çº¿ç¨‹ç‰¹å®šæ•°æ®è¿›è¡Œå…³è”ã€‚</li><li>çº¿ç¨‹é€šå¸¸ä½¿ç”¨mallocä¸ºçº¿ç¨‹ç‰¹å®šæ•°æ®åˆ†é…å†…å­˜ã€‚ææ„å‡½æ•°é‡Šæ”¾å·²åˆ†é…çš„å†…å­˜ã€‚å¦‚æœçº¿ç¨‹åœ¨æ²¡æœ‰é‡Šæ”¾å†…å­˜ä¹‹å‰å°±é€€å‡ºäº†ï¼Œé‚£ä¹ˆè¿™å—å†…å­˜å°±ä¼šä¸¢å¤±ï¼Œå³çº¿ç¨‹æ‰€å±è¿›ç¨‹å‡ºç°äº†å†…å­˜æ³„æ¼ã€‚</li><li>ä½¿ç”¨ pthread_once å¯ä»¥ä¿è¯æŸä¸ªé€»è¾‘åœ¨å¤šçº¿ç¨‹ä¸­åªæ‰§è¡Œä¸€æ¬¡ï¼Œå¦‚åˆ›å»ºç‰¹å®šæ•°æ®çš„é”®ã€‚</li><li>ä½¿ç”¨ pthread_getspecific ä¸ pthread_setspecific è®¿é—®ç®¡ç†ç‰¹å®šæ•°æ®ã€‚</li></ul><h2 id="å–æ¶ˆé€‰é¡¹"><a href="#å–æ¶ˆé€‰é¡¹" class="headerlink" title="å–æ¶ˆé€‰é¡¹"></a>å–æ¶ˆé€‰é¡¹</h2><p>æœ‰ä¸¤ä¸ªçº¿ç¨‹æ²¡æœ‰åŒ…å«åœ¨ pthread_attr ç»“æ„ä¸­ï¼Œå®ƒä»¬æ˜¯å¯å–æ¶ˆçŠ¶æ€å’Œå¯å–æ¶ˆç±»å‹ã€‚</p><ul><li>å¯å–æ¶ˆçŠ¶æ€çŠ¶æ€å±æ€§å†³å®šäº†çº¿ç¨‹æ˜¯å¦å¯ä»¥è¢«å–æ¶ˆã€‚pthread_cancel è°ƒç”¨å¹¶ä¸ç­‰å¾…çº¿ç¨‹ç»ˆæ­¢ï¼Œè€Œæ˜¯ç»§ç»­è¿è¡Œï¼Œç›´åˆ°çº¿ç¨‹åˆ°è¾¾æŸä¸ªå–æ¶ˆç‚¹ï¼ˆPOSIX.1æŒ‡å®šçš„å¤šä¸ªå‡½æ•°ï¼‰å†å»æ£€æŸ¥ã€‚å¦‚æœå–æ¶ˆäº†åˆ™æŒ‰ç…§è¯·æ±‚è¡Œäº‹ã€‚</li><li>è°ƒç”¨ pthread_testcancel å¯ä»¥ä¸»åŠ¨æµ‹è¯•çº¿ç¨‹æ˜¯å¦è¢«å–æ¶ˆã€‚</li><li>å–æ¶ˆç±»å‹åŒ…æ‹¬æ¨è¿Ÿå–æ¶ˆï¼ˆé»˜è®¤ä¸Šè¿°é€»è¾‘ï¼‰å’Œå¼‚æ­¥å–æ¶ˆã€‚ä½¿ç”¨å¼‚æ­¥å–æ¶ˆæ—¶ï¼Œçº¿ç¨‹å¯ä»¥åœ¨ä»»æ„æ—¶é—´æ’¤é”€ï¼Œä¸æ˜¯éå¾—é‡åˆ°å–æ¶ˆç‚¹æ‰è¢«å–æ¶ˆã€‚</li></ul><h2 id="çº¿ç¨‹å’Œä¿¡å·"><a href="#çº¿ç¨‹å’Œä¿¡å·" class="headerlink" title="çº¿ç¨‹å’Œä¿¡å·"></a>çº¿ç¨‹å’Œä¿¡å·</h2><p>çº¿ç¨‹å’Œè¿›ç¨‹ç±»ä¼¼ï¼Œä¹Ÿå¯ä»¥è®¾ç½®ä¿¡å·é›†æ¥å±è”½ä¿¡å·ã€‚<br><strong>è¿›ç¨‹ä¸­çš„ä¿¡å·æ˜¯é€’é€åˆ°å•ä¸ªçº¿ç¨‹çš„ã€‚å¦‚æœä¸€ä¸ªä¿¡å·ä¸ç¡¬ä»¶æ•…éšœç›¸å…³ï¼Œé‚£ä¹ˆè¯¥ä¿¡å·ä¸€èˆ¬ä¼šè¢«å‘é€åˆ°å¼•èµ·è¯¥äº‹ä»¶çš„çº¿ç¨‹ä¸­å»ï¼Œè€Œå…¶ä»–ä¿¡å·åˆ™è¢«å‘é€åˆ°ä»»æ„ä¸€ä¸ªçº¿ç¨‹ã€‚</strong><br>çº¿ç¨‹ä¸­é€’é€ä¿¡å·ä½¿ç”¨ pthread_killã€‚</p><h2 id="çº¿ç¨‹å’Œfork"><a href="#çº¿ç¨‹å’Œfork" class="headerlink" title="çº¿ç¨‹å’Œfork"></a>çº¿ç¨‹å’Œfork</h2><p>çº¿ç¨‹è°ƒç”¨forkæ—¶ï¼Œå°±ä¸ºå­è¿›ç¨‹åˆ›å»ºäº†æ•´ä¸ªè¿›ç¨‹ç©ºé—´çš„å‰¯æœ¬ï¼ŒåŒ…æ‹¬æ¯ä¸ªäº’æ–¥é‡ã€è¯»å†™é”å’Œé›•ä»¶å˜é‡çš„çŠ¶æ€ã€‚å¦‚æœçˆ¶è¿›ç¨‹åŒ…å«ä¸€ä¸ªä»¥ä¸Šçš„çº¿ç¨‹ï¼Œå­è¿›ç¨‹åœ¨forkè¿”å›åå¦‚æœä¸æ˜¯é©¬ä¸Šè°ƒç”¨execçš„è¯ï¼Œå°±éœ€è¦æ¸…ç†é”çŠ¶æ€ã€‚é—®é¢˜æ˜¯å­è¿›ç¨‹å¹¶ä¸ä¸€å®šåŒ…å«å æœ‰é”çš„çº¿ç¨‹çš„å‰¯æœ¬ï¼Œæ‰€ä»¥å­è¿›ç¨‹æ²¡æœ‰åŠæ³•ç›´åˆ°å®ƒå æœ‰äº†å“ªäº›é”ï¼Œéœ€è¦é‡Šæ”¾å“ªäº›é”ã€‚<br>åœ¨å¤šçº¿ç¨‹ä¸­ï¼Œä¸ºäº†é¿å…ä¸ä¸€è‡´çŠ¶æ€çš„é—®é¢˜ï¼ŒPOSIX.1å£°æ˜ï¼Œåœ¨forkè¿”å›å’Œå­è¿›ç¨‹è°ƒç”¨ä¸€ä¸ªexecå‡½æ•°ä¹‹é—´ï¼Œå­è¿›ç¨‹åªèƒ½è°ƒç”¨<code>å¼‚æ­¥ä¿¡å·å®‰å…¨</code>çš„å‡½æ•°ã€‚<br>è¦æ¸…é™¤é”çŠ¶æ€ï¼Œå¯ä»¥é€šè¿‡è°ƒç”¨ pthread_affork å‡½æ•°å»ºç«‹forkå¤„ç†ç¨‹åºï¼Œå®ƒåˆ†åˆ«åœ¨è°ƒç”¨forkå‰ã€çˆ¶å­è¿›ç¨‹ä¸­forkè¿”å›å è¿™ä¸‰ä¸ªæ—¶æœºå®‰è£…ä¸‰ä¸ªå¤„ç†ç¨‹åºç”¨äºæ¸…ç†é”ã€‚</p><h2 id="çº¿ç¨‹å’ŒI-O"><a href="#çº¿ç¨‹å’ŒI-O" class="headerlink" title="çº¿ç¨‹å’ŒI/O"></a>çº¿ç¨‹å’ŒI/O</h2><p>å› ä¸ºè¿›ç¨‹ä¸­çš„æ‰€æœ‰çº¿ç¨‹å…±äº«ç›¸åŒçš„æ–‡ä»¶æè¿°ç¬¦ï¼Œæ‰€ä»¥å¤šçº¿ç¨‹ä¸­è¦ä½¿ç”¨ pread å’Œ pwrite å‡½æ•°è¿›è¡Œè¯»å†™æ¥ä¿è¯seekå’ŒI/Oæ˜¯ç»‘å®šçš„åŸå­æ“ä½œã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;çº¿ç¨‹é™åˆ¶&quot;&gt;&lt;a href=&quot;#çº¿ç¨‹é™åˆ¶&quot; class=&quot;headerlink&quot; title=&quot;çº¿ç¨‹é™åˆ¶&quot;&gt;&lt;/a&gt;çº¿ç¨‹é™åˆ¶&lt;/h2&gt;&lt;p&gt;Single UNIX Specificationå®šä¹‰äº†ä¸€äº›ä¸çº¿ç¨‹æ“ä½œæœ‰å…³çš„é™åˆ¶ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;çº¿ç¨‹é€€å‡ºæ—¶æ“ä½œç³»ç»Ÿè¯•å›¾é”€æ¯ç‰¹å®šæ•°æ®çš„æœ€å¤§æ¬¡æ•°&lt;/li&gt;
&lt;li&gt;è¿›ç¨‹å¯åˆ›å»ºçš„é”®çš„æœ€å¤§æ•°ç›®&lt;/li&gt;
&lt;li&gt;ä¸€ä¸ªçº¿ç¨‹çš„æ ˆå¯ç”¨çš„æœ€å°å­—èŠ‚æ•°&lt;/li&gt;
&lt;li&gt;è¿›ç¨‹å¯åˆ›å»ºçš„æœ€å¤§çº¿ç¨‹æ•°&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;çº¿ç¨‹å±æ€§&quot;&gt;&lt;a href=&quot;#çº¿ç¨‹å±æ€§&quot; class=&quot;headerlink&quot; title=&quot;çº¿ç¨‹å±æ€§&quot;&gt;&lt;/a&gt;çº¿ç¨‹å±æ€§&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;å±æ€§ç±»å‹ä¸º pthread_attr_t&lt;/li&gt;
&lt;li&gt;é€šè¿‡ pthread_attr_init åˆå§‹åŒ–&lt;/li&gt;
&lt;li&gt;é€šè¿‡ pthread_attr_destroy ååˆå§‹åŒ–&lt;/li&gt;
&lt;li&gt;å¦‚æœå¯¹çº¿ç¨‹çš„ç»ˆæ­¢çŠ¶æ€ä¸æ„Ÿå…´è¶£ï¼Œå¯ä»¥ä½¿ç”¨pthread_detachå‡½æ•°è®©æ“ä½œç³»ç»Ÿåœ¨çº¿ç¨‹é€€å‡ºæ—¶å›æ”¶å®ƒæ‰€å ç”¨çš„èµ„æºã€‚&lt;/li&gt;
&lt;li&gt;åˆ›å»ºçº¿ç¨‹å‰å¯ä»¥é€šè¿‡pthread_attr_getdetachstate å’Œ pthread_attr_setdetachstateè®¾ç½®çº¿ç¨‹çš„åˆ†ç¦»çŠ¶æ€&lt;/li&gt;
&lt;li&gt;é€šè¿‡pthread_attr_getstack å’Œ pthread_attr_setstack è®¾ç½®æ ˆå¸§&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
    
      <category term="ã€ŠAPUEã€‹ç¬”è®°" scheme="https://akaqin.github.io/categories/%E3%80%8AAPUE%E3%80%8B%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="pthread" scheme="https://akaqin.github.io/tags/pthread/"/>
    
  </entry>
  
  <entry>
    <title>ã€ŠUNIXç¯å¢ƒé«˜çº§ç¼–ç¨‹ã€‹ç¬¬11ç« â€”â€”çº¿ç¨‹</title>
    <link href="https://akaqin.github.io/2020/03/25/%E3%80%8AUNIX%E7%8E%AF%E5%A2%83%E9%AB%98%E7%BA%A7%E7%BC%96%E7%A8%8B%E3%80%8B%E7%AC%AC11%E7%AB%A0%E2%80%94%E2%80%94%E7%BA%BF%E7%A8%8B/"/>
    <id>https://akaqin.github.io/2020/03/25/%E3%80%8AUNIX%E7%8E%AF%E5%A2%83%E9%AB%98%E7%BA%A7%E7%BC%96%E7%A8%8B%E3%80%8B%E7%AC%AC11%E7%AB%A0%E2%80%94%E2%80%94%E7%BA%BF%E7%A8%8B/</id>
    <published>2020-03-25T14:19:30.000Z</published>
    <updated>2020-04-14T01:27:48.821Z</updated>
    
    <content type="html"><![CDATA[<h2 id="çº¿ç¨‹æ¦‚å¿µ"><a href="#çº¿ç¨‹æ¦‚å¿µ" class="headerlink" title="çº¿ç¨‹æ¦‚å¿µ"></a>çº¿ç¨‹æ¦‚å¿µ</h2><p>æ¯ä¸ªçº¿ç¨‹éƒ½åŒ…å«æœ‰è¡¨ç¤ºæ‰§è¡Œç¯å¢ƒæ‰€å¿…é¡»çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬çº¿ç¨‹IDã€ä¸€ç»„å¯„å­˜å™¨å€¼ã€æ ˆã€è°ƒåº¦ä¼˜å…ˆçº§å’Œç­–ç•¥ã€ä¿¡å·å±è”½å­—ã€errnoå˜é‡ä»¥åŠçº¿ç¨‹ç§æœ‰æ•°æ®ã€‚ä¸€ä¸ªè¿›ç¨‹çš„æ‰€æœ‰ä¿¡æ¯å¯¹è¯¥è¿›ç¨‹çš„æ‰€æœ‰çº¿ç¨‹éƒ½æ˜¯å…±äº«çš„ï¼ŒåŒ…æ‹¬å¯æ‰§è¡Œç¨‹åºçš„ä»£ç ã€ç¨‹åºçš„å…¨å±€å†…å­˜å’Œå †å†…å­˜ã€æ ˆä»¥åŠæ–‡ä»¶æè¿°ç¬¦ã€‚</p><h2 id="çº¿ç¨‹æ ‡è¯†"><a href="#çº¿ç¨‹æ ‡è¯†" class="headerlink" title="çº¿ç¨‹æ ‡è¯†"></a>çº¿ç¨‹æ ‡è¯†</h2><p>æ¯ä¸ªçº¿ç¨‹æœ‰ä¸€ä¸ªçº¿ç¨‹IDï¼Œçº¿ç¨‹å¯ä»¥é€šè¿‡è°ƒç”¨ pthread_self å‡½æ•°è·å¾—è‡ªèº«çš„çº¿ç¨‹IDã€‚<br><img src="11-1.png" alt=""></p><a id="more"></a><h2 id="çº¿ç¨‹åˆ›å»º-pthread-create"><a href="#çº¿ç¨‹åˆ›å»º-pthread-create" class="headerlink" title="çº¿ç¨‹åˆ›å»º pthread_create"></a>çº¿ç¨‹åˆ›å»º pthread_create</h2><p>çº¿ç¨‹åˆ›å»ºæ—¶ä¸ä¿è¯å“ªä¸ªçº¿ç¨‹ä¼šå…ˆè¿è¡Œã€‚æ–°åˆ›å»ºçš„çº¿ç¨‹å¯ä»¥è®¿é—®è¿›ç¨‹çš„åœ°å€ç©ºé—´ï¼Œå¹¶ç»§æ‰¿è°ƒç”¨çº¿ç¨‹çš„æµ®ç‚¹ç¯å¢ƒå’Œä¿¡å·å±è”½å­—ï¼Œä½†æ˜¯è¯¥çº¿ç¨‹çš„æŒ‚èµ·ä¿¡å·é›†ä¼šè¢«æ¸…é™¤ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"../apue.3e/include/apue.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;pthread.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">pthread_t</span> ntid;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">printids</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *s)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">pid_t</span> pid;</span><br><span class="line">    <span class="keyword">pthread_t</span> tid;</span><br><span class="line"></span><br><span class="line">    pid = getpid();</span><br><span class="line">    tid = pthread_self();</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%s pid %lu tid %lu (0x%lx)\n"</span>, s, (<span class="keyword">unsigned</span> <span class="keyword">long</span>) pid, (<span class="keyword">unsigned</span> <span class="keyword">long</span>) tid, (<span class="keyword">unsigned</span> <span class="keyword">long</span>) tid);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> *<span class="title">thr_fn</span><span class="params">(<span class="keyword">void</span> *arg)</span> </span>&#123;</span><br><span class="line">    printids(<span class="string">"new thread: "</span>);</span><br><span class="line">    <span class="keyword">return</span> ((<span class="keyword">void</span> *) <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> err;</span><br><span class="line"></span><br><span class="line">    err = pthread_create(&amp;ntid, <span class="literal">NULL</span>, thr_fn, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="keyword">if</span> (err != <span class="number">0</span>) &#123;</span><br><span class="line">        err_exit(err, <span class="string">"can't create thread"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    printids(<span class="string">"main thread:"</span>);</span><br><span class="line">    sleep(<span class="number">1</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå®ä¾‹æœ‰ä¸¤ä¸ªç‰¹åˆ«ä¹‹å¤„ï¼Œä¸»çº¿ç¨‹ä¸æ–°çº¿ç¨‹ä¹‹é—´å­˜åœ¨ç«äº‰ï¼š</p><ol><li>ä¸»çº¿ç¨‹å¦‚æœä¸ä¼‘çœ ï¼Œå¯èƒ½æ–°çº¿ç¨‹è¿˜æ²¡æœ‰æœºä¼šæ‰§è¡Œï¼Œæ•´ä¸ªè¿›ç¨‹å°±ç»ˆæ­¢äº†</li><li>æ–°çº¿ç¨‹é€šè¿‡è°ƒç”¨pthread_selfè·å–è‡ªèº«çš„çº¿ç¨‹IDï¼Œè€Œä¸æ˜¯ä»å…±äº«å†…å­˜è¯»å‡ºæˆ–ä»çº¿ç¨‹çš„å¯åŠ¨ä¾‹ç¨‹ä¸­ä»¥å‚æ•°å½¢å¼æ¥æ”¶ï¼Œå› ä¸ºé‚£æ ·å¹¶ä¸å®‰å…¨ã€‚</li></ol><!--more--><h2 id="çº¿ç¨‹ç»ˆæ­¢"><a href="#çº¿ç¨‹ç»ˆæ­¢" class="headerlink" title="çº¿ç¨‹ç»ˆæ­¢"></a>çº¿ç¨‹ç»ˆæ­¢</h2><p>å¦‚æœè¿›ç¨‹ä¸­çš„ä»»æ„çº¿ç¨‹è°ƒç”¨äº†exitã€_Exitã€æˆ–è€…_exitï¼Œé‚£ä¹ˆæ•´ä¸ªè¿›ç¨‹å°±ä¼šç»ˆæ­¢ã€‚<br>å•ä¸ªçº¿ç¨‹å¯ä»¥åœ¨ä¸ç»ˆæ­¢æ•´ä¸ªè¿›ç¨‹çš„æƒ…å†µä¸‹ï¼Œä»¥ä»¥ä¸‹ä¸‰ç§æ–¹å¼åœæ­¢å®ƒçš„æ§åˆ¶æµï¼š</p><ol><li>çº¿ç¨‹å¯ä»¥ç®€å•åœ°ä»å¯åŠ¨ä¾‹ç¨‹ä¸­è¿”å›ï¼Œè¿”å›å€¼æ˜¯çº¿ç¨‹çš„é€€å‡ºç ã€‚</li><li>çº¿ç¨‹å¯ä»¥è¢«åŒä¸€è¿›ç¨‹ä¸­çš„å…¶ä»–çº¿ç¨‹å–æ¶ˆã€‚</li><li>çº¿ç¨‹è°ƒç”¨pthread_exitã€‚</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"../apue.3e/include/apue.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;pthread.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">foo</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> a, b, c, d;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">printfoo</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *s, <span class="keyword">const</span> struct foo *fp)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%s"</span>, s);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"  structure at 0x%lx\n"</span>, (<span class="keyword">unsigned</span> <span class="keyword">long</span>) fp);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"  foo.a = %d\n"</span>, fp-&gt;a);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"  foo.b = %d\n"</span>, fp-&gt;b);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"  foo.c = %d\n"</span>, fp-&gt;c);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"  foo.d = %d\n"</span>, fp-&gt;d);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> *<span class="title">thr_fn1</span><span class="params">(<span class="keyword">void</span> *arg)</span> </span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">foo</span> <span class="title">foo</span> = &#123;</span><span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>&#125;;</span><br><span class="line"></span><br><span class="line">    printfoo(<span class="string">"thread 1:\n"</span>, &amp;foo);</span><br><span class="line">    pthread_exit((<span class="keyword">void</span> *) &amp;foo);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> *<span class="title">thr_fn2</span><span class="params">(<span class="keyword">void</span> *arg)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"thread 2: ID is %lu\n"</span>, (<span class="keyword">unsigned</span> <span class="keyword">long</span>) pthread_self());</span><br><span class="line">    pthread_exit((<span class="keyword">void</span> *) <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> err;</span><br><span class="line">    <span class="keyword">pthread_t</span> tid1, tid2;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">foo</span> \*<span class="title">fp</span>;</span></span><br><span class="line"></span><br><span class="line">    err = pthread_create(&amp;tid1, <span class="literal">NULL</span>, thr_fn1, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="keyword">if</span> (err != <span class="number">0</span>)</span><br><span class="line">        err_exit(err, <span class="string">"can't create thread 1"</span>);</span><br><span class="line">    err = pthread_join(tid1, (<span class="keyword">void</span> *) &amp;fp);</span><br><span class="line">    <span class="keyword">if</span> (err != <span class="number">0</span>)</span><br><span class="line">        err_exit(err, <span class="string">"can't join with thread 1"</span>);</span><br><span class="line">    sleep(<span class="number">1</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"parent starting second thread\n"</span>);</span><br><span class="line">    err = pthread_create(&amp;tid2, <span class="literal">NULL</span>, thr_fn2, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="keyword">if</span> (err != <span class="number">0</span>)</span><br><span class="line">        err_exit(err, <span class="string">"can't create thread 2"</span>);</span><br><span class="line">    sleep(<span class="number">1</span>);</span><br><span class="line">    printfoo(<span class="string">"parent:\n"</span>, fp);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">//åœ¨macOS Xä¸Šè¿è¡Œï¼š</span><br><span class="line">$ ./a.out  </span><br><span class="line">thread 1:</span><br><span class="line"> structure at 0x700001aa0f90</span><br><span class="line"> foo.a = 1</span><br><span class="line"> foo.b = 2</span><br><span class="line"> foo.c = 3</span><br><span class="line"> foo.d = 4</span><br><span class="line">parent starting second thread</span><br><span class="line">thread 2: ID is 123145330233344</span><br><span class="line">parent:</span><br><span class="line"> structure at 0x700001aa0f90</span><br><span class="line">[1]    50009 segmentation fault  ./a.out</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œå½“ä¸»çº¿ç¨‹è®¿é—®è¿™ä¸ªç»“æ„æ—¶,ç»“æ„çš„å†…å®¹ï¼ˆåœ¨çº¿ç¨‹tid1çš„æ ˆä¸Šåˆ†é…çš„ï¼‰å·²ç»æ”¹å˜äº†ã€‚çˆ¶è¿›ç¨‹è¯•å›¾è®¿é—®å·²é€€å‡ºçš„ç¬¬ä¸€ä¸ªçº¿ç¨‹ä¼ ç»™å®ƒçš„ç»“æ„æ—¶ï¼Œå†…å­˜ä¸å†æœ‰æ•ˆï¼Œè¿™æ—¶å¾—åˆ°çš„æ˜¯SIGSEGVä¿¡å·ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨å…¨å±€ç»“æ„ï¼Œæˆ–è€…ç”¨mallocå‡½æ•°åˆ†é…ç»“æ„ã€‚</p><p>çº¿ç¨‹å¯ä»¥é€šè¿‡pthread_cancelå‡½æ•°æ¥è¯·æ±‚å–æ¶ˆåŒä¸€è¿›ç¨‹ä¸­çš„å…¶ä»–çº¿ç¨‹ã€‚<br><img src="11-6.png" alt=""></p><h2 id="çº¿ç¨‹åŒæ­¥"><a href="#çº¿ç¨‹åŒæ­¥" class="headerlink" title="çº¿ç¨‹åŒæ­¥"></a>çº¿ç¨‹åŒæ­¥</h2><p>å½“è¿›ç¨‹ä¸­å­˜åœ¨å¤šä¸ªçº¿ç¨‹æ—¶ï¼Œæ¯ä¸ªçº¿ç¨‹ä½¿ç”¨çš„å˜é‡å¯èƒ½ä¼šè¢«å…¶ä»–çº¿ç¨‹è¯»å–æˆ–ä¿®æ”¹ï¼Œä¸ºè§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå°±å¿…é¡»ä½¿ç”¨é”ã€‚<br><img src="11-7.png" alt=""></p><h3 id="äº’æ–¥é‡"><a href="#äº’æ–¥é‡" class="headerlink" title="äº’æ–¥é‡"></a>äº’æ–¥é‡</h3><p>äº’æ–¥é‡æœ¬è´¨æ˜¯ä¸€æŠŠé”ï¼Œåœ¨è®¿é—®å…±äº«èµ„æºå‰åŠ é”ï¼ˆå¯¹äº’æ–¥é‡è¿›è¡Œè®¾ç½®ï¼‰ï¼Œå®Œæˆåè§£é”ï¼ˆé‡Šæ”¾äº’æ–¥é‡ï¼‰ã€‚æ¶‰åŠä»¥ä¸‹å‡½æ•°ï¼š</p><ul><li>pthread_mutex_init äº’æ–¥é‡åˆå§‹åŒ–ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ç”¨ PTHREAD_MUTEX_INITIALIZER å¸¸é‡é™æ€åˆå§‹åŒ–</li><li>pthread_mutex_destory é‡Šæ”¾äº’æ–¥é‡</li><li>pthread_mutex_lock å¯¹äº’æ–¥é‡åŠ é”ï¼Œå¦‚æœå·²ç»ä¸Šé”ï¼Œåˆ™è°ƒç”¨çº¿ç¨‹å°†é˜»å¡ç›´è‡³äº’æ–¥é‡è¢«è§£é”</li><li>pthread_mutex_trylock å¯¹äº’æ–¥é‡å°è¯•åŠ é”ï¼ŒæˆåŠŸè¿”å›0ï¼Œå¤±è´¥ä¸é˜»å¡ï¼Œç›´æ¥è¿”å›EBUSY</li><li>pthread_mutex_unlock å¯¹äº’æ–¥é‡è§£é”</li></ul><h3 id="é¿å…æ­»é”"><a href="#é¿å…æ­»é”" class="headerlink" title="é¿å…æ­»é”"></a>é¿å…æ­»é”</h3><h4 id="é€ æˆæ­»é”çš„åŸå› "><a href="#é€ æˆæ­»é”çš„åŸå› " class="headerlink" title="é€ æˆæ­»é”çš„åŸå› "></a>é€ æˆæ­»é”çš„åŸå› </h4><p>å¦‚æœçº¿ç¨‹å¯¹åŒä¸€ä¸ªäº’æ–¥é‡åŠ é”ä¸¤æ¬¡ï¼Œä¼šé€ æˆæ­»é”ï¼›ä¸¤ä¸ªçº¿ç¨‹å„è‡ªé”ä½ä¸€ä¸ªäº’æ–¥é‡ï¼Œå¹¶ç­‰å¾…å¯¹æ–¹è§£é”å®ƒæŒæœ‰çš„äº’æ–¥é‡ï¼Œä¹Ÿä¼šé€ æˆæ­»é”ã€‚</p><h4 id="é¿å…æ­»é”çš„æ–¹æ³•ï¼š"><a href="#é¿å…æ­»é”çš„æ–¹æ³•ï¼š" class="headerlink" title="é¿å…æ­»é”çš„æ–¹æ³•ï¼š"></a>é¿å…æ­»é”çš„æ–¹æ³•ï¼š</h4><ol><li>å¯ä»¥é€šè¿‡ä»”ç»†æ§åˆ¶äº’æ–¥é‡åŠ é”çš„é¡ºåºæ¥é¿å…æ­»é”å‘ç”Ÿï¼ˆæŒ‰ç›¸åŒçš„é¡ºåºåŠ é”ï¼‰</li><li>ä½¿ç”¨tpthread_mutex_trylockå°è¯•åŠ é”ï¼Œå¦‚æœå¤±è´¥åˆ™å…ˆé‡Šæ”¾å·²æœ‰çš„é”ï¼Œåšå¥½æ¸…ç†å·¥ä½œï¼Œè¿‡æ®µæ—¶é—´å†è¯•<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"../apue.3e/include/apue.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;pthread.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> NHASH 29</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> HASH(id) (((unsigned long) id) % NHASH)</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">foo</span> \*<span class="title">fh</span>[<span class="title">NHASH</span>];</span></span><br><span class="line"><span class="keyword">pthread_mutex_t</span> hashlock = PTHREAD_MUTEX_INITIALIZER;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">foo</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> f_count; /\* <span class="keyword">protected</span> by hashlock \*/</span><br><span class="line">    <span class="keyword">pthread_mutex_t</span> f_lock;</span><br><span class="line">    <span class="keyword">int</span> f_id;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">foo</span> \*<span class="title">f_next</span>;</span> /\* <span class="keyword">protected</span> by hashlock \*/</span><br><span class="line">    /\* ... more stuff here ... \*/</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">foo</span> \* <span class="title">foo_alloc</span>(<span class="title">int</span> <span class="title">id</span>) /\* <span class="title">allocate</span> <span class="title">the</span> <span class="title">object</span> \*/</span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">foo</span> \*<span class="title">fp</span>;</span></span><br><span class="line">    <span class="keyword">int</span> idx;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ((fp = <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(struct foo))) != <span class="literal">NULL</span>) &#123;</span><br><span class="line">        fp-&gt;f_count = <span class="number">1</span>;</span><br><span class="line">        fp-&gt;f_id = id;</span><br><span class="line">        <span class="keyword">if</span> (pthread_mutex_init(&amp;fp-&gt;f_lock, <span class="literal">NULL</span>) != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="built_in">free</span>(fp);</span><br><span class="line">            <span class="keyword">return</span> (<span class="literal">NULL</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        idx = HASH(id);</span><br><span class="line">        pthread_mutex_lock(&amp;hashlock);</span><br><span class="line">        fp-&gt;f_next = fh[idx];</span><br><span class="line">        fh[idx] = fp;</span><br><span class="line">        pthread_mutex_lock(&amp;fp-&gt;f_lock);</span><br><span class="line">        pthread_mutex_unlock(&amp;hashlock);</span><br><span class="line">        /\* ... <span class="keyword">continue</span> initialization ... \*/</span><br><span class="line">        pthread_mutex_unlock(&amp;fp-&gt;f_lock);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (fp);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void foo_hold(struct foo \*fp) /\* add a reference to the object \*/</span><br><span class="line">&#123;</span><br><span class="line">    pthread_mutex_lock(&amp;hashlock);</span><br><span class="line">    fp-&gt;f_count++;</span><br><span class="line">    pthread_mutex_unlock(&amp;hashlock);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">foo</span> \* <span class="title">foo_find</span>(<span class="title">int</span> <span class="title">id</span>) /\* <span class="title">find</span> <span class="title">an</span> <span class="title">existing</span> <span class="title">object</span> \*/</span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">foo</span> \*<span class="title">fp</span>;</span></span><br><span class="line"></span><br><span class="line">    pthread_mutex_lock(&amp;hashlock);</span><br><span class="line">    <span class="keyword">for</span> (fp = fh[HASH(id)]; fp != <span class="literal">NULL</span>; fp = fp-&gt;f_next) &#123;</span><br><span class="line">        <span class="keyword">if</span> (fp-&gt;f_id == id) &#123;</span><br><span class="line">            fp-&gt;f_count++;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    pthread_mutex_unlock(&amp;hashlock);</span><br><span class="line">    <span class="keyword">return</span> (fp);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void foo_rele(struct foo \*fp) /\* release a reference to the object \*/</span><br><span class="line">&#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">foo</span> \*<span class="title">tfp</span>;</span></span><br><span class="line">    <span class="keyword">int</span> idx;</span><br><span class="line"></span><br><span class="line">    pthread_mutex_lock(&amp;hashlock);</span><br><span class="line">    <span class="keyword">if</span> (--fp-&gt;f_count == <span class="number">0</span>) &#123; /\* last reference, <span class="built_in">remove</span> from <span class="built_in">list</span> \*/</span><br><span class="line">        idx = HASH(fp-&gt;f_id);</span><br><span class="line">        tfp = fh[idx];</span><br><span class="line">        <span class="keyword">if</span> (tfp == fp) &#123;</span><br><span class="line">            fh[idx] = fp-&gt;f_next;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">while</span> (tfp-&gt;f_next != fp)</span><br><span class="line">                tfp = tfp-&gt;f_next;</span><br><span class="line">            tfp-&gt;f_next = fp-&gt;f_next;</span><br><span class="line">        &#125;</span><br><span class="line">        pthread_mutex_unlock(&amp;hashlock);</span><br><span class="line">        pthread_mutex_destroy(&amp;fp-&gt;f_lock);</span><br><span class="line">        <span class="built_in">free</span>(fp);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        pthread_mutex_unlock(&amp;hashlock);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><p><strong>å¤šçº¿ç¨‹çš„è½¯ä»¶è®¾è®¡è¦æ³¨æ„é”çš„ç²’åº¦ï¼šå¦‚æœé”çš„ç²’åº¦å¤ªç²—ï¼Œå°±ä¼šå‡ºç°å¤šçº¿ç¨‹é˜»å¡ç­‰å¾…ç›¸åŒçš„é”ï¼Œè¿™å¯èƒ½å¹¶ä¸èƒ½æ”¹å–„å¹¶å‘æ€§ï¼›å¦‚æœé”çš„ç²’åº¦å¤ªç»†ï¼Œé‚£ä¹ˆè¿‡å¤šçš„é”å¼€é”€ä¼šä½¿ç³»ç»Ÿæ€§èƒ½å—å½±å“ï¼Œè€Œä¸”ä»£ç å˜å¾—å¤æ‚ã€‚ä½œä¸ºä¸€ä¸ªç¨‹åºå‘˜ï¼Œéœ€è¦åœ¨æ»¡è¶³é”éœ€æ±‚çš„æƒ…å†µä¸‹ï¼Œåœ¨ä»£ç å¤æ‚æ€§å’Œæ€§èƒ½ä¹‹é—´æ‰¾åˆ°æ­£ç¡®çš„å¹³è¡¡ã€‚</strong></p><h4 id="å¸¦æœ‰è¶…æ—¶çš„äº’æ–¥é‡"><a href="#å¸¦æœ‰è¶…æ—¶çš„äº’æ–¥é‡" class="headerlink" title="å¸¦æœ‰è¶…æ—¶çš„äº’æ–¥é‡"></a>å¸¦æœ‰è¶…æ—¶çš„äº’æ–¥é‡</h4><p>å‡½æ•° pthread_mutex_timedlockï¼ŒåŠ é”æ—¶è®¾ç½®ä¸€ä¸ªæ„¿æ„ç­‰å¾…çš„ç»å¯¹æ—¶é—´ï¼Œè¶…æ—¶åæ”¾å¼ƒåŠ é”ï¼Œè¿”å›é”™è¯¯ç ETIMEDOUTã€‚</p><h3 id="è¯»å†™é”"><a href="#è¯»å†™é”" class="headerlink" title="è¯»å†™é”"></a>è¯»å†™é”</h3><p>è¯»å†™é”ä¸äº’æ–¥é‡ç±»ä¼¼ï¼Œä½†å…è®¸æ›´é«˜çš„å¹¶è¡Œæ€§ã€‚éå¸¸é€‚åˆäºå¯¹æ•°æ®ç»“æ„è¯»çš„æ¬¡æ•°è¿œå¤§äºå†™çš„æƒ…å†µã€‚</p><ul><li>pthread_rwlock_init åˆå§‹åŒ–</li><li>pthread_rwlock_destory é”€æ¯</li><li>pthread_rwlock_rdlock åŠ è¯»é”</li><li>pthread_rwlock_wrlock åŠ å†™é”</li><li>pthread_rwlock_unlock è§£é”</li><li>pthread_rwlock_tryrdlock å°è¯•åŠ è¯»é”</li><li>pthread_rwlock_trywrlock å°è¯•åŠ å†™é”</li></ul><p>ä¸‹é¢çš„ä¾‹å­é€šè¿‡è¯»å†™é”å®ç°äº†ä¸€ä¸ªå¤šçº¿ç¨‹çš„ä½œä¸šè¯·æ±‚é˜Ÿåˆ—</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"../apue.3e/include/apue.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;pthread.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">job</span> &#123;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">job</span> \*<span class="title">next</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">job</span> \*<span class="title">prev</span>;</span></span><br><span class="line">    <span class="keyword">pthread_t</span> id;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">queue</span> &#123;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">job</span> \*<span class="title">head</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">job</span> \*<span class="title">tail</span>;</span></span><br><span class="line">    <span class="keyword">pthread_rwlock_t</span> lock;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">queue_init</span><span class="params">(struct <span class="built_in">queue</span> \*qp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> err;</span><br><span class="line">    qp-&gt;head = <span class="literal">NULL</span>;</span><br><span class="line">    qp-&gt;tail = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">if</span> ((err = pthread_rwlock_init(&amp;qp-&gt;lock, <span class="literal">NULL</span>)) != <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> err;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">job_insert</span><span class="params">(struct <span class="built_in">queue</span> \*qp, struct job \*jp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    pthread_rwlock_wrlock(&amp;qp-&gt;lock);</span><br><span class="line">    jp-&gt;next = qp-&gt;head;</span><br><span class="line">    jp-&gt;prev = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">if</span> (qp-&gt;head == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        qp-&gt;tail = jp;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        qp-&gt;head-&gt;prev = jp;</span><br><span class="line">    &#125;</span><br><span class="line">    qp-&gt;head = jp;</span><br><span class="line">    pthread_rwlock_unlock(&amp;qp-&gt;lock);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">job_append</span><span class="params">(struct <span class="built_in">queue</span> \*qp, struct job \*jp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    pthread_rwlock_wrlock(&amp;qp-&gt;lock);</span><br><span class="line">    jp-&gt;next = <span class="literal">NULL</span>;</span><br><span class="line">    jp-&gt;prev = qp-&gt;tail;</span><br><span class="line">    <span class="keyword">if</span> (qp-&gt;head == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        qp-&gt;head = jp;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        qp-&gt;tail-&gt;next = jp;</span><br><span class="line">    &#125;</span><br><span class="line">    qp-&gt;tail = jp;</span><br><span class="line">    pthread_rwlock_unlock(&amp;qp-&gt;lock);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">job_remove</span><span class="params">(struct <span class="built_in">queue</span> \*qp, struct job \*jp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    pthread_rwlock_wrlock(&amp;qp-&gt;lock);</span><br><span class="line">    <span class="keyword">if</span> (jp == qp-&gt;head) &#123;</span><br><span class="line">        qp-&gt;head = jp-&gt;next;</span><br><span class="line">        <span class="keyword">if</span> (qp-&gt;tail == jp) &#123;</span><br><span class="line">            qp-&gt;tail = <span class="literal">NULL</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            jp-&gt;next-&gt;prev = jp-&gt;prev;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (jp == qp-&gt;tail) &#123;</span><br><span class="line">        qp-&gt;tail = jp-&gt;prev;</span><br><span class="line">        jp-&gt;prev-&gt;next = jp-&gt;next;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        jp-&gt;prev-&gt;next = jp-&gt;next;</span><br><span class="line">        jp-&gt;next-&gt;prev = jp-&gt;prev;</span><br><span class="line">    &#125;</span><br><span class="line">    pthread_rwlock_unlock(&amp;qp-&gt;lock);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">job</span> \*<span class="title">job_find</span>(<span class="title">struct</span> <span class="title">queue</span> \*<span class="title">qp</span>, <span class="title">pthread_t</span> <span class="title">id</span>)</span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">job</span> \*<span class="title">jp</span> = <span class="title">NULL</span>;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (pthread_rwlock_rdlock(&amp;qp-&gt;lock) != <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>(<span class="literal">NULL</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (jp = qp-&gt;head; jp != <span class="literal">NULL</span>; jp = jp-&gt;next) &#123;</span><br><span class="line">        <span class="keyword">if</span> (pthread_equal(jp-&gt;id, id)) &#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    pthread_rwlock_unlock(&amp;qp-&gt;lock);</span><br><span class="line">    <span class="keyword">return</span> jp;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å¸¦æœ‰è¶…æ—¶çš„è¯»å†™é”"><a href="#å¸¦æœ‰è¶…æ—¶çš„è¯»å†™é”" class="headerlink" title="å¸¦æœ‰è¶…æ—¶çš„è¯»å†™é”"></a>å¸¦æœ‰è¶…æ—¶çš„è¯»å†™é”</h4><p>å‡½æ•° pthread_rwlock_timedrdlock å’Œ pthread_rwlock_timedwdlock æä¾›å¸¦æœ‰è¶…æ—¶çš„åŠ é”åŠŸèƒ½ï¼Œé¿å…åœ¨è·å–é”æ—¶æ°¸ä¹…é˜»å¡ã€‚</p><h3 id="æ¡ä»¶å˜é‡"><a href="#æ¡ä»¶å˜é‡" class="headerlink" title="æ¡ä»¶å˜é‡"></a>æ¡ä»¶å˜é‡</h3><p>æ¡ä»¶å˜é‡(cond)æ˜¯åœ¨å¤šçº¿ç¨‹ç¨‹åºä¸­ç”¨æ¥å®ç°â€ç­‰å¾…â€“ã€‹å”¤é†’â€é€»è¾‘å¸¸ç”¨çš„æ–¹æ³•ã€‚æ¡ä»¶å˜é‡åˆ©ç”¨çº¿ç¨‹é—´å…±äº«çš„å…¨å±€å˜é‡è¿›è¡ŒåŒæ­¥çš„ä¸€ç§æœºåˆ¶ï¼Œä¸»è¦åŒ…æ‹¬ä¸¤ä¸ªåŠ¨ä½œï¼šä¸€ä¸ªçº¿ç¨‹ç­‰å¾…â€æ¡ä»¶å˜é‡çš„æ¡ä»¶æˆç«‹â€è€ŒæŒ‚èµ·ï¼›å¦ä¸€ä¸ªçº¿ç¨‹ä½¿â€œæ¡ä»¶æˆç«‹â€ã€‚ä¸ºäº†é˜²æ­¢ç«äº‰ï¼Œæ¡ä»¶å˜é‡çš„ä½¿ç”¨æ€»æ˜¯å’Œä¸€ä¸ªäº’æ–¥é”ç»“åˆåœ¨ä¸€èµ·ã€‚çº¿ç¨‹åœ¨æ”¹å˜æ¡ä»¶çŠ¶æ€å‰å¿…é¡»é¦–å…ˆé”ä½äº’æ–¥é‡ï¼Œå‡½æ•°pthread_cond_waitæŠŠè‡ªå·±æ”¾åˆ°ç­‰å¾…æ¡ä»¶çš„çº¿ç¨‹åˆ—è¡¨ä¸Šï¼Œç„¶åå¯¹äº’æ–¥é”è§£é”(è¿™ä¸¤ä¸ªæ“ä½œæ˜¯åŸå­æ“ä½œ)ã€‚åœ¨å‡½æ•°è¿”å›æ—¶ï¼Œäº’æ–¥é‡å†æ¬¡è¢«é”ä½ã€‚</p><h4 id="é‚£ä¸ºä»€ä¹ˆæœ‰äº’æ–¥é”ï¼Œè¿˜éœ€è¦æ¡ä»¶å˜é‡ï¼Ÿ"><a href="#é‚£ä¸ºä»€ä¹ˆæœ‰äº’æ–¥é”ï¼Œè¿˜éœ€è¦æ¡ä»¶å˜é‡ï¼Ÿ" class="headerlink" title="é‚£ä¸ºä»€ä¹ˆæœ‰äº’æ–¥é”ï¼Œè¿˜éœ€è¦æ¡ä»¶å˜é‡ï¼Ÿ"></a>é‚£ä¸ºä»€ä¹ˆæœ‰äº’æ–¥é”ï¼Œè¿˜éœ€è¦æ¡ä»¶å˜é‡ï¼Ÿ</h4><p>å› ä¸ºï¼šäº’æ–¥é”å’Œæ¡ä»¶å˜é‡æ‰€è§£å†³çš„ï¼Œæ˜¯ä¸åŒçš„é—®é¢˜ï¼Œä¸åŒçš„åœºæ™¯ã€‚</p><p>äº’æ–¥é”è§£å†³çš„æ˜¯åœ¨ shared memory space æ¨¡å‹ä¸‹ï¼Œå¤šä¸ªçº¿ç¨‹å¯¹åŒä¸€ä¸ªå…¨å±€å˜é‡çš„è®¿é—®çš„ç«äº‰é—®é¢˜(æƒŠç¾¤æ•ˆåº”)ã€‚ç”±äºä¸€äº›å¸¸ç”¨å†™æ“ä½œçš„éåŸå­æ€§ï¼ˆä»å†…å­˜ä¸­è¯»è¿›å¯„å­˜å™¨ï¼Œä¿®æ”¹ï¼Œå¦‚æœå…¶ä»–çº¿ç¨‹å®Œæˆäº†å¯¹è¿™ä¸ªå˜é‡çš„ä¿®æ”¹ï¼Œåˆ™æ—§çš„ä¿®æ”¹å°±è¢«è¦†ç›–ï¼Œç­‰ç­‰é—®é¢˜ï¼‰ï¼Œå¿…é¡»ä¿è¯åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨è¿›è¡Œå†™æ“ä½œã€‚è¿™å°±æ¶‰åŠåˆ°äº†äº’æ–¥é”ï¼Œå°†ä¸´ç•ŒåŒºçš„æ“ä½œé”èµ·æ¥ï¼Œä¿è¯åªæœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨è¿›è¡Œæ“ä½œã€‚å¤šä¸ªçº¿ç¨‹åœ¨ç­‰å¾…åŒä¸€æŠŠé”çš„æ—¶å€™ï¼ŒæŒ‰ç…§ FIFO ç»„ç»‡é˜Ÿåˆ—ï¼Œå½“é”è¢«é‡Šæ”¾æ—¶ï¼Œé˜Ÿå¤´çº¿ç¨‹è·å¾—é”ï¼ˆç”±æ“ä½œç³»ç»Ÿç®¡ç†ï¼Œå…·ä½“ä¸è¡¨ï¼‰ã€‚æ²¡æœ‰è·å¾—é”çš„çº¿ç¨‹ç»§ç»­è¢« blockï¼Œæ¢è¨€ä¹‹ï¼Œå®ƒä»¬æ˜¯å› ä¸ºæ²¡æœ‰è·å¾—é”è€Œè¢« blockã€‚</p><p>å‡å¦‚æˆ‘ä»¬æ²¡æœ‰â€œæ¡ä»¶å˜é‡â€è¿™ä¸ªæ¦‚å¿µï¼Œå¦‚æœä¸€ä¸ªçº¿ç¨‹è¦ç­‰å¾…æŸä¸ªâ€œè‡ªå®šä¹‰çš„æ¡ä»¶â€æ»¡è¶³è€Œç»§ç»­æ‰§è¡Œï¼Œè€Œè¿™ä¸ªæ¡ä»¶åªèƒ½ç”±å¦ä¸€ä¸ªçº¿ç¨‹æ¥æ»¡è¶³ï¼Œæ¯”å¦‚ T1ä¸æ–­ç»™ä¸€ä¸ªå…¨å±€å˜é‡ x +1ï¼Œ T2æ£€æµ‹åˆ°x å¤§äº100æ—¶ï¼Œå°†x ç½®0ï¼Œå¦‚æœæˆ‘ä»¬æ²¡æœ‰æ¡ä»¶å˜é‡ï¼Œåˆ™åªé€šè¿‡äº’æ–¥é”åˆ™å¯ä»¥æœ‰å¦‚ä¸‹å®ç°:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;*</span><br><span class="line"> * Assume we have global variables:</span><br><span class="line"> * int iCount &#x3D;&#x3D; 0;</span><br><span class="line"> * pthread_cond_t cond &#x3D; PTHREAD_COND_INITIALIZER;</span><br><span class="line"> *&#x2F;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;thread 1:</span><br><span class="line"></span><br><span class="line">while(true)</span><br><span class="line">&#123;</span><br><span class="line">    pthread_mutex_lock(&amp;mutex);</span><br><span class="line">    iCount++;</span><br><span class="line">    pthread_mutex_unlock(&amp;mutex);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;thread 2:</span><br><span class="line">while(true)</span><br><span class="line">&#123;</span><br><span class="line">    pthread_mutex_lock(&amp;mutex);</span><br><span class="line">    if(iCount &gt;&#x3D; 100)</span><br><span class="line">    &#123;</span><br><span class="line">        iCount &#x3D; 0;</span><br><span class="line">    &#125;</span><br><span class="line">    pthread_mutex_unlock(&amp;mutex);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ç§å®ç°ä¸‹ï¼Œå°±ç®— lock ç©ºé—²ï¼Œthread2éœ€è¦ä¸æ–­é‡å¤&lt;åŠ é”ï¼Œåˆ¤æ–­ï¼Œè§£é”&gt;è¿™ä¸ªæµç¨‹ï¼Œä¼šç»™ç³»ç»Ÿå¸¦æ¥ä¸å¿…è¦çš„å¼€é”€ã€‚æœ‰æ²¡æœ‰ä¸€ç§åŠæ³•è®© thread2å…ˆè¢« blockï¼Œç­‰æ¡ä»¶æ»¡è¶³çš„æ—¶å€™å†å”¤é†’ thread2ï¼Ÿè¿™æ · thread2 å°±ä¸ç”¨ä¸æ–­è¿›è¡Œé‡å¤çš„åŠ è§£é”æ“ä½œäº†ï¼Ÿè¿™å°±è¦ç”¨åˆ°æ¡ä»¶å˜é‡äº†ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;thread1 :</span><br><span class="line">while(true)</span><br><span class="line">&#123;</span><br><span class="line">    pthread_mutex_lock(&amp;mutex);</span><br><span class="line">    iCount++;</span><br><span class="line">    pthread_mutex_unlock(&amp;mutex);</span><br><span class="line"></span><br><span class="line">    pthread_mutex_lock(&amp;mutex);</span><br><span class="line">    if(iCount &gt;&#x3D; 100)</span><br><span class="line">    &#123;</span><br><span class="line">        pthread_cond_signal(&amp;cond);</span><br><span class="line">    &#125;</span><br><span class="line">    pthread_mutex_unlock(&amp;mutex);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;thread2:</span><br><span class="line">while(1)</span><br><span class="line">&#123;</span><br><span class="line">    pthread_mutex_lock(&amp;mutex);</span><br><span class="line">    while(iCount &lt; 100)</span><br><span class="line">    &#123;</span><br><span class="line">        pthread_cond_wait(&amp;cond, &amp;mutex);</span><br><span class="line">    &#125;</span><br><span class="line">    printf(&quot;iCount &gt;&#x3D; 100\r\n&quot;);</span><br><span class="line">    iCount &#x3D; 0;</span><br><span class="line">    pthread_mutex_unlock(&amp;mutex);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ¡ä»¶å˜é‡éœ€è¦é…åˆäº’æ–¥é”æ¥ä½¿ç”¨ï¼š<br>ä¸ºä»€ä¹ˆè¦ä¸pthread_mutex ä¸€èµ·ä½¿ç”¨å‘¢ï¼Ÿ è¿™æ˜¯ä¸ºäº†åº”å¯¹ çº¿ç¨‹1åœ¨è°ƒç”¨pthread_cond_wait()ä½†çº¿ç¨‹1è¿˜æ²¡æœ‰è¿›å…¥wait condçš„çŠ¶æ€çš„æ—¶å€™ï¼Œæ­¤æ—¶çº¿ç¨‹2è°ƒç”¨äº† cond_singal çš„æƒ…å†µã€‚ å¦‚æœä¸ç”¨mutexé”çš„è¯ï¼Œè¿™ä¸ªcond_singalå°±ä¸¢å¤±äº†ã€‚åŠ äº†é”çš„æƒ…å†µæ˜¯ï¼Œçº¿ç¨‹2å¿…é¡»ç­‰åˆ° mutex è¢«é‡Šæ”¾ï¼ˆä¹Ÿå°±æ˜¯ pthread_cod_wait() é‡Šæ”¾é”å¹¶è¿›å…¥wait_condçŠ¶æ€ ï¼Œæ­¤æ—¶çº¿ç¨‹2ä¸Šé”ï¼‰ çš„æ—¶å€™æ‰èƒ½è°ƒç”¨cond_singal.</p><p>ç®€è€Œè¨€ä¹‹å°±æ˜¯ï¼Œåœ¨thread 2 call pthread_cond_wait() çš„æ—¶åˆ»åˆ° thread 2çœŸæ­£è¿›å…¥ wait çŠ¶æ€æ—¶ï¼Œæ˜¯å­˜åœ¨ç€æ—¶é—´å·®çš„ã€‚å¦‚æœåœ¨è¿™æ®µæ—¶é—´å·®å†… thread1 è°ƒç”¨äº† pthread_cond_signal() é‚£è¿™ä¸ª signal ä¿¡å·å°±ä¸¢å¤±äº†ã€‚ç»™ wait åŠ é”å¯ä»¥é˜²æ­¢åŒæ—¶æœ‰å¦ä¸€ä¸ªçº¿ç¨‹åœ¨ signalã€‚</p><h3 id="è‡ªæ—‹é”"><a href="#è‡ªæ—‹é”" class="headerlink" title="è‡ªæ—‹é”"></a>è‡ªæ—‹é”</h3><p>è‡ªæ—‹é”ä¸äº’æ–¥é‡ç±»ä¼¼ï¼Œä½†å®ƒä¸æ˜¯é€šè¿‡ä¼‘çœ ä½¿è¿›ç¨‹é˜»å¡ï¼Œè€Œæ˜¯åœ¨è·å–é”ä¹‹å‰ä¸€ç›´å¤„äºå¿™ç­‰ï¼ˆè‡ªæ—‹ï¼‰é˜»å¡çŠ¶æ€ã€‚è‡ªæ—‹é”é€‚ç”¨ä¸ä»¥ä¸‹æƒ…å†µï¼šé”è¢«æŒæœ‰çš„æ—¶é—´çŸ­ï¼Œè€Œä¸”çº¿ç¨‹å¹¶ä¸å¸Œæœ›åœ¨é‡æ–°è°ƒåº¦ä¸Šè¯è´¹å¤ªå¤šæˆæœ¬ã€‚å½“çº¿ç¨‹è‡ªæ—‹ç­‰å¾…é”å˜ä¸ºå¯ç”¨æ—¶ï¼ŒCPUä¸èƒ½åšå…¶ä»–äº‹æƒ…ï¼Œè¿™æ˜¯å®ƒåªèƒ½è¢«æŒæœ‰ä¸€å°æ®µæ—¶é—´çš„åŸå› ï¼Œè¶…è¿‡æ—¶é—´åˆ†ç‰‡åä¼šè¢«CPUå¼ºè¡Œåˆ‡æ¢ã€‚</p><p>è‡ªæ—‹é”åœ¨éæŠ¢å å¼å†…æ ¸ä¸­éå¸¸æœ‰ç”¨ï¼Œä½†åœ¨ç”¨æˆ·å±‚ï¼Œè‡ªæ—‹é”ä¸æ˜¯éå¸¸æœ‰ç”¨ï¼Œé™¤éè¿è¡Œåœ¨ä¸å…è®¸æŠ¢å çš„å®æ—¶è°ƒåº¦ç±»ä¸­ã€‚<br>pthread_spin_initå‡½æ•°å¯¹è‡ªæ—‹é”åˆå§‹åŒ–ï¼Œpthread_spin_destory å‡½æ•°å¯¹è‡ªæ—‹é”è¿›è¡Œååˆå§‹åŒ–ã€‚<br>pthread_spin_lock å’Œ pthread_spin_trylock è¿›è¡ŒåŠ é”ï¼Œpthread_spin_unlock è¿›è¡Œè§£é”ã€‚</p><h3 id="å±éšœ"><a href="#å±éšœ" class="headerlink" title="å±éšœ"></a>å±éšœ</h3><p>å±éšœæ˜¯ç”¨æˆ·åè°ƒå¤šä¸ªçº¿ç¨‹å¹¶è¡Œå·¥ä½œçš„åŒæ­¥æœºåˆ¶ã€‚å®ƒå…è®¸æ¯ä¸ªçº¿ç¨‹ç­‰å¾…ï¼Œç›´åˆ°æ‰€æœ‰çš„åˆä½œçº¿ç¨‹éƒ½åˆ°è¾¾æŸä¸€ç‚¹ï¼Œç„¶åä»è¯¥ç‚¹ç»§ç»­æ‰§è¡Œã€‚å±éšœå…è®¸ä»»æ„æ•°é‡çš„çº¿ç¨‹ç­‰å¾…ï¼Œç›´åˆ°æ‰€æœ‰çš„çº¿ç¨‹å®Œæˆå¤„ç†å·¥ä½œï¼Œè€Œçº¿ç¨‹ä¸éœ€è¦é€€å‡ºï¼Œæ‰€æœ‰çš„çº¿ç¨‹åˆ°è¾¾å±éšœåå¯ä»¥æ¥ç€å·¥ä½œã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;çº¿ç¨‹æ¦‚å¿µ&quot;&gt;&lt;a href=&quot;#çº¿ç¨‹æ¦‚å¿µ&quot; class=&quot;headerlink&quot; title=&quot;çº¿ç¨‹æ¦‚å¿µ&quot;&gt;&lt;/a&gt;çº¿ç¨‹æ¦‚å¿µ&lt;/h2&gt;&lt;p&gt;æ¯ä¸ªçº¿ç¨‹éƒ½åŒ…å«æœ‰è¡¨ç¤ºæ‰§è¡Œç¯å¢ƒæ‰€å¿…é¡»çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬çº¿ç¨‹IDã€ä¸€ç»„å¯„å­˜å™¨å€¼ã€æ ˆã€è°ƒåº¦ä¼˜å…ˆçº§å’Œç­–ç•¥ã€ä¿¡å·å±è”½å­—ã€errnoå˜é‡ä»¥åŠçº¿ç¨‹ç§æœ‰æ•°æ®ã€‚ä¸€ä¸ªè¿›ç¨‹çš„æ‰€æœ‰ä¿¡æ¯å¯¹è¯¥è¿›ç¨‹çš„æ‰€æœ‰çº¿ç¨‹éƒ½æ˜¯å…±äº«çš„ï¼ŒåŒ…æ‹¬å¯æ‰§è¡Œç¨‹åºçš„ä»£ç ã€ç¨‹åºçš„å…¨å±€å†…å­˜å’Œå †å†…å­˜ã€æ ˆä»¥åŠæ–‡ä»¶æè¿°ç¬¦ã€‚&lt;/p&gt;
&lt;h2 id=&quot;çº¿ç¨‹æ ‡è¯†&quot;&gt;&lt;a href=&quot;#çº¿ç¨‹æ ‡è¯†&quot; class=&quot;headerlink&quot; title=&quot;çº¿ç¨‹æ ‡è¯†&quot;&gt;&lt;/a&gt;çº¿ç¨‹æ ‡è¯†&lt;/h2&gt;&lt;p&gt;æ¯ä¸ªçº¿ç¨‹æœ‰ä¸€ä¸ªçº¿ç¨‹IDï¼Œçº¿ç¨‹å¯ä»¥é€šè¿‡è°ƒç”¨ pthread_self å‡½æ•°è·å¾—è‡ªèº«çš„çº¿ç¨‹IDã€‚&lt;br&gt;&lt;img src=&quot;11-1.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="ã€ŠAPUEã€‹ç¬”è®°" scheme="https://akaqin.github.io/categories/%E3%80%8AAPUE%E3%80%8B%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="pthread" scheme="https://akaqin.github.io/tags/pthread/"/>
    
  </entry>
  
  <entry>
    <title>ã€ŠUNIXç¯å¢ƒé«˜çº§ç¼–ç¨‹ã€‹ç¬¬10ç« â€”â€”ä¿¡å·</title>
    <link href="https://akaqin.github.io/2020/03/13/%E3%80%8AUNIX%E7%8E%AF%E5%A2%83%E9%AB%98%E7%BA%A7%E7%BC%96%E7%A8%8B%E3%80%8B%E7%AC%AC10%E7%AB%A0%E2%80%94%E2%80%94%E4%BF%A1%E5%8F%B7/"/>
    <id>https://akaqin.github.io/2020/03/13/%E3%80%8AUNIX%E7%8E%AF%E5%A2%83%E9%AB%98%E7%BA%A7%E7%BC%96%E7%A8%8B%E3%80%8B%E7%AC%AC10%E7%AB%A0%E2%80%94%E2%80%94%E4%BF%A1%E5%8F%B7/</id>
    <published>2020-03-13T12:35:08.000Z</published>
    <updated>2020-04-14T01:25:51.847Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ä¿¡å·æ¦‚å¿µ"><a href="#ä¿¡å·æ¦‚å¿µ" class="headerlink" title="ä¿¡å·æ¦‚å¿µ"></a>ä¿¡å·æ¦‚å¿µ</h2><p>ä¿¡å·æ˜¯è½¯ä»¶ä¸­æ–­ã€‚å®ƒæä¾›äº†ä¸€ç§å¤„ç†å¼‚æ­¥äº‹ä»¶çš„æ–¹æ³•ã€‚æ¯ä¸ªä¿¡å·éƒ½æœ‰ä¸€ä¸ªåå­—ï¼Œä»¥SIGå¼€å¤´ã€‚åœ¨å¤´æ–‡ä»¶&lt;signal.h&gt;ä¸­ï¼Œä¿¡å·åéƒ½è¢«å®šä¹‰ä¸ºæ­£æ•´æ•°å¸¸é‡ï¼ˆä¿¡å·ç¼–å·ï¼‰ã€‚<br>ä¸å­˜åœ¨ç¼–å·ä¸º0çš„ä¿¡å·ã€‚killå‡½æ•°å¯¹ä¿¡å·ç¼–å·0æœ‰ç‰¹æ®Šçš„ä½œç”¨ã€‚POSIX.1å°†æ­¤ä¸­ä¿¡å·ç¼–å·å€¼ç§°ä¸ºç©ºä¿¡å·ã€‚<br>ä¿¡å·å‡ºç°æ—¶ï¼Œå†…æ ¸æŒ‰ä¸‹åˆ—ä¸‰ç§æ–¹å¼ä¹‹ä¸€è¿›è¡Œå¤„ç†ï¼š</p><ul><li>å¿½ç•¥æ­¤ä¿¡å·ã€‚å¤§å¤šæ•°ä¿¡å·éƒ½å¯ä½¿ç”¨è¿™ç§æ–¹å¼è¿›è¡Œå¤„ç†ï¼Œä½†æœ‰ä¸¤ç§ä¿¡å·å†³ä¸èƒ½è¢«å¿½ç•¥ï¼Œå®ƒä»¬æ˜¯SIGKILLå’ŒSIGSTOPã€‚åŸå› æ˜¯å®ƒä»¬æƒ³å†…æ ¸æä¾›äº†ä½¿è¿›ç¨‹ç»ˆæ­¢æˆ–åœæ­¢çš„å¯é æ–¹æ³•ã€‚</li><li>æ•æ‰ä¿¡å·ã€‚ä¸ºäº†åšåˆ°è¿™ä¸€ç‚¹ï¼Œè¦é€šçŸ¥å†…æ ¸åœ¨æŸç§ä¿¡å·å‘ç”Ÿæ—¶ï¼Œè°ƒç”¨ä¸€ä¸ªå¯æ‰§è¡Œç”¨æˆ·å¸Œæœ›å¯¹è¿™ç§äº‹ä»¶è¿›è¡Œçš„å¤„ç†çš„ç”¨æˆ·å‡½æ•°ã€‚</li><li>æ‰§è¡Œç³»ç»Ÿé»˜è®¤åŠ¨ä½œã€‚å¯¹å¤§å¤šæ•°ä¿¡å·çš„ç³»ç»Ÿé»˜è®¤åŠ¨ä½œæ˜¯ç»ˆæ­¢è¯¥è¿›ç¨‹ã€‚<br><img src="10-1.png" alt=""></li></ul><a id="more"></a><h2 id="å‡½æ•°signal"><a href="#å‡½æ•°signal" class="headerlink" title="å‡½æ•°signal"></a>å‡½æ•°signal</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;signal.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// void (*signal(int signo, void (*func)(int)))(int);</span></span><br><span class="line"><span class="comment">//ç­‰ä»·äº</span></span><br><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="keyword">void</span> <span class="title">Sigfunc</span><span class="params">(<span class="keyword">int</span>)</span></span>;</span><br><span class="line"><span class="function">Sigfunc *<span class="title">signal</span><span class="params">(<span class="keyword">int</span>, Sigfunc *)</span></span>;</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"apue.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">sig_usr</span><span class="params">(<span class="keyword">int</span> signo)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (signal(SIGUSR1, sig_usr) == SIG_ERR) &#123;</span><br><span class="line">        err_sys(<span class="string">"signal error"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (signal(SIGUSR2, sig_usr) == SIG_ERR) &#123;</span><br><span class="line">        err_sys(<span class="string">"signal error"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">        pause();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">sig_usr</span><span class="params">(<span class="keyword">int</span> signo)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (signo == SIGUSR1) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"received SIGUSR1\n"</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (signo == SIGUSR2) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"received SIGUSR2\n"</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        err_dump(<span class="string">"received signal %d\n"</span>, signo);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„ï¼šåœ¨UNIXç³»ç»Ÿä¸­ï¼Œæ€æ­»ï¼ˆkillï¼‰è¿™ä¸ªæœ¯è¯­æ˜¯ä¸æ°å½“çš„ã€‚killï¼ˆ1ï¼‰å‘½ä»¤å’Œkillï¼ˆ2ï¼‰å‡½æ•°åªæ˜¯å°†ä¸€ä¸ªä¿¡å·å‘é€ç»™ä¸€ä¸ªè¿›ç¨‹æˆ–è¿›ç¨‹ç»„ã€‚è¯¥ä¿¡å·æ˜¯å¦ç»ˆæ­¢è¿›ç¨‹åˆ™å–å†³äºè¯¥ä¿¡å·çš„ç±»å‹ï¼Œä»¥åŠè¿›ç¨‹æ˜¯å¦å®‰æ’äº†æ•æ‰è¯¥ä¿¡å·</strong></p><h3 id="ç¨‹åºå¯åŠ¨"><a href="#ç¨‹åºå¯åŠ¨" class="headerlink" title="ç¨‹åºå¯åŠ¨"></a>ç¨‹åºå¯åŠ¨</h3><p>å½“æ‰§è¡Œä¸€ä¸ªç¨‹åºæ—¶ï¼Œæ‰€æœ‰ä¿¡å·çš„çŠ¶æ€éƒ½æ˜¯ç³»ç»Ÿé»˜è®¤æˆ–å¿½ç•¥ã€‚é€šå¸¸æ‰€æœ‰ä¿¡å·éƒ½è¢«è®¾ç½®ä¸ºå®ƒä»¬çš„é»˜è®¤åŠ¨ä½œï¼Œé™¤éè°ƒç”¨execçš„è¿›ç¨‹å¿½ç•¥è¯¥ä¿¡å·ã€‚<br>å½“è¿›ç¨‹æ‰§è¡Œä¸€ä¸ªæ–°ç¨‹åºåï¼Œä¿¡å·æ•æ‰å‡½æ•°çš„åœ°å€å¾ˆå¯èƒ½åœ¨æ‰€æ‰§è¡Œçš„æ–°ç¨‹åºæ–‡ä»¶ä¸­å·²æ— æ„ä¹‰ã€‚</p><h3 id="è¿›ç¨‹åˆ›å»º"><a href="#è¿›ç¨‹åˆ›å»º" class="headerlink" title="è¿›ç¨‹åˆ›å»º"></a>è¿›ç¨‹åˆ›å»º</h3><p>å½“ä¸€ä¸ªè¿›ç¨‹è°ƒç”¨forkæ—¶ï¼Œå…¶å­è¿›ç¨‹ç»§æ‰¿çˆ¶è¿›ç¨‹çš„ä¿¡å·å¤„ç†æ–¹å¼ã€‚å› ä¸ºå­è¿›ç¨‹åœ¨å¼€å§‹æ—¶å¤åˆ¶äº†çˆ¶è¿›ç¨‹å†…å­˜æ˜ åƒï¼Œæ‰€ä»¥ä¿¡å·æ•æ‰å‡½æ•°çš„åœ°å€åœ¨å­è¿›ç¨‹ä¸­æ˜¯æœ‰æ„ä¹‰çš„ã€‚</p><h2 id="å¯é‡å…¥å‡½æ•°"><a href="#å¯é‡å…¥å‡½æ•°" class="headerlink" title="å¯é‡å…¥å‡½æ•°"></a>å¯é‡å…¥å‡½æ•°</h2><p>è¿›ç¨‹æ•æ‰åˆ°ä¿¡å·å¹¶å¯¹å…¶è¿›è¡Œå¤„ç†æ—¶ï¼Œè¿›ç¨‹æ­£åœ¨æ‰§è¡Œçš„æ­£å¸¸æŒ‡ä»¤åºåˆ—å°±è¢«ä¿¡å·å¤„ç†ç¨‹åºä¸´æ—¶ä¸­æ–­ï¼Œå®ƒé¦–å…ˆæ‰§è¡Œè¯¥ä¿¡å·å¤„ç†ç¨‹åºä¸­çš„æŒ‡ä»¤ã€‚å¦‚æœä¿¡å·å¤„ç†ç¨‹åºè¿”å›ï¼ˆä¾‹å¦‚æ²¡æœ‰è°ƒç”¨exitæˆ–longjmpï¼‰ï¼Œåˆ™ç»§ç»­æ‰§è¡Œåœ¨æ•æ‰åˆ°ä¿¡å·æ—¶è¿›ç¨‹æ­£åœ¨æ‰§è¡Œçš„æ­£å¸¸æŒ‡ä»¤åºåˆ—ã€‚</p><p>Single UNIX Specifiation è¯´æ˜äº†åœ¨ä¿¡å·å¤„ç†ç¨‹åºä¸­ä¿è¯è°ƒç”¨å®‰å…¨çš„å‡½æ•°ã€‚è¿™äº›å‡½æ•°æ˜¯å¯é‡å…¥çš„å¹¶è¢«ç§°ä¸ºæ˜¯å¼‚æ­¥ä¿¡å·å®‰å…¨çš„ã€‚é™¤äº†å¯é‡å…¥ä»¥å¤–ï¼Œåœ¨ä¿¡å·å¤„ç†æ“ä½œæœŸé—´ï¼Œå®ƒä¼šé˜»å¡ä»»ä½•ä¼šå¼•èµ·ä¸ä¸€è‡´çš„ä¿¡å·å‘é€ã€‚</p><h2 id="å¯é ä¿¡å·æœ¯è¯­å’Œè¯­ä¹‰"><a href="#å¯é ä¿¡å·æœ¯è¯­å’Œè¯­ä¹‰" class="headerlink" title="å¯é ä¿¡å·æœ¯è¯­å’Œè¯­ä¹‰"></a>å¯é ä¿¡å·æœ¯è¯­å’Œè¯­ä¹‰</h2><p>é¦–å…ˆï¼Œå½“é€ æˆä¿¡å·äº‹ä»¶çš„å‘ç”Ÿæ—¶ï¼Œä¸ºè¿›ç¨‹<code>äº§ç”Ÿ</code>ä¸€ä¸ªä¿¡å·ï¼ˆæˆ–å‘ä¸€ä¸ªè¿›ç¨‹å‘é€ä¸€ä¸ªä¿¡å·ï¼‰ã€‚äº‹ä»¶å¯ä»¥æ˜¯ç¡¬ä»¶å¼‚å¸¸ï¼ˆå¦‚é™¤ä»¥0ï¼‰ã€è½¯ä»¶æ¡ä»¶ï¼ˆå¦‚alarmå®šæ—¶å™¨è¶…æ—¶ï¼‰ã€ç»ˆç«¯äº§ç”Ÿçš„ä¿¡å·æˆ–è°ƒç”¨killå‡½æ•°ã€‚å½“ä¸€ä¸ªä¿¡å·äº§ç”Ÿæ—¶ï¼Œå†…æ ¸é€šå¸¸åœ¨è¿›ç¨‹è¡¨ä¸­ä»¥æŸç§å½¢å¼è®¾ç½®ä¸€ä¸ªæ ‡å¿—ã€‚</p><p>å½“å¯¹ä¿¡å·é‡‡å–äº†è¿™ç§åŠ¨ä½œæ—¶ï¼Œæˆ‘ä»¬è¯´å‘è¿›ç¨‹<code>é€’é€</code>äº†ä¸€ä¸ªä¿¡å·ã€‚åœ¨ä¿¡å·<code>äº§ç”Ÿï¼ˆgenerationï¼‰</code>å’Œ<code>é€’é€ï¼ˆdeliveryï¼‰</code>ä¹‹é—´çš„æ—¶é—´é—´éš”å†…ï¼Œç§°ä¿¡å·æ˜¯<code>æœªå†³çš„ï¼ˆpendingï¼‰</code>ã€‚</p><p>è¿›ç¨‹å¯ä»¥é€‰ç”¨â€œé˜»å¡ä¿¡å·é€’é€â€ã€‚å¦‚æœä¸ºè¿›ç¨‹äº§ç”Ÿäº†ä¸€ä¸ªé˜»å¡çš„ä¿¡å·ï¼Œè€Œå¯¹è¯¥ä¿¡å·çš„åŠ¨ä½œæ˜¯ç³»ç»Ÿé»˜è®¤åŠ¨ä½œæˆ–æ•æ‰è¯¥ä¿¡å·ï¼Œåˆ™ä¸ºè¯¥è¿›ç¨‹å°†æ­¤ä¿¡å·ä¿æŒä¸ºæœªå†³çŠ¶æ€ï¼Œç›´åˆ°è¯¥è¿›ç¨‹å¯¹æ­¤ä¿¡å·è§£é™¤äº†é˜»å¡ï¼Œæˆ–è€…å°†å¯¹æ­¤ä¿¡å·çš„åŠ¨ä½œæ›´æ”¹ä¸ºå¿½ç•¥ã€‚å†…æ ¸åœ¨é€’é€ä¸€ä¸ªåŸæ¥è¢«é˜»å¡çš„ä¿¡å·ç»™è¿›ç¨‹æ—¶ï¼ˆè€Œä¸æ˜¯åœ¨äº§ç”Ÿè¯¥ä¿¡å·æ—¶ï¼‰ï¼Œæ‰å†³å®šå¯¹å®ƒçš„å¤„ç†æ–¹å¼ã€‚</p><p>POSIX.1å…è®¸ç³»ç»Ÿé€’é€è¯¥ä¿¡å·ä¸€æ¬¡æˆ–å¤šæ¬¡ã€‚å¦‚æœå¤šæ¬¡åˆ™æ’é˜Ÿã€‚ä½†é™¤éæ”¯æŒPOSIX.1å®æ—¶æ‰©å±•ï¼Œå¦åˆ™å¤§å¤šæ•°UNIXå¹¶ä¸æ’é˜Ÿï¼Œè€Œæ˜¯åªé€’é€è¿™ç§ä¿¡å·ä¸€æ¬¡ã€‚</p><p>æ¯ä¸ªè¿›ç¨‹éƒ½ä¸€ä¸ªä¿¡å·å±è”½å­—ï¼ˆsingal maskï¼‰ï¼Œå®ƒè§„å®šäº†å½“å‰è¦é˜»å¡é€’é€è¯¥è¿›ç¨‹çš„ä¿¡å·é›†ã€‚</p><h2 id="å‡½æ•°kill-å’Œ-raise"><a href="#å‡½æ•°kill-å’Œ-raise" class="headerlink" title="å‡½æ•°kill å’Œ raise"></a>å‡½æ•°kill å’Œ raise</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;signal.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">kill</span><span class="params">(<span class="keyword">pid_t</span> pid, <span class="keyword">int</span> signo)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">raise</span><span class="params">(<span class="keyword">int</span> signo)</span></span>;</span><br></pre></td></tr></table></figure><p>killå‡½æ•°å°†ä¿¡å·å‘é€ç»™è¿›ç¨‹æˆ–è¿›ç¨‹ç»„ã€‚raiseå‡½æ•°åˆ™å…è®¸è¿›ç¨‹å‘è‡ªèº«å‘é€ä¿¡å·ã€‚</p><h2 id="å‡½æ•°alarm-å’Œ-pause"><a href="#å‡½æ•°alarm-å’Œ-pause" class="headerlink" title="å‡½æ•°alarm å’Œ pause"></a>å‡½æ•°alarm å’Œ pause</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">unsigned</span> <span class="keyword">int</span> <span class="title">alarm</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">int</span> seconds)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">pause</span><span class="params">(<span class="keyword">void</span>)</span></span>;</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;signal.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">sig_alrm</span><span class="params">(<span class="keyword">int</span> signo)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    /\* nothing to <span class="keyword">do</span>, just <span class="keyword">return</span> to wake up the pause \*/</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> sleep1(<span class="keyword">unsigned</span> <span class="keyword">int</span> seconds)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//æ³¨å†Œä¿¡å·å¤„ç†ç¨‹åº</span></span><br><span class="line">    <span class="keyword">if</span> (signal(SIGALRM, sig_alrm) == SIG_ERR) &#123;</span><br><span class="line">        <span class="keyword">return</span> seconds;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//è®¾ç½®é—¹é’Ÿ</span></span><br><span class="line">    alarm(seconds);</span><br><span class="line">    <span class="comment">//æš‚åœ</span></span><br><span class="line">    pause();</span><br><span class="line">    <span class="comment">//å…³æ‰é—¹é’Ÿ</span></span><br><span class="line">    <span class="keyword">return</span> alarm(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>sleep1å­˜åœ¨3ä¸ªé—®é¢˜ï¼š</p><ol><li>å¦‚æœè°ƒç”¨alarmå‰è®¾ç½®äº†é—¹é’Ÿï¼Œåˆ™å®ƒè¢«sleep1å‡½æ•°ä¸­çš„ç¬¬ä¸€æ¬¡alarmè°ƒç”¨æ“¦é™¤ã€‚æ›´æ­£æ–¹æ³•ï¼šæ£€æŸ¥ç¬¬ä¸€æ¬¡è°ƒç”¨çš„è¿”å›å€¼ï¼Œå¦‚æœå°äºæœ¬æ¬¡è°ƒç”¨çš„å‚æ•°å€¼ï¼Œåˆ™åªåº”ç­‰å¾…è¶…æ—¶ä¾‹å¦‚è¿‡å¤§äºæœ¬æ¬¡å‚æ•°ï¼Œåˆ™åœ¨sleep1å‡½æ•°è¿”å›å‰ï¼Œé‡ç½®æ­¤é—¹é’Ÿï¼Œä½¿å…¶å†æ¬¡å‘ç”Ÿè¶…æ—¶ã€‚</li><li>è¯¥ç¨‹åºä¿®æ”¹äº†å¯¹SIGALRMçš„é…ç½®ã€‚å¦‚æœç¼–å†™äº†ä¸€ä¸ªå‡½æ•°ä¾›å…¶ä»–å‡½æ•°è°ƒç”¨ï¼Œåˆ™åœ¨è¯¥å‡½æ•°è¢«è°ƒç”¨æ—¶å…ˆè¦ä¿å­˜åŸé…ç½®ï¼Œåœ¨è¯¥å‡½æ•°è¿”å›å‰å†æ¢å¤åŸé…ç½®ã€‚æ›´æ­£æ–¹æ³•ï¼šä¿å­˜signalå‡½æ•°çš„è¿”å›å€¼ï¼Œåœ¨è¿”å›å‰é‡ç½®åŸé…ç½®ã€‚</li><li>åœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨alarmå’Œpauseä¹‹é—´æœ‰ä¸€ä¸ªç«äº‰æ¡ä»¶ã€‚åœ¨ä¸€ä¸ªç¹å¿™çš„ç³»ç»Ÿä¸­ï¼Œå¯èƒ½alarmåœ¨è°ƒç”¨pauseä¹‹å‰è¶…æ—¶ï¼Œå¹¶è°ƒç”¨äº†ä¿¡å·å¤„ç†ç¨‹åºã€‚å¦‚æœå‘ç”Ÿäº†è¿™ç§æƒ…å†µï¼Œåˆ™åœ¨è°ƒç”¨pauseåï¼Œå¦‚æœæ²¡æœ‰æ•æ‰åˆ°å…¶ä»–ä¿¡å·ï¼Œè°ƒç”¨è€…å°†æ°¸è¿œè¢«æŒ‚èµ·ã€‚</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span>    <span class="meta-string">&lt;setjmp.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span>    <span class="meta-string">&lt;signal.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span>    <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> jmp_buf env_alrm;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">sig_alrm</span><span class="params">(<span class="keyword">int</span> signo)</span> </span>&#123;</span><br><span class="line">    longjmp(env_alrm, <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">unsigned</span> <span class="keyword">int</span> <span class="title">sleep2</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">int</span> seconds)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (signal(SIGALRM, sig_alrm) == SIG_ERR) &#123;</span><br><span class="line">        <span class="keyword">return</span> seconds;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (setjmp(env_alrm) == <span class="number">0</span>) &#123;</span><br><span class="line">        alarm(seconds);</span><br><span class="line">        pause();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> alarm(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>sleep2é€šè¿‡longjmpçš„æ–¹å¼è§£å†³äº†sleep1ä¸­çš„ç«äº‰æ¡ä»¶é—®é¢˜ï¼Œä½†å¸¦æ¥äº†å¦å¤–ä¸€ä¸ªé—®é¢˜ï¼šå®ƒæ¶‰åŠä¸å…¶ä»–ä¿¡å·çš„äº¤äº’ã€‚å¦‚æœSIGALRMä¸­æ–­äº†æŸä¸ªå…¶ä»–ä¿¡å·å¤„ç†ç¨‹åºï¼Œåˆ™è°ƒç”¨longjmpä¼šææ—©ç»ˆæ­¢è¯¥ä¿¡å·å¤„ç†ç¨‹åºã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"../apue.3e/include/apue.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">unsigned</span> <span class="keyword">int</span> <span class="title">sleep2</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">int</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">sig_int</span><span class="params">(<span class="keyword">int</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> unslept;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (signal(SIGINT, sig_int) == SIG_ERR)</span><br><span class="line">        err_sys(<span class="string">"signal(SIGINT) error"</span>);</span><br><span class="line">    unslept = sleep2(<span class="number">5</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"sleep2 returned: %u\n"</span>, unslept);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">sig_int</span><span class="params">(<span class="keyword">int</span> signo)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i, j;</span><br><span class="line">    <span class="keyword">volatile</span> <span class="keyword">int</span> k;</span><br><span class="line"></span><br><span class="line">    /\*</span><br><span class="line">     \* Tune these loops to <span class="built_in">run</span> <span class="keyword">for</span> more than <span class="number">5</span> seconds</span><br><span class="line">     \* on whatever system <span class="keyword">this</span> test program is <span class="built_in">run</span>.</span><br><span class="line">     \*/</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"\nsig_int starting\n"</span>);</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">300000</span>; i++)</span><br><span class="line">        <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">4000</span>; j++)</span><br><span class="line">            k += i * j;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"sig_int finished\n"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ ./a.out</span><br><span class="line">^C</span><br><span class="line">sig_int starting</span><br><span class="line">sig_int finished</span><br><span class="line">sleep2 returned: 2</span><br></pre></td></tr></table></figure><p>ä»ä¸­å¯è§sleep2å‡½æ•°æ‰€å¼•èµ·çš„longjmpä½¿å¦ä¸€ä¸ªä¿¡å·å¤„ç†ç¨‹åºsig_intææ—©ç»ˆæ­¢ï¼Œå³ä½¿å®ƒæœªå®Œæˆä¹Ÿä¼šå¦‚æ­¤ã€‚</p><p><em>sleep1 å’Œ sleep2 å‡½æ•°çš„è¿™ä¸¤ä¸ªå®ä¾‹å‘Šè¯‰æˆ‘ä»¬åœ¨æ¶‰åŠä¿¡å·æ—¶éœ€è¦æœ‰ç²¾ç»†è€Œå‘¨åˆ°çš„è€ƒè™‘ã€‚</em></p><p>é™¤äº†ç”¨æ¥å®ç°sleepå‡½æ•°å¤–ï¼Œalarmè¿˜å¸¸ç”¨è¯­å¯¹å¯èƒ½é˜»å¡çš„æ“ä½œè®¾ç½®æ—¶é—´ä¸Šçº¿å€¼ã€‚ä¾‹å¦‚ï¼Œç¨‹åºä¸­æœ‰ä¸€ä¸ªè¯»ä½é€Ÿè®¾å¤‡çš„å¯èƒ½é˜»å¡çš„æ“ä½œï¼Œæˆ‘ä»¬å¸Œæœ›è¶…è¿‡ä¸€å®šæ—¶é—´é‡åå°±åœæ­¢æ‰§è¡Œè¯¥æ“ä½œã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"apue.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">sig_alrm</span><span class="params">(<span class="keyword">int</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    <span class="keyword">char</span> <span class="built_in">line</span>[MAXLINE];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (signal(SIGALRM, sig_alrm) == SIG_ERR) &#123;</span><br><span class="line">        err_sys(<span class="string">"signal(SIGALRM) error"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    alarm(<span class="number">10</span>);</span><br><span class="line">    <span class="keyword">if</span> ((n = <span class="built_in">read</span>(STDIN_FILENO, <span class="built_in">line</span>, MAXLINE)) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        err_sys(<span class="string">"read error"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    alarm(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">write</span>(STDOUT_FILENO, <span class="built_in">line</span>, n);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">sig_alrm</span><span class="params">(<span class="keyword">int</span> signo)</span> </span>&#123;</span><br><span class="line">    /\* nothing to <span class="keyword">do</span>, just <span class="keyword">return</span> to interrupt the <span class="built_in">read</span> \*/</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ç§ç¨‹åºæœ‰ä¸¤ä¸ªé—®é¢˜ï¼š</p><ol><li>ç¬¬ä¸€æ¬¡è°ƒç”¨alarmä¸readä¹‹é—´å­˜åœ¨ç«äº‰æ¡ä»¶ã€‚å¤§å¤šæ•°è§£å†³æ–¹æ¡ˆæ˜¯æŠŠé—¹é’Ÿçš„æ—¶é•¿è®¾ç½®ä¹…ä¸€ç‚¹ã€‚</li><li>å¦‚æœç³»ç»Ÿè°ƒç”¨æ˜¯è‡ªåŠ¨é‡å¯çš„ï¼Œåˆ™å½“alarmä¿¡å·å¤„ç†ç¨‹åºè¿”å›æ—¶ï¼Œreadå¹¶ä¸è¢«ä¸­æ–­ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œè®¾ç½®æ—¶é—´é™åˆ¶ä¸èµ·ä½œç”¨ã€‚</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"../apue.3e/include/apue.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;setjmp.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">sig_alrm</span><span class="params">(<span class="keyword">int</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> jmp_buf env_alrm;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    <span class="keyword">char</span> <span class="built_in">line</span>[MAXLINE];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (signal(SIGALRM, sig_alrm) == SIG_ERR) &#123;</span><br><span class="line">        err_sys(<span class="string">"signal(SIGALRM) error"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (setjmp(env_alrm) != <span class="number">0</span>) &#123;</span><br><span class="line">        err_quit(<span class="string">"read timeout"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    alarm(<span class="number">10</span>);</span><br><span class="line">    <span class="keyword">if</span> ((n = <span class="built_in">read</span>(STDIN_FILENO, <span class="built_in">line</span>, MAXLINE)) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        err_sys(<span class="string">"read error"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    alarm(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">write</span>(STDOUT_FILENO, <span class="built_in">line</span>, n);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">sig_alrm</span><span class="params">(<span class="keyword">int</span> signo)</span> </span>&#123;</span><br><span class="line">    longjmp(env_alrm, <span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·çš„ç¨‹åºä¸ç®¡ç³»ç»Ÿæ˜¯å¦é‡æ–°å¯åŠ¨è¢«ä¸­æ–­çš„ç³»ç»Ÿè°ƒç”¨éƒ½èƒ½æ­£å¸¸å·¥ä½œï¼Œä½†ä»æ—§å­˜åœ¨ä¸å…¶ä»–ä¿¡å·å¤„ç†ç¨‹åºäº¤äº’çš„é—®é¢˜ã€‚</p><h2 id="ä¿¡å·é›†"><a href="#ä¿¡å·é›†" class="headerlink" title="ä¿¡å·é›†"></a>ä¿¡å·é›†</h2><p>ä¸€ä¸ªèƒ½è¡¨ç¤ºå¤šä¸ªä¿¡å·çš„æ•°æ®ç±»å‹ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">sigemptyset</span><span class="params">(<span class="keyword">sigset_t</span> *<span class="built_in">set</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">sigfillset</span><span class="params">(sigset *<span class="built_in">set</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">sigaddset</span><span class="params">(sigset *<span class="built_in">set</span>, <span class="keyword">int</span> signo)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">sigdelset</span><span class="params">(sigset_st *<span class="built_in">set</span>, <span class="keyword">int</span> signo)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">sigismember</span><span class="params">(<span class="keyword">const</span> <span class="keyword">sigset_t</span> *<span class="built_in">set</span>, <span class="keyword">int</span> signo)</span></span>;</span><br></pre></td></tr></table></figure><h3 id="å‡½æ•°-sigprocmask"><a href="#å‡½æ•°-sigprocmask" class="headerlink" title="å‡½æ•° sigprocmask"></a>å‡½æ•° sigprocmask</h3><p>ä¸€ä¸ªè¿›ç¨‹ä¿¡å·å±è”½å­—è§„å®šäº†å½“å‰é˜»å¡è€Œä¸èƒ½é€’é€è¯¥è¿›ç¨‹çš„ä¿¡å·é›†ã€‚è°ƒç”¨å‡½æ•° sigprocmask å¯ä»¥æ£€æµ‹æˆ–æ›´æ”¹ï¼Œæˆ–åŒæ—¶è¿›è¡Œæ£€æµ‹å’Œæ›´æ”¹è¿›ç¨‹çš„ä¿¡å·å±è”½å­—ã€‚</p><h3 id="å‡½æ•°-sigpending"><a href="#å‡½æ•°-sigpending" class="headerlink" title="å‡½æ•° sigpending"></a>å‡½æ•° sigpending</h3><p>sigpendingè¿”å›ä¸€ä¿¡å·é›†ï¼Œå¯¹äºè°ƒç”¨è¿›ç¨‹è€Œè¨€ï¼Œå…¶ä¸­çš„å„ä¿¡å·æ˜¯é˜»å¡ä¸èƒ½é€’é€çš„ï¼Œå› è€Œä¹Ÿä¸€å®šæ˜¯å½“å‰æœªå†³çš„ã€‚è¯¥ä¿¡å·é›†é€šè¿‡setå‚æ•°è¿”å›ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"../apue.3e/include/apue.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">sig_quit</span><span class="params">(<span class="keyword">int</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">sigset_t</span> newmask, oldmask, pendmask;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (signal(SIGQUIT, sig_quit) == SIG_ERR)</span><br><span class="line">        err_sys(<span class="string">"can't catch SIGQUIT"</span>);</span><br><span class="line"></span><br><span class="line">    /\*</span><br><span class="line">     \* Block SIGQUIT <span class="keyword">and</span> save current signal mask.</span><br><span class="line">     \*/</span><br><span class="line">    sigemptyset(&amp;newmask);</span><br><span class="line">    sigaddset(&amp;newmask, SIGQUIT);</span><br><span class="line">    <span class="keyword">if</span> (sigprocmask(SIG_BLOCK, &amp;newmask, &amp;oldmask) &lt; <span class="number">0</span>)</span><br><span class="line">        err_sys(<span class="string">"SIG_BLOCK error"</span>);</span><br><span class="line"></span><br><span class="line">    sleep(<span class="number">5</span>);    /\* SIGQUIT here will remain pending \*/</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (sigpending(&amp;pendmask) &lt; <span class="number">0</span>)</span><br><span class="line">        err_sys(<span class="string">"sigpending error"</span>);</span><br><span class="line">    <span class="keyword">if</span> (sigismember(&amp;pendmask, SIGQUIT))</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"\nSIGQUIT pending\n"</span>);</span><br><span class="line"></span><br><span class="line">    /\*</span><br><span class="line">     \* Restore signal mask which unblocks SIGQUIT.</span><br><span class="line">     \*/</span><br><span class="line">    <span class="keyword">if</span> (sigprocmask(SIG_SETMASK, &amp;oldmask, <span class="literal">NULL</span>) &lt; <span class="number">0</span>)</span><br><span class="line">        err_sys(<span class="string">"SIG_SETMASK error"</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"SIGQUIT unblocked\n"</span>);</span><br><span class="line"></span><br><span class="line">    sleep(<span class="number">5</span>);    /\* SIGQUIT here will <span class="built_in">terminate</span> with core file \*/</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">sig_quit</span><span class="params">(<span class="keyword">int</span> signo)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"caught SIGQUIT\n"</span>);</span><br><span class="line">    <span class="keyword">if</span> (signal(SIGQUIT, SIG_DFL) == SIG_ERR)</span><br><span class="line">        err_sys(<span class="string">"can't reset SIGQUIT"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å‡½æ•°-sigaction"><a href="#å‡½æ•°-sigaction" class="headerlink" title="å‡½æ•° sigaction"></a>å‡½æ•° sigaction</h3><p>å®ƒçš„åŠŸèƒ½æ˜¯æ£€æŸ¥æˆ–ï¼ˆå¹¶ï¼‰ä¿®æ”¹ä¸æŒ‡å®šä¿¡å·ç›¸å…³è”çš„å¤„ç†åŠ¨ä½œã€‚å®ƒå–ä»£äº†UNIXæ—©æœŸç‰ˆæœ¬çš„signalå‡½æ•°ã€‚</p><h3 id="å‡½æ•°-sigsetjmp-ä¸-siglongjmp"><a href="#å‡½æ•°-sigsetjmp-ä¸-siglongjmp" class="headerlink" title="å‡½æ•° sigsetjmp ä¸ siglongjmp"></a>å‡½æ•° sigsetjmp ä¸ siglongjmp</h3><p>å®ƒä»¬æ¯”setjmpä¸longjmpå¤šäº†ä¸€ä¸ªå‚æ•°ï¼Œç”¨æ¥ä¿å­˜å½“å‰ä¿¡å·çš„å±è”½å­—ï¼Œç”¨äºåœ¨è°ƒç”¨siglongjmpæ—¶æ¢å¤ã€‚</p><h3 id="å‡½æ•°-sigsuspend"><a href="#å‡½æ•°-sigsuspend" class="headerlink" title="å‡½æ•° sigsuspend"></a>å‡½æ•° sigsuspend</h3><p>å®ƒåœ¨ä¸€ä¸ªåŸå­æ“ä½œä¸­å…ˆæ¢å¤ä¿¡å·å±è”½å­—ï¼Œå†ä½¿è¿›ç¨‹ä¼‘çœ ã€‚è§£å†³äº†ä¿¡å·ä¸¢å¤±çš„é—®é¢˜ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sigprocmask(SIG_SETMASK, &amp;oldmask, <span class="literal">NULL</span>);</span><br><span class="line">pause();</span><br><span class="line"><span class="comment">//å½“ä¿¡å·æ”¾ç”Ÿåœ¨sigprocmaskä¸pauseä¹‹é—´æ—¶ï¼Œä¿¡å·å°±ä¸¢å¤±äº†ï¼Œè¿›ç¨‹å°†æ°¸è¿œé˜»å¡</span></span><br></pre></td></tr></table></figure><p>å¦ä¸€ç§åº”ç”¨æ˜¯ç­‰å¾…ä¸€ä¸ªä¿¡å·å¤„ç†ç¨‹åºè®¾ç½®ä¸€ä¸ªå…¨å±€å˜é‡ï¼Œä»¥æ­¤å®ç°çˆ¶ã€å­è¿›ç¨‹ä¹‹é—´çš„åŒæ­¥ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"../apue.3e/include/apue.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">volatile</span> <span class="keyword">sig_atomic_t</span> sigflag; <span class="comment">/* set nonzero by sig handler * /</span></span><br><span class="line"><span class="comment">static sigset_t newmask, oldmask, zeromask;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">static void sig_usr(int signo)    /* one signal handler for SIGUSR1 and SIGUSR2 * /</span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">    sigflag = 1;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">void TELL_WAIT(void) &#123;</span></span><br><span class="line"><span class="comment">    if (signal(SIGUSR1, sig_usr) == SIG_ERR)</span></span><br><span class="line"><span class="comment">        err_sys("signal(SIGUSR1) error");</span></span><br><span class="line"><span class="comment">    if (signal(SIGUSR2, sig_usr) == SIG_ERR)</span></span><br><span class="line"><span class="comment">        err_sys("signal(SIGUSR2) error");</span></span><br><span class="line"><span class="comment">    sigemptyset(&amp;zeromask);</span></span><br><span class="line"><span class="comment">    sigemptyset(&amp;newmask);</span></span><br><span class="line"><span class="comment">    sigaddset(&amp;newmask, SIGUSR1);</span></span><br><span class="line"><span class="comment">    sigaddset(&amp;newmask, SIGUSR2);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    /* Block SIGUSR1 and SIGUSR2, and save current signal mask */</span></span><br><span class="line">    <span class="keyword">if</span> (sigprocmask(SIG_BLOCK, &amp;newmask, &amp;oldmask) &lt; <span class="number">0</span>)</span><br><span class="line">        err_sys(<span class="string">"SIG_BLOCK error"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">TELL_PARENT</span><span class="params">(<span class="keyword">pid_t</span> pid)</span> </span>&#123;</span><br><span class="line">    kill(pid, SIGUSR2);        <span class="comment">/* tell parent we're done */</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">WAIT_PARENT</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (sigflag == <span class="number">0</span>)</span><br><span class="line">        sigsuspend(&amp;zeromask);    <span class="comment">/* and wait for parent */</span></span><br><span class="line">    sigflag = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Reset signal mask to original value */</span></span><br><span class="line">    <span class="keyword">if</span> (sigprocmask(SIG_SETMASK, &amp;oldmask, <span class="literal">NULL</span>) &lt; <span class="number">0</span>)</span><br><span class="line">        err_sys(<span class="string">"SIG_SETMASK error"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">TELL_CHILD</span><span class="params">(<span class="keyword">pid_t</span> pid)</span> </span>&#123;</span><br><span class="line">    kill(pid, SIGUSR1);            <span class="comment">/* tell child we're done */</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">WAIT_CHILD</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (sigflag == <span class="number">0</span>)</span><br><span class="line">        sigsuspend(&amp;zeromask);    <span class="comment">/* and wait for child */</span></span><br><span class="line">    sigflag = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Reset signal mask to original value */</span></span><br><span class="line">    <span class="keyword">if</span> (sigprocmask(SIG_SETMASK, &amp;oldmask, <span class="literal">NULL</span>) &lt; <span class="number">0</span>)</span><br><span class="line">        err_sys(<span class="string">"SIG_SETMASK error"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å¦‚æœç­‰å¾…ä¿¡å·å‘ç”Ÿæ—¶å¸Œæœ›å»ä¼‘çœ ï¼Œåˆ™ä½¿ç”¨sigsuspendå‡½æ•°éå¸¸åˆé€‚ï¼Œä½†å¦‚æœåœ¨ç­‰å¾…ä¿¡å·æœŸé—´å¸Œæœ›è°ƒç”¨å…¶ä»–ç³»ç»Ÿå‡½æ•°ï¼Œåœ¨å•çº¿ç¨‹ç¯å¢ƒä¸‹æ²¡æœ‰å¦¥å–„çš„è§£å†³åŠæ³•ã€‚å¦‚æœä¸ä½¿ç”¨çº¿ç¨‹ï¼Œæˆ‘ä»¬èƒ½å°½åŠ›åšåˆ°æœ€å¥½çš„æ˜¯ï¼šå½“ä¿¡å·å‘ç”Ÿæ—¶ï¼Œåœ¨ä¿¡å·æ•æ‰ç¨‹åºä¸­å¯¹ä¸€ä¸ªå…¨å±€å˜é‡ç½®1ã€‚</strong></p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;ä¿¡å·æ¦‚å¿µ&quot;&gt;&lt;a href=&quot;#ä¿¡å·æ¦‚å¿µ&quot; class=&quot;headerlink&quot; title=&quot;ä¿¡å·æ¦‚å¿µ&quot;&gt;&lt;/a&gt;ä¿¡å·æ¦‚å¿µ&lt;/h2&gt;&lt;p&gt;ä¿¡å·æ˜¯è½¯ä»¶ä¸­æ–­ã€‚å®ƒæä¾›äº†ä¸€ç§å¤„ç†å¼‚æ­¥äº‹ä»¶çš„æ–¹æ³•ã€‚æ¯ä¸ªä¿¡å·éƒ½æœ‰ä¸€ä¸ªåå­—ï¼Œä»¥SIGå¼€å¤´ã€‚åœ¨å¤´æ–‡ä»¶&amp;lt;signal.h&amp;gt;ä¸­ï¼Œä¿¡å·åéƒ½è¢«å®šä¹‰ä¸ºæ­£æ•´æ•°å¸¸é‡ï¼ˆä¿¡å·ç¼–å·ï¼‰ã€‚&lt;br&gt;ä¸å­˜åœ¨ç¼–å·ä¸º0çš„ä¿¡å·ã€‚killå‡½æ•°å¯¹ä¿¡å·ç¼–å·0æœ‰ç‰¹æ®Šçš„ä½œç”¨ã€‚POSIX.1å°†æ­¤ä¸­ä¿¡å·ç¼–å·å€¼ç§°ä¸ºç©ºä¿¡å·ã€‚&lt;br&gt;ä¿¡å·å‡ºç°æ—¶ï¼Œå†…æ ¸æŒ‰ä¸‹åˆ—ä¸‰ç§æ–¹å¼ä¹‹ä¸€è¿›è¡Œå¤„ç†ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¿½ç•¥æ­¤ä¿¡å·ã€‚å¤§å¤šæ•°ä¿¡å·éƒ½å¯ä½¿ç”¨è¿™ç§æ–¹å¼è¿›è¡Œå¤„ç†ï¼Œä½†æœ‰ä¸¤ç§ä¿¡å·å†³ä¸èƒ½è¢«å¿½ç•¥ï¼Œå®ƒä»¬æ˜¯SIGKILLå’ŒSIGSTOPã€‚åŸå› æ˜¯å®ƒä»¬æƒ³å†…æ ¸æä¾›äº†ä½¿è¿›ç¨‹ç»ˆæ­¢æˆ–åœæ­¢çš„å¯é æ–¹æ³•ã€‚&lt;/li&gt;
&lt;li&gt;æ•æ‰ä¿¡å·ã€‚ä¸ºäº†åšåˆ°è¿™ä¸€ç‚¹ï¼Œè¦é€šçŸ¥å†…æ ¸åœ¨æŸç§ä¿¡å·å‘ç”Ÿæ—¶ï¼Œè°ƒç”¨ä¸€ä¸ªå¯æ‰§è¡Œç”¨æˆ·å¸Œæœ›å¯¹è¿™ç§äº‹ä»¶è¿›è¡Œçš„å¤„ç†çš„ç”¨æˆ·å‡½æ•°ã€‚&lt;/li&gt;
&lt;li&gt;æ‰§è¡Œç³»ç»Ÿé»˜è®¤åŠ¨ä½œã€‚å¯¹å¤§å¤šæ•°ä¿¡å·çš„ç³»ç»Ÿé»˜è®¤åŠ¨ä½œæ˜¯ç»ˆæ­¢è¯¥è¿›ç¨‹ã€‚&lt;br&gt;&lt;img src=&quot;10-1.png&quot; alt=&quot;&quot;&gt;&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
    
      <category term="ã€ŠAPUEã€‹ç¬”è®°" scheme="https://akaqin.github.io/categories/%E3%80%8AAPUE%E3%80%8B%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="signal" scheme="https://akaqin.github.io/tags/signal/"/>
    
  </entry>
  
  <entry>
    <title>ã€ŠUNIXç¯å¢ƒé«˜çº§ç¼–ç¨‹ã€‹ç¬¬9ç« â€”â€”è¿›ç¨‹å…³ç³»</title>
    <link href="https://akaqin.github.io/2020/03/08/%E3%80%8AUNIX%E7%8E%AF%E5%A2%83%E9%AB%98%E7%BA%A7%E7%BC%96%E7%A8%8B%E3%80%8B%E7%AC%AC9%E7%AB%A0%E2%80%94%E2%80%94%E8%BF%9B%E7%A8%8B%E5%85%B3%E7%B3%BB/"/>
    <id>https://akaqin.github.io/2020/03/08/%E3%80%8AUNIX%E7%8E%AF%E5%A2%83%E9%AB%98%E7%BA%A7%E7%BC%96%E7%A8%8B%E3%80%8B%E7%AC%AC9%E7%AB%A0%E2%80%94%E2%80%94%E8%BF%9B%E7%A8%8B%E5%85%B3%E7%B3%BB/</id>
    <published>2020-03-08T07:53:47.000Z</published>
    <updated>2020-04-14T01:22:50.042Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ç»ˆç«¯ç™»å½•"><a href="#ç»ˆç«¯ç™»å½•" class="headerlink" title="ç»ˆç«¯ç™»å½•"></a>ç»ˆç«¯ç™»å½•</h2><p>æˆ‘ä»¬ç°åœ¨æè¿°çš„è¿‡ç¨‹ç”¨äºç»ç”±ç»ˆç«¯ç™»å½•è‡³UNIXç³»ç»Ÿã€‚è¯¥è¿‡ç¨‹å‡ ä¹ä¸æ‰€ä½¿ç”¨çš„ç»ˆç«¯ç±»å‹æ— å…³ï¼Œå¯ä»¥æ˜¯åŸºäºå­—ç¬¦çš„ç»ˆç«¯ã€ä»¿çœŸåŸºäºå­—ç¬¦ç»ˆç«¯çš„å›¾å½¢ç»ˆç«¯ï¼Œæˆ–è€…è¿è¡Œçª—å£ç³»ç»Ÿçš„å›¾å½¢ç»ˆç«¯ã€‚</p><h3 id="BSDç»ˆç«¯ç™»å½•"><a href="#BSDç»ˆç«¯ç™»å½•" class="headerlink" title="BSDç»ˆç«¯ç™»å½•"></a>BSDç»ˆç«¯ç™»å½•</h3><p>ç³»ç»Ÿç®¡ç†è€…åˆ›å»ºé€šå¸¸åä¸º/etc/ttysçš„æ–‡ä»¶ï¼Œå…¶ä¸­æ¯ä¸ªç»ˆç«¯è®¾å¤‡éƒ½æœ‰ä¸€è¡Œï¼Œè¯´æ˜è®¾å¤‡åå’Œä¼ åˆ°gettyç¨‹åºçš„å‚æ•°ã€‚å½“ç³»ç»Ÿè‡ªä¸¾æ—¶ï¼Œå†…æ ¸åˆ›å»ºè¿›ç¨‹IDä¸º1çš„è¿›ç¨‹ï¼Œä¹Ÿå°±æ˜¯initè¿›ç¨‹ã€‚<br>initè¿›ç¨‹ä½¿ç³»ç»Ÿè¿›å…¥å¤šç”¨æˆ·æ¨¡å¼ã€‚initè¯»å–æ–‡ä»¶/etc/ttysï¼Œå¯¹æ¯ä¸€ä¸ªå…è®¸ç™»å½•çš„ç»ˆç«¯è®¾å¤‡ï¼Œinitè°ƒç”¨ä¸€æ¬¡forkï¼Œå®ƒæ‰€ç”Ÿæˆçš„å­è¿›ç¨‹åˆ™exec gettyç¨‹åºã€‚<br><img src="9-1.png" alt=""></p><a id="more"></a><p>gettyå¯¹ç»ˆç«¯è®¾å¤‡è°ƒç”¨openå‡½æ•°ï¼Œä»¥è¯»ã€å†™æ–¹å¼å°†ç»ˆç«¯æ‰“å¼€ã€‚å¦‚æœè®¾å¤‡æ˜¯è°ƒåˆ¶è§£è°ƒå™¨ï¼Œåˆ™openå¯èƒ½ä¼šåœ¨è®¾å¤‡é©±åŠ¨ç¨‹åºä¸­æ»ç•™ï¼Œç›´åˆ°ç”¨æˆ·æ‹¨å·è°ƒåˆ¶è§£è°ƒå™¨ï¼Œå¹¶ä¸”çº¿è·¯è¢«æ¥é€šã€‚<br>ä¸€æ—¦è®¾å¤‡è¢«æ‰“å¼€ï¼Œåˆ™æ–‡ä»¶æè¿°ç¬¦0ã€1ã€2å°±è¢«è®¾ç½®åˆ°è¯¥è®¾å¤‡ï¼Œç„¶ågettyè¾“å‡ºâ€œloginï¼šâ€ä¹‹ç±»çš„ä¿¡æ¯ï¼Œç­‰å¾…ç”¨æˆ·é”®å…¥ç”¨æˆ·åã€‚<br>   <img src="9-2.png" alt=""></p><p>å› ä¸ºinitè¿›ç¨‹å…·æœ‰è¶…çº§ç”¨æˆ·ç‰¹æƒï¼Œæ‰€ä»¥å›¾9-2ä¸­çš„æ‰€æœ‰è¿›ç¨‹éƒ½æœ‰è¶…çº§ç”¨æˆ·ç‰¹æƒã€‚å›¾9-2ä¸­çš„ä¸‹é¢ä¸‰ä¸ªè¿›ç¨‹IDç›¸åŒï¼Œexecä¸ä¼šæ”¹å˜è¿›ç¨‹IDï¼Œçˆ¶è¿›ç¨‹IDéƒ½ä¸º1ã€‚</p><p>å¦‚æœç”¨æˆ·æ­£ç¡®ç™»å½•ï¼Œloginå°†å®Œæˆä¸‹åˆ—å·¥ä½œï¼š</p><ul><li>å°†å½“å‰å·¥ä½œç›®å½•æ”¹ä¸ºè¯¥ç”¨æˆ·çš„èµ·å§‹ç›®å½•ï¼ˆchdirï¼‰ã€‚</li><li>è°ƒç”¨chownæ›´æ”¹è¯¥ç»ˆç«¯çš„æ‰€æœ‰æƒï¼Œä½¿ç™»å½•ç”¨æˆ·æˆä¸ºå®ƒçš„æ‰€æœ‰è€…ã€‚</li><li>å°†å¯¹è¯¥ç»ˆç«¯è®¾å¤‡çš„è®¿é—®æƒé™æ”¹å˜æˆâ€œç”¨æˆ·è¯»å’Œå†™â€ã€‚</li><li>è°ƒç”¨ setgid åŠ initgroups è®¾ç½®è¿›ç¨‹çš„ç»„IDã€‚</li><li>ç”¨ login å¾—åˆ°çš„æ‰€æœ‰ä¿¡æ¯åˆå§‹åŒ–ç¯å¢ƒï¼šèµ·å§‹ç›®å½•ï¼ˆHOMEï¼‰ã€shellï¼ˆSHELLï¼‰ã€ç”¨æˆ·åï¼ˆUSERå’ŒLOGNAMEï¼‰ä»¥åŠä¸€ä¸ªç³»ç»Ÿé»˜è®¤è·¯å¾„ï¼ˆPATHï¼‰ã€‚</li><li>login è¿›ç¨‹æ›´æ”¹ä¸ºç™»å½•ç”¨æˆ·çš„ç”¨æˆ·IDï¼ˆsetuidï¼‰å¹¶è°ƒç”¨è¯¥ç”¨æˆ·ç™»å½•çš„shellï¼Œå…¶æ–¹å¼ç±»ä¼¼äºï¼š<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">execl(<span class="string">"/bin/sh"</span>, <span class="string">"-sh"</span>, (<span class="keyword">char</span> *)<span class="number">0</span>);</span><br></pre></td></tr></table></figure></li><li>å…¶ä»–ä»»åŠ¡ï¼ˆæ‰“å°æ—¥æœŸæ¶ˆæ¯æ–‡ä»¶ã€æ£€æŸ¥æ–°é‚®ä»¶ç­‰ï¼‰</li></ul><p>è‡³æ­¤ï¼Œç™»å½•ç”¨æˆ·çš„ç™»å½•shellå¼€å§‹è¿è¡Œã€‚å…¶çˆ¶è¿›ç¨‹IDæ˜¯initè¿›ç¨‹ï¼Œæ‰€ä»¥æ­¤ç™»å½•shellç»ˆæ­¢æ—¶ï¼Œinitä¼šç­‰åˆ°é€šçŸ¥ï¼ˆæ¥åˆ°SIGCHLDä¿¡å·ï¼‰ï¼Œå®ƒä¼šå¯¹è¯¥ç»ˆç«¯é‡å¤å…¨éƒ¨ä¸Šè¿°è¿‡ç¨‹ã€‚ç™»å½•shellçš„æ–‡ä»¶æè¿°ç¬¦0ã€1å’Œ2è®¾ç½®ä¸ºç»ˆç«¯è®¾å¤‡ã€‚<br>   <img src="9-3.png" alt=""></p><h3 id="Mac-OS-X-ç»ˆç«¯ç™»å½•"><a href="#Mac-OS-X-ç»ˆç«¯ç™»å½•" class="headerlink" title="Mac OS X ç»ˆç«¯ç™»å½•"></a>Mac OS X ç»ˆç«¯ç™»å½•</h3><p>Mac OS Xéƒ¨åˆ†åœ°åŸºäºFreeBSDï¼Œæ‰€ä»¥å…¶ç»ˆç«¯ç™»å½•è¿›ç¨‹ä¸BSDåŸºæœ¬ä¸€è‡´ï¼Œä¸åŒä¹‹å¤„åœ¨äºï¼š</p><ul><li>initçš„å·¥ä½œæ˜¯ç”±launchdå®Œæˆçš„ã€‚</li><li>ä¸€å¼€å§‹æä¾›çš„å°±æ˜¯å›¾å½¢ç»ˆç«¯</li></ul><h3 id="Linux-ç»ˆç«¯ç™»å½•"><a href="#Linux-ç»ˆç«¯ç™»å½•" class="headerlink" title="Linux ç»ˆç«¯ç™»å½•"></a>Linux ç»ˆç«¯ç™»å½•</h3><p>Linuxçš„ç»ˆç«¯ç™»å½•è¿‡ç¨‹éå¸¸ç±»ä¼¼äºBSDã€‚Linux loginå‘½ä»¤æ˜¯ä»4.3BSD loginå‘½ä»¤æ´¾ç”Ÿå‡ºæ¥çš„ã€‚ç™»å½•è¿‡ç¨‹çš„ä¸»è¦åŒºåˆ«åœ¨äºè¯´æ˜ç»ˆç«¯é…ç½®çš„æ–¹å¼ã€‚</p><h2 id="ç½‘ç»œç™»å½•"><a href="#ç½‘ç»œç™»å½•" class="headerlink" title="ç½‘ç»œç™»å½•"></a>ç½‘ç»œç™»å½•</h2><p>é€šè¿‡ä¸²è¡Œç»ˆç«¯ç™»å½•è‡³ç³»ç»Ÿå’Œç”±ç½‘ç»œç™»å½•è‡³ç³»ç»Ÿä¸¤è€…ä¹‹é—´çš„ä¸»è¦ï¼ˆç‰©ç†ä¸Šçš„ï¼‰åŒºåˆ«æ˜¯ï¼šç½‘ç»œç™»å½•æ—¶ï¼Œåœ¨ç»ˆç«¯å’Œè®¡ç®—æœºä¹‹é—´çš„è¿æ¥ä¸å†æ˜¯ç‚¹åˆ°ç‚¹çš„ã€‚åœ¨ç½‘ç»œç™»å½•æƒ…å†µä¸‹ï¼Œloginä»…ä»…æ˜¯ä¸€ç§å¯ç”¨çš„æœåŠ¡ï¼Œè¿™ä¸å…¶ä»–ç½‘ç»œæœåŠ¡ï¼ˆå¦‚FTPã€SMTPï¼‰çš„æ€§è´¨ç›¸åŒã€‚<br>æ‰€æœ‰ç™»å½•éƒ½ç»ç”±å†…æ ¸çš„ç½‘ç»œæ¥å£é©±åŠ¨ç¨‹åºï¼ˆå¦‚ä»¥å¤ªç½‘é©±åŠ¨ç¨‹åºï¼‰ï¼Œè€Œä¸”äº‹å…ˆå¹¶ä¸çŸ¥é“ä¼šæœ‰å¤šå°‘è¿™æ ·çš„ç™»å½•ã€‚å› æ­¤å¿…é¡»ç­‰å¾…ä¸€ä¸ªç½‘ç»œè¯·æ±‚çš„åˆ°è¾¾ï¼Œè€Œä¸æ˜¯ä½¿ä¸€ä¸ªè¿›ç¨‹ç­‰å¾…æ¯ä¸€ä¸ªå¯èƒ½çš„ç™»å½•ã€‚</p><h3 id="BSDç½‘ç»œç™»å½•"><a href="#BSDç½‘ç»œç™»å½•" class="headerlink" title="BSDç½‘ç»œç™»å½•"></a>BSDç½‘ç»œç™»å½•</h3><p>åœ¨BSDä¸­ï¼Œæœ‰ä¸€ä¸ªinetdè¿›ç¨‹ï¼Œå®ƒç­‰å¾…å¤§å¤šæ•°ç½‘ç»œè¿æ¥ã€‚ä½œä¸ºç³»ç»Ÿå¯åŠ¨çš„ä¸€éƒ¨åˆ†ï¼Œinitè°ƒç”¨ä¸€ä¸ªshellï¼Œä½¿å…¶æ‰§è¡Œshellè„šæœ¬/etc/rcã€‚ç”±æ­¤shellè„šæœ¬å¯åŠ¨ä¸€ä¸ªå®ˆæŠ¤è¿›ç¨‹inetdã€‚ä¸€æ—¦æ­¤shellè„šæœ¬ç»ˆæ­¢ï¼Œinetdçš„çˆ¶è¿›ç¨‹å°±å˜æˆinitã€‚inetdç­‰å¾…TCP/IPè¿æ¥è¯·æ±‚åˆ°è¾¾ä¸»æœºï¼Œè€Œå½“ä¸€ä¸ªè¿æ¥è¯·æ±‚åˆ°è¾¾æ—¶ï¼Œå®ƒæ‰§è¡Œä¸€æ¬¡forkï¼Œç„¶åç”Ÿæˆçš„å­è¿›ç¨‹execé€‚å½“çš„ç¨‹åºã€‚</p><p><img src="9-4.png" alt=""></p><p><img src="9-5.png" alt=""></p><h2 id="è¿›ç¨‹ç»„"><a href="#è¿›ç¨‹ç»„" class="headerlink" title="è¿›ç¨‹ç»„"></a>è¿›ç¨‹ç»„</h2><p>æ¯ä¸ªè¿›ç¨‹é™¤äº†æœ‰ä¸€è¿›ç¨‹IDä¹‹å¤–ï¼Œè¿˜å±äºä¸€ä¸ªè¿›ç¨‹ç»„ã€‚è¿›ç¨‹ç»„æ˜¯ä¸€ä¸ªæˆ–å¤šä¸ªè¿›ç¨‹çš„é›†åˆã€‚<br>é€šå¸¸ï¼Œå®ƒä»¬æ˜¯åŒä¸€ä½œä¸šä¸­ç»“åˆèµ·æ¥çš„ï¼ŒåŒä¸€è¿›ç¨‹ç»„ä¸­çš„å„è¿›ç¨‹æ¥æ”¶æ¥è‡ªåŒä¸€ç»ˆç«¯çš„å„ç§ä¿¡å·ã€‚æ¯ä¸ªè¿›ç¨‹ç»„æœ‰ä¸€ä¸ªå”¯ä¸€çš„è¿›ç¨‹ç»„IDâ€”â€”å®ƒæ˜¯ä¸€ä¸ªæ­£æ•´æ•°ï¼Œå¹¶å¯å­˜æ”¾åœ¨pid_tæ•°æ®ç±»å‹ä¸­ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">pid_t</span> <span class="title">getpgrp</span><span class="params">(<span class="keyword">void</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">pid_t</span> <span class="title">getpgid</span><span class="params">(<span class="keyword">pid_t</span> pid)</span></span>;</span><br></pre></td></tr></table></figure><p>æ¯ä¸ªè¿›ç¨‹ç»„æœ‰ä¸€ä¸ªç»„é•¿è¿›ç¨‹ã€‚ç»„é•¿è¿›ç¨‹çš„è¿›ç¨‹ç»„IDç­‰äºå…¶è¿›ç¨‹IDã€‚<br>è¿›ç¨‹ç»„ç»„é•¿å¯ä»¥åˆ›å»ºä¸€ä¸ªè¿›ç¨‹ç»„ï¼Œåˆ›å»ºè¯¥ç»„ä¸­çš„è¿›ç¨‹ï¼Œç„¶åç»ˆæ­¢ã€‚åªè¦åœ¨æŸä¸ªè¿›ç¨‹ç»„ä¸­æœ‰ä¸€ä¸ªè¿›ç¨‹å­˜åœ¨ï¼Œè¯¥è¿›ç¨‹ç»„å°±å­˜åœ¨ï¼Œè¿™ä¸å…¶ç»„é•¿è¿›ç¨‹æ˜¯å¦ç»ˆæ­¢æ— å…³ã€‚ä»è¿›ç¨‹ç»„åˆ›å»ºå¼€å§‹åˆ°å…¶ä¸­æœ€åä¸€ä¸ªè¿›ç¨‹ç¦»å¼€ä¸ºæ­¢çš„æ—¶é—´åŒºé—´ç§°ä¸ºè¿›ç¨‹ç»„çš„ç”Ÿå‘½<br>å‘¨æœŸã€‚æŸä¸ªè¿›ç¨‹ç»„çš„æœ€åä¸€ä¸ªè¿›ç¨‹å¯ä»¥ç»ˆæ­¢ï¼Œä¹Ÿå¯ä»¥è½¬ç§»åˆ°å¦ä¸€ä¸ªè¿›ç¨‹ç»„ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">pid_t</span> <span class="title">setpgid</span><span class="params">(<span class="keyword">pid_t</span> pid, <span class="keyword">pid_t</span> pgid)</span></span>;</span><br></pre></td></tr></table></figure><h2 id="ä¼šè¯"><a href="#ä¼šè¯" class="headerlink" title="ä¼šè¯"></a>ä¼šè¯</h2><p>ä¼šè¯ï¼ˆsessionï¼‰æ˜¯ä¸€ä¸ªæˆ–å¤šä¸ªè¿›ç¨‹ç»„çš„é›†åˆã€‚<br><img src="9-6.png" alt=""><br>è¿›ç¨‹è°ƒç”¨setsidå‡½æ•°å»ºç«‹ä¸€ä¸ªæ–°ä¼šè¯ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">pid_t</span> <span class="title">setsid</span><span class="params">(<span class="keyword">void</span>)</span></span>;</span><br></pre></td></tr></table></figure><p>å¦‚æœè°ƒç”¨æ­¤å‡½æ•°çš„è¿›ç¨‹ä¸æ˜¯ä¸€ä¸ªè¿›ç¨‹ç»„çš„ç»„é•¿ï¼Œåˆ™æ­¤å‡½æ•°åˆ›å»ºä¸€ä¸ªæ–°ä¼šè¯ã€‚å…·ä½“å‘ç”Ÿä»¥ä¸‹3ä»¶äº‹ï¼š</p><ol><li>è¯¥è¿›ç¨‹å˜æˆæ–°ä¼šè¯çš„ä¼šè¯é¦–è¿›ç¨‹ï¼ˆsession leaderï¼‰ã€‚æ­¤æ—¶ï¼Œè¯¥è¿›ç¨‹æ˜¯æ–°ä¼šè¯ä¸­çš„å”¯ä¸€è¿›ç¨‹ã€‚</li><li>è¯¥è¿›ç¨‹æˆä¸ºä¸€ä¸ªæ–°è¿›ç¨‹ç»„çš„ç»„é•¿è¿›ç¨‹ã€‚æ–°è¿›ç¨‹ç»„IDæ˜¯è¯¥è°ƒç”¨è¿›ç¨‹çš„è¿›ç¨‹IDã€‚</li><li>è¯¥è¿›ç¨‹æ²¡æœ‰æ§åˆ¶ç»ˆç«¯ã€‚å¦‚æœè°ƒç”¨setsidä¹‹å‰ç”±ï¼Œé‚£ä¹ˆè¿™ç§è”ç³»ä¹Ÿè¢«åˆ‡æ–­ã€‚</li></ol><h2 id="æ§åˆ¶ç»ˆç«¯"><a href="#æ§åˆ¶ç»ˆç«¯" class="headerlink" title="æ§åˆ¶ç»ˆç«¯"></a>æ§åˆ¶ç»ˆç«¯</h2><p>ä¼šè¯å’Œè¿›ç¨‹ç»„è¿˜æœ‰ä¸€äº›å…¶ä»–ç‰¹æ€§ï¼š</p><ul><li>ä¸€ä¸ªä¼šè¯å¯ä»¥æœ‰ä¸€ä¸ªæ§åˆ¶ç»ˆç«¯ï¼ˆcontrolling terminalï¼‰ã€‚è¿™é€šå¸¸æ˜¯ç»ˆç«¯è®¾å¤‡ï¼ˆåœ¨ç»ˆç«¯ç™»å½•æƒ…å†µä¸‹ï¼‰æˆ–ä¼ªç»ˆç«¯è®¾å¤‡ï¼ˆåœ¨ç½‘ç»œç™»å½•æƒ…å†µä¸‹ï¼‰ã€‚</li><li>å»ºç«‹ä¸æ§åˆ¶ç»ˆç«¯è¿æ¥çš„ä¼šè¯é¦–è¿›ç¨‹è¢«ç§°ä¸ºæ§åˆ¶è¿›ç¨‹ï¼ˆcontrolling processï¼‰ã€‚</li><li>ä¸€ä¸ªä¼šè¯ä¸­çš„å‡ ä¸ªè¿›ç¨‹ç»„å¯è¢«åˆ†æˆä¸€ä¸ªå‰å°è¿›ç¨‹ç»„ï¼ˆforeground process groupï¼‰ä»¥åŠä¸€ä¸ªæˆ–å¤šä¸ªåå°è¿›ç¨‹ç»„ï¼ˆbackground process groupï¼‰ã€‚</li><li>å¦‚æœä¸€ä¸ªä¼šè¯æœ‰ä¸€ä¸ªæ§åˆ¶ç»ˆç«¯ï¼Œåˆ™å®ƒæœ‰ä¸€ä¸ªå‰å°è¿›ç¨‹ç»„ï¼Œå…¶ä»–è¿›ç¨‹ç»„ä¸ºåå°è¿›ç¨‹ç»„ã€‚</li><li>æ— è®ºä½•æ—¶é”®å…¥ç»ˆç«¯çš„ä¸­æ–­é”®ï¼ˆé€šå¸¸æ˜¯Deleteæˆ–Ctrl+Cï¼‰ï¼Œéƒ½ä¼šå°†ä¸­æ–­ä¿¡å·å‘é€è‡³å‰å°è¿›ç¨‹ç»„çš„æ‰€æœ‰è¿›ç¨‹ã€‚</li><li>æ— è®ºä½•æ—¶é”®å…¥ç»ˆç«¯çš„é€€å‡ºé”®ï¼ˆé€šå¸¸æ˜¯Ctrl+\ï¼‰,éƒ½ä¼šå°†é€€å‡ºä¿¡å·å‘é€è‡³å‰å°è¿›ç¨‹ç»„çš„æ‰€æœ‰è¿›ç¨‹ã€‚</li><li>å¦‚æœç»ˆç«¯æ¥å£æ£€æµ‹åˆ°è°ƒåˆ¶è§£è°ƒå™¨ï¼ˆæˆ–ç½‘ç»œï¼‰å·²ç»æ–­å¼€è¿æ¥ï¼Œåˆ™å°†æŒ‚æ–­ä¿¡å·å‘é€è‡³æ§åˆ¶è¿›ç¨‹ï¼ˆä¼šè¯é¦–è¿›ç¨‹ï¼‰ã€‚<br><img src="9-7.png" alt=""></li></ul><h2 id="è·å–ã€è®¾ç½®å‰å°è¿›ç¨‹ç»„IDï¼Œè·å–ä¼šè¯é¦–è¿›ç¨‹çš„ä¼šè¯IDï¼ˆä¼šè¯é¦–è¿›ç¨‹çš„è¿›ç¨‹ç»„IDï¼‰"><a href="#è·å–ã€è®¾ç½®å‰å°è¿›ç¨‹ç»„IDï¼Œè·å–ä¼šè¯é¦–è¿›ç¨‹çš„ä¼šè¯IDï¼ˆä¼šè¯é¦–è¿›ç¨‹çš„è¿›ç¨‹ç»„IDï¼‰" class="headerlink" title="è·å–ã€è®¾ç½®å‰å°è¿›ç¨‹ç»„IDï¼Œè·å–ä¼šè¯é¦–è¿›ç¨‹çš„ä¼šè¯IDï¼ˆä¼šè¯é¦–è¿›ç¨‹çš„è¿›ç¨‹ç»„IDï¼‰"></a>è·å–ã€è®¾ç½®å‰å°è¿›ç¨‹ç»„IDï¼Œè·å–ä¼šè¯é¦–è¿›ç¨‹çš„ä¼šè¯IDï¼ˆä¼šè¯é¦–è¿›ç¨‹çš„è¿›ç¨‹ç»„IDï¼‰</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">pid_t</span> <span class="title">tcgetpgrp</span><span class="params">(<span class="keyword">int</span> fd)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">tcsetpgrp</span><span class="params">(<span class="keyword">int</span> fd, <span class="keyword">pid_t</span> pgrpid)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">pid_t</span> <span class="title">tcgetsid</span><span class="params">(<span class="keyword">int</span> fd)</span></span>;</span><br></pre></td></tr></table></figure><h2 id="ä½œä¸šæ§åˆ¶"><a href="#ä½œä¸šæ§åˆ¶" class="headerlink" title="ä½œä¸šæ§åˆ¶"></a>ä½œä¸šæ§åˆ¶</h2><p>ä½œä¸šæ§åˆ¶å…è®¸åœ¨ä¸€ä¸ªç»ˆç«¯ä¸Šå¯åŠ¨å¤šä¸ªä½œä¸šï¼ˆè¿›ç¨‹ç»„ï¼‰ï¼Œå®ƒæ§åˆ¶å“ªä¸€ä¸ªä½œä¸šå¯ä»¥è®¿é—®è¯¥ç»ˆç«¯ä»¥åŠå“ªäº›ä½œä¸šåœ¨åå°è¿è¡Œã€‚<br>ç”¨æˆ·å¯ä»¥åœ¨å‰å°æˆ–åå°å¯åŠ¨ä¸€ä¸ªä½œä¸šã€‚ä¸€ä¸ªä½œä¸šåªæ˜¯å‡ ä¸ªè¿›ç¨‹çš„é›†åˆã€‚<br><img src="9-9.png" alt=""></p><h2 id="shellæ‰§è¡Œç¨‹åº"><a href="#shellæ‰§è¡Œç¨‹åº" class="headerlink" title="shellæ‰§è¡Œç¨‹åº"></a>shellæ‰§è¡Œç¨‹åº</h2><p><img src="9.9.1.png" alt=""><br>åœ¨ä¸æ”¯æŒä½œä¸šæ§åˆ¶çš„shellä¸­ï¼Œç®¡é“ä¸­çš„æœ€åä¸€ä¸ªè¿›ç¨‹æ˜¯shellçš„å­è¿›ç¨‹ï¼Œç®¡é“ä¸­çš„å…¶ä»–è¿›ç¨‹æ˜¯æœ€åä¸€ä¸ªè¿›ç¨‹çš„å­è¿›ç¨‹ã€‚ä»ä¸­å¯ä»¥çœ‹å‡ºï¼Œshell forkä¸€ä¸ªå®ƒè‡ªèº«çš„å‰¯æœ¬ï¼Œç„¶åæ­¤å‰¯æœ¬å†ä¸ºç®¡é“ä¸­çš„æ¯æ¡å‘½ä»¤å„forkä¸€ä¸ªè¿›ç¨‹ã€‚<br><img src="9-10.png" alt=""><br>æœ‰ä½œä¸šæ§åˆ¶æ—¶ï¼Œåå°ä½œä¸šè¢«æ”¾åœ¨åå°è¿›ç¨‹ç»„ï¼Œå¦‚æœåå°ä½œä¸šè¯•å›¾è¯»æ§åˆ¶ç»ˆç«¯ï¼Œåˆ™ä¼šäº§ç”Ÿä¿¡å·SIGTTINã€‚<br><img src="9.9.2.png" alt=""><br><img src="9.9.3.png" alt=""></p><h2 id="å­¤å„¿è¿›ç¨‹ç»„"><a href="#å­¤å„¿è¿›ç¨‹ç»„" class="headerlink" title="å­¤å„¿è¿›ç¨‹ç»„"></a>å­¤å„¿è¿›ç¨‹ç»„</h2><p>è¯¥ç»„ä¸­æ¯ä¸ªæˆå‘˜çš„çˆ¶è¿›ç¨‹è¦ä¹ˆæ˜¯è¯¥ç»„çš„ä¸€ä¸ªæˆå‘˜ï¼Œè¦ä¹ˆä¸æ˜¯è¯¥ç»„æ‰€å±ä¼šè¯çš„æˆå‘˜ã€‚å¦ä¸€ç§æè¿°å¯ä»¥æ˜¯ï¼šä¸€ä¸ªè¿›ç¨‹ç»„ä¸æ˜¯å­¤å„¿è¿›ç¨‹ç»„çš„æ¡ä»¶æ˜¯â€”â€”è¯¥ç»„ä¸­æœ‰ä¸€ä¸ªè¿›ç¨‹ï¼Œå…¶çˆ¶è¿›ç¨‹å±äºåŒä¸€ä¼šè¯çš„å¦ä¸€ä¸ªç»„ä¸­ã€‚å¦‚æœè¿›ç¨‹ç»„ä¸æ˜¯å­¤å„¿è¿›ç¨‹ç»„ï¼Œé‚£ä¹ˆåœ¨å±äºåŒä¸€ä¼šè¯çš„å¦ä¸€ä¸ªç»„ä¸­çš„çˆ¶è¿›ç¨‹å°±æœ‰æœºä¼šé‡æ–°å¯åŠ¨è¯¥ç»„ä¸­åœæ­¢çš„è¿›ç¨‹ã€‚<br><img src="9-11.png" alt=""><br>å› ä¸ºåœ¨çˆ¶è¿›ç¨‹ç»ˆæ­¢åï¼Œè¿›ç¨‹ç»„åŒ…å«ä¸€ä¸ªåœæ­¢çš„è¿›ç¨‹ï¼Œè¿›ç¨‹ç»„ç§°ä¸ºå­¤å„¿è¿›ç¨‹ç»„ï¼ŒPOSIXã€‚1è¦æ±‚å‘æ–°å­¤å„¿è¿›ç¨‹ç»„ä¸­å¤„äºåœæ­¢çŠ¶æ€çš„æ¯ä¸€ä¸ªè¿›ç¨‹å‘é€æŒ‚æ–­ä¿¡å·ï¼ˆSIGHUPï¼‰ï¼Œæ¥ç€åˆå‘å…¶å‘é€ç»§ç»­ä¿¡å·ï¼ˆSIGCONTï¼‰ã€‚<br>åœ¨å¤„ç†äº†æŒ‚æ–­ä¿¡å·åï¼Œå­è¿›ç¨‹ç»§ç»­ã€‚å¯¹æŒ‚æ–­ä¿¡å·çš„ç³»ç»Ÿé»˜è®¤åŠ¨ä½œæ˜¯ç»ˆæ­¢è¯¥è¿›ç¨‹ã€‚</p><h2 id="FreeBSDå®ç°"><a href="#FreeBSDå®ç°" class="headerlink" title="FreeBSDå®ç°"></a>FreeBSDå®ç°</h2><p><img src="9-13.png" alt=""><br>æ¯ä¸ªä¼šè¯éƒ½åˆ†é…ä¸€ä¸ªsessionç»“æ„ã€‚åœ¨è°ƒç”¨setsidæ—¶ï¼Œåœ¨å†…æ ¸åˆ†é…ä¸€ä¸ªå¿ƒå¾—sessionç»“æ„ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;ç»ˆç«¯ç™»å½•&quot;&gt;&lt;a href=&quot;#ç»ˆç«¯ç™»å½•&quot; class=&quot;headerlink&quot; title=&quot;ç»ˆç«¯ç™»å½•&quot;&gt;&lt;/a&gt;ç»ˆç«¯ç™»å½•&lt;/h2&gt;&lt;p&gt;æˆ‘ä»¬ç°åœ¨æè¿°çš„è¿‡ç¨‹ç”¨äºç»ç”±ç»ˆç«¯ç™»å½•è‡³UNIXç³»ç»Ÿã€‚è¯¥è¿‡ç¨‹å‡ ä¹ä¸æ‰€ä½¿ç”¨çš„ç»ˆç«¯ç±»å‹æ— å…³ï¼Œå¯ä»¥æ˜¯åŸºäºå­—ç¬¦çš„ç»ˆç«¯ã€ä»¿çœŸåŸºäºå­—ç¬¦ç»ˆç«¯çš„å›¾å½¢ç»ˆç«¯ï¼Œæˆ–è€…è¿è¡Œçª—å£ç³»ç»Ÿçš„å›¾å½¢ç»ˆç«¯ã€‚&lt;/p&gt;
&lt;h3 id=&quot;BSDç»ˆç«¯ç™»å½•&quot;&gt;&lt;a href=&quot;#BSDç»ˆç«¯ç™»å½•&quot; class=&quot;headerlink&quot; title=&quot;BSDç»ˆç«¯ç™»å½•&quot;&gt;&lt;/a&gt;BSDç»ˆç«¯ç™»å½•&lt;/h3&gt;&lt;p&gt;ç³»ç»Ÿç®¡ç†è€…åˆ›å»ºé€šå¸¸åä¸º/etc/ttysçš„æ–‡ä»¶ï¼Œå…¶ä¸­æ¯ä¸ªç»ˆç«¯è®¾å¤‡éƒ½æœ‰ä¸€è¡Œï¼Œè¯´æ˜è®¾å¤‡åå’Œä¼ åˆ°gettyç¨‹åºçš„å‚æ•°ã€‚å½“ç³»ç»Ÿè‡ªä¸¾æ—¶ï¼Œå†…æ ¸åˆ›å»ºè¿›ç¨‹IDä¸º1çš„è¿›ç¨‹ï¼Œä¹Ÿå°±æ˜¯initè¿›ç¨‹ã€‚&lt;br&gt;initè¿›ç¨‹ä½¿ç³»ç»Ÿè¿›å…¥å¤šç”¨æˆ·æ¨¡å¼ã€‚initè¯»å–æ–‡ä»¶/etc/ttysï¼Œå¯¹æ¯ä¸€ä¸ªå…è®¸ç™»å½•çš„ç»ˆç«¯è®¾å¤‡ï¼Œinitè°ƒç”¨ä¸€æ¬¡forkï¼Œå®ƒæ‰€ç”Ÿæˆçš„å­è¿›ç¨‹åˆ™exec gettyç¨‹åºã€‚&lt;br&gt;&lt;img src=&quot;9-1.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="ã€ŠAPUEã€‹ç¬”è®°" scheme="https://akaqin.github.io/categories/%E3%80%8AAPUE%E3%80%8B%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="process" scheme="https://akaqin.github.io/tags/process/"/>
    
  </entry>
  
  <entry>
    <title>vnodeä¸inodeåŒºåˆ«</title>
    <link href="https://akaqin.github.io/2020/03/08/vnode%E4%B8%8Einode%E5%8C%BA%E5%88%AB/"/>
    <id>https://akaqin.github.io/2020/03/08/vnode%E4%B8%8Einode%E5%8C%BA%E5%88%AB/</id>
    <published>2020-03-08T05:30:41.000Z</published>
    <updated>2020-03-08T07:46:35.882Z</updated>
    
    <content type="html"><![CDATA[<h1 id="vnodeä¸inodeçš„åŒºåˆ«"><a href="#vnodeä¸inodeçš„åŒºåˆ«" class="headerlink" title="vnodeä¸inodeçš„åŒºåˆ«"></a>vnodeä¸inodeçš„åŒºåˆ«</h1><blockquote><p>æ–‡ç« æ•´ç†è‡ª  <a href="https://www.freebsd.org/cgi/man.cgi?query=vnode" target="_blank" rel="noopener">FreeBSD docs</a> å’Œ  <a href="https://stackoverflow.com/questions/27345342/inode-vs-vnode-difference" target="_blank" rel="noopener">StackOverflow</a></p></blockquote><h2 id="vnode"><a href="#vnode" class="headerlink" title="vnode"></a>vnode</h2><h3 id="åç§°"><a href="#åç§°" class="headerlink" title="åç§°"></a>åç§°</h3><p>vnode â€”â€” æ–‡ä»¶æˆ–ç›®å½•çš„å†…éƒ¨è¡¨ç¤º</p><h3 id="æ¦‚è¦"><a href="#æ¦‚è¦" class="headerlink" title="æ¦‚è¦"></a>æ¦‚è¦</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/param.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/vnode.h&gt;</span></span></span><br></pre></td></tr></table></figure><h3 id="æè¿°"><a href="#æè¿°" class="headerlink" title="æè¿°"></a>æè¿°</h3><ul><li>vnodeæ˜¯UNIXä¸­æ‰€æœ‰æ–‡ä»¶æ´»åŠ¨çš„ç„¦ç‚¹ã€‚</li><li>vnodeèŠ‚ç‚¹ç”±<code>struct vnode</code>å£°æ˜ã€‚</li><li>æ¯ä¸ªæ´»åŠ¨æ–‡ä»¶ã€å½“å‰ç›®å½•ã€æŒ‚è½½æ–‡ä»¶ã€æ–‡æœ¬æ–‡ä»¶å’Œæ ¹ç›®å½•éƒ½åˆ†é…äº†ä¸€ä¸ªvnodeèŠ‚ç‚¹ã€‚</li><li>vnodeæœ€åˆæ˜¯ä¸ºFreeBSDåˆ›å»ºçš„ï¼Œå› ä¸ºéœ€è¦ä½¿ç”¨çš„ä¸åŒç±»å‹çš„æ–‡ä»¶ç³»ç»Ÿï¼ˆä¾‹å¦‚UFSã€NFSç­‰ï¼‰æ¿€å¢ã€‚</li><li>Vnodeæ—¨åœ¨ä¸ºæ‰€æœ‰å¯èƒ½çš„æ–‡ä»¶ç³»ç»Ÿæä¾›æŠ½è±¡ï¼Œä»¥ä¾¿OSå¯ä»¥ä¸å®ƒä»¬è¿›è¡Œå¯¹æ¥ï¼Œä»è€Œè®©å†…æ ¸æ–¹æ³•ä¸å¿…å…¼å®¹æ¯ä¸ªç‰¹å®šçš„æ–‡ä»¶ç³»ç»Ÿï¼›å†…æ ¸åªéœ€è¦çŸ¥é“å¦‚ä½•ä¸Vnodeè¿›è¡Œäº¤äº’ã€‚</li><li>VnodeæŠ½è±¡åœ¨å†…å­˜ä¸­ï¼Œå¯ä»¥ä¸UFSã€ext4ç­‰æ–‡ä»¶ç³»ç»Ÿè¿›è¡Œäº¤äº’ï¼›è€Œinodeå­˜å‚¨åœ¨ç£ç›˜ä¸Šï¼Œåªèƒ½ç”¨äºç‰¹å®šçš„æ–‡ä»¶ç³»ç»Ÿã€‚</li><li>inodeèŠ‚ç‚¹åŒ…å«æ–‡ä»¶å¤§å°ã€æ‹¥æœ‰è€…ã€æŒ‡å‘åœ°å€å—çš„æŒ‡é’ˆç­‰å…ƒæ•°æ®ã€‚</li><li>vnodeä»…åŒ…å«åœ¨æ–‡ä»¶ç”Ÿå‘½å‘¨æœŸä¸­ä¸ä¼šæ”¹å˜çš„ä¸€äº›å±æ€§ï¼Œå› æ­¤å¦‚æœæƒ³è·å¾—æ›´å¤šä¿¡æ¯è¯·ä½¿ç”¨inodeä½œä¸ºå‚è€ƒã€‚</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;vnodeä¸inodeçš„åŒºåˆ«&quot;&gt;&lt;a href=&quot;#vnodeä¸inodeçš„åŒºåˆ«&quot; class=&quot;headerlink&quot; title=&quot;vnodeä¸inodeçš„åŒºåˆ«&quot;&gt;&lt;/a&gt;vnodeä¸inodeçš„åŒºåˆ«&lt;/h1&gt;&lt;blockquote&gt;
&lt;p&gt;æ–‡ç« æ•´ç†è‡ª  &lt;a
      
    
    </summary>
    
    
      <category term="çŸ¥è¯†ç‚¹æ€»ç»“" scheme="https://akaqin.github.io/categories/%E7%9F%A5%E8%AF%86%E7%82%B9%E6%80%BB%E7%BB%93/"/>
    
    
      <category term="File System" scheme="https://akaqin.github.io/tags/File-System/"/>
    
  </entry>
  
  <entry>
    <title>strlenä¸sizeofåŒºåˆ«</title>
    <link href="https://akaqin.github.io/2020/03/02/strlen%E4%B8%8Esizeof%E5%8C%BA%E5%88%AB/"/>
    <id>https://akaqin.github.io/2020/03/02/strlen%E4%B8%8Esizeof%E5%8C%BA%E5%88%AB/</id>
    <published>2020-03-02T13:18:44.000Z</published>
    <updated>2020-03-08T07:41:04.398Z</updated>
    
    <content type="html"><![CDATA[<ul><li>strlenè®¡ç®—ä¸åŒ…å«ç»ˆæ­¢nullå­—èŠ‚çš„å­—ç¬¦ä¸²é•¿åº¦ï¼Œè€Œsizeofåˆ™è®¡ç®—åŒ…æ‹¬ç»ˆæ­¢nullå­—èŠ‚çš„ç¼“å†²åŒºé•¿åº¦</li><li>strlenéœ€è¦è¿›è¡Œä¸€æ¬¡å‡½æ•°è°ƒç”¨ï¼Œè€Œå¯¹äºsizeofï¼Œç¼“å†²åŒºé•¿åº¦åœ¨ç¼–è¯‘æ—¶è®¡ç®—ï¼Œæ˜¯å›ºå®šçš„</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;ul&gt;
&lt;li&gt;strlenè®¡ç®—ä¸åŒ…å«ç»ˆæ­¢nullå­—èŠ‚çš„å­—ç¬¦ä¸²é•¿åº¦ï¼Œè€Œsizeofåˆ™è®¡ç®—åŒ…æ‹¬ç»ˆæ­¢nullå­—èŠ‚çš„ç¼“å†²åŒºé•¿åº¦&lt;/li&gt;
&lt;li&gt;strlenéœ€è¦è¿›è¡Œä¸€æ¬¡å‡½æ•°è°ƒç”¨ï¼Œè€Œå¯¹äºsizeofï¼Œç¼“å†²åŒºé•¿åº¦åœ¨ç¼–è¯‘æ—¶è®¡ç®—ï¼Œæ˜¯å›ºå®šçš„&lt;/li&gt;
&lt;/ul&gt;

      
    
    </summary>
    
    
      <category term="çŸ¥è¯†ç‚¹æ€»ç»“" scheme="https://akaqin.github.io/categories/%E7%9F%A5%E8%AF%86%E7%82%B9%E6%80%BB%E7%BB%93/"/>
    
    
      <category term="C" scheme="https://akaqin.github.io/tags/C/"/>
    
  </entry>
  
  <entry>
    <title>ã€ŠUNIXç¯å¢ƒé«˜çº§ç¼–ç¨‹ã€‹ç¬¬8ç« â€”â€”è¿›ç¨‹æ§åˆ¶</title>
    <link href="https://akaqin.github.io/2020/03/02/%E3%80%8AUNIX%E7%8E%AF%E5%A2%83%E9%AB%98%E7%BA%A7%E7%BC%96%E7%A8%8B%E3%80%8B%E7%AC%AC8%E7%AB%A0%E2%80%94%E2%80%94%E8%BF%9B%E7%A8%8B%E6%8E%A7%E5%88%B6/"/>
    <id>https://akaqin.github.io/2020/03/02/%E3%80%8AUNIX%E7%8E%AF%E5%A2%83%E9%AB%98%E7%BA%A7%E7%BC%96%E7%A8%8B%E3%80%8B%E7%AC%AC8%E7%AB%A0%E2%80%94%E2%80%94%E8%BF%9B%E7%A8%8B%E6%8E%A7%E5%88%B6/</id>
    <published>2020-03-02T13:01:18.000Z</published>
    <updated>2020-04-14T01:23:26.927Z</updated>
    
    <content type="html"><![CDATA[<h2 id="è¿›ç¨‹æ ‡è¯†"><a href="#è¿›ç¨‹æ ‡è¯†" class="headerlink" title="è¿›ç¨‹æ ‡è¯†"></a>è¿›ç¨‹æ ‡è¯†</h2><ul><li>æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰ä¸€ä¸ªéè´Ÿæ•´å‹è¡¨ç¤ºçš„å”¯ä¸€è¿›ç¨‹ID</li><li>IDä¸º0çš„è¿›ç¨‹é€šå¸¸æ˜¯è°ƒåº¦è¿›ç¨‹ï¼Œå¸¸å¸¸è¢«ç§°ä¸ºäº¤æ¢è¿›ç¨‹ï¼ˆswapperï¼‰ã€‚è¯¥è¿›ç¨‹æ˜¯å†…æ ¸çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒå¹¶ä¸æ‰§è¡Œä»»ä½•ç£ç›˜ä¸Šçš„ç¨‹åºï¼Œå› æ­¤ä¹Ÿè¢«ç§°ä¸ºç³»ç»Ÿè¿›ç¨‹ã€‚</li><li>è¿›ç¨‹ID 1é€šå¸¸æ˜¯initè¿›ç¨‹ï¼Œåœ¨è‡ªä¸¾è¿‡ç¨‹ç»“æŸæ—¶ç”±å†…æ ¸è°ƒç”¨ã€‚è¯¥è¿›ç¨‹çš„ç¨‹åºæ–‡ä»¶æ˜¯/etc/initæˆ–/sbin/initã€‚æ­¤è¿›ç¨‹è´Ÿè´£åœ¨è‡ªä¸¾å†…æ ¸åå¯åŠ¨ä¸€ä¸ªUNIXç³»ç»Ÿã€‚</li><li>initè¯»å–ä¸ç³»ç»Ÿæœ‰å…³çš„åˆå§‹åŒ–æ–‡ä»¶ï¼Œå¹¶å°†ç³»ç»Ÿå¼•å¯¼åˆ°ä¸€ä¸ªçŠ¶æ€ã€‚</li><li>initè¿›ç¨‹ä¸ä¼šç»ˆæ­¢ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ™®é€šçš„ç”¨æˆ·è¿›ç¨‹ï¼Œä»¥è¶…çº§ç”¨æˆ·ç‰¹æƒè¿è¡Œï¼›äº¤æ¢è¿›ç¨‹æ˜¯å†…æ ¸ä¸­çš„ç³»ç»Ÿè¿›ç¨‹ã€‚</li></ul><h2 id="forkå‡½æ•°"><a href="#forkå‡½æ•°" class="headerlink" title="forkå‡½æ•°"></a>forkå‡½æ•°</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">pid_t</span> <span class="title">fork</span><span class="params">(<span class="keyword">void</span>)</span></span>;</span><br></pre></td></tr></table></figure><h3 id="å‡½æ•°è¯´æ˜"><a href="#å‡½æ•°è¯´æ˜" class="headerlink" title="å‡½æ•°è¯´æ˜"></a>å‡½æ•°è¯´æ˜</h3><ul><li>è°ƒç”¨ä¸€æ¬¡ï¼Œè¿”å›ä¸¤æ¬¡ã€‚å­è¿›ç¨‹è¿”å›0ï¼Œçˆ¶è¿›ç¨‹è¿”å›å­è¿›ç¨‹IDï¼Œå‡ºé”™è¿”å›-1</li><li>å­è¿›ç¨‹å’Œçˆ¶è¿›ç¨‹ç»§ç»­æ‰§è¡Œforkä¹‹åçš„æŒ‡ä»¤ï¼›å­è¿›ç¨‹è·å¾—çˆ¶è¿›ç¨‹æ•°æ®ç©ºé—´ã€å †ã€æ ˆçš„å‰¯æœ¬ï¼›å­è¿›ç¨‹å’Œçˆ¶è¿›ç¨‹å…±äº«æ­£æ–‡æ®µ</li><li>forkæ—¶ç”¨åˆ°<code>å†™æ—¶å¤åˆ¶ï¼ˆCopy-On-Writeï¼‰</code>æŠ€æœ¯ï¼Œè¿™äº›åŒºåŸŸç”±çˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹å…±äº«ï¼Œå†…æ ¸å°†ä»–ä»¬çš„è®¿é—®æƒé™æ”¹ä¸ºåªè¯»ï¼Œå½“ä»»ä¸€è¿›ç¨‹å°è¯•ä¿®æ”¹æ—¶ï¼Œå†…æ ¸åªä¸ºä¿®æ”¹åŒºåŸŸçš„é‚£å—å†…å­˜åˆ¶ä½œä¸€ä¸ªå‰¯æœ¬ï¼Œé€šå¸¸æ˜¯è™šæ‹Ÿå†…å­˜ä¸­çš„ä¸€â€œé¡µâ€</li><li>forkåå…ˆæ‰§è¡Œå“ªä¸ªè¿›ç¨‹æ˜¯ä¸ç¡®å®šçš„ï¼Œå–å†³äºå†…æ ¸æ‰€ä½¿ç”¨çš„è°ƒåº¦ç®—æ³•</li><li>æ–‡ä»¶å…±äº«ã€‚çˆ¶è¿›ç¨‹çš„æ‰€æœ‰æ‰“å¼€æ–‡ä»¶æè¿°ç¬¦éƒ½è¢«å¤åˆ¶åˆ°å­è¿›ç¨‹ä¸­ï¼Œçˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹æ¯ä¸ªç›¸åŒçš„æ‰“å¼€æè¿°ç¬¦å…±äº«ä¸€ä¸ªæ–‡ä»¶è¡¨é¡¹ï¼ˆåŒ…æ‹¬æ–‡ä»¶åç§»é‡ï¼‰ã€‚<br><img src="8-2.png" alt=""></li></ul><a id="more"></a><h3 id="å­è¿›ç¨‹ä»çˆ¶è¿›ç¨‹ç»§æ‰¿"><a href="#å­è¿›ç¨‹ä»çˆ¶è¿›ç¨‹ç»§æ‰¿" class="headerlink" title="å­è¿›ç¨‹ä»çˆ¶è¿›ç¨‹ç»§æ‰¿"></a>å­è¿›ç¨‹ä»çˆ¶è¿›ç¨‹ç»§æ‰¿</h3><ul><li>å®é™…ç”¨æˆ·IDã€å®é™…ç»„IDã€æœ‰æ•ˆç”¨æˆ·IDã€æœ‰æ•ˆç»„ID</li><li>é™„å±ç»„ID</li><li>è¿›ç¨‹ç»„ID</li><li>ä¼šè¯ID</li><li>æ§åˆ¶ç»ˆç«¯</li><li>è®¾ç½®ç”¨æˆ·IDæ ‡å¿—å’Œè®¾ç½®ç»„IDæ ‡å¿—</li><li>å½“å‰å·¥ä½œç›®å½•</li><li>æ ¹ç›®å½•</li><li>æ–‡ä»¶æ¨¡å¼åˆ›å»ºå±è”½å­—</li><li>ä¿¡å·å±è”½å’Œå®‰æ’</li><li>å¯¹ä»»ä¸€æ‰“å¼€é—´æè¿°ç¬¦çš„æ‰§è¡Œæ—¶å…³é—­ï¼ˆclose-on-execï¼‰æ ‡å¿—</li><li>ç¯å¢ƒ</li><li>è¿æ¥çš„å…±äº«å­˜å‚¨æ®µ</li><li>å­˜å‚¨æ˜ åƒ</li><li>èµ„æºé™åˆ¶</li></ul><h3 id="çˆ¶è¿›ç¨‹ä¸å­è¿›ç¨‹çš„åŒºåˆ«"><a href="#çˆ¶è¿›ç¨‹ä¸å­è¿›ç¨‹çš„åŒºåˆ«" class="headerlink" title="çˆ¶è¿›ç¨‹ä¸å­è¿›ç¨‹çš„åŒºåˆ«"></a>çˆ¶è¿›ç¨‹ä¸å­è¿›ç¨‹çš„åŒºåˆ«</h3><ul><li>forkçš„è¿”å›å€¼ä¸åŒ</li><li>è¿›ç¨‹IDä¸åŒ</li><li>è¿™ä¸¤ä¸ªè¿›ç¨‹çš„çˆ¶è¿›ç¨‹IDä¸åŒ</li><li>å­è¿›ç¨‹çš„tms_utimeã€tms_stimeã€tms_cutimeå’Œtms_ustimeçš„å€¼è®¾ç½®ä¸º0</li><li>å­è¿›ç¨‹ä¸ç»§æ‰¿çˆ¶è¿›ç¨‹è®¾ç½®çš„æ–‡ä»¶é”</li><li>å­è¿›ç¨‹çš„æœªå¤„ç†é—¹é’Ÿè¢«æ¸…é™¤</li><li>å­è¿›ç¨‹çš„æœªå¤„ç†ä¿¡å·é›†è®¾ç½®ä¸ºç©ºé›†<ul><li>forkå¤±è´¥çš„ä¸¤ä¸ªä¸»è¦åŸå› ï¼š</li></ul></li><li>ç³»ç»Ÿä¸­å·²ç»æœ‰äº†å¤ªå¤šçš„è¿›ç¨‹</li><li>è¯¥ç”¨æˆ·IDçš„è¿›ç¨‹æ€»æ•°è¶…è¿‡äº†ç³»ç»Ÿçš„é™åˆ¶</li></ul><h2 id="vforkå‡½æ•°"><a href="#vforkå‡½æ•°" class="headerlink" title="vforkå‡½æ•°"></a>vforkå‡½æ•°</h2><ul><li>vforkå‡½æ•°ç”¨äºåˆ›å»ºä¸€ä¸ªæ–°è¿›ç¨‹ï¼Œè€Œè¯¥æ–°è¿›ç¨‹çš„ç›®çš„æ˜¯execä¸€ä¸ªæ–°ç¨‹åºã€‚</li><li>vforkå’Œforkä¸€æ ·éƒ½åˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹ï¼Œä½†æ˜¯å®ƒå¹¶ä¸å°†çˆ¶è¿›ç¨‹çš„åœ°å€ç©ºé—´å®Œå…¨å¤åˆ¶åˆ°å­è¿›ç¨‹ä¸­ï¼Œå› ä¸ºå­è¿›ç¨‹ä¼šç«‹å³è°ƒç”¨execæˆ–exitï¼Œäºæ˜¯ä¹Ÿå°±ä¸ä¼šå¼•ç”¨è¯¥åœ°å€ç©ºé—´ã€‚ä¸è¿‡åœ¨å­è¿›ç¨‹è°ƒç”¨execæˆ–exitä¹‹å‰ï¼Œå®ƒåœ¨çˆ¶è¿›ç¨‹çš„ç©ºé—´ä¸­è¿è¡Œã€‚</li><li>vforkä¿è¯å­è¿›ç¨‹å…ˆè¿è¡Œï¼Œåœ¨å®ƒè°ƒç”¨execæˆ–exitä¹‹åçˆ¶è¿›ç¨‹æ‰å¯èƒ½è¢«è°ƒåº¦è¿è¡Œï¼Œå½“å­è¿›ç¨‹è°ƒç”¨è¿™ä¸¤ä¸ªå‡½æ•°ä¸­ä»»æ„ä¸€ä¸ªæ—¶ï¼Œçˆ¶è¿›ç¨‹ä¼šæ¢å¤è¿è¡Œã€‚</li></ul><h2 id="exitå‡½æ•°"><a href="#exitå‡½æ•°" class="headerlink" title="exitå‡½æ•°"></a>exitå‡½æ•°</h2><ul><li>è¿›ç¨‹çš„5ç§æ­£å¸¸ç»ˆæ­¢æ–¹å¼ï¼š<ul><li>åœ¨mainå‡½æ•°å†…æ‰§è¡Œreturnè¯­å¥ã€‚ç­‰æ•ˆäºè°ƒç”¨exit</li><li>è°ƒç”¨exitå‡½æ•°ã€‚ç”±ISO Cå®šä¹‰ï¼Œå…¶æ“ä½œåŒ…æ‹¬è°ƒç”¨å„ç»ˆæ­¢å¤„ç†ç¨‹åºï¼Œå…³é—­æ‰€æœ‰æ ‡å‡†I/Oæµç­‰</li><li>è°ƒç”¨_exitæˆ–_Exitå‡½æ•°ã€‚ISO Cå®šä¹‰_Exitï¼Œç›®çš„æ˜¯æä¾›ä¸€ç§æ— éœ€è¿è¡Œç»ˆæ­¢å¤„ç†ç¨‹åºå’Œä¿¡å·å¤„ç†ç¨‹åºçš„æ–¹æ³•ã€‚å¯¹æ ‡å‡†I/Oæµæ˜¯å¦è¿›è¡Œå†²æ´—ï¼Œè¿™å–å†³äºå®ç°ã€‚</li><li>è¿›ç¨‹çš„æœ€åä¸€ä¸ªçº¿ç¨‹åœ¨å¯åŠ¨ä¾‹ç¨‹ä¸­æ‰§è¡Œreturnè¯­å¥ã€‚</li><li>è¿›ç¨‹çš„æœ€åä¸€ä¸ªçº¿ç¨‹è°ƒç”¨pthread_exitå‡½æ•°ã€‚</li></ul></li><li>è¿›ç¨‹çš„3ç§å¼‚å¸¸ç»ˆæ­¢æ–¹å¼ï¼š<ul><li>è°ƒç”¨abortï¼Œå®ƒäº§ç”ŸSIGABRTä¿¡å·</li><li>å½“è¿›ç¨‹æ¥æ”¶åˆ°æŸç§ä¿¡å·æ—¶</li><li>æœ€åä¸€ä¸ªçº¿ç¨‹å¯¹â€œå–æ¶ˆâ€è¯·æ±‚åšå‡ºå“åº”ã€‚</li></ul></li><li>ä¸ç®¡è¿›ç¨‹å¦‚ä½•ç»ˆæ­¢ï¼Œæœ€åå†…æ ¸éƒ½ä¼šä¸ºç›¸åº”è¿›ç¨‹å…³é—­æ‰€æœ‰æ‰“å¼€æè¿°ç¬¦ï¼Œé‡Šæ”¾å®ƒæ‰€ä½¿ç”¨çš„å­˜å‚¨å™¨ç­‰ã€‚æ‰€ä»¥å¤§å¤šæ•°exitçš„ç°ä»£å®ç°ä¸å†å…³é—­æµ</li></ul><h3 id="ç»ˆæ­¢è¿›ç¨‹å¦‚ä½•é€šçŸ¥çˆ¶è¿›ç¨‹å®ƒæ˜¯å¦‚ä½•ç»ˆæ­¢çš„ï¼Ÿ"><a href="#ç»ˆæ­¢è¿›ç¨‹å¦‚ä½•é€šçŸ¥çˆ¶è¿›ç¨‹å®ƒæ˜¯å¦‚ä½•ç»ˆæ­¢çš„ï¼Ÿ" class="headerlink" title="ç»ˆæ­¢è¿›ç¨‹å¦‚ä½•é€šçŸ¥çˆ¶è¿›ç¨‹å®ƒæ˜¯å¦‚ä½•ç»ˆæ­¢çš„ï¼Ÿ"></a>ç»ˆæ­¢è¿›ç¨‹å¦‚ä½•é€šçŸ¥çˆ¶è¿›ç¨‹å®ƒæ˜¯å¦‚ä½•ç»ˆæ­¢çš„ï¼Ÿ</h3><p>å¯¹äºä¸‰ä¸ªç»ˆæ­¢å‡½æ•°ï¼ˆexitã€_exitå’Œ_Exitï¼‰ï¼Œå°†å…¶<code>é€€å‡ºçŠ¶æ€</code>ä½œä¸ºå‚æ•°ä¼ é€’ç»™å‡½æ•°ã€‚å¯¹äºå¼‚å¸¸ç»ˆæ­¢æƒ…å†µï¼Œå†…æ ¸ï¼ˆä¸æ˜¯è¿›ç¨‹æœ¬èº«ï¼‰äº§ç”Ÿä¸€ä¸ªæŒ‡ç¤ºå…¶ç»ˆæ­¢åŸå› çš„<code>ç»ˆæ­¢çŠ¶æ€</code>ã€‚åœ¨ä»»æ„ä¸€ç§æƒ…å†µä¸‹ï¼Œè¯¥ç»ˆæ­¢è¿›ç¨‹çš„çˆ¶è¿›ç¨‹éƒ½èƒ½ç”¨waitå’Œwaitpidå‡½æ•°å–å¾—å…¶ç»ˆæ­¢çŠ¶æ€ã€‚</p><h3 id="çˆ¶è¿›ç¨‹åœ¨å­è¿›ç¨‹ä¹‹å‰ç»ˆæ­¢ä¼šæ€æ ·ï¼Ÿ"><a href="#çˆ¶è¿›ç¨‹åœ¨å­è¿›ç¨‹ä¹‹å‰ç»ˆæ­¢ä¼šæ€æ ·ï¼Ÿ" class="headerlink" title="çˆ¶è¿›ç¨‹åœ¨å­è¿›ç¨‹ä¹‹å‰ç»ˆæ­¢ä¼šæ€æ ·ï¼Ÿ"></a>çˆ¶è¿›ç¨‹åœ¨å­è¿›ç¨‹ä¹‹å‰ç»ˆæ­¢ä¼šæ€æ ·ï¼Ÿ</h3><p>å¯¹äºçˆ¶è¿›ç¨‹å·²ç»ç»ˆæ­¢çš„æ‰€æœ‰è¿›ç¨‹ï¼Œå®ƒä»¬çš„çˆ¶è¿›ç¨‹éƒ½æ”¹å˜ä¸ºinitè¿›ç¨‹ï¼ˆç§°ä¸ºç”±initè¿›ç¨‹æ”¶å…»ï¼‰ã€‚æ“ä½œè¿‡ç¨‹å¤§è‡´æ˜¯ï¼šåœ¨ä¸€ä¸ªè¿›ç¨‹ç»ˆæ­¢æ—¶ï¼Œå†…æ ¸é€ä¸ªæ£€æŸ¥æ‰€æœ‰æ´»åŠ¨è¿›ç¨‹ï¼Œå¦‚æœæ˜¯æ­£è¦ç»ˆæ­¢è¿›ç¨‹çš„å­è¿›ç¨‹ï¼Œåˆ™å°†è¯¥è¿›ç¨‹çš„çˆ¶è¿›ç¨‹IDæ”¹ä¸º1ã€‚</p><h3 id="å¦‚æœå­è¿›ç¨‹åœ¨çˆ¶è¿›ç¨‹ä¹‹å‰ç»ˆæ­¢ï¼Œçˆ¶è¿›ç¨‹å¦‚ä½•è·å¾—å­è¿›ç¨‹çš„ç»ˆæ­¢çŠ¶æ€ï¼Ÿ"><a href="#å¦‚æœå­è¿›ç¨‹åœ¨çˆ¶è¿›ç¨‹ä¹‹å‰ç»ˆæ­¢ï¼Œçˆ¶è¿›ç¨‹å¦‚ä½•è·å¾—å­è¿›ç¨‹çš„ç»ˆæ­¢çŠ¶æ€ï¼Ÿ" class="headerlink" title="å¦‚æœå­è¿›ç¨‹åœ¨çˆ¶è¿›ç¨‹ä¹‹å‰ç»ˆæ­¢ï¼Œçˆ¶è¿›ç¨‹å¦‚ä½•è·å¾—å­è¿›ç¨‹çš„ç»ˆæ­¢çŠ¶æ€ï¼Ÿ"></a>å¦‚æœå­è¿›ç¨‹åœ¨çˆ¶è¿›ç¨‹ä¹‹å‰ç»ˆæ­¢ï¼Œçˆ¶è¿›ç¨‹å¦‚ä½•è·å¾—å­è¿›ç¨‹çš„ç»ˆæ­¢çŠ¶æ€ï¼Ÿ</h3><p>å¦‚æœå­è¿›ç¨‹å®Œå…¨æ¶ˆå¤±äº†ï¼Œçˆ¶è¿›ç¨‹åœ¨æœ€ç»ˆå‡†å¤‡å¥½æ£€æŸ¥å­è¿›ç¨‹æ˜¯å¦ç»ˆæ­¢æ—¶æ˜¯æ— æ³•è·å–å®ƒçš„ç»ˆæ­¢çŠ¶æ€çš„ã€‚å†…æ ¸ä¸ºæ¯ä¸ªç»ˆæ­¢å­è¿›ç¨‹ä¿å­˜äº†ä¸€å®šé‡çš„ä¿¡æ¯ï¼Œæ‰€ä»¥å½“ç»ˆæ­¢è¿›ç¨‹çš„çˆ¶è¿›ç¨‹è°ƒç”¨waitæˆ–waitpidæ—¶ï¼Œå¯ä»¥å¾—åˆ°è¿™äº›ä¿¡æ¯ã€‚åŒ…æ‹¬è¿›ç¨‹IDã€ç»ˆæ­¢çŠ¶æ€å’ŒCPUæ—¶é—´æ€»é‡ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯åƒµå°¸è¿›ç¨‹ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯åƒµå°¸è¿›ç¨‹ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯åƒµå°¸è¿›ç¨‹ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯åƒµå°¸è¿›ç¨‹ï¼Ÿ</h3><p>å†…æ ¸å¯ä»¥é‡Šæ”¾ç»ˆæ­¢è¿›ç¨‹æ‰€ä½¿ç”¨çš„æ‰€æœ‰å­˜å‚¨åŒºï¼Œå…³é—­å…¶æ‰€æœ‰æ‰“å¼€æ–‡ä»¶ã€‚ä¸€ä¸ªå·²ç»ç»ˆæ­¢ã€ä½†æ˜¯å…¶çˆ¶è¿›ç¨‹å°šæœªå¯¹å…¶è¿›è¡Œå–„åå¤„ç†ï¼ˆè·å–ç»ˆæ­¢å­è¿›ç¨‹çš„æœ‰å…³ä¿¡æ¯ã€é‡Šæ”¾å®ƒä»å ç”¨çš„èµ„æºï¼‰çš„è¿›ç¨‹è¢«ç§°ä¸ºåƒµå°¸è¿›ç¨‹ã€‚å¦‚æœç¼–å†™ä¸€ä¸ªé•¿æœŸè¿è¡Œçš„ç¨‹åºï¼Œå®ƒforkäº†å¾ˆå¤šå­è¿›ç¨‹ï¼Œé‚£ä¹ˆé™¤éçˆ¶è¿›ç¨‹ç­‰å¾…å–å¾—å­è¿›ç¨‹çš„ç»ˆæ­¢çŠ¶æ€ï¼Œä¸ç„¶è¿™äº›å­è¿›ç¨‹ç»ˆæ­¢åå°±ä¼šå˜æˆåƒµå°¸è¿›ç¨‹ã€‚</p><h3 id="ä¸€ä¸ªç”±initè¿›ç¨‹æ”¶å…»çš„è¿›ç¨‹ç»ˆæ­¢åä¼šä¸ä¼šå˜æˆåƒµå°¸è¿›ç¨‹ï¼Ÿ"><a href="#ä¸€ä¸ªç”±initè¿›ç¨‹æ”¶å…»çš„è¿›ç¨‹ç»ˆæ­¢åä¼šä¸ä¼šå˜æˆåƒµå°¸è¿›ç¨‹ï¼Ÿ" class="headerlink" title="ä¸€ä¸ªç”±initè¿›ç¨‹æ”¶å…»çš„è¿›ç¨‹ç»ˆæ­¢åä¼šä¸ä¼šå˜æˆåƒµå°¸è¿›ç¨‹ï¼Ÿ"></a>ä¸€ä¸ªç”±initè¿›ç¨‹æ”¶å…»çš„è¿›ç¨‹ç»ˆæ­¢åä¼šä¸ä¼šå˜æˆåƒµå°¸è¿›ç¨‹ï¼Ÿ</h3><p>ä¸ä¼šçš„ã€‚å› ä¸ºinitè¢«ç¼–å†™æˆæ— è®ºä½•æ—¶åªè¦æœ‰ä¸€ä¸ªå­è¿›ç¨‹ç»ˆæ­¢ï¼Œinitå°±ä¼šè°ƒç”¨ä¸€ä¸ªwaitå‡½æ•°å–å¾—å…¶ç»ˆæ­¢çŠ¶æ€ã€‚</p><h2 id="waitå’Œwaitpidå‡½æ•°"><a href="#waitå’Œwaitpidå‡½æ•°" class="headerlink" title="waitå’Œwaitpidå‡½æ•°"></a>waitå’Œwaitpidå‡½æ•°</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/wait.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">pid_t</span> <span class="title">wait</span><span class="params">(<span class="keyword">int</span> *statloc)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">pid_t</span> <span class="title">waitpid</span><span class="params">(<span class="keyword">pid_t</span> pid, <span class="keyword">int</span> *statloc, <span class="keyword">int</span> options)</span></span>;</span><br></pre></td></tr></table></figure><h3 id="å‡½æ•°è¯´æ˜-1"><a href="#å‡½æ•°è¯´æ˜-1" class="headerlink" title="å‡½æ•°è¯´æ˜"></a>å‡½æ•°è¯´æ˜</h3><ul><li>æˆåŠŸè¿”å›è¿›ç¨‹idï¼Œå‡ºé”™è¿”å›0æˆ–-1</li><li>statlocæ˜¯ä¸€ä¸ªæ•´å‹æŒ‡é’ˆï¼Œä¿å­˜ç»ˆæ­¢è¿›ç¨‹çš„ç»ˆæ­¢çŠ¶æ€ï¼Œå½“å®ƒæ˜¯ä¸€ä¸ªç©ºæŒ‡é’ˆæ—¶ï¼Œåˆ™ä¸ä¿å­˜</li></ul><h3 id="è°ƒç”¨waitæˆ–waitpidä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ"><a href="#è°ƒç”¨waitæˆ–waitpidä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ" class="headerlink" title="è°ƒç”¨waitæˆ–waitpidä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ"></a>è°ƒç”¨waitæˆ–waitpidä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</h3><ul><li>å¦‚æœæ‰€æœ‰å­è¿›ç¨‹éƒ½è¿˜åœ¨è¿è¡Œï¼Œåˆ™é˜»å¡</li><li>å¦‚æœä¸€ä¸ªå­è¿›ç¨‹å·²ç»ç»ˆæ­¢ï¼Œæ­£ç­‰å¾…çˆ¶è¿›ç¨‹è·å–å…¶ç»ˆæ­¢çŠ¶æ€ï¼Œåˆ™å–å¾—è¯¥å­è¿›ç¨‹çš„ç»ˆæ­¢çŠ¶æ€ç«‹å³è¿”å›</li><li>å¦‚æœå®ƒæ²¡æœ‰ä»»ä½•å­è¿›ç¨‹ï¼Œåˆ™ç«‹å³å‡ºé”™è¿”å›</li></ul><h3 id="ä¸¤ä¸ªå‡½æ•°çš„åŒºåˆ«"><a href="#ä¸¤ä¸ªå‡½æ•°çš„åŒºåˆ«" class="headerlink" title="ä¸¤ä¸ªå‡½æ•°çš„åŒºåˆ«"></a>ä¸¤ä¸ªå‡½æ•°çš„åŒºåˆ«</h3><ul><li>åœ¨ä¸€ä¸ªå­è¿›ç¨‹ç»ˆæ­¢å‰ï¼Œwaitä½¿å…¶è°ƒç”¨è€…é˜»å¡ï¼Œè€Œwaitpidæœ‰ä¸€é€‰é¡¹ï¼Œå¯ä½¿è°ƒç”¨è€…ä¸é˜»å¡</li><li>waitpidå¹¶ä¸ç­‰å¾…å…¶è°ƒç”¨ä¹‹åçš„ç¬¬ä¸€ä¸ªå­è¿›ç¨‹ç»ˆæ­¢ï¼Œå®ƒæœ‰è‹¥å¹²é€‰é¡¹ï¼Œå¯ä»¥æ§åˆ¶å®ƒæ‰€ç­‰å¾…çš„è¿›ç¨‹</li></ul><h3 id="å…¶ä»–ç›¸å…³å‡½æ•°"><a href="#å…¶ä»–ç›¸å…³å‡½æ•°" class="headerlink" title="å…¶ä»–ç›¸å…³å‡½æ•°"></a>å…¶ä»–ç›¸å…³å‡½æ•°</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/wait.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">waitid</span><span class="params">(<span class="keyword">idtype_t</span> idtype, <span class="keyword">id_t</span> id, <span class="keyword">siginfo_t</span> *infop, <span class="keyword">int</span> options)</span></span>;</span><br></pre></td></tr></table></figure><ul><li>ä¸waitpidç›¸ä¼¼ï¼Œwaitidå…è®¸ä¸€ä¸ªè¿›ç¨‹æŒ‡å®šè¦ç­‰å¾…çš„å­è¿›ç¨‹ã€‚ä½†å®ƒä½¿ç”¨ä¸¤ä¸ªå•ç‹¬çš„å‚æ•°è¡¨ç¤ºè¦ç­‰å¾…çš„å­è¿›ç¨‹æ‰€å±çš„ç±»å‹ï¼Œè€Œä¸æ˜¯å°†æ­¤ä¸è¿›ç¨‹IDæˆ–è¿›ç¨‹ç»„IDç»„åˆæˆä¸€ä¸ªå‚æ•°ã€‚<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">pid_t</span> <span class="title">wait3</span><span class="params">(<span class="keyword">int</span> *statloc, <span class="keyword">int</span> options, struct rusage *resage)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">pid_t</span> <span class="title">wait4</span><span class="params">(<span class="keyword">pid_t</span> pid, <span class="keyword">int</span> *statloc, <span class="keyword">int</span> options, struct rusage *rusage)</span></span>;</span><br></pre></td></tr></table></figure></li><li>è¿™ä¸¤ä¸ªå‡½æ•°æä¾›çš„åŠŸèƒ½æ¯”waitã€waitpidå’Œwaitidè¦å¤šä¸€ä¸ªï¼Œä¸é™„åŠ å‚æ•°æœ‰å…³ã€‚è¯¥å‚æ•°å…è®¸å†…æ ¸è¿”å›ç”±ç»ˆæ­¢è¿›ç¨‹åŠå…¶æ‰€æœ‰å­è¿›ç¨‹æ‰€ä½¿ç”¨çš„èµ„æºæ¦‚å†µã€‚</li></ul><h2 id="ç«äº‰æ¡ä»¶"><a href="#ç«äº‰æ¡ä»¶" class="headerlink" title="ç«äº‰æ¡ä»¶"></a>ç«äº‰æ¡ä»¶</h2><ul><li>å½“å¤šä¸ªè¿›ç¨‹éƒ½ä¼å›¾å¯¹å…±äº«æ•°æ®è¿›è¡ŒæŸç§å¤„ç†ï¼Œè€Œæœ€åçš„ç»“æœåˆå–å†³äºè¿›ç¨‹è¿è¡Œçš„é¡ºåºæ—¶ï¼Œæˆ‘ä»¬è®¤ä¸ºå‘ç”Ÿäº†ç«äº‰æ¡ä»¶ã€‚</li><li>å¦‚æœä¸€ä¸ªè¿›ç¨‹å¸Œæœ›ç­‰å¾…ä¸€ä¸ªå­è¿›ç¨‹ç»ˆæ­¢ï¼Œåˆ™å®ƒå¿…é¡»è°ƒç”¨waitå‡½æ•°ä¸­çš„ä¸€ä¸ªã€‚</li><li>å¦‚æœä¸€ä¸ªè¿›ç¨‹è¦ç­‰å¾…å…¶çˆ¶è¿›ç¨‹ç»ˆæ­¢ï¼Œåˆ™å¯ä½¿ç”¨ä¸‹åˆ—å½¢å¼çš„å¾ªç¯ï¼š<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span>(getppid() != <span class="number">1</span>) &#123;</span><br><span class="line">  sleep(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>è¿™ç§å½¢å¼çš„å¾ªç¯ç§°ä¸º<code>è½®è¯¢ï¼ˆpollingï¼‰</code>ï¼Œå®ƒçš„é—®é¢˜æ˜¯æµªè´¹äº†CPUæ—¶é—´ï¼Œå› ä¸ºè°ƒç”¨è€…æ¯éš”1séƒ½è¢«å”¤é†’ï¼Œç„¶åè¿›è¡Œæ¡ä»¶æµ‹è¯•</li><li>ä¸ºäº†é¿å…ç«äº‰æ¡ä»¶å’Œè½®è¯¢ï¼Œåœ¨å¤šä¸ªè¿›ç¨‹ä¹‹é—´éœ€è¦æŸç§å½¢å¼çš„ä¿¡å·å‘é€å’Œæ¥æ”¶çš„æ–¹æ³•ã€‚åŒ…æ‹¬ä¿¡å·æœºåˆ¶å’Œè¿›ç¨‹é—´é€šä¿¡ï¼ˆIPCï¼‰</li></ul><h2 id="execå‡½æ•°"><a href="#execå‡½æ•°" class="headerlink" title="execå‡½æ•°"></a>execå‡½æ•°</h2><h3 id="å‡½æ•°è¯´æ˜-2"><a href="#å‡½æ•°è¯´æ˜-2" class="headerlink" title="å‡½æ•°è¯´æ˜"></a>å‡½æ•°è¯´æ˜</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="comment">//æ­¤å¤„çœç•¥å‚æ•°å£°æ˜</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">execl</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">execv</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">execle</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">execve</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">execlp</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">execvp</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">fexecve</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure><ul><li>å½“è¿›ç¨‹è°ƒç”¨ä¸€ç§execå‡½æ•°æ—¶ï¼Œè¯¥è¿›ç¨‹æ‰§è¡Œçš„ç¨‹åºå®Œå…¨æ›¿æ¢ä¸ºæ–°ç¨‹åºï¼Œä»mainå‡½æ•°å¼€å§‹æ‰§è¡Œã€‚</li><li>execä¸åˆ›å»ºæ–°è¿›ç¨‹ï¼Œè¿›ç¨‹IDä¸å˜ã€‚</li><li>execåªæ˜¯ç”¨ç£ç›˜ä¸Šçš„ä¸€ä¸ªæ–°ç¨‹åºæ›¿æ¢äº†å½“å‰è¿›ç¨‹çš„æ­£æ–‡æ®µã€æ•°æ®æ®µã€å †æ®µå’Œæ ˆæ®µ</li><li>7ä¸ªå‡½æ•°çš„å…³ç³»ï¼š<br><img src="8-15.png" alt=""></li></ul><h2 id="æ›´æ”¹ç”¨æˆ·IDã€ç»„ID"><a href="#æ›´æ”¹ç”¨æˆ·IDã€ç»„ID" class="headerlink" title="æ›´æ”¹ç”¨æˆ·IDã€ç»„ID"></a>æ›´æ”¹ç”¨æˆ·IDã€ç»„ID</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">setuid</span><span class="params">(<span class="keyword">uid_t</span> uid)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">setgid</span><span class="params">(<span class="keyword">gid_t</span> gid)</span></span>;</span><br></pre></td></tr></table></figure><p><img src="8-19.png" alt=""></p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;è¿›ç¨‹æ ‡è¯†&quot;&gt;&lt;a href=&quot;#è¿›ç¨‹æ ‡è¯†&quot; class=&quot;headerlink&quot; title=&quot;è¿›ç¨‹æ ‡è¯†&quot;&gt;&lt;/a&gt;è¿›ç¨‹æ ‡è¯†&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰ä¸€ä¸ªéè´Ÿæ•´å‹è¡¨ç¤ºçš„å”¯ä¸€è¿›ç¨‹ID&lt;/li&gt;
&lt;li&gt;IDä¸º0çš„è¿›ç¨‹é€šå¸¸æ˜¯è°ƒåº¦è¿›ç¨‹ï¼Œå¸¸å¸¸è¢«ç§°ä¸ºäº¤æ¢è¿›ç¨‹ï¼ˆswapperï¼‰ã€‚è¯¥è¿›ç¨‹æ˜¯å†…æ ¸çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒå¹¶ä¸æ‰§è¡Œä»»ä½•ç£ç›˜ä¸Šçš„ç¨‹åºï¼Œå› æ­¤ä¹Ÿè¢«ç§°ä¸ºç³»ç»Ÿè¿›ç¨‹ã€‚&lt;/li&gt;
&lt;li&gt;è¿›ç¨‹ID 1é€šå¸¸æ˜¯initè¿›ç¨‹ï¼Œåœ¨è‡ªä¸¾è¿‡ç¨‹ç»“æŸæ—¶ç”±å†…æ ¸è°ƒç”¨ã€‚è¯¥è¿›ç¨‹çš„ç¨‹åºæ–‡ä»¶æ˜¯/etc/initæˆ–/sbin/initã€‚æ­¤è¿›ç¨‹è´Ÿè´£åœ¨è‡ªä¸¾å†…æ ¸åå¯åŠ¨ä¸€ä¸ªUNIXç³»ç»Ÿã€‚&lt;/li&gt;
&lt;li&gt;initè¯»å–ä¸ç³»ç»Ÿæœ‰å…³çš„åˆå§‹åŒ–æ–‡ä»¶ï¼Œå¹¶å°†ç³»ç»Ÿå¼•å¯¼åˆ°ä¸€ä¸ªçŠ¶æ€ã€‚&lt;/li&gt;
&lt;li&gt;initè¿›ç¨‹ä¸ä¼šç»ˆæ­¢ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ™®é€šçš„ç”¨æˆ·è¿›ç¨‹ï¼Œä»¥è¶…çº§ç”¨æˆ·ç‰¹æƒè¿è¡Œï¼›äº¤æ¢è¿›ç¨‹æ˜¯å†…æ ¸ä¸­çš„ç³»ç»Ÿè¿›ç¨‹ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;forkå‡½æ•°&quot;&gt;&lt;a href=&quot;#forkå‡½æ•°&quot; class=&quot;headerlink&quot; title=&quot;forkå‡½æ•°&quot;&gt;&lt;/a&gt;forkå‡½æ•°&lt;/h2&gt;&lt;figure class=&quot;highlight c&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;meta-keyword&quot;&gt;include&lt;/span&gt; &lt;span class=&quot;meta-string&quot;&gt;&amp;lt;unistd.h&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;pid_t&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;fork&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)&lt;/span&gt;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;å‡½æ•°è¯´æ˜&quot;&gt;&lt;a href=&quot;#å‡½æ•°è¯´æ˜&quot; class=&quot;headerlink&quot; title=&quot;å‡½æ•°è¯´æ˜&quot;&gt;&lt;/a&gt;å‡½æ•°è¯´æ˜&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;è°ƒç”¨ä¸€æ¬¡ï¼Œè¿”å›ä¸¤æ¬¡ã€‚å­è¿›ç¨‹è¿”å›0ï¼Œçˆ¶è¿›ç¨‹è¿”å›å­è¿›ç¨‹IDï¼Œå‡ºé”™è¿”å›-1&lt;/li&gt;
&lt;li&gt;å­è¿›ç¨‹å’Œçˆ¶è¿›ç¨‹ç»§ç»­æ‰§è¡Œforkä¹‹åçš„æŒ‡ä»¤ï¼›å­è¿›ç¨‹è·å¾—çˆ¶è¿›ç¨‹æ•°æ®ç©ºé—´ã€å †ã€æ ˆçš„å‰¯æœ¬ï¼›å­è¿›ç¨‹å’Œçˆ¶è¿›ç¨‹å…±äº«æ­£æ–‡æ®µ&lt;/li&gt;
&lt;li&gt;forkæ—¶ç”¨åˆ°&lt;code&gt;å†™æ—¶å¤åˆ¶ï¼ˆCopy-On-Writeï¼‰&lt;/code&gt;æŠ€æœ¯ï¼Œè¿™äº›åŒºåŸŸç”±çˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹å…±äº«ï¼Œå†…æ ¸å°†ä»–ä»¬çš„è®¿é—®æƒé™æ”¹ä¸ºåªè¯»ï¼Œå½“ä»»ä¸€è¿›ç¨‹å°è¯•ä¿®æ”¹æ—¶ï¼Œå†…æ ¸åªä¸ºä¿®æ”¹åŒºåŸŸçš„é‚£å—å†…å­˜åˆ¶ä½œä¸€ä¸ªå‰¯æœ¬ï¼Œé€šå¸¸æ˜¯è™šæ‹Ÿå†…å­˜ä¸­çš„ä¸€â€œé¡µâ€&lt;/li&gt;
&lt;li&gt;forkåå…ˆæ‰§è¡Œå“ªä¸ªè¿›ç¨‹æ˜¯ä¸ç¡®å®šçš„ï¼Œå–å†³äºå†…æ ¸æ‰€ä½¿ç”¨çš„è°ƒåº¦ç®—æ³•&lt;/li&gt;
&lt;li&gt;æ–‡ä»¶å…±äº«ã€‚çˆ¶è¿›ç¨‹çš„æ‰€æœ‰æ‰“å¼€æ–‡ä»¶æè¿°ç¬¦éƒ½è¢«å¤åˆ¶åˆ°å­è¿›ç¨‹ä¸­ï¼Œçˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹æ¯ä¸ªç›¸åŒçš„æ‰“å¼€æè¿°ç¬¦å…±äº«ä¸€ä¸ªæ–‡ä»¶è¡¨é¡¹ï¼ˆåŒ…æ‹¬æ–‡ä»¶åç§»é‡ï¼‰ã€‚&lt;br&gt;&lt;img src=&quot;8-2.png&quot; alt=&quot;&quot;&gt;&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
    
      <category term="ã€ŠAPUEã€‹ç¬”è®°" scheme="https://akaqin.github.io/categories/%E3%80%8AAPUE%E3%80%8B%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="process" scheme="https://akaqin.github.io/tags/process/"/>
    
  </entry>
  
  <entry>
    <title>ä¸ºä»€ä¹ˆcallocä¼šæ¯”malloc+memsetå¿«</title>
    <link href="https://akaqin.github.io/2020/02/23/%E4%B8%BA%E4%BB%80%E4%B9%88calloc%E4%BC%9A%E6%AF%94malloc-memset%E5%BF%AB/"/>
    <id>https://akaqin.github.io/2020/02/23/%E4%B8%BA%E4%BB%80%E4%B9%88calloc%E4%BC%9A%E6%AF%94malloc-memset%E5%BF%AB/</id>
    <published>2020-02-23T09:03:12.000Z</published>
    <updated>2020-03-08T07:41:56.376Z</updated>
    
    <content type="html"><![CDATA[<ol><li><code>malloc</code>å’Œ<code>calloc</code>åˆ†é…å°çš„å†…å­˜æ—¶ç›´æ¥ä»å†…å­˜æ± åˆ†é…ï¼Œå†…å­˜æ± ä¸å¤Ÿæ—¶å‘å†…æ ¸ç”³è¯·æ›´å¤šå†…å­˜ï¼›åˆ†é…å¤§å†…å­˜æ—¶ä¼šç›´æ¥è°ƒç”¨<code>mmap</code>æˆ–<code>sbrk</code>ç³»ç»Ÿè°ƒç”¨</li><li>å†…æ ¸åˆ†é…çš„å†…å­˜å¯èƒ½æ˜¯å‰ä¸€ä¸ªè¿›ç¨‹ç”¨è¿‡çš„ï¼Œä¸ºä¿è¯ä¸æ³„æ¼æ•æ„Ÿæ•°æ®ï¼Œå†…æ ¸å§‹ç»ˆåœ¨å°†å†…å­˜äº¤ç»™è¿›ç¨‹å‰å…ˆå°†å†…å­˜ç½®0ï¼Œå› æ­¤<code>mmap()</code>ä¿è¯è¿”å›çš„æ–°å†…å­˜å§‹ç»ˆä¸ºé›¶</li><li>å½“ç¨‹åºç”³è¯·å†…å­˜æ—¶ï¼Œå†…æ ¸å¹¶ä¸ä¼šé©¬ä¸Šä¿®æ”¹é¡µè¡¨ä¸ºè¿›ç¨‹æä¾›RAMï¼Œè€Œæ˜¯åœ¨è¿›ç¨‹ä¸­æ‰¾åˆ°ä¸€äº›åœ°å€ç©ºé—´ï¼Œè®°ä¸‹åº”è¯¥å»çš„åœ°æ–¹ï¼Œå¹¶ä¿è¯å¦‚æœæ‚¨çš„ç¨‹åºå®é™…ä½¿ç”¨RAMï¼Œå®ƒå°†åœ¨å…¶ä¸­æ”¾ç½®RAMã€‚å½“ç¨‹åºå°è¯•è¯»å†™é‚£äº›åœ°å€ï¼Œä¼šå‡ºå‘ç¼ºé¡µæ•…éšœï¼Œå†…æ ¸å°†RAMåˆ†é…ç»™è¿™äº›åœ°å€ï¼Œç»§ç»­æ‰§è¡Œç¨‹åºã€‚å¦‚æœä¸è¯»å†™ï¼Œå†…æ ¸å°±ä¸ä¼šåˆ†é…RAMç»™è¿›ç¨‹ã€‚</li><li>æœ‰çš„è¿›ç¨‹åˆ†é…å†…å­˜ååªè¯»ä¸å†™ï¼Œè¿™æ„å‘³ç€è·¨ä¸åŒè¿›ç¨‹çš„å†…å­˜ä¸­çš„è®¸å¤šé¡µé¢å¯èƒ½å¡«å……æœ‰ä»<code>mmap()</code>è¿”å›çš„åŸå§‹é›¶ã€‚ç”±äºè¿™äº›é¡µé¢éƒ½æ˜¯ç›¸åŒçš„ï¼Œå› æ­¤å†…æ ¸ä½¿æ‰€æœ‰è¿™äº›è™šæ‹Ÿåœ°å€æŒ‡å‘ä¸€ä¸ªå…±äº«çš„4 KiBå†…å­˜é¡µé¢ï¼Œå…¶ä¸­å¡«å……äº†é›¶ã€‚å¦‚æœæ‚¨å°è¯•å†™å…¥è¯¥å†…å­˜ï¼Œåˆ™å¤„ç†å™¨ä¼šè§¦å‘å¦ä¸€ä¸ªé¡µé¢é”™è¯¯ï¼ˆå†™æ—¶å¤åˆ¶ï¼‰ï¼Œå†…æ ¸ä¼šä»‹å…¥ï¼Œä»è€Œä¸ºæ‚¨æä¾›ä¸€ä¸ªé›¶çš„æ–°é¡µé¢ï¼Œè¯¥é¡µé¢ä¸ä¼šä¸ä»»ä½•å…¶ä»–ç¨‹åºå…±äº«ã€‚</li></ol>]]></content>
    
    <summary type="html">
    
      
      
        &lt;ol&gt;
&lt;li&gt;&lt;code&gt;malloc&lt;/code&gt;å’Œ&lt;code&gt;calloc&lt;/code&gt;åˆ†é…å°çš„å†…å­˜æ—¶ç›´æ¥ä»å†…å­˜æ± åˆ†é…ï¼Œå†…å­˜æ± ä¸å¤Ÿæ—¶å‘å†…æ ¸ç”³è¯·æ›´å¤šå†…å­˜ï¼›åˆ†é…å¤§å†…å­˜æ—¶ä¼šç›´æ¥è°ƒç”¨&lt;code&gt;mmap&lt;/code&gt;æˆ–&lt;code&gt;sbrk&lt;/code&gt;ç³»ç»Ÿè°ƒç”¨&lt;/li&gt;
&lt;li&gt;
      
    
    </summary>
    
    
      <category term="çŸ¥è¯†ç‚¹æ€»ç»“" scheme="https://akaqin.github.io/categories/%E7%9F%A5%E8%AF%86%E7%82%B9%E6%80%BB%E7%BB%93/"/>
    
    
      <category term="C" scheme="https://akaqin.github.io/tags/C/"/>
    
  </entry>
  
  <entry>
    <title>ã€ŠUNIXç¯å¢ƒé«˜çº§ç¼–ç¨‹ã€‹ç¬¬7ç« â€”â€”è¿›ç¨‹ç¯å¢ƒ</title>
    <link href="https://akaqin.github.io/2020/02/23/%E3%80%8AUNIX%E7%8E%AF%E5%A2%83%E9%AB%98%E7%BA%A7%E7%BC%96%E7%A8%8B%E3%80%8B%E7%AC%AC7%E7%AB%A0%E2%80%94%E2%80%94%E8%BF%9B%E7%A8%8B%E7%8E%AF%E5%A2%83/"/>
    <id>https://akaqin.github.io/2020/02/23/%E3%80%8AUNIX%E7%8E%AF%E5%A2%83%E9%AB%98%E7%BA%A7%E7%BC%96%E7%A8%8B%E3%80%8B%E7%AC%AC7%E7%AB%A0%E2%80%94%E2%80%94%E8%BF%9B%E7%A8%8B%E7%8E%AF%E5%A2%83/</id>
    <published>2020-02-23T08:03:39.000Z</published>
    <updated>2020-04-14T01:27:04.668Z</updated>
    
    <content type="html"><![CDATA[<h3 id="è¿›ç¨‹å¼€å§‹"><a href="#è¿›ç¨‹å¼€å§‹" class="headerlink" title="è¿›ç¨‹å¼€å§‹"></a>è¿›ç¨‹å¼€å§‹</h3>   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">int main(int argc, char *argv[]);</span><br></pre></td></tr></table></figure><p>   ä»¥mainå‡½æ•°å¼€å§‹æ‰§è¡Œã€‚å½“å†…æ ¸æ‰§è¡ŒCç¨‹åºæ—¶ï¼Œåœ¨è°ƒç”¨mainå‰å…ˆè°ƒç”¨ä¸€ä¸ªç‰¹æ®Šçš„å¯åŠ¨ä¾‹ç¨‹ã€‚å¯æ‰§è¡Œç¨‹åºå°†æ­¤å¯åŠ¨ä¾‹ç¨‹æŒ‡å®šä¸ºç¨‹åºçš„èµ·å§‹åœ°å€â€”â€”è¿™æ˜¯ç”±é“¾æ¥ç¼–è¾‘å™¨è®¾ç½®çš„ï¼Œè€Œé“¾æ¥ç¼–è¾‘å™¨åˆ™ç”±Cç¼–è¯‘å™¨è°ƒç”¨ã€‚å¯åŠ¨ä¾‹ç¨‹ä»å†…æ ¸å–å¾—å‘½ä»¤è¡Œå‚æ•°å’Œç¯å¢ƒå˜é‡å€¼ï¼Œç„¶åä¸ºæŒ‰ä¸Šè¿°æ–¹å¼è°ƒç”¨åšå¥½å®‰æ’ã€‚</p><h3 id="è¿›ç¨‹ç»ˆæ­¢"><a href="#è¿›ç¨‹ç»ˆæ­¢" class="headerlink" title="è¿›ç¨‹ç»ˆæ­¢"></a>è¿›ç¨‹ç»ˆæ­¢</h3><p>   æœ‰8ç§ç»ˆæ­¢æ–¹å¼ï¼Œå‰5ç§ä¸ºæ­£å¸¸ç»ˆæ­¢ï¼š</p><ol><li>ä»mainè¿”å›</li><li>è°ƒç”¨exit</li><li>è°ƒç”¨_exitæˆ–_Exit</li><li>æœ€åä¸€ä¸ªçº¿ç¨‹ä»å¯åŠ¨ä¾‹ç¨‹è¿”å›</li><li>ä»æœ€åä¸€ä¸ªçº¿ç¨‹è°ƒç”¨pthread_exit<br>å¼‚å¸¸ç»ˆæ­¢æœ‰3ç§ï¼š</li><li>è°ƒç”¨abort</li><li>é‡åˆ°ä¸€ä¸ªä¿¡å·</li><li>æœ€åä¸€ä¸ªçº¿ç¨‹å¯¹å–æ¶ˆè¯·æ±‚åšå‡ºå“åº”</li></ol><a id="more"></a><h3 id="ç»ˆæ­¢å¤„ç†ç¨‹åº"><a href="#ç»ˆæ­¢å¤„ç†ç¨‹åº" class="headerlink" title="ç»ˆæ­¢å¤„ç†ç¨‹åº"></a>ç»ˆæ­¢å¤„ç†ç¨‹åº</h3><ul><li>ä¸€ä¸ªè¿›ç¨‹å¯ä»¥é€šè¿‡<code>atexit</code>å‡½æ•°ç™»è®°è‡³å¤š32ä¸ªå‡½æ•°ä½œä¸ºç»ˆæ­¢å¤„ç†ç¨‹åºï¼ˆexit handlerï¼‰ï¼Œè¿™äº›å‡½æ•°å°†åœ¨ç¨‹åºç»ˆæ­¢æ—¶æœ‰<code>exit</code>è‡ªåŠ¨è°ƒç”¨ã€‚<br> è°ƒç”¨é¡ºåºä¸ç™»è®°é¡ºåºç›¸åï¼Œç™»è®°å¤šæ¬¡ä¹Ÿä¼šè°ƒç”¨å¤šæ¬¡ã€‚<br> å¦‚è‹¥ç¨‹åºè°ƒç”¨<code>exec</code>å‡½æ•°æ—ä¸­ä»»ä¸€å‡½æ•°ï¼Œåˆ™å°†æ¸…é™¤æ‰€æœ‰å·²å®‰è£…çš„ç»ˆæ­¢å¤„ç†ç¨‹åºã€‚</li></ul><h3 id="exitå‡½æ•°"><a href="#exitå‡½æ•°" class="headerlink" title="exitå‡½æ•°"></a><code>exit</code>å‡½æ•°</h3><ul><li><code>_exit</code>å’Œ<code>_Exit</code>ç«‹å³è¿›å…¥å†…æ ¸ï¼Œ<code>exit</code>é¦–å…ˆè°ƒç”¨å„ç»ˆæ­¢å¤„ç†ç¨‹åºï¼Œç„¶åé€šè¿‡<code>fclose</code>å…³é—­æ‰€æœ‰æ‰“å¼€æµï¼Œè¿™é€ æˆè¾“å‡ºç¼“å†²ä¸­çš„æ‰€æœ‰æ•°æ®éƒ½è¢«å†²æ´—ï¼ˆå†™åˆ°æ–‡ä»¶ä¸Šï¼‰ã€‚</li><li>å†…æ ¸ä½¿ç¨‹åºæ‰§è¡Œçš„å”¯ä¸€æ–¹æ³•æ˜¯è°ƒç”¨ä¸€ä¸ª<code>exec</code>å‡½æ•°ã€‚è¿›ç¨‹è‡ªæ„¿ç»ˆæ­¢çš„å”¯ä¸€æ–¹æ³•æ˜¯æ˜¾ç¤ºæˆ–éšå¼åœ°ï¼ˆé€šè¿‡è°ƒç”¨<code>exit</code>ï¼‰è°ƒç”¨<code>_exit</code>æˆ–<code>_Exit</code>ã€‚è¿›ç¨‹ä¹Ÿå¯éè‡ªæ„¿åœ°ç”±ä¸€ä¸ªä¿¡å·ä½¿å…¶ç»ˆæ­¢ã€‚<br> <img src="7-2.png" alt=""></li></ul><h3 id="ç¯å¢ƒå˜é‡ä¸ç¯å¢ƒè¡¨"><a href="#ç¯å¢ƒå˜é‡ä¸ç¯å¢ƒè¡¨" class="headerlink" title="ç¯å¢ƒå˜é‡ä¸ç¯å¢ƒè¡¨"></a>ç¯å¢ƒå˜é‡ä¸ç¯å¢ƒè¡¨</h3><ul><li>é€šå¸¸ç”¨<code>getenv</code>å’Œ<code>putenv</code>è®¿é—®ç‰¹å®šçš„ç¯å¢ƒå˜é‡</li><li>æˆ‘ä»¬èƒ½å½±å“çš„é€šå¸¸åªæ˜¯å½“å‰è¿›ç¨‹åŠå…¶åç”Ÿæˆå’Œè°ƒç”¨çš„ä»»ä½•å­è¿›ç¨‹çš„ç¯å¢ƒï¼Œä½†ä¸èƒ½å½±å“çˆ¶è¿›ç¨‹çš„ç¯å¢ƒï¼Œè¿™é€šå¸¸æ˜¯ä¸€ä¸ªshellè¿›ç¨‹</li><li>ç¯å¢ƒè¡¨å’Œç¯å¢ƒå­—ç¬¦ä¸²é€šå¸¸å­˜æ”¾åœ¨è¿›ç¨‹å­˜å‚¨ç©ºé—´çš„é¡¶éƒ¨ï¼ˆæ ˆä¹‹ä¸Šï¼‰<br> <img src="7-5.png" alt=""></li></ul><h3 id="Cç¨‹åºçš„å­˜å‚¨ç©ºé—´å¸ƒå±€"><a href="#Cç¨‹åºçš„å­˜å‚¨ç©ºé—´å¸ƒå±€" class="headerlink" title="Cç¨‹åºçš„å­˜å‚¨ç©ºé—´å¸ƒå±€"></a>Cç¨‹åºçš„å­˜å‚¨ç©ºé—´å¸ƒå±€</h3><ul><li>æ­£æ–‡æ®µã€‚ç”±CPUæ‰§è¡Œçš„æœºå™¨æŒ‡ä»¤éƒ¨åˆ†ã€‚é€šå¸¸ï¼Œæ­£æ–‡æ®µæ˜¯å¯å…±äº«çš„ï¼Œæ‰€ä»¥å³ä½¿é¢‘ç¹æ‰§è¡Œçš„ç¨‹åºåœ¨å­˜å‚¨å™¨ä¸­ä¹Ÿåªéœ€è¦ç”±ä¸€ä¸ªå‰¯æœ¬ã€‚æ­£æ–‡æ®µé€šå¸¸æ˜¯åªè¯»çš„ï¼Œä»¥é˜²æ­¢ç¨‹åºç”±äºæ„å¤–è€Œä¿®æ”¹å…¶æŒ‡ä»¤ã€‚</li><li>åˆå§‹åŒ–æ•°æ®æ®µï¼Œé€šå¸¸ç§°ä¸ºæ•°æ®æ®µã€‚åŒ…å«äº†æ˜ç¡®èµ‹åˆå€¼çš„å˜é‡ã€‚ä¾‹å¦‚Cç¨‹åºä¸­ä»»ä½•å‡½æ•°ä¹‹å¤–çš„å£°æ˜ï¼š<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> maxcount = <span class="number">99</span>;</span><br></pre></td></tr></table></figure></li><li>æœªåˆå§‹åŒ–æ•°æ®æ®µï¼Œä¹Ÿç§°ä¸ºbssï¼ˆblock started by symbolï¼‰æ®µã€‚ç¨‹åºå¼€å§‹æ‰§è¡Œå‰ï¼Œå†…æ ¸å°†æ­¤æ®µæ•°æ®åˆå§‹åŒ–ä¸º0æˆ–ç©ºæŒ‡é’ˆã€‚ä¾‹å¦‚å‡½æ•°å¤–çš„å£°æ˜ï¼š<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">long</span> sum[<span class="number">100</span>];</span><br></pre></td></tr></table></figure></li><li>æ ˆã€‚è‡ªåŠ¨å˜é‡ä»¥åŠæ¯æ¬¡å‡½æ•°è°ƒç”¨æ—¶æ‰€éœ€ä¿å­˜çš„ä¿¡æ¯éƒ½å­˜æ”¾åœ¨æ­¤æ®µä¸­ã€‚</li><li>å †ã€‚é€šå¸¸ç”¨äºè¿›è¡ŒåŠ¨æ€å­˜å‚¨åˆ†é…ã€‚</li><li>æœªåˆå§‹åŒ–æ•°æ®æ®µçš„å†…å®¹å¹¶ä¸å­˜å‚¨åœ¨ç£ç›˜æ–‡ä»¶ä¸­ï¼Œå†…æ ¸åœ¨ç¨‹åºè¿è¡Œå‰å°†å®ƒä»¬è®¾ç½®ä¸º0.å­˜æ”¾åœ¨ç£ç›˜æ–‡ä»¶ä¸­çš„æ®µåªæœ‰æ­£æ–‡æ®µå’Œåˆå§‹åŒ–æ•°æ®æ®µã€‚<br> <img src="7-6.png" alt=""></li></ul><h3 id="å…±äº«åº“"><a href="#å…±äº«åº“" class="headerlink" title="å…±äº«åº“"></a>å…±äº«åº“</h3><ul><li>å…±äº«åº“ä½¿å¾—å¯æ‰§è¡Œæ–‡ä»¶ä¸­ä¸å†éœ€è¦åŒ…å«å…¬ç”¨çš„åº“å‡½æ•°ï¼Œåªéœ€è¦åœ¨æ‰€æœ‰è¿›ç¨‹éƒ½å¯å¼•ç”¨çš„å­˜å‚¨åŒºä¿å­˜è¿™ç§åº“ä¾‹ç¨‹çš„ä¸€ä¸ªå‰¯æœ¬ã€‚</li><li>ç¨‹åºç¬¬ä¸€æ¬¡æ‰§è¡Œæˆ–è€…ç¬¬ä¸€æ¬¡è°ƒç”¨æŸä¸ªåº“å‡½æ•°æ—¶ï¼Œç”¨åŠ¨æ€é“¾æ¥æ–¹æ³•å°†ç¨‹åºä¸å…±äº«åº“å‡½æ•°é“¾æ¥ã€‚</li><li>è¿™å‡å°‘äº†æ¯ä¸ªå¯æ‰§è¡Œæ–‡ä»¶çš„é•¿åº¦ï¼Œä½†å¢åŠ äº†ä¸€äº›è¿è¡Œæ—¶é—´å¼€é”€ã€‚è¿™ç§æ—¶é—´å¼€é”€å‘ç”Ÿåœ¨è¯¥ç¨‹åºç¬¬ä¸€æ¬¡æ‰§è¡Œæ—¶æˆ–æ¯ä¸ªå…±äº«åº“å‡½æ•°ç¬¬ä¸€æ¬¡è¢«è°ƒç”¨æ—¶ã€‚</li><li>å…±äº«åº“çš„å¦ä¸€ä¸ªä¼˜ç‚¹æ˜¯å¯ä»¥ç”¨åº“å‡½æ•°çš„æ–°ç‰ˆæœ¬ä»£æ›¿è€ç‰ˆæœ¬è€Œæ— éœ€å¯¹ä½¿ç”¨è¯¥åº“çš„ç¨‹åºé‡æ–°é“¾æ¥ç¼–è¾‘ã€‚</li></ul><h3 id="å­˜å‚¨ç©ºé—´åˆ†é…"><a href="#å­˜å‚¨ç©ºé—´åˆ†é…" class="headerlink" title="å­˜å‚¨ç©ºé—´åˆ†é…"></a>å­˜å‚¨ç©ºé—´åˆ†é…</h3><ul><li><code>malloc</code>åˆ†é…æŒ‡å®šå­—èŠ‚æ•°çš„å­˜å‚¨åŒºã€‚å…¶ä¸­çš„åˆå§‹å€¼ä¸ç¡®å®šã€‚</li><li><code>calloc</code>åˆ†é…çš„æ¯ä¸€ä½éƒ½åˆå§‹åŒ–ä¸º0ã€‚</li><li><code>realloc</code>å¢åŠ æˆ–å‡å°‘åˆ†é…åŒºé•¿åº¦ã€‚æ–°å¢åŒºåŸŸå†…åˆå§‹å€¼ä¸ç¡®å®š</li><li>è¿™äº›åˆ†é…ä¾‹ç¨‹é€šå¸¸é€šè¿‡<code>sbrk</code>ç³»ç»Ÿè°ƒç”¨å®ç°</li><li><a href="../ä¸ºä»€ä¹ˆcallocä¼šæ¯”malloc-memsetå¿«">ä¸ºä»€ä¹ˆcallocä¼šæ¯”malloc+memsetå¿«</a></li><li>å¤§éƒ¨åˆ†<code>malloc</code>å’Œ<code>free</code>çš„å®ç°éƒ½ä¸å‡å°è¿›ç¨‹çš„å­˜å‚¨ç©ºé—´ã€‚é‡Šæ”¾çš„ç©ºé—´å¯ä¾›ä»¥åå†åˆ†é…ï¼Œä½†å°†å®ƒä»¬ä¿æŒåœ¨mallocæ± ä¸­è€Œä¸è¿”å›ç»™å†…æ ¸ã€‚</li><li>å¤§å¤šæ•°å®ç°æ‰€åˆ†é…çš„å­˜å‚¨ç©ºé—´æ¯”è¦æ±‚çš„è¦å¤§ä¸€äº›ï¼Œé¢å¤–çš„ç©ºé—´ç”¨æ¥è®°å½•ç®¡ç†ä¿¡æ¯â€”â€”åˆ†é…å—çš„é•¿åº¦ã€æŒ‡å‘ä¸‹ä¸€ä¸ªåˆ†é…å—çš„æŒ‡é’ˆç­‰ã€‚</li></ul><h3 id="å†…å­˜åˆ†é…æ—¶å¸¸è§é”™è¯¯"><a href="#å†…å­˜åˆ†é…æ—¶å¸¸è§é”™è¯¯" class="headerlink" title="å†…å­˜åˆ†é…æ—¶å¸¸è§é”™è¯¯"></a>å†…å­˜åˆ†é…æ—¶å¸¸è§é”™è¯¯</h3><ul><li>åœ¨åŠ¨æ€åˆ†é…çš„ç¼“å†²åŒºå‰åè¿›è¡Œå†™æ“ä½œï¼Œç ´åç®¡ç†è®°å½•ä¿¡æ¯æˆ–ç”¨äºå…¶ä»–åŠ¨æ€åˆ†é…çš„å¯¹è±¡ã€‚</li><li>é‡Šæ”¾ä¸€ä¸ªå·²ç»é‡Šæ”¾äº†çš„å—</li><li>è°ƒç”¨freeæ—¶çš„æŒ‡é’ˆä¸æ˜¯ä¸‰ä¸ªallocå‡½æ•°çš„è¿”å›å€¼</li><li>è°ƒç”¨mallocä¸è°ƒç”¨freeï¼Œé€ æˆå†…å­˜æ³„æ¼ã€‚è¿›ç¨‹åœ°å€ç©ºé—´é•¿åº¦ä¼šæ…¢æ…¢å¢åŠ ï¼Œç›´è‡³æ²¡æœ‰ç©ºé—²ç©ºé—´ã€‚æ­¤æ—¶ç”±äºè¿‡åº¦çš„æ¢é¡µå¼€é”€ï¼Œä¼šå¯¼è‡´æ€§èƒ½ä¸‹é™ã€‚</li></ul><h3 id="setjumpä¸longjump"><a href="#setjumpä¸longjump" class="headerlink" title="setjumpä¸longjump"></a>setjumpä¸longjump</h3><ul><li>Cè¯­è¨€ä¸­gotoæ˜¯æ— æ³•è·¨åŸŸå‡½æ•°çš„ï¼Œè€Œæ‰§è¡Œè¿™ç§ç±»å‹çš„è·³è½¬åŠŸèƒ½çš„å‡½æ•°æ˜¯setjmpå’Œlongjmpã€‚</li></ul><h3 id="getrlimitå’Œsetrlimit"><a href="#getrlimitå’Œsetrlimit" class="headerlink" title="getrlimitå’Œsetrlimit"></a>getrlimitå’Œsetrlimit</h3><ul><li>æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰ä¸€ç»„èµ„æºé™åˆ¶ï¼Œç”±getrlimitå’Œsetrlimitå‡½æ•°æŸ¥è¯¢å’Œæ›´æ”¹ã€‚</li></ul>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;è¿›ç¨‹å¼€å§‹&quot;&gt;&lt;a href=&quot;#è¿›ç¨‹å¼€å§‹&quot; class=&quot;headerlink&quot; title=&quot;è¿›ç¨‹å¼€å§‹&quot;&gt;&lt;/a&gt;è¿›ç¨‹å¼€å§‹&lt;/h3&gt;   &lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;int main(int argc, char *argv[]);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;   ä»¥mainå‡½æ•°å¼€å§‹æ‰§è¡Œã€‚å½“å†…æ ¸æ‰§è¡ŒCç¨‹åºæ—¶ï¼Œåœ¨è°ƒç”¨mainå‰å…ˆè°ƒç”¨ä¸€ä¸ªç‰¹æ®Šçš„å¯åŠ¨ä¾‹ç¨‹ã€‚å¯æ‰§è¡Œç¨‹åºå°†æ­¤å¯åŠ¨ä¾‹ç¨‹æŒ‡å®šä¸ºç¨‹åºçš„èµ·å§‹åœ°å€â€”â€”è¿™æ˜¯ç”±é“¾æ¥ç¼–è¾‘å™¨è®¾ç½®çš„ï¼Œè€Œé“¾æ¥ç¼–è¾‘å™¨åˆ™ç”±Cç¼–è¯‘å™¨è°ƒç”¨ã€‚å¯åŠ¨ä¾‹ç¨‹ä»å†…æ ¸å–å¾—å‘½ä»¤è¡Œå‚æ•°å’Œç¯å¢ƒå˜é‡å€¼ï¼Œç„¶åä¸ºæŒ‰ä¸Šè¿°æ–¹å¼è°ƒç”¨åšå¥½å®‰æ’ã€‚&lt;/p&gt;
&lt;h3 id=&quot;è¿›ç¨‹ç»ˆæ­¢&quot;&gt;&lt;a href=&quot;#è¿›ç¨‹ç»ˆæ­¢&quot; class=&quot;headerlink&quot; title=&quot;è¿›ç¨‹ç»ˆæ­¢&quot;&gt;&lt;/a&gt;è¿›ç¨‹ç»ˆæ­¢&lt;/h3&gt;&lt;p&gt;   æœ‰8ç§ç»ˆæ­¢æ–¹å¼ï¼Œå‰5ç§ä¸ºæ­£å¸¸ç»ˆæ­¢ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä»mainè¿”å›&lt;/li&gt;
&lt;li&gt;è°ƒç”¨exit&lt;/li&gt;
&lt;li&gt;è°ƒç”¨_exitæˆ–_Exit&lt;/li&gt;
&lt;li&gt;æœ€åä¸€ä¸ªçº¿ç¨‹ä»å¯åŠ¨ä¾‹ç¨‹è¿”å›&lt;/li&gt;
&lt;li&gt;ä»æœ€åä¸€ä¸ªçº¿ç¨‹è°ƒç”¨pthread_exit&lt;br&gt;å¼‚å¸¸ç»ˆæ­¢æœ‰3ç§ï¼š&lt;/li&gt;
&lt;li&gt;è°ƒç”¨abort&lt;/li&gt;
&lt;li&gt;é‡åˆ°ä¸€ä¸ªä¿¡å·&lt;/li&gt;
&lt;li&gt;æœ€åä¸€ä¸ªçº¿ç¨‹å¯¹å–æ¶ˆè¯·æ±‚åšå‡ºå“åº”&lt;/li&gt;
&lt;/ol&gt;
    
    </summary>
    
    
      <category term="ã€ŠAPUEã€‹ç¬”è®°" scheme="https://akaqin.github.io/categories/%E3%80%8AAPUE%E3%80%8B%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="process" scheme="https://akaqin.github.io/tags/process/"/>
    
  </entry>
  
  <entry>
    <title>CSçŸ¥è¯†ç‚¹æ€»ç»“</title>
    <link href="https://akaqin.github.io/2019/03/17/CS%E7%9F%A5%E8%AF%86%E7%82%B9%E6%80%BB%E7%BB%93/"/>
    <id>https://akaqin.github.io/2019/03/17/CS%E7%9F%A5%E8%AF%86%E7%82%B9%E6%80%BB%E7%BB%93/</id>
    <published>2019-03-17T03:29:09.000Z</published>
    <updated>2020-03-08T07:36:37.026Z</updated>
    
    <content type="html"><![CDATA[<h2 id="è®¡ç®—æœºæ“ä½œç³»ç»Ÿ"><a href="#è®¡ç®—æœºæ“ä½œç³»ç»Ÿ" class="headerlink" title="è®¡ç®—æœºæ“ä½œç³»ç»Ÿ"></a>è®¡ç®—æœºæ“ä½œç³»ç»Ÿ</h2><h3 id="è¿›ç¨‹ä¸çº¿ç¨‹åŒºåˆ«"><a href="#è¿›ç¨‹ä¸çº¿ç¨‹åŒºåˆ«" class="headerlink" title="è¿›ç¨‹ä¸çº¿ç¨‹åŒºåˆ«"></a>è¿›ç¨‹ä¸çº¿ç¨‹åŒºåˆ«</h3><ol><li>è¿›ç¨‹æ˜¯èµ„æºåˆ†é…çš„åŸºæœ¬å•ä½ï¼Œä½†æ˜¯çº¿ç¨‹ä¸æ‹¥æœ‰èµ„æºï¼Œçº¿ç¨‹å¯ä»¥è®¿é—®éš¶å±è¿›ç¨‹çš„èµ„æºã€‚</li><li>çº¿ç¨‹æ˜¯ç‹¬ç«‹è°ƒåº¦çš„åŸºæœ¬å•ä½ï¼Œåœ¨åŒä¸€è¿›ç¨‹ä¸­ï¼Œçº¿ç¨‹çš„åˆ‡æ¢ä¸ä¼šå¼•èµ·è¿›ç¨‹åˆ‡æ¢ï¼Œä»ä¸€ä¸ªè¿›ç¨‹ä¸­çš„çº¿ç¨‹åˆ‡æ¢åˆ°å¦ä¸€ä¸ªè¿›ç¨‹ä¸­çš„çº¿ç¨‹æ—¶ï¼Œä¼šå¼•èµ·è¿›ç¨‹åˆ‡æ¢ã€‚</li><li>ç”±äºåˆ›å»ºæˆ–æ’¤é”€è¿›ç¨‹æ—¶ï¼Œç³»ç»Ÿéƒ½è¦ä¸ºä¹‹åˆ†é…æˆ–å›æ”¶èµ„æºï¼Œå¦‚å†…å­˜ç©ºé—´ã€I/O è®¾å¤‡ç­‰ï¼Œæ‰€ä»˜å‡ºçš„å¼€é”€è¿œå¤§äºåˆ›å»ºæˆ–æ’¤é”€çº¿ç¨‹æ—¶çš„å¼€é”€ã€‚ç±»ä¼¼åœ°ï¼Œåœ¨è¿›è¡Œè¿›ç¨‹åˆ‡æ¢æ—¶ï¼Œæ¶‰åŠå½“å‰æ‰§è¡Œè¿›ç¨‹ CPU ç¯å¢ƒçš„ä¿å­˜åŠæ–°è°ƒåº¦è¿›ç¨‹ CPU ç¯å¢ƒçš„è®¾ç½®ï¼Œè€Œçº¿ç¨‹åˆ‡æ¢æ—¶åªéœ€ä¿å­˜å’Œè®¾ç½®å°‘é‡å¯„å­˜å™¨å†…å®¹ï¼Œå¼€é”€å¾ˆå°ã€‚</li><li>çº¿ç¨‹é—´å¯ä»¥é€šè¿‡ç›´æ¥è¯»å†™åŒä¸€è¿›ç¨‹ä¸­çš„æ•°æ®è¿›è¡Œé€šä¿¡ï¼Œä½†æ˜¯è¿›ç¨‹é€šä¿¡éœ€è¦å€ŸåŠ© IPCã€‚</li></ol><h3 id="è¿›ç¨‹é—´é€šä¿¡"><a href="#è¿›ç¨‹é—´é€šä¿¡" class="headerlink" title="è¿›ç¨‹é—´é€šä¿¡"></a>è¿›ç¨‹é—´é€šä¿¡</h3><ol><li>ç®¡é“ï¼ˆåŠåŒå·¥ï¼Œåªèƒ½çˆ¶å­é—´ä½¿ç”¨ï¼‰</li><li>FIFOï¼ˆå‘½åç®¡é“ï¼Œå»é™¤äº†çˆ¶å­é—´é™åˆ¶ï¼‰</li><li>æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆæ¶ˆæ¯é˜Ÿåˆ—å¯ä»¥ç‹¬ç«‹äºè¯»å†™è¿›ç¨‹å­˜åœ¨ï¼Œä»è€Œé¿å…äº† FIFO ä¸­åŒæ­¥ç®¡é“çš„æ‰“å¼€å’Œå…³é—­æ—¶å¯èƒ½äº§ç”Ÿçš„å›°éš¾ï¼‰</li><li>ä¿¡å·é‡ï¼ˆä¸€ä¸ªè®¡æ•°å™¨ï¼Œç”¨äºä¸ºå¤šä¸ªè¿›ç¨‹æä¾›å¯¹å…±äº«æ•°æ®å¯¹è±¡çš„è®¿é—®ã€‚ï¼‰</li><li>å…±äº«å­˜å‚¨ï¼ˆå…è®¸å¤šä¸ªè¿›ç¨‹å…±äº«ä¸€ä¸ªç»™å®šçš„å­˜å‚¨åŒºã€‚å› ä¸ºæ•°æ®ä¸éœ€è¦åœ¨è¿›ç¨‹ä¹‹é—´å¤åˆ¶ï¼Œæ‰€ä»¥è¿™æ˜¯æœ€å¿«çš„ä¸€ç§ IPCï¼‰</li><li>å¥—æ¥å­—ï¼ˆä¸å…¶å®ƒé€šä¿¡æœºåˆ¶ä¸åŒçš„æ˜¯ï¼Œå®ƒå¯ç”¨äºä¸åŒæœºå™¨é—´çš„è¿›ç¨‹é€šä¿¡ï¼‰</li></ol><a id="more"></a><h3 id="æ­»é”"><a href="#æ­»é”" class="headerlink" title="æ­»é”"></a>æ­»é”</h3><p><strong>å¿…è¦æ¡ä»¶</strong></p><ul><li>äº’æ–¥ï¼šæ¯ä¸ªèµ„æºè¦ä¹ˆå·²ç»åˆ†é…ç»™äº†ä¸€ä¸ªè¿›ç¨‹ï¼Œè¦ä¹ˆå°±æ˜¯å¯ç”¨çš„ã€‚</li><li>å æœ‰å’Œç­‰å¾…ï¼šå·²ç»å¾—åˆ°äº†æŸä¸ªèµ„æºçš„è¿›ç¨‹å¯ä»¥å†è¯·æ±‚æ–°çš„èµ„æºã€‚</li><li>ä¸å¯æŠ¢å ï¼šå·²ç»åˆ†é…ç»™ä¸€ä¸ªè¿›ç¨‹çš„èµ„æºä¸èƒ½å¼ºåˆ¶æ€§åœ°è¢«æŠ¢å ï¼Œå®ƒåªèƒ½è¢«å æœ‰å®ƒçš„è¿›ç¨‹æ˜¾å¼åœ°é‡Šæ”¾ã€‚</li><li>ç¯è·¯ç­‰å¾…ï¼šæœ‰ä¸¤ä¸ªæˆ–è€…ä¸¤ä¸ªä»¥ä¸Šçš„è¿›ç¨‹ç»„æˆä¸€æ¡ç¯è·¯ï¼Œè¯¥ç¯è·¯ä¸­çš„æ¯ä¸ªè¿›ç¨‹éƒ½åœ¨ç­‰å¾…ä¸‹ä¸€ä¸ªè¿›ç¨‹æ‰€å æœ‰çš„èµ„æºã€‚</li></ul><p><strong>å¤„ç†æ–¹æ³•</strong></p><ul><li>é¸µé¸Ÿç­–ç•¥</li><li>æ­»é”æ£€æµ‹ä¸æ­»é”æ¢å¤</li><li>æ­»é”é¢„é˜²</li><li>æ­»é”é¿å…</li></ul>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;è®¡ç®—æœºæ“ä½œç³»ç»Ÿ&quot;&gt;&lt;a href=&quot;#è®¡ç®—æœºæ“ä½œç³»ç»Ÿ&quot; class=&quot;headerlink&quot; title=&quot;è®¡ç®—æœºæ“ä½œç³»ç»Ÿ&quot;&gt;&lt;/a&gt;è®¡ç®—æœºæ“ä½œç³»ç»Ÿ&lt;/h2&gt;&lt;h3 id=&quot;è¿›ç¨‹ä¸çº¿ç¨‹åŒºåˆ«&quot;&gt;&lt;a href=&quot;#è¿›ç¨‹ä¸çº¿ç¨‹åŒºåˆ«&quot; class=&quot;headerlink&quot; title=&quot;è¿›ç¨‹ä¸çº¿ç¨‹åŒºåˆ«&quot;&gt;&lt;/a&gt;è¿›ç¨‹ä¸çº¿ç¨‹åŒºåˆ«&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;è¿›ç¨‹æ˜¯èµ„æºåˆ†é…çš„åŸºæœ¬å•ä½ï¼Œä½†æ˜¯çº¿ç¨‹ä¸æ‹¥æœ‰èµ„æºï¼Œçº¿ç¨‹å¯ä»¥è®¿é—®éš¶å±è¿›ç¨‹çš„èµ„æºã€‚&lt;/li&gt;
&lt;li&gt;çº¿ç¨‹æ˜¯ç‹¬ç«‹è°ƒåº¦çš„åŸºæœ¬å•ä½ï¼Œåœ¨åŒä¸€è¿›ç¨‹ä¸­ï¼Œçº¿ç¨‹çš„åˆ‡æ¢ä¸ä¼šå¼•èµ·è¿›ç¨‹åˆ‡æ¢ï¼Œä»ä¸€ä¸ªè¿›ç¨‹ä¸­çš„çº¿ç¨‹åˆ‡æ¢åˆ°å¦ä¸€ä¸ªè¿›ç¨‹ä¸­çš„çº¿ç¨‹æ—¶ï¼Œä¼šå¼•èµ·è¿›ç¨‹åˆ‡æ¢ã€‚&lt;/li&gt;
&lt;li&gt;ç”±äºåˆ›å»ºæˆ–æ’¤é”€è¿›ç¨‹æ—¶ï¼Œç³»ç»Ÿéƒ½è¦ä¸ºä¹‹åˆ†é…æˆ–å›æ”¶èµ„æºï¼Œå¦‚å†…å­˜ç©ºé—´ã€I/O è®¾å¤‡ç­‰ï¼Œæ‰€ä»˜å‡ºçš„å¼€é”€è¿œå¤§äºåˆ›å»ºæˆ–æ’¤é”€çº¿ç¨‹æ—¶çš„å¼€é”€ã€‚ç±»ä¼¼åœ°ï¼Œåœ¨è¿›è¡Œè¿›ç¨‹åˆ‡æ¢æ—¶ï¼Œæ¶‰åŠå½“å‰æ‰§è¡Œè¿›ç¨‹ CPU ç¯å¢ƒçš„ä¿å­˜åŠæ–°è°ƒåº¦è¿›ç¨‹ CPU ç¯å¢ƒçš„è®¾ç½®ï¼Œè€Œçº¿ç¨‹åˆ‡æ¢æ—¶åªéœ€ä¿å­˜å’Œè®¾ç½®å°‘é‡å¯„å­˜å™¨å†…å®¹ï¼Œå¼€é”€å¾ˆå°ã€‚&lt;/li&gt;
&lt;li&gt;çº¿ç¨‹é—´å¯ä»¥é€šè¿‡ç›´æ¥è¯»å†™åŒä¸€è¿›ç¨‹ä¸­çš„æ•°æ®è¿›è¡Œé€šä¿¡ï¼Œä½†æ˜¯è¿›ç¨‹é€šä¿¡éœ€è¦å€ŸåŠ© IPCã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&quot;è¿›ç¨‹é—´é€šä¿¡&quot;&gt;&lt;a href=&quot;#è¿›ç¨‹é—´é€šä¿¡&quot; class=&quot;headerlink&quot; title=&quot;è¿›ç¨‹é—´é€šä¿¡&quot;&gt;&lt;/a&gt;è¿›ç¨‹é—´é€šä¿¡&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;ç®¡é“ï¼ˆåŠåŒå·¥ï¼Œåªèƒ½çˆ¶å­é—´ä½¿ç”¨ï¼‰&lt;/li&gt;
&lt;li&gt;FIFOï¼ˆå‘½åç®¡é“ï¼Œå»é™¤äº†çˆ¶å­é—´é™åˆ¶ï¼‰&lt;/li&gt;
&lt;li&gt;æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆæ¶ˆæ¯é˜Ÿåˆ—å¯ä»¥ç‹¬ç«‹äºè¯»å†™è¿›ç¨‹å­˜åœ¨ï¼Œä»è€Œé¿å…äº† FIFO ä¸­åŒæ­¥ç®¡é“çš„æ‰“å¼€å’Œå…³é—­æ—¶å¯èƒ½äº§ç”Ÿçš„å›°éš¾ï¼‰&lt;/li&gt;
&lt;li&gt;ä¿¡å·é‡ï¼ˆä¸€ä¸ªè®¡æ•°å™¨ï¼Œç”¨äºä¸ºå¤šä¸ªè¿›ç¨‹æä¾›å¯¹å…±äº«æ•°æ®å¯¹è±¡çš„è®¿é—®ã€‚ï¼‰&lt;/li&gt;
&lt;li&gt;å…±äº«å­˜å‚¨ï¼ˆå…è®¸å¤šä¸ªè¿›ç¨‹å…±äº«ä¸€ä¸ªç»™å®šçš„å­˜å‚¨åŒºã€‚å› ä¸ºæ•°æ®ä¸éœ€è¦åœ¨è¿›ç¨‹ä¹‹é—´å¤åˆ¶ï¼Œæ‰€ä»¥è¿™æ˜¯æœ€å¿«çš„ä¸€ç§ IPCï¼‰&lt;/li&gt;
&lt;li&gt;å¥—æ¥å­—ï¼ˆä¸å…¶å®ƒé€šä¿¡æœºåˆ¶ä¸åŒçš„æ˜¯ï¼Œå®ƒå¯ç”¨äºä¸åŒæœºå™¨é—´çš„è¿›ç¨‹é€šä¿¡ï¼‰&lt;/li&gt;
&lt;/ol&gt;
    
    </summary>
    
    
      <category term="çŸ¥è¯†ç‚¹æ€»ç»“" scheme="https://akaqin.github.io/categories/%E7%9F%A5%E8%AF%86%E7%82%B9%E6%80%BB%E7%BB%93/"/>
    
    
      <category term="CS" scheme="https://akaqin.github.io/tags/CS/"/>
    
  </entry>
  
  <entry>
    <title>MySQLçŸ¥è¯†ç‚¹æ•´ç†</title>
    <link href="https://akaqin.github.io/2019/03/01/MySQL%E7%9F%A5%E8%AF%86%E7%82%B9%E6%95%B4%E7%90%86/"/>
    <id>https://akaqin.github.io/2019/03/01/MySQL%E7%9F%A5%E8%AF%86%E7%82%B9%E6%95%B4%E7%90%86/</id>
    <published>2019-03-01T01:36:09.000Z</published>
    <updated>2020-03-08T07:39:43.610Z</updated>
    
    <content type="html"><![CDATA[<h3 id="InnoDBä¸MyISAMåŒºåˆ«ï¼š"><a href="#InnoDBä¸MyISAMåŒºåˆ«ï¼š" class="headerlink" title="InnoDBä¸MyISAMåŒºåˆ«ï¼š"></a>InnoDBä¸MyISAMåŒºåˆ«ï¼š</h3><ol><li>InnoDBæ”¯æŒäº‹åŠ¡ï¼ŒMyISAMä¸æ”¯æŒï¼Œå¯¹äºInnoDBæ¯ä¸€æ¡SQLè¯­è¨€éƒ½é»˜è®¤å°è£…æˆäº‹åŠ¡ï¼Œè‡ªåŠ¨æäº¤ï¼Œè¿™æ ·ä¼šå½±å“é€Ÿåº¦ï¼Œæ‰€ä»¥æœ€å¥½æŠŠå¤šæ¡SQLè¯­è¨€æ”¾åœ¨beginå’Œcommitä¹‹é—´ï¼Œç»„æˆä¸€ä¸ªäº‹åŠ¡ï¼›</li><li>InnoDBæ”¯æŒå¤–é”®ï¼Œè€ŒMyISAMä¸æ”¯æŒã€‚å¯¹ä¸€ä¸ªåŒ…å«å¤–é”®çš„InnoDBè¡¨è½¬ä¸ºMYISAMä¼šå¤±è´¥ï¼›</li><li>InnoDBæ˜¯èšé›†ç´¢å¼•ï¼Œæ•°æ®æ–‡ä»¶æ˜¯å’Œç´¢å¼•ç»‘åœ¨ä¸€èµ·çš„ï¼Œå¿…é¡»è¦æœ‰ä¸»é”®ï¼Œé€šè¿‡ä¸»é”®ç´¢å¼•æ•ˆç‡å¾ˆé«˜ã€‚ä½†æ˜¯è¾…åŠ©ç´¢å¼•éœ€è¦ä¸¤æ¬¡æŸ¥è¯¢ï¼Œå…ˆæŸ¥è¯¢åˆ°ä¸»é”®ï¼Œç„¶åå†é€šè¿‡ä¸»é”®æŸ¥è¯¢åˆ°æ•°æ®ã€‚å› æ­¤ï¼Œä¸»é”®ä¸åº”è¯¥è¿‡å¤§ï¼Œå› ä¸ºä¸»é”®å¤ªå¤§ï¼Œå…¶ä»–ç´¢å¼•ä¹Ÿéƒ½ä¼šå¾ˆå¤§ã€‚è€ŒMyISAMæ˜¯éèšé›†ç´¢å¼•ï¼Œæ•°æ®æ–‡ä»¶æ˜¯åˆ†ç¦»çš„ï¼Œç´¢å¼•ä¿å­˜çš„æ˜¯æ•°æ®æ–‡ä»¶çš„æŒ‡é’ˆã€‚ä¸»é”®ç´¢å¼•å’Œè¾…åŠ©ç´¢å¼•æ˜¯ç‹¬ç«‹çš„ã€‚</li><li>InnoDBä¸ä¿å­˜è¡¨çš„å…·ä½“è¡Œæ•°ï¼Œæ‰§è¡Œselect count(*) from tableæ—¶éœ€è¦å…¨è¡¨æ‰«æã€‚è€ŒMyISAMç”¨ä¸€ä¸ªå˜é‡ä¿å­˜äº†æ•´ä¸ªè¡¨çš„è¡Œæ•°ï¼Œæ‰§è¡Œä¸Šè¿°è¯­å¥æ—¶åªéœ€è¦è¯»å‡ºè¯¥å˜é‡å³å¯ï¼Œé€Ÿåº¦å¾ˆå¿«ï¼›</li><li>Innodbä¸æ”¯æŒå…¨æ–‡ç´¢å¼•ï¼Œè€ŒMyISAMæ”¯æŒå…¨æ–‡ç´¢å¼•ï¼ŒæŸ¥è¯¢æ•ˆç‡ä¸ŠMyISAMè¦é«˜ï¼›</li></ol><h3 id="å¦‚ä½•é€‰æ‹©ï¼š"><a href="#å¦‚ä½•é€‰æ‹©ï¼š" class="headerlink" title="å¦‚ä½•é€‰æ‹©ï¼š"></a>å¦‚ä½•é€‰æ‹©ï¼š</h3><ol><li>æ˜¯å¦è¦æ”¯æŒäº‹åŠ¡ï¼Œå¦‚æœè¦è¯·é€‰æ‹©innodbï¼Œå¦‚æœä¸éœ€è¦å¯ä»¥è€ƒè™‘MyISAMï¼›</li><li>å¦‚æœè¡¨ä¸­ç»å¤§å¤šæ•°éƒ½åªæ˜¯è¯»æŸ¥è¯¢ï¼Œå¯ä»¥è€ƒè™‘MyISAMï¼Œå¦‚æœæ—¢æœ‰è¯»å†™ä¹ŸæŒºé¢‘ç¹ï¼Œè¯·ä½¿ç”¨InnoDBã€‚</li><li>ç³»ç»Ÿå¥”æºƒåï¼ŒMyISAMæ¢å¤èµ·æ¥æ›´å›°éš¾ï¼Œèƒ½å¦æ¥å—ï¼›</li></ol><a id="more"></a><h3 id="varcharå’Œcharçš„åŒºåˆ«ï¼š"><a href="#varcharå’Œcharçš„åŒºåˆ«ï¼š" class="headerlink" title="varcharå’Œcharçš„åŒºåˆ«ï¼š"></a>varcharå’Œcharçš„åŒºåˆ«ï¼š</h3><ol><li>char(M)ç±»å‹çš„æ•°æ®åˆ—é‡Œï¼Œæ¯ä¸ªå€¼éƒ½å ç”¨Mä¸ªå­—èŠ‚ï¼Œå¦‚æœæŸä¸ªé•¿åº¦å°äºMï¼ŒMySQLå°±ä¼šåœ¨å®ƒçš„å³è¾¹ç”¨ç©ºæ ¼å­—ç¬¦è¡¥è¶³ï¼ï¼ˆåœ¨æ£€ç´¢æ“ä½œä¸­é‚£äº›å¡«è¡¥å‡ºæ¥çš„ç©ºæ ¼å­—ç¬¦å°†è¢«å»æ‰ï¼‰</li><li>åœ¨varchar(M)ç±»å‹çš„æ•°æ®åˆ—é‡Œï¼Œæ¯ä¸ªå€¼åªå ç”¨åˆšå¥½å¤Ÿç”¨çš„å­—èŠ‚å†åŠ ä¸Šä¸€ä¸ªç”¨æ¥è®°å½•å…¶é•¿åº¦çš„å­—èŠ‚ï¼ˆå³æ€»é•¿åº¦ä¸ºL+1å­—èŠ‚ï¼‰ï¼</li><li>varcharæœ€å¤šèƒ½å­˜å‚¨65535ä¸ªå­—èŠ‚çš„æ•°æ®ã€‚varchar çš„æœ€å¤§é•¿åº¦å—é™äºæœ€å¤§è¡Œé•¿åº¦ï¼ˆmax row sizeï¼Œ65535bytesï¼‰ã€‚65535å¹¶ä¸æ˜¯ä¸€ä¸ªå¾ˆç²¾ç¡®çš„ä¸Šé™ï¼Œå¯ä»¥ç»§ç»­ç¼©å°è¿™ä¸ªä¸Šé™ã€‚65535ä¸ªå­—èŠ‚åŒ…æ‹¬æ‰€æœ‰å­—æ®µçš„é•¿åº¦ï¼Œå˜é•¿å­—æ®µçš„é•¿åº¦æ ‡è¯†ï¼ˆæ¯ä¸ªå˜é•¿å­—æ®µé¢å¤–ä½¿ç”¨1æˆ–è€…2ä¸ªå­—èŠ‚è®°å½•å®é™…æ•°æ®é•¿åº¦ï¼‰ã€NULLæ ‡è¯†ä½çš„ç´¯è®¡ã€‚</li></ol><h3 id="nullä¸æœ€å¤§é•¿åº¦"><a href="#nullä¸æœ€å¤§é•¿åº¦" class="headerlink" title="nullä¸æœ€å¤§é•¿åº¦:"></a>nullä¸æœ€å¤§é•¿åº¦:</h3><ol><li>NULLæ ‡è¯†ä½ï¼Œå¦‚æœvarcharå­—æ®µå®šä¹‰ä¸­å¸¦æœ‰default nullå…è®¸åˆ—ç©º,åˆ™éœ€è¦éœ€è¦1bitæ¥æ ‡è¯†ï¼Œæ¯8ä¸ªbitsçš„æ ‡è¯†ç»„æˆä¸€ä¸ªå­—æ®µã€‚ä¸€å¼ è¡¨ä¸­å­˜åœ¨Nä¸ªvarcharå­—æ®µï¼Œé‚£ä¹ˆéœ€è¦ï¼ˆN+7ï¼‰/8 ï¼ˆå–æ•´ï¼‰byteså­˜å‚¨æ‰€æœ‰çš„NULLæ ‡è¯†ä½</li><li>å¦‚æœæ•°æ®è¡¨åªæœ‰ä¸€ä¸ªvarcharå­—æ®µä¸”è¯¥å­—æ®µDEFAULT NULLï¼Œé‚£ä¹ˆè¯¥varcharå­—æ®µçš„æœ€å¤§é•¿åº¦ä¸º65532ä¸ªå­—èŠ‚ï¼Œå³65535-2-1=65532 byteã€‚</li><li>å¦‚æœæ•°æ®è¡¨åªæœ‰ä¸€ä¸ªvarcharå­—æ®µä¸”è¯¥å­—æ®µNOT NULLï¼Œé‚£ä¹ˆè¯¥varcharå­—æ®µçš„æœ€å¤§é•¿åº¦ä¸º65533ä¸ªå­—èŠ‚ï¼Œå³65535-2=65533byte</li><li>å­—ç¬¦ç±»å‹è‹¥ä¸ºgbkï¼Œæ¯ä¸ªå­—ç¬¦æœ€å¤šå 2ä¸ªå­—èŠ‚ï¼Œæœ€å¤§é•¿åº¦ä¸èƒ½è¶…è¿‡32766;</li><li>å­—ç¬¦ç±»å‹è‹¥ä¸ºutf8ï¼Œæ¯ä¸ªå­—ç¬¦æœ€å¤šå 3ä¸ªå­—èŠ‚ï¼Œæœ€å¤§é•¿åº¦ä¸èƒ½è¶…è¿‡21845ã€‚</li><li>è‹¥å®šä¹‰çš„æ—¶å€™è¶…è¿‡ä¸Šè¿°é™åˆ¶ï¼Œåˆ™varcharå­—æ®µä¼šè¢«å¼ºè¡Œè½¬ä¸ºtextç±»å‹ï¼Œå¹¶äº§ç”Ÿwarningã€‚</li></ol><h3 id="utf8-ä¸-utf8mb4-ï¼š"><a href="#utf8-ä¸-utf8mb4-ï¼š" class="headerlink" title="utf8 ä¸ utf8mb4 ï¼š"></a>utf8 ä¸ utf8mb4 ï¼š</h3><ol><li>utf-8ä¸­ï¼Œä¸€ä¸ªå­—ç¬¦æœ€å¤š3å­—èŠ‚ï¼ˆæ±‰å­—3å­—èŠ‚ï¼Œè‹±æ–‡å­—æ¯1å­—èŠ‚ï¼‰ã€‚</li><li>utf8_mb4æ˜¯utf8çš„è¶…é›†ï¼Œä¸€ä¸ªå­—ç¬¦æœ€å¤š4å­—èŠ‚ï¼Œæ”¯æŒè¡¥å……å­—ç¬¦ã€‚</li></ol><p>** 3ã€varcharç‰©ç†å­˜å‚¨**</p><p><strong>åœ¨ç‰©ç†å­˜å‚¨ä¸Šï¼Œvarcharä½¿ç”¨1åˆ°2ä¸ªé¢å¤–çš„å­—èŠ‚è¡¨ç¤ºå®é™…å­˜å‚¨çš„å­—ç¬¦ä¸²é•¿åº¦ï¼ˆbytesï¼‰ã€‚å¦‚æœåˆ—çš„æœ€å¤§é•¿åº¦å°äº256ä¸ªå­—èŠ‚ï¼Œç”¨ä¸€ä¸ªå­—èŠ‚è¡¨ç¤ºï¼ˆæ ‡è¯†ï¼‰ã€‚å¦‚æœæœ€å¤§é•¿åº¦å¤§äºç­‰äº256ï¼Œä½¿ç”¨ä¸¤ä¸ªå­—èŠ‚ã€‚</strong></p><p><strong>å½“é€‰æ‹©çš„å­—ç¬¦é›†ä¸ºlatin1ï¼Œä¸€ä¸ªå­—ç¬¦å ç”¨ä¸€ä¸ªbyte</strong></p><p><strong>varchar(255)å­˜å‚¨ä¸€ä¸ªå­—ç¬¦ï¼Œä¸€å…±ä½¿ç”¨2ä¸ªbytesç‰©ç†ç©ºé—´å­˜å‚¨æ•°æ®å®é™…æ•°æ®é•¿åº¦å’Œæ•°æ®å€¼ã€‚</strong></p><p><strong>varchar(256)å­˜å‚¨ä¸€ä¸ªå­—ç¬¦ï¼Œä½¿ç”¨2 bytesè¡¨ç¤ºå®é™…æ•°æ®é•¿åº¦ï¼Œä¸€å…±éœ€è¦3 bytesç‰©ç†å­˜å‚¨ç©ºé—´ã€‚</strong></p><p><strong>varcharå¯¹äºä¸åŒçš„RDBMSå¼•æ“ï¼Œæœ‰ä¸é€šçš„ç‰©ç†å­˜å‚¨æ–¹å¼ï¼Œè™½ç„¶æœ‰ç»Ÿä¸€çš„é€»è¾‘æ„ä¹‰ã€‚å¯¹äºmysqlçš„ä¸åŒå­˜å‚¨å¼•æ“ï¼Œå…¶å®ç°æ–¹æ³•ä¸æ•°æ®çš„ç‰©ç†å­˜æ”¾æ–¹å¼ä¹Ÿä¸åŒã€‚</strong></p><p><strong>4ã€InnoDBä¸­çš„varchar</strong></p><p><strong>InnoDBä¸­varcharçš„ç‰©ç†å­˜å‚¨æ–¹å¼ä¸InnoDBä½¿ç”¨çš„innodb_file_formatæœ‰å…³ã€‚æ—©æœŸçš„innodb_file_formaä½¿ç”¨çš„Antelopeæ–‡ä»¶æ ¼å¼ï¼Œæ”¯æŒredundantå’Œcompactä¸¤ç§row_formatã€‚ä»5.5å¼€å§‹æˆ–è€…InnoDB1.1ï¼Œå¯ä»¥ä½¿ç”¨ä¸€ç§æ–°çš„file formatï¼ŒBarracudaã€‚Barracudaå…¼å®¹Redundantï¼Œå¦å¤–è¿˜æ”¯æŒdynamicå’Œcompressedä¸¤ç§row_format.</strong></p><p><strong>å½“innodb_file_format=Antelopeï¼ŒROW_FORMAT=REDUNDANT æˆ–è€…COMPACTã€‚</strong></p><p><strong>innodbçš„èšé›†ç´¢å¼•ï¼ˆcluster indexï¼‰ä»…ä»…å­˜å‚¨varcharã€textã€blobå­—æ®µçš„å‰768ä¸ªå­—èŠ‚ï¼Œå¤šä½™çš„å­—èŠ‚å­˜å‚¨åœ¨ä¸€ä¸ªç‹¬ç«‹çš„overflow pageä¸­ï¼Œè¿™ä¸ªåˆ—ä¹Ÿè¢«ç§°ä½œoff-pageã€‚768ä¸ªå­—èŠ‚å‰ç¼€åé¢ç´§è·Ÿç€20å­—èŠ‚æŒ‡é’ˆï¼ŒæŒ‡å‘overflow pagesçš„ä½ç½®ã€‚</strong></p><p><strong>å¦å¤–ï¼Œåœ¨innodb_file_format=Antelopeæƒ…å†µä¸‹ï¼ŒInnoDBä¸­æœ€å¤šèƒ½å­˜å‚¨10ä¸ªå¤§å­—æ®µï¼ˆéœ€è¦ä½¿ç”¨off-pageå­˜å‚¨ï¼‰ã€‚innodbdçš„é»˜è®¤page sizeä¸º16KBï¼ŒInnoDBå•è¡Œçš„é•¿åº¦ä¸èƒ½è¶…è¿‡16k/2=8kä¸ªå­—èŠ‚ï¼Œï¼ˆ768+20ï¼‰*10 &lt; 8kã€‚</strong></p><p><strong>å½“innodb_file_format=Barracuda, ROW_FORMAT=DYNAMIC æˆ–è€… COMPRESSED</strong></p><p><strong>innodbä¸­æ‰€æœ‰çš„varcharã€textã€blobå­—æ®µæ•°æ®æ˜¯å¦å®Œå…¨off-pageå­˜å‚¨ï¼Œæ ¹æ®è¯¥å­—æ®µçš„é•¿åº¦å’Œæ•´è¡Œçš„æ€»é•¿åº¦è€Œå®šã€‚å¯¹off-pageå­˜å‚¨çš„åˆ—ï¼Œcluster indexä¸­ä»…ä»…å­˜å‚¨20å­—èŠ‚çš„æŒ‡é’ˆï¼ŒæŒ‡å‘å®é™…çš„overflow pageå­˜å‚¨ä½ç½®ã€‚å¦‚æœå•è¡Œçš„é•¿åº¦å¤ªå¤§è€Œä¸èƒ½å®Œå…¨é€‚é…cluster index pageï¼Œinnodbå°†ä¼šé€‰æ‹©æœ€é•¿çš„åˆ—ä½œä¸ºoff-pageå­˜å‚¨ï¼Œç›´åˆ°è¡Œçš„é•¿åº¦èƒ½å¤Ÿé€‚é…cluster index pageã€‚</strong></p><p><strong>5ã€MyISAMä¸­çš„varchar</strong></p><p><strong>å¯¹äºMyISAMå¼•æ“ï¼Œvarcharå­—æ®µæ‰€æœ‰æ•°æ®å­˜å‚¨åœ¨æ•°æ®è¡Œå†…ï¼ˆin-lineï¼‰ã€‚myisamè¡¨çš„row_formatä¹Ÿå½±å“åˆ°varcharçš„ç‰©ç†å­˜å‚¨è¡Œä¸ºã€‚</strong></p><p><strong>MyISAMçš„row_formatå¯ä»¥é€šè¿‡createæˆ–è€…alter sqlè¯­å¥è®¾ä¸ºfixedå’Œdynamicã€‚å¦å¤–å¯ä»¥é€šè¿‡myisampackç”Ÿæˆrow_format=compresseçš„å­˜å‚¨æ ¼å¼ã€‚</strong></p><p><strong>å½“myisamè¡¨ä¸­ä¸å­˜åœ¨textæˆ–è€…blobç±»å‹çš„å­—æ®µï¼Œé‚£ä¹ˆå¯ä»¥æŠŠrow_formatè®¾ç½®ä¸ºfixed(ä¹Ÿå¯ä»¥ä¸ºdynamic)ï¼Œå¦åˆ™åªèƒ½ä¸ºdynamicã€‚</strong></p><p><strong>å½“è¡¨ä¸­å­˜åœ¨varcharå­—æ®µçš„æ—¶å€™ï¼Œrow_formatå¯ä»¥è®¾å®šä¸ºfixedæˆ–è€…dynamicã€‚ä½¿ç”¨row_format=fixedå­˜å‚¨varcharå­—æ®µæ•°æ®ï¼Œæµªè´¹å­˜å‚¨ç©ºé—´ï¼Œvarcharæ­¤æ—¶ä¼šå®šé•¿å­˜å‚¨ã€‚row_formatä¸ºfixedå’Œdynamicï¼Œvarcharçš„ç‰©ç†å®ç°æ–¹å¼ä¹Ÿä¸åŒï¼ˆå¯ä»¥æŸ¥çœ‹æºä»£ç æ–‡ä»¶field.hå’Œfield.ccï¼‰ï¼Œå› è€Œmyisamçš„row_formatåœ¨fixedå’Œdynamicä¹‹é—´å‘ç”Ÿè½¬æ¢çš„æ—¶å€™ï¼Œvarcharå­—æ®µçš„ç‰©ç†å­˜å‚¨æ–¹å¼ä¹Ÿå°†ä¼šå‘ç”Ÿå˜åŒ–ã€‚</strong></p><h3 id="éš”ç¦»çº§åˆ«ï¼š"><a href="#éš”ç¦»çº§åˆ«ï¼š" class="headerlink" title="éš”ç¦»çº§åˆ«ï¼š"></a>éš”ç¦»çº§åˆ«ï¼š</h3><p><strong>ä¸€ã€é¦–å…ˆä»€ä¹ˆæ˜¯äº‹åŠ¡ï¼Ÿ</strong></p><p>äº‹åŠ¡æ˜¯åº”ç”¨ç¨‹åºä¸­ä¸€ç³»åˆ—ä¸¥å¯†çš„æ“ä½œï¼Œæ‰€æœ‰æ“ä½œå¿…é¡»æˆåŠŸå®Œæˆï¼Œå¦åˆ™åœ¨æ¯ä¸ªæ“ä½œä¸­æ‰€ä½œçš„æ‰€æœ‰æ›´æ”¹éƒ½ä¼šè¢«æ’¤æ¶ˆã€‚ä¹Ÿå°±æ˜¯äº‹åŠ¡å…·æœ‰åŸå­æ€§ï¼Œä¸€ä¸ªäº‹åŠ¡ä¸­çš„ä¸€ç³»åˆ—çš„æ“ä½œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆä¸€ä¸ªéƒ½ä¸åšã€‚</p><p>äº‹åŠ¡çš„ç»“æŸæœ‰ä¸¤ç§ï¼Œå½“äº‹åŠ¡ä¸­çš„æ‰€æœ‰æ­¥éª¤å…¨éƒ¨æˆåŠŸæ‰§è¡Œæ—¶ï¼Œäº‹åŠ¡æäº¤ã€‚å¦‚æœå…¶ä¸­ä¸€ä¸ªæ­¥éª¤å¤±è´¥ï¼Œå°†å‘ç”Ÿå›æ»šæ“ä½œï¼Œæ’¤æ¶ˆäº‹åŠ¡å¼€å§‹æ—¶çš„æ‰€æœ‰æ“ä½œã€‚</p><p><strong>äºŒã€äº‹åŠ¡çš„ACID</strong></p><p>äº‹åŠ¡å…·æœ‰å››ä¸ªç‰¹å¾ï¼šåŸå­æ€§ï¼ˆ Atomicity ï¼‰ã€ä¸€è‡´æ€§ï¼ˆ Consistency ï¼‰ã€éš”ç¦»æ€§ï¼ˆ Isolation ï¼‰å’ŒæŒç»­æ€§ï¼ˆ Durability ï¼‰ã€‚è¿™å››ä¸ªç‰¹æ€§ç®€ç§°ä¸º ACID ç‰¹æ€§ã€‚</p><p>1 ã€åŸå­æ€§ã€‚äº‹åŠ¡æ˜¯æ•°æ®åº“çš„é€»è¾‘å·¥ä½œå•ä½ï¼Œäº‹åŠ¡ä¸­åŒ…å«çš„å„æ“ä½œè¦ä¹ˆéƒ½åšï¼Œè¦ä¹ˆéƒ½ä¸åšã€‚</p><p>2 ã€ä¸€è‡´æ€§ã€‚äº‹åŠ¡æ‰§è¡Œçš„ç»“æœå¿…é¡»æ˜¯ä½¿æ•°æ®åº“ä»ä¸€ä¸ªä¸€è‡´æ€§çŠ¶æ€å˜åˆ°å¦ä¸€ä¸ªä¸€è‡´æ€§çŠ¶æ€ã€‚å› æ­¤å½“æ•°æ®åº“åªåŒ…å«æˆåŠŸäº‹åŠ¡æäº¤çš„ç»“æœæ—¶ï¼Œå°±è¯´æ•°æ®åº“å¤„äºä¸€è‡´æ€§çŠ¶æ€ã€‚å¦‚æœæ•°æ®åº“ç³»ç»Ÿè¿è¡Œä¸­å‘ç”Ÿæ•…éšœï¼Œæœ‰äº›äº‹åŠ¡å°šæœªå®Œæˆå°±è¢«è¿«ä¸­æ–­ï¼Œè¿™äº›æœªå®Œæˆäº‹åŠ¡å¯¹æ•°æ®åº“æ‰€åšçš„ä¿®æ”¹æœ‰ä¸€éƒ¨åˆ†å·²å†™å…¥ç‰©ç†æ•°æ®åº“ï¼Œè¿™æ—¶æ•°æ®åº“å°±å¤„äºä¸€ç§ä¸æ­£ç¡®çš„çŠ¶æ€ï¼Œæˆ–è€…è¯´æ˜¯ä¸ä¸€è‡´çš„çŠ¶æ€ã€‚</p><p>3 ã€éš”ç¦»æ€§ã€‚ä¸€ä¸ªäº‹åŠ¡çš„æ‰§è¡Œä¸èƒ½è¢«å…¶å®ƒäº‹åŠ¡å¹²æ‰°ã€‚å³ä¸€ä¸ªäº‹åŠ¡å†…éƒ¨çš„æ“ä½œåŠä½¿ç”¨çš„æ•°æ®å¯¹å…¶å®ƒå¹¶å‘äº‹åŠ¡æ˜¯éš”ç¦»çš„ï¼Œå¹¶å‘æ‰§è¡Œçš„å„ä¸ªäº‹åŠ¡ä¹‹é—´ä¸èƒ½äº’ç›¸å¹²æ‰°ã€‚</p><p>4 ã€æŒç»­æ€§ã€‚ä¹Ÿç§°æ°¸ä¹…æ€§ï¼ŒæŒ‡ä¸€ä¸ªäº‹åŠ¡ä¸€æ—¦æäº¤ï¼Œå®ƒå¯¹æ•°æ®åº“ä¸­çš„æ•°æ®çš„æ”¹å˜å°±åº”è¯¥æ˜¯æ°¸ä¹…æ€§çš„ã€‚æ¥ä¸‹æ¥çš„å…¶å®ƒæ“ä½œæˆ–æ•…éšœä¸åº”è¯¥å¯¹å…¶æ‰§è¡Œç»“æœæœ‰ä»»ä½•å½±å“ã€‚</p><p><strong>ä¸‰ã€MySQLçš„å››ç§éš”ç¦»çº§åˆ«</strong></p><p>SQLæ ‡å‡†å®šä¹‰äº†4ç±»éš”ç¦»çº§åˆ«ï¼ŒåŒ…æ‹¬äº†ä¸€äº›å…·ä½“è§„åˆ™ï¼Œç”¨æ¥é™å®šäº‹åŠ¡å†…å¤–çš„å“ªäº›æ”¹å˜æ˜¯å¯è§çš„ï¼Œå“ªäº›æ˜¯ä¸å¯è§çš„ã€‚ä½çº§åˆ«çš„éš”ç¦»çº§ä¸€èˆ¬æ”¯æŒæ›´é«˜çš„å¹¶å‘å¤„ç†ï¼Œå¹¶æ‹¥æœ‰æ›´ä½çš„ç³»ç»Ÿå¼€é”€ã€‚</p><p><strong>Read Uncommittedï¼ˆè¯»å–æœªæäº¤å†…å®¹ï¼‰</strong></p><p>åœ¨è¯¥éš”ç¦»çº§åˆ«ï¼Œæ‰€æœ‰äº‹åŠ¡éƒ½å¯ä»¥çœ‹åˆ°å…¶ä»–æœªæäº¤äº‹åŠ¡çš„æ‰§è¡Œç»“æœã€‚æœ¬éš”ç¦»çº§åˆ«å¾ˆå°‘ç”¨äºå®é™…åº”ç”¨ï¼Œå› ä¸ºå®ƒçš„æ€§èƒ½ä¹Ÿä¸æ¯”å…¶ä»–çº§åˆ«å¥½å¤šå°‘ã€‚è¯»å–æœªæäº¤çš„æ•°æ®ï¼Œä¹Ÿè¢«ç§°ä¹‹ä¸ºè„è¯»ï¼ˆDirty Readï¼‰ã€‚</p><p><strong>Read Committedï¼ˆè¯»å–æäº¤å†…å®¹ï¼‰</strong></p><p>è¿™æ˜¯å¤§å¤šæ•°æ•°æ®åº“ç³»ç»Ÿçš„é»˜è®¤éš”ç¦»çº§åˆ«ï¼ˆä½†ä¸æ˜¯MySQLé»˜è®¤çš„ï¼‰ã€‚å®ƒæ»¡è¶³äº†éš”ç¦»çš„ç®€å•å®šä¹‰ï¼šä¸€ä¸ªäº‹åŠ¡åªèƒ½çœ‹è§å·²ç»æäº¤äº‹åŠ¡æ‰€åšçš„æ”¹å˜ã€‚è¿™ç§éš”ç¦»çº§åˆ«ä¹Ÿæ”¯æŒæ‰€è°“çš„ä¸å¯é‡å¤è¯»ï¼ˆNonrepeatable Readï¼‰ï¼Œå› ä¸ºåŒä¸€äº‹åŠ¡çš„å…¶ä»–å®ä¾‹åœ¨è¯¥å®ä¾‹å¤„ç†æœŸé—´å¯èƒ½ä¼šæœ‰æ–°çš„commitï¼Œæ‰€ä»¥åŒä¸€selectå¯èƒ½è¿”å›ä¸åŒç»“æœã€‚</p><p><strong>Repeatable Readï¼ˆå¯é‡è¯»ï¼‰</strong></p><p>è¿™æ˜¯MySQLçš„é»˜è®¤äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼Œå®ƒç¡®ä¿åŒä¸€äº‹åŠ¡çš„å¤šä¸ªå®ä¾‹åœ¨å¹¶å‘è¯»å–æ•°æ®æ—¶ï¼Œä¼šçœ‹åˆ°åŒæ ·çš„æ•°æ®è¡Œã€‚ä¸è¿‡ç†è®ºä¸Šï¼Œè¿™ä¼šå¯¼è‡´å¦ä¸€ä¸ªæ£˜æ‰‹çš„é—®é¢˜ï¼šå¹»è¯» ï¼ˆPhantom Readï¼‰ã€‚ç®€å•çš„è¯´ï¼Œå¹»è¯»æŒ‡å½“ç”¨æˆ·è¯»å–æŸä¸€èŒƒå›´çš„æ•°æ®è¡Œæ—¶ï¼Œå¦ä¸€ä¸ªäº‹åŠ¡åˆåœ¨è¯¥èŒƒå›´å†…æ’å…¥äº†æ–°è¡Œï¼Œå½“ç”¨æˆ·å†è¯»å–è¯¥èŒƒå›´çš„æ•°æ®è¡Œæ—¶ï¼Œä¼šå‘ç°æœ‰æ–°çš„â€œå¹»å½±â€ è¡Œã€‚InnoDBå’ŒFalconå­˜å‚¨å¼•æ“é€šè¿‡å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼ˆMVCCï¼ŒMultiversion Concurrency Controlï¼‰æœºåˆ¶è§£å†³äº†è¯¥é—®é¢˜ã€‚</p><p><strong>Serializableï¼ˆå¯ä¸²è¡ŒåŒ–ï¼‰</strong></p><p>è¿™æ˜¯æœ€é«˜çš„éš”ç¦»çº§åˆ«ï¼Œå®ƒé€šè¿‡å¼ºåˆ¶äº‹åŠ¡æ’åºï¼Œä½¿ä¹‹ä¸å¯èƒ½ç›¸äº’å†²çªï¼Œä»è€Œè§£å†³å¹»è¯»é—®é¢˜ã€‚ç®€è¨€ä¹‹ï¼Œå®ƒæ˜¯åœ¨æ¯ä¸ªè¯»çš„æ•°æ®è¡Œä¸ŠåŠ ä¸Šå…±äº«é”ã€‚åœ¨è¿™ä¸ªçº§åˆ«ï¼Œå¯èƒ½å¯¼è‡´å¤§é‡çš„è¶…æ—¶ç°è±¡å’Œé”ç«äº‰ã€‚</p><p>è¿™å››ç§éš”ç¦»çº§åˆ«é‡‡å–ä¸åŒçš„é”ç±»å‹æ¥å®ç°ï¼Œè‹¥è¯»å–çš„æ˜¯åŒä¸€ä¸ªæ•°æ®çš„è¯ï¼Œå°±å®¹æ˜“å‘ç”Ÿé—®é¢˜ã€‚</p><p>è„è¯»(Drity Read)ï¼šæŸä¸ªäº‹åŠ¡å·²æ›´æ–°ä¸€ä»½æ•°æ®ï¼Œå¦ä¸€ä¸ªäº‹åŠ¡åœ¨æ­¤æ—¶è¯»å–äº†åŒä¸€ä»½æ•°æ®ï¼Œç”±äºæŸäº›åŸå› ï¼Œå‰ä¸€ä¸ªRollBackäº†æ“ä½œï¼Œåˆ™åä¸€ä¸ªäº‹åŠ¡æ‰€è¯»å–çš„æ•°æ®å°±ä¼šæ˜¯ä¸æ­£ç¡®çš„ã€‚</p><p>ä¸å¯é‡å¤è¯»(Non-repeatable read)ï¼šåœ¨ä¸€ä¸ªäº‹åŠ¡çš„ä¸¤æ¬¡æŸ¥è¯¢ä¹‹ä¸­æ•°æ®ä¸ä¸€è‡´ï¼Œè¿™å¯èƒ½æ˜¯ä¸¤æ¬¡æŸ¥è¯¢è¿‡ç¨‹ä¸­é—´æ’å…¥äº†ä¸€ä¸ªäº‹åŠ¡æ›´æ–°çš„åŸæœ‰çš„æ•°æ®ã€‚</p><p>å¹»è¯»(Phantom Read)ï¼šåœ¨ä¸€ä¸ªäº‹åŠ¡çš„ä¸¤æ¬¡æŸ¥è¯¢ä¸­æ•°æ®ç¬”æ•°ä¸ä¸€è‡´ï¼Œä¾‹å¦‚æœ‰ä¸€ä¸ªäº‹åŠ¡æŸ¥è¯¢äº†å‡ åˆ—(Row)æ•°æ®ï¼Œè€Œå¦ä¸€ä¸ªäº‹åŠ¡å´åœ¨æ­¤æ—¶æ’å…¥äº†æ–°çš„å‡ åˆ—æ•°æ®ï¼Œå…ˆå‰çš„äº‹åŠ¡åœ¨æ¥ä¸‹æ¥çš„æŸ¥è¯¢ä¸­ï¼Œå°±ä¼šå‘ç°æœ‰å‡ åˆ—æ•°æ®æ˜¯å®ƒå…ˆå‰æ‰€æ²¡æœ‰çš„ã€‚</p><p>åœ¨MySQLä¸­ï¼Œå®ç°äº†è¿™å››ç§éš”ç¦»çº§åˆ«ï¼Œåˆ†åˆ«æœ‰å¯èƒ½äº§ç”Ÿé—®é¢˜å¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src="https:////upload-images.jianshu.io/upload_images/5219651-fdd241489731111a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/686/format/webp" alt="img"></p><p><strong>å››**</strong>ã€äº‹åŠ¡éš”ç¦»çš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ**</p><p>æˆ‘ä»¬éƒ½çŸ¥é“äº‹åŠ¡çš„å‡ ç§æ€§è´¨ï¼Œæ•°æ®åº“ä¸ºäº†ç»´æŠ¤è¿™äº›æ€§è´¨ï¼Œå°¤å…¶æ˜¯ä¸€è‡´æ€§å’Œéš”ç¦»æ€§ï¼Œä¸€èˆ¬ä½¿ç”¨åŠ é”è¿™ç§æ–¹å¼ã€‚åŒæ—¶æ•°æ®åº“åˆæ˜¯ä¸ªé«˜å¹¶å‘çš„åº”ç”¨ï¼ŒåŒä¸€æ—¶é—´ä¼šæœ‰å¤§é‡çš„å¹¶å‘è®¿é—®ï¼Œå¦‚æœåŠ é”è¿‡åº¦ï¼Œä¼šæå¤§çš„é™ä½å¹¶å‘å¤„ç†èƒ½åŠ›ã€‚æ‰€ä»¥å¯¹äºåŠ é”çš„å¤„ç†ï¼Œå¯ä»¥è¯´å°±æ˜¯æ•°æ®åº“å¯¹äºäº‹åŠ¡å¤„ç†çš„ç²¾é«“æ‰€åœ¨ã€‚è¿™é‡Œé€šè¿‡åˆ†æMySQLä¸­InnoDBå¼•æ“çš„åŠ é”æœºåˆ¶ï¼Œæ¥æŠ›ç –å¼•ç‰ï¼Œè®©æˆ‘ä»¬æ›´å¥½çš„ç†è§£ï¼Œåœ¨äº‹åŠ¡å¤„ç†ä¸­æ•°æ®åº“åˆ°åº•åšäº†ä»€ä¹ˆã€‚</p><p><strong>4.1ã€ä¸€æ¬¡å°é”orä¸¤æ®µé”ï¼Ÿ</strong></p><p>å› ä¸ºæœ‰å¤§é‡çš„å¹¶å‘è®¿é—®ï¼Œä¸ºäº†é¢„é˜²æ­»é”ï¼Œä¸€èˆ¬åº”ç”¨ä¸­æ¨èä½¿ç”¨ä¸€æ¬¡å°é”æ³•ï¼Œå°±æ˜¯åœ¨æ–¹æ³•çš„å¼€å§‹é˜¶æ®µï¼Œå·²ç»é¢„å…ˆçŸ¥é“ä¼šç”¨åˆ°å“ªäº›æ•°æ®ï¼Œç„¶åå…¨éƒ¨é”ä½ï¼Œåœ¨æ–¹æ³•è¿è¡Œä¹‹åï¼Œå†å…¨éƒ¨è§£é”ã€‚è¿™ç§æ–¹å¼å¯ä»¥æœ‰æ•ˆçš„é¿å…å¾ªç¯æ­»é”ï¼Œä½†åœ¨æ•°æ®åº“ä¸­å´ä¸é€‚ç”¨ï¼Œå› ä¸ºåœ¨äº‹åŠ¡å¼€å§‹é˜¶æ®µï¼Œæ•°æ®åº“å¹¶ä¸çŸ¥é“ä¼šç”¨åˆ°å“ªäº›æ•°æ®ã€‚</p><p>æ•°æ®åº“éµå¾ªçš„æ˜¯ä¸¤æ®µé”åè®®ï¼Œå°†äº‹åŠ¡åˆ†æˆä¸¤ä¸ªé˜¶æ®µï¼ŒåŠ é”é˜¶æ®µå’Œè§£é”é˜¶æ®µï¼ˆæ‰€ä»¥å«ä¸¤æ®µé”ï¼‰ã€‚</p><p>åŠ é”é˜¶æ®µï¼šåœ¨è¯¥é˜¶æ®µå¯ä»¥è¿›è¡ŒåŠ é”æ“ä½œã€‚åœ¨å¯¹ä»»ä½•æ•°æ®è¿›è¡Œè¯»æ“ä½œä¹‹å‰è¦ç”³è¯·å¹¶è·å¾—Sé”ï¼ˆå…±äº«é”ï¼Œå…¶å®ƒäº‹åŠ¡å¯ä»¥ç»§ç»­åŠ å…±äº«é”ï¼Œä½†ä¸èƒ½åŠ æ’å®ƒé”ï¼‰ï¼Œåœ¨è¿›è¡Œå†™æ“ä½œä¹‹å‰è¦ç”³è¯·å¹¶è·å¾—Xé”ï¼ˆæ’å®ƒé”ï¼Œå…¶å®ƒäº‹åŠ¡ä¸èƒ½å†è·å¾—ä»»ä½•é”ï¼‰ã€‚åŠ é”ä¸æˆåŠŸï¼Œåˆ™äº‹åŠ¡è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œç›´åˆ°åŠ é”æˆåŠŸæ‰ç»§ç»­æ‰§è¡Œã€‚</p><p>è§£é”é˜¶æ®µï¼šå½“äº‹åŠ¡é‡Šæ”¾äº†ä¸€ä¸ªå°é”ä»¥åï¼Œäº‹åŠ¡è¿›å…¥è§£é”é˜¶æ®µï¼Œåœ¨è¯¥é˜¶æ®µåªèƒ½è¿›è¡Œè§£é”æ“ä½œä¸èƒ½å†è¿›è¡ŒåŠ é”æ“ä½œã€‚</p><blockquote><p><strong>äº‹åŠ¡                 åŠ é”/è§£é”å¤„ç†</strong></p><p>beginï¼›</p><p>insert into test â€¦..     # åŠ insertå¯¹åº”çš„é”</p><p>update test setâ€¦      # åŠ updateå¯¹åº”çš„é”</p><p>delete from test â€¦.   # åŠ deleteå¯¹åº”çš„é”</p><p>commit;                    # äº‹åŠ¡æäº¤æ—¶ï¼ŒåŒæ—¶é‡Šæ”¾insertã€updateã€deleteå¯¹åº”çš„é”</p></blockquote><p>è¿™ç§æ–¹å¼è™½ç„¶æ— æ³•é¿å…æ­»é”ï¼Œä½†æ˜¯ä¸¤æ®µé”åè®®å¯ä»¥ä¿è¯äº‹åŠ¡çš„å¹¶å‘è°ƒåº¦æ˜¯ä¸²è¡ŒåŒ–ï¼ˆä¸²è¡ŒåŒ–å¾ˆé‡è¦ï¼Œå°¤å…¶æ˜¯åœ¨æ•°æ®æ¢å¤å’Œå¤‡ä»½çš„æ—¶å€™ï¼‰çš„ã€‚</p><p><strong>4.2ã€äº‹åŠ¡ä¸­çš„åŠ é”æ–¹å¼</strong></p><p>åœ¨æ•°æ®åº“æ“ä½œä¸­ï¼Œä¸ºäº†æœ‰æ•ˆä¿è¯å¹¶å‘è¯»å–æ•°æ®çš„æ­£ç¡®æ€§ï¼Œæå‡ºçš„äº‹åŠ¡éš”ç¦»çº§åˆ«ã€‚æˆ‘ä»¬çš„æ•°æ®åº“é”ï¼Œä¹Ÿæ˜¯ä¸ºäº†æ„å»ºè¿™äº›éš”ç¦»çº§åˆ«å­˜åœ¨çš„ã€‚</p><p>æˆ‘ä»¬åœ¨å‰é¢å·²ç»ä»‹ç»äº†MySQLçš„å››ç§éš”ç¦»çº§åˆ«ï¼š</p><blockquote><p>æœªæäº¤è¯»(Read Uncommitted)ï¼šå…è®¸è„è¯»ï¼Œä¹Ÿå°±æ˜¯å¯èƒ½è¯»å–åˆ°å…¶ä»–ä¼šè¯ä¸­æœªæäº¤äº‹åŠ¡ä¿®æ”¹çš„æ•°æ®ã€‚</p><p>æäº¤è¯»(Read Committed)ï¼šåªèƒ½è¯»å–åˆ°å·²ç»æäº¤çš„æ•°æ®ã€‚Oracleç­‰å¤šæ•°æ•°æ®åº“é»˜è®¤éƒ½æ˜¯è¯¥çº§åˆ« (ä¸é‡å¤è¯»)ã€‚</p><p>å¯é‡å¤è¯»(Repeated Read)ï¼šå¯é‡å¤è¯»ã€‚åœ¨åŒä¸€ä¸ªäº‹åŠ¡å†…çš„æŸ¥è¯¢éƒ½æ˜¯äº‹åŠ¡å¼€å§‹æ—¶åˆ»ä¸€è‡´çš„ï¼ŒInnoDBé»˜è®¤çº§åˆ«ã€‚åœ¨SQLæ ‡å‡†ä¸­ï¼Œè¯¥éš”ç¦»çº§åˆ«æ¶ˆé™¤äº†ä¸å¯é‡å¤è¯»ï¼Œä½†æ˜¯è¿˜å­˜åœ¨å¹»è±¡è¯»ã€‚</p><p>ä¸²è¡Œè¯»(Serializable)ï¼šå®Œå…¨ä¸²è¡ŒåŒ–çš„è¯»ï¼Œæ¯æ¬¡è¯»éƒ½éœ€è¦è·å¾—è¡¨çº§å…±äº«é”ï¼Œè¯»å†™ç›¸äº’éƒ½ä¼šé˜»å¡ã€‚</p></blockquote><p><strong>Read UnCommittedï¼ˆè¯»å–æœªæäº¤å†…å®¹ï¼‰</strong></p><p>Read Uncommittedè¿™ç§çº§åˆ«ï¼Œæ•°æ®åº“ä¸€èˆ¬éƒ½ä¸ä¼šç”¨ï¼Œè€Œä¸”ä»»ä½•æ“ä½œéƒ½ä¸ä¼šåŠ é”ï¼Œè¿™é‡Œå°±ä¸è®¨è®ºäº†ã€‚</p><blockquote><p>MySQLä¸­é”çš„ç§ç±»ï¼š</p><p>MySQLä¸­é”çš„ç§ç±»å¾ˆå¤šï¼Œæœ‰å¸¸è§çš„è¡¨é”å’Œè¡Œé”ï¼Œä¹Ÿæœ‰æ–°åŠ å…¥çš„Metadata Lockç­‰ç­‰,è¡¨é”æ˜¯å¯¹ä¸€æ•´å¼ è¡¨åŠ é”ï¼Œè™½ç„¶å¯åˆ†ä¸ºè¯»é”å’Œå†™é”ï¼Œä½†æ¯•ç«Ÿæ˜¯é”ä½æ•´å¼ è¡¨ï¼Œä¼šå¯¼è‡´å¹¶å‘èƒ½åŠ›ä¸‹é™ï¼Œä¸€èˆ¬æ˜¯åšddlå¤„ç†æ—¶ä½¿ç”¨ã€‚</p><p>è¡Œé”åˆ™æ˜¯é”ä½æ•°æ®è¡Œï¼Œè¿™ç§åŠ é”æ–¹æ³•æ¯”è¾ƒå¤æ‚ï¼Œä½†æ˜¯ç”±äºåªé”ä½æœ‰é™çš„æ•°æ®ï¼Œå¯¹äºå…¶å®ƒæ•°æ®ä¸åŠ é™åˆ¶ï¼Œæ‰€ä»¥å¹¶å‘èƒ½åŠ›å¼ºï¼ŒMySQLä¸€èˆ¬éƒ½æ˜¯ç”¨è¡Œé”æ¥å¤„ç†å¹¶å‘äº‹åŠ¡ã€‚è¿™é‡Œä¸»è¦è®¨è®ºçš„ä¹Ÿå°±æ˜¯è¡Œé”ã€‚</p></blockquote><p><strong>Read Committedï¼ˆè¯»å–æäº¤å†…å®¹ï¼‰</strong></p><p>åœ¨RCçº§åˆ«ä¸­ï¼Œæ•°æ®çš„è¯»å–éƒ½æ˜¯ä¸åŠ é”çš„ï¼Œä½†æ˜¯æ•°æ®çš„å†™å…¥ã€ä¿®æ”¹å’Œåˆ é™¤æ˜¯éœ€è¦åŠ é”çš„ã€‚è¿™ç§éš”ç¦»çº§åˆ«ä¹Ÿæ”¯æŒæ‰€è°“çš„ä¸å¯é‡å¤è¯»ï¼ˆNonrepeatable Readï¼‰ã€‚</p><p><strong>Repeatable Readï¼ˆå¯é‡è¯»ï¼‰</strong></p><p>è¿™æ˜¯MySQLä¸­InnoDBé»˜è®¤çš„éš”ç¦»çº§åˆ«ã€‚æˆ‘ä»¬å§‘ä¸”åˆ†â€œè¯»â€å’Œâ€œå†™â€ä¸¤ä¸ªæ¨¡å—æ¥è®²è§£ã€‚</p><p><strong>è¯»ï¼ˆå¿«ç…§è¯»ï¼‰</strong></p><p>è¯»å°±æ˜¯å¯é‡è¯»ï¼Œå¯é‡è¯»è¿™ä¸ªæ¦‚å¿µæ˜¯ä¸€äº‹åŠ¡çš„å¤šä¸ªå®ä¾‹åœ¨å¹¶å‘è¯»å–æ•°æ®æ—¶ã€‚æˆ‘ä»¬å‰é¢å·²ç»è®²è¿‡â€œç†è®ºä¸Šï¼Œè¿™ä¼šå¯¼è‡´å¦ä¸€ä¸ªæ£˜æ‰‹çš„é—®é¢˜ï¼šå¹»è¯» ï¼ˆPhantom Readï¼‰â€ã€‚</p><p>è®²åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å…ˆæ¥å¥½å¥½åœ°è¯´æ˜ä¸‹ä¸å¯é‡å¤è¯»å’Œå¹»è¯»çš„åŒºåˆ«ï¼š</p><blockquote><p>å¾ˆå¤šäººå®¹æ˜“ææ··ä¸å¯é‡å¤è¯»å’Œå¹»è¯»ï¼Œç¡®å®è¿™ä¸¤è€…æœ‰äº›ç›¸ä¼¼ã€‚ä½†ä¸å¯é‡å¤è¯»é‡ç‚¹åœ¨äºupdateå’Œdeleteï¼Œè€Œå¹»è¯»çš„é‡ç‚¹åœ¨äºinsertã€‚</p><p>å¦‚æœä½¿ç”¨é”æœºåˆ¶æ¥å®ç°è¿™ä¸¤ç§éš”ç¦»çº§åˆ«ï¼Œåœ¨å¯é‡å¤è¯»ä¸­ï¼Œè¯¥sqlç¬¬ä¸€æ¬¡è¯»å–åˆ°æ•°æ®åï¼Œå°±å°†è¿™äº›æ•°æ®åŠ é”ï¼Œå…¶å®ƒäº‹åŠ¡æ— æ³•ä¿®æ”¹è¿™äº›æ•°æ®ï¼Œå°±å¯ä»¥å®ç°å¯é‡å¤è¯»äº†ã€‚ä½†è¿™ç§æ–¹æ³•å´æ— æ³•é”ä½insertçš„æ•°æ®ï¼Œæ‰€ä»¥å½“äº‹åŠ¡Aå…ˆå‰è¯»å–äº†æ•°æ®ï¼Œæˆ–è€…ä¿®æ”¹äº†å…¨éƒ¨æ•°æ®ï¼Œäº‹åŠ¡Bè¿˜æ˜¯å¯ä»¥insertæ•°æ®æäº¤ï¼Œè¿™æ—¶äº‹åŠ¡Aå°±ä¼šå‘ç°è«åå…¶å¦™å¤šäº†ä¸€æ¡ä¹‹å‰æ²¡æœ‰çš„æ•°æ®ï¼Œè¿™å°±æ˜¯å¹»è¯»ï¼Œä¸èƒ½é€šè¿‡è¡Œé”æ¥é¿å…ã€‚éœ€è¦Serializableéš”ç¦»çº§åˆ« ï¼Œè¯»ç”¨è¯»é”ï¼Œå†™ç”¨å†™é”ï¼Œè¯»é”å’Œå†™é”äº’æ–¥ï¼Œè¿™ä¹ˆåšå¯ä»¥æœ‰æ•ˆçš„é¿å…å¹»è¯»ã€ä¸å¯é‡å¤è¯»ã€è„è¯»ç­‰é—®é¢˜ï¼Œä½†ä¼šæå¤§çš„é™ä½æ•°æ®åº“çš„å¹¶å‘èƒ½åŠ›ã€‚</p><p>æ‰€ä»¥è¯´ä¸å¯é‡å¤è¯»å’Œå¹»è¯»æœ€å¤§çš„åŒºåˆ«ï¼Œå°±åœ¨äºå¦‚ä½•é€šè¿‡é”æœºåˆ¶æ¥è§£å†³ä»–ä»¬äº§ç”Ÿçš„é—®é¢˜ã€‚</p><p>MySQLã€ORACLEã€PostgreSQLç­‰æˆç†Ÿçš„æ•°æ®åº“ï¼Œå‡ºäºæ€§èƒ½è€ƒè™‘ï¼Œéƒ½æ˜¯ä½¿ç”¨äº†ä»¥ä¹è§‚é”ä¸ºç†è®ºåŸºç¡€çš„MVCCï¼ˆå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼‰æ¥é¿å…è¿™ä¸¤ç§é—®é¢˜ã€‚</p></blockquote><p>è¿™é‡Œç»§ç»­æ‰©å±•ä¸‹æ‚²è§‚é”å’Œä¹è§‚é”çš„çŸ¥è¯†ã€‚</p><blockquote><p>æ‚²è§‚é”ï¼š</p><p>æ­£å¦‚å…¶åï¼Œå®ƒæŒ‡çš„æ˜¯å¯¹æ•°æ®è¢«å¤–ç•Œï¼ˆåŒ…æ‹¬æœ¬ç³»ç»Ÿå½“å‰çš„å…¶ä»–äº‹åŠ¡ï¼Œä»¥åŠæ¥è‡ªå¤–éƒ¨ç³»ç»Ÿçš„äº‹åŠ¡å¤„ç†ï¼‰ä¿®æ”¹æŒä¿å®ˆæ€åº¦ï¼Œå› æ­¤ï¼Œåœ¨æ•´ä¸ªæ•°æ®å¤„ç†è¿‡ç¨‹ä¸­ï¼Œå°†æ•°æ®å¤„äºé”å®šçŠ¶æ€ã€‚æ‚²è§‚é”çš„å®ç°ï¼Œå¾€å¾€ä¾é æ•°æ®åº“æä¾›çš„é”æœºåˆ¶ï¼ˆä¹Ÿåªæœ‰æ•°æ®åº“å±‚æä¾›çš„é”æœºåˆ¶æ‰èƒ½çœŸæ­£ä¿è¯æ•°æ®è®¿é—®çš„æ’ä»–æ€§ï¼Œå¦åˆ™ï¼Œå³ä½¿åœ¨æœ¬ç³»ç»Ÿä¸­å®ç°äº†åŠ é”æœºåˆ¶ï¼Œä¹Ÿæ— æ³•ä¿è¯å¤–éƒ¨ç³»ç»Ÿä¸ä¼šä¿®æ”¹æ•°æ®ï¼‰ã€‚</p><p>åœ¨æ‚²è§‚é”çš„æƒ…å†µä¸‹ï¼Œä¸ºäº†ä¿è¯äº‹åŠ¡çš„éš”ç¦»æ€§ï¼Œå°±éœ€è¦ä¸€è‡´æ€§é”å®šè¯»ã€‚è¯»å–æ•°æ®æ—¶ç»™åŠ é”ï¼Œå…¶å®ƒäº‹åŠ¡æ— æ³•ä¿®æ”¹è¿™äº›æ•°æ®ã€‚ä¿®æ”¹åˆ é™¤æ•°æ®æ—¶ä¹Ÿè¦åŠ é”ï¼Œå…¶å®ƒäº‹åŠ¡æ— æ³•è¯»å–è¿™äº›æ•°æ®ã€‚</p><p>ä¹è§‚é”ï¼š</p><p>ç›¸å¯¹æ‚²è§‚é”è€Œè¨€ï¼Œä¹è§‚é”æœºåˆ¶é‡‡å–äº†æ›´åŠ å®½æ¾çš„åŠ é”æœºåˆ¶ã€‚æ‚²è§‚é”å¤§å¤šæ•°æƒ…å†µä¸‹ä¾é æ•°æ®åº“çš„é”æœºåˆ¶å®ç°ï¼Œä»¥ä¿è¯æ“ä½œæœ€å¤§ç¨‹åº¦çš„ç‹¬å æ€§ã€‚ä½†éšä¹‹è€Œæ¥çš„å°±æ˜¯æ•°æ®åº“æ€§èƒ½çš„å¤§é‡å¼€é”€ï¼Œç‰¹åˆ«æ˜¯å¯¹é•¿äº‹åŠ¡è€Œè¨€ï¼Œè¿™æ ·çš„å¼€é”€å¾€å¾€æ— æ³•æ‰¿å—ã€‚</p><p>è€Œä¹è§‚é”æœºåˆ¶åœ¨ä¸€å®šç¨‹åº¦ä¸Šè§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚ä¹è§‚é”ï¼Œå¤§å¤šæ˜¯åŸºäºæ•°æ®ç‰ˆæœ¬ï¼ˆ Version ï¼‰è®°å½•æœºåˆ¶å®ç°ã€‚ä½•è°“æ•°æ®ç‰ˆæœ¬ï¼Ÿå³ä¸ºæ•°æ®å¢åŠ ä¸€ä¸ªç‰ˆæœ¬æ ‡è¯†ï¼Œåœ¨åŸºäºæ•°æ®åº“è¡¨çš„ç‰ˆæœ¬è§£å†³æ–¹æ¡ˆä¸­ï¼Œä¸€èˆ¬æ˜¯é€šè¿‡ä¸ºæ•°æ®åº“è¡¨å¢åŠ ä¸€ä¸ª â€œversionâ€ å­—æ®µæ¥å®ç°ã€‚è¯»å–å‡ºæ•°æ®æ—¶ï¼Œå°†æ­¤ç‰ˆæœ¬å·ä¸€åŒè¯»å‡ºï¼Œä¹‹åæ›´æ–°æ—¶ï¼Œå¯¹æ­¤ç‰ˆæœ¬å·åŠ ä¸€ã€‚æ­¤æ—¶ï¼Œå°†æäº¤æ•°æ®çš„ç‰ˆæœ¬æ•°æ®ä¸æ•°æ®åº“è¡¨å¯¹åº”è®°å½•çš„å½“å‰ç‰ˆæœ¬ä¿¡æ¯è¿›è¡Œæ¯”å¯¹ï¼Œå¦‚æœæäº¤çš„æ•°æ®ç‰ˆæœ¬å·å¤§äºæ•°æ®åº“è¡¨å½“å‰ç‰ˆæœ¬å·ï¼Œåˆ™äºˆä»¥æ›´æ–°ï¼Œå¦åˆ™è®¤ä¸ºæ˜¯è¿‡æœŸæ•°æ®ã€‚</p><p>è¦è¯´æ˜çš„æ˜¯ï¼ŒMVCCçš„å®ç°æ²¡æœ‰å›ºå®šçš„è§„èŒƒï¼Œæ¯ä¸ªæ•°æ®åº“éƒ½ä¼šæœ‰ä¸åŒçš„å®ç°æ–¹å¼ï¼Œè¿™é‡Œè®¨è®ºçš„æ˜¯InnoDBçš„MVCCã€‚</p></blockquote><p>æ¥ä¸‹æ¥è®²è§£MVCCåœ¨MySQLçš„InnoDBä¸­çš„å®ç°ï¼š</p><blockquote><p>åœ¨InnoDBä¸­ï¼Œä¼šåœ¨æ¯è¡Œæ•°æ®åæ·»åŠ ä¸¤ä¸ªé¢å¤–çš„éšè—çš„å€¼æ¥å®ç°MVCCï¼Œè¿™ä¸¤ä¸ªå€¼ä¸€ä¸ªè®°å½•è¿™è¡Œæ•°æ®ä½•æ—¶è¢«åˆ›å»ºï¼Œå¦å¤–ä¸€ä¸ªè®°å½•è¿™è¡Œæ•°æ®ä½•æ—¶è¿‡æœŸï¼ˆæˆ–è€…è¢«åˆ é™¤ï¼‰ã€‚ åœ¨å®é™…æ“ä½œä¸­ï¼Œå­˜å‚¨çš„å¹¶ä¸æ˜¯æ—¶é—´ï¼Œè€Œæ˜¯äº‹åŠ¡çš„ç‰ˆæœ¬å·ï¼Œæ¯å¼€å¯ä¸€ä¸ªæ–°äº‹åŠ¡ï¼Œäº‹åŠ¡çš„ç‰ˆæœ¬å·å°±ä¼šé€’å¢ã€‚ åœ¨å¯é‡è¯»Repeatable readsäº‹åŠ¡éš”ç¦»çº§åˆ«ä¸‹ï¼š</p><p>SELECTæ—¶ï¼Œè¯»å–åˆ›å»ºç‰ˆæœ¬å·&lt;=å½“å‰äº‹åŠ¡ç‰ˆæœ¬å·ï¼Œåˆ é™¤ç‰ˆæœ¬å·ä¸ºç©ºæˆ–&gt;å½“å‰äº‹åŠ¡ç‰ˆæœ¬å·ã€‚</p><p>INSERTæ—¶ï¼Œä¿å­˜å½“å‰äº‹åŠ¡ç‰ˆæœ¬å·ä¸ºè¡Œçš„åˆ›å»ºç‰ˆæœ¬å·ã€‚</p><p>DELETEæ—¶ï¼Œä¿å­˜å½“å‰äº‹åŠ¡ç‰ˆæœ¬å·ä¸ºè¡Œçš„åˆ é™¤ç‰ˆæœ¬å·ã€‚</p><p>UPDATEæ—¶ï¼Œæ’å…¥ä¸€æ¡æ–°çºªå½•ï¼Œä¿å­˜å½“å‰äº‹åŠ¡ç‰ˆæœ¬å·ä¸ºè¡Œåˆ›å»ºç‰ˆæœ¬å·ï¼ŒåŒæ—¶ä¿å­˜å½“å‰äº‹åŠ¡ç‰ˆæœ¬å·åˆ°åŸæ¥åˆ é™¤çš„è¡Œã€‚</p><p>é€šè¿‡MVCCï¼Œè™½ç„¶æ¯è¡Œè®°å½•éƒ½éœ€è¦é¢å¤–çš„å­˜å‚¨ç©ºé—´ï¼Œæ›´å¤šçš„è¡Œæ£€æŸ¥å·¥ä½œä»¥åŠä¸€äº›é¢å¤–çš„ç»´æŠ¤å·¥ä½œï¼Œä½†å¯ä»¥å‡å°‘é”çš„ä½¿ç”¨ï¼Œå¤§å¤šæ•°è¯»æ“ä½œéƒ½ä¸ç”¨åŠ é”ï¼Œè¯»æ•°æ®æ“ä½œå¾ˆç®€å•ï¼Œæ€§èƒ½å¾ˆå¥½ï¼Œå¹¶ä¸”ä¹Ÿèƒ½ä¿è¯åªä¼šè¯»å–åˆ°ç¬¦åˆæ ‡å‡†çš„è¡Œï¼Œä¹Ÿåªé”ä½å¿…è¦è¡Œã€‚</p></blockquote><p>æ³¨ï¼šâ€œè¯»â€ä¸â€œè¯»â€çš„åŒºåˆ«ã€‚</p><p>äº‹åŠ¡çš„éš”ç¦»çº§åˆ«å…¶å®éƒ½æ˜¯å¯¹äºè¯»æ•°æ®çš„å®šä¹‰ï¼Œä½†åˆ°äº†è¿™é‡Œï¼Œå°±è¢«æ‹†æˆäº†è¯»å’Œå†™ä¸¤ä¸ªæ¨¡å—æ¥è®²è§£ã€‚è¿™ä¸»è¦æ˜¯å› ä¸ºMySQLä¸­çš„è¯»ï¼Œå’Œäº‹åŠ¡éš”ç¦»çº§åˆ«ä¸­çš„è¯»ï¼Œæ˜¯ä¸ä¸€æ ·çš„ã€‚</p><p>æˆ‘ä»¬ä¸”çœ‹ï¼Œåœ¨RRçº§åˆ«ä¸­ï¼Œé€šè¿‡MVCCæœºåˆ¶ï¼Œè™½ç„¶è®©æ•°æ®å˜å¾—å¯é‡å¤è¯»ï¼Œä½†æˆ‘ä»¬è¯»åˆ°çš„æ•°æ®å¯èƒ½æ˜¯å†å²æ•°æ®ï¼Œæ˜¯ä¸åŠæ—¶çš„æ•°æ®ï¼Œä¸æ˜¯æ•°æ®åº“å½“å‰çš„æ•°æ®ï¼è¿™åœ¨ä¸€äº›å¯¹äºæ•°æ®çš„æ—¶æ•ˆç‰¹åˆ«æ•æ„Ÿçš„ä¸šåŠ¡ä¸­ï¼Œå°±å¾ˆå¯èƒ½å‡ºé—®é¢˜ã€‚</p><p>å¯¹äºè¿™ç§è¯»å–å†å²æ•°æ®çš„æ–¹å¼ï¼Œæˆ‘ä»¬å«å®ƒå¿«ç…§è¯» (snapshot read)ï¼Œè€Œè¯»å–æ•°æ®åº“å½“å‰ç‰ˆæœ¬æ•°æ®çš„æ–¹å¼ï¼Œå«å½“å‰è¯» (current read)ã€‚å¾ˆæ˜¾ç„¶ï¼Œåœ¨MVCCä¸­ï¼š</p><blockquote><p>å¿«ç…§è¯»ï¼šå°±æ˜¯select</p><p>select * from table â€¦.;</p><p>å½“å‰è¯»ï¼šç‰¹æ®Šçš„è¯»æ“ä½œï¼Œæ’å…¥/æ›´æ–°/åˆ é™¤æ“ä½œï¼Œå±äºå½“å‰è¯»ï¼Œå¤„ç†çš„éƒ½æ˜¯å½“å‰çš„æ•°æ®ï¼Œéœ€è¦åŠ é”ã€‚</p><p>select * from table where ? lock in share mode;</p><p>select * from table where ? for update;</p><p>insert;</p><p>update ;</p><p>delete;</p></blockquote><p>äº‹åŠ¡çš„éš”ç¦»çº§åˆ«å®é™…ä¸Šéƒ½æ˜¯å®šä¹‰äº†å½“å‰è¯»çš„çº§åˆ«ï¼ŒMySQLä¸ºäº†å‡å°‘é”å¤„ç†ï¼ˆåŒ…æ‹¬ç­‰å¾…å…¶å®ƒé”ï¼‰çš„æ—¶é—´ï¼Œæå‡å¹¶å‘èƒ½åŠ›ï¼Œå¼•å…¥äº†å¿«ç…§è¯»çš„æ¦‚å¿µï¼Œä½¿å¾—selectä¸ç”¨åŠ é”ã€‚è€Œupdateã€insertè¿™äº›â€œå½“å‰è¯»â€ï¼Œå°±éœ€è¦å¦å¤–çš„æ¨¡å—æ¥è§£å†³äº†ã€‚</p><p><strong>å› ä¸ºæ›´æ–°æ•°æ®ã€æ’å…¥æ•°æ®æ˜¯é’ˆå¯¹å½“å‰æ•°æ®çš„ï¼Œæ‰€ä»¥ä¸èƒ½ä»¥å¿«ç…§çš„å†å²æ•°æ®ä¸ºå‚è€ƒï¼Œæ­¤å¤„å°±æ˜¯è¿™ä¸ªæ„æ€ã€‚</strong></p><p><strong>å†™ï¼ˆâ€å½“å‰è¯»â€ï¼‰</strong></p><p>äº‹åŠ¡çš„éš”ç¦»çº§åˆ«ä¸­è™½ç„¶åªå®šä¹‰äº†è¯»æ•°æ®çš„è¦æ±‚ï¼Œå®é™…ä¸Šè¿™ä¹Ÿå¯ä»¥è¯´æ˜¯å†™æ•°æ®çš„è¦æ±‚ã€‚ä¸Šæ–‡çš„â€œè¯»â€ï¼Œå®é™…æ˜¯è®²çš„å¿«ç…§è¯»ï¼Œè€Œè¿™é‡Œè¯´çš„â€œå†™â€å°±æ˜¯å½“å‰è¯»äº†ã€‚</p><p>ä¸ºäº†è§£å†³å½“å‰è¯»ä¸­çš„å¹»è¯»é—®é¢˜ï¼ŒMySQLäº‹åŠ¡ä½¿ç”¨äº†Next-Keyé”ã€‚</p><p>Next-Keyé”æ˜¯è¡Œé”å’ŒGAPï¼ˆé—´éš™é”ï¼‰çš„åˆå¹¶ï¼Œè¡Œé”ä¸Šæ–‡å·²ç»ä»‹ç»äº†ï¼Œæ¥ä¸‹æ¥è¯´ä¸‹GAPé—´éš™é”ã€‚</p><p>è¡Œé”å¯ä»¥é˜²æ­¢ä¸åŒäº‹åŠ¡ç‰ˆæœ¬çš„æ•°æ®ä¿®æ”¹æäº¤æ—¶é€ æˆæ•°æ®å†²çªçš„æƒ…å†µã€‚ä½†å¦‚ä½•é¿å…åˆ«çš„äº‹åŠ¡æ’å…¥æ•°æ®å°±æˆäº†é—®é¢˜ã€‚è¡Œé”é˜²æ­¢åˆ«çš„äº‹åŠ¡ä¿®æ”¹æˆ–åˆ é™¤ï¼ŒGAPé”é˜²æ­¢åˆ«çš„äº‹åŠ¡æ–°å¢ï¼Œè¡Œé”å’ŒGAPé”ç»“åˆå½¢æˆçš„çš„Next-Keyé”å…±åŒè§£å†³äº†RRçº§åˆ«åœ¨å†™æ•°æ®æ—¶çš„å¹»è¯»é—®é¢˜ã€‚</p><p><strong>Serializable</strong></p><p>è¿™ä¸ªçº§åˆ«å¾ˆç®€å•ï¼Œè¯»åŠ å…±äº«é”ï¼Œå†™åŠ æ’ä»–é”ï¼Œè¯»å†™äº’æ–¥ã€‚ä½¿ç”¨çš„æ‚²è§‚é”çš„ç†è®ºï¼Œå®ç°ç®€å•ï¼Œæ•°æ®æ›´åŠ å®‰å…¨ï¼Œä½†æ˜¯å¹¶å‘èƒ½åŠ›éå¸¸å·®ã€‚å¦‚æœä½ çš„ä¸šåŠ¡å¹¶å‘çš„ç‰¹åˆ«å°‘æˆ–è€…æ²¡æœ‰å¹¶å‘ï¼ŒåŒæ—¶åˆè¦æ±‚æ•°æ®åŠæ—¶å¯é çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨è¿™ç§æ¨¡å¼ã€‚</p><p>è¿™é‡Œéœ€è¦æ³¨æ„æ”¹å˜ä¸€ä¸ªè§‚å¿µï¼Œä¸è¦çœ‹åˆ°selectå°±è¯´ä¸ä¼šåŠ é”äº†ï¼Œåœ¨Serializableè¿™ä¸ªçº§åˆ«ï¼Œè¿˜æ˜¯ä¼šåŠ é”çš„</p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;InnoDBä¸MyISAMåŒºåˆ«ï¼š&quot;&gt;&lt;a href=&quot;#InnoDBä¸MyISAMåŒºåˆ«ï¼š&quot; class=&quot;headerlink&quot; title=&quot;InnoDBä¸MyISAMåŒºåˆ«ï¼š&quot;&gt;&lt;/a&gt;InnoDBä¸MyISAMåŒºåˆ«ï¼š&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;InnoDBæ”¯æŒäº‹åŠ¡ï¼ŒMyISAMä¸æ”¯æŒï¼Œå¯¹äºInnoDBæ¯ä¸€æ¡SQLè¯­è¨€éƒ½é»˜è®¤å°è£…æˆäº‹åŠ¡ï¼Œè‡ªåŠ¨æäº¤ï¼Œè¿™æ ·ä¼šå½±å“é€Ÿåº¦ï¼Œæ‰€ä»¥æœ€å¥½æŠŠå¤šæ¡SQLè¯­è¨€æ”¾åœ¨beginå’Œcommitä¹‹é—´ï¼Œç»„æˆä¸€ä¸ªäº‹åŠ¡ï¼›&lt;/li&gt;
&lt;li&gt;InnoDBæ”¯æŒå¤–é”®ï¼Œè€ŒMyISAMä¸æ”¯æŒã€‚å¯¹ä¸€ä¸ªåŒ…å«å¤–é”®çš„InnoDBè¡¨è½¬ä¸ºMYISAMä¼šå¤±è´¥ï¼›&lt;/li&gt;
&lt;li&gt;InnoDBæ˜¯èšé›†ç´¢å¼•ï¼Œæ•°æ®æ–‡ä»¶æ˜¯å’Œç´¢å¼•ç»‘åœ¨ä¸€èµ·çš„ï¼Œå¿…é¡»è¦æœ‰ä¸»é”®ï¼Œé€šè¿‡ä¸»é”®ç´¢å¼•æ•ˆç‡å¾ˆé«˜ã€‚ä½†æ˜¯è¾…åŠ©ç´¢å¼•éœ€è¦ä¸¤æ¬¡æŸ¥è¯¢ï¼Œå…ˆæŸ¥è¯¢åˆ°ä¸»é”®ï¼Œç„¶åå†é€šè¿‡ä¸»é”®æŸ¥è¯¢åˆ°æ•°æ®ã€‚å› æ­¤ï¼Œä¸»é”®ä¸åº”è¯¥è¿‡å¤§ï¼Œå› ä¸ºä¸»é”®å¤ªå¤§ï¼Œå…¶ä»–ç´¢å¼•ä¹Ÿéƒ½ä¼šå¾ˆå¤§ã€‚è€ŒMyISAMæ˜¯éèšé›†ç´¢å¼•ï¼Œæ•°æ®æ–‡ä»¶æ˜¯åˆ†ç¦»çš„ï¼Œç´¢å¼•ä¿å­˜çš„æ˜¯æ•°æ®æ–‡ä»¶çš„æŒ‡é’ˆã€‚ä¸»é”®ç´¢å¼•å’Œè¾…åŠ©ç´¢å¼•æ˜¯ç‹¬ç«‹çš„ã€‚&lt;/li&gt;
&lt;li&gt;InnoDBä¸ä¿å­˜è¡¨çš„å…·ä½“è¡Œæ•°ï¼Œæ‰§è¡Œselect count(*) from tableæ—¶éœ€è¦å…¨è¡¨æ‰«æã€‚è€ŒMyISAMç”¨ä¸€ä¸ªå˜é‡ä¿å­˜äº†æ•´ä¸ªè¡¨çš„è¡Œæ•°ï¼Œæ‰§è¡Œä¸Šè¿°è¯­å¥æ—¶åªéœ€è¦è¯»å‡ºè¯¥å˜é‡å³å¯ï¼Œé€Ÿåº¦å¾ˆå¿«ï¼›&lt;/li&gt;
&lt;li&gt;Innodbä¸æ”¯æŒå…¨æ–‡ç´¢å¼•ï¼Œè€ŒMyISAMæ”¯æŒå…¨æ–‡ç´¢å¼•ï¼ŒæŸ¥è¯¢æ•ˆç‡ä¸ŠMyISAMè¦é«˜ï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&quot;å¦‚ä½•é€‰æ‹©ï¼š&quot;&gt;&lt;a href=&quot;#å¦‚ä½•é€‰æ‹©ï¼š&quot; class=&quot;headerlink&quot; title=&quot;å¦‚ä½•é€‰æ‹©ï¼š&quot;&gt;&lt;/a&gt;å¦‚ä½•é€‰æ‹©ï¼š&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;æ˜¯å¦è¦æ”¯æŒäº‹åŠ¡ï¼Œå¦‚æœè¦è¯·é€‰æ‹©innodbï¼Œå¦‚æœä¸éœ€è¦å¯ä»¥è€ƒè™‘MyISAMï¼›&lt;/li&gt;
&lt;li&gt;å¦‚æœè¡¨ä¸­ç»å¤§å¤šæ•°éƒ½åªæ˜¯è¯»æŸ¥è¯¢ï¼Œå¯ä»¥è€ƒè™‘MyISAMï¼Œå¦‚æœæ—¢æœ‰è¯»å†™ä¹ŸæŒºé¢‘ç¹ï¼Œè¯·ä½¿ç”¨InnoDBã€‚&lt;/li&gt;
&lt;li&gt;ç³»ç»Ÿå¥”æºƒåï¼ŒMyISAMæ¢å¤èµ·æ¥æ›´å›°éš¾ï¼Œèƒ½å¦æ¥å—ï¼›&lt;/li&gt;
&lt;/ol&gt;
    
    </summary>
    
    
      <category term="çŸ¥è¯†ç‚¹æ€»ç»“" scheme="https://akaqin.github.io/categories/%E7%9F%A5%E8%AF%86%E7%82%B9%E6%80%BB%E7%BB%93/"/>
    
    
      <category term="MySQL" scheme="https://akaqin.github.io/tags/MySQL/"/>
    
  </entry>
  
  <entry>
    <title>PHP HashTable è§£æ</title>
    <link href="https://akaqin.github.io/2019/02/23/PHP%E5%86%85%E6%A0%B8%E8%A7%A3%E6%9E%90HashTable/"/>
    <id>https://akaqin.github.io/2019/02/23/PHP%E5%86%85%E6%A0%B8%E8%A7%A3%E6%9E%90HashTable/</id>
    <published>2019-02-23T08:03:39.000Z</published>
    <updated>2020-03-08T07:52:42.882Z</updated>
    
    <content type="html"><![CDATA[<p>è¯´ HashTable æ˜¯PHPçš„çµé­‚ï¼Œä¸€ç‚¹ä¹Ÿä¸ä¸ºè¿‡ã€‚åœ¨Zendå¼•æ“ä¸­ï¼Œæ¯”å¦‚å˜é‡è¡¨ã€å¸¸é‡è¡¨ã€å‡½æ•°è¡¨ã€æ•°ç»„ï¼Œä»¥åŠèµ„æºç®¡ç†ã€çº¿ç¨‹å®‰å…¨ç­‰ï¼Œå…¶å®ç°éƒ½æœ‰HashTableçš„èº«å½±ã€‚HashTable æ˜¯ä¸€ç§æŸ¥æ‰¾æ€§èƒ½æé«˜çš„æ•°æ®ç»“æ„ï¼Œç†æƒ³æƒ…å†µä¸‹å…¶ç®—æ³•å¤æ‚åº¦æ˜¯O(1)ã€‚</p><h3 id="PHP-HashTable-æ¦‚è¿°"><a href="#PHP-HashTable-æ¦‚è¿°" class="headerlink" title="PHP HashTable æ¦‚è¿°"></a>PHP HashTable æ¦‚è¿°</h3><ul><li>æœ‰ä¸¤éƒ¨åˆ†ç»„æˆï¼ŒBucket å’Œ HashTableï¼Œè€Œä¸”å‡ä¸ºç»“æ„ä½“(struct)ã€‚</li><li>Bucket æ˜¯å­˜å‚¨æ•°æ®çš„å•å…ƒï¼Œç”¨äºä¿å­˜å…·ä½“çš„æ•°æ®å†…å®¹ï¼›HashTable ç”¨äºä¿å­˜æ•´ä¸ªå“ˆå¸Œè¡¨éœ€è¦çš„åŸºæœ¬ä¿¡æ¯ã€‚</li><li>äºŒè€…å…³ç³»å¯ä»¥ç®€å•ç†è§£ä¸ºï¼šHashTable = Array(); HashTable[â€˜arBucketsâ€™] = [Bucket1, Bucket2, Bucket3, â€¦]ã€‚</li><li>HashTable çš„ç›®çš„å°±æ˜¯é€šè¿‡ç´¢å¼•æŠŠæ¯ä¸ªBucketå…ƒç´ åˆ†æ•£åˆ°å”¯ä¸€çš„ä½ç½®ã€‚</li><li>PHP å†…æ ¸é€šè¿‡HashTable ç»“æ„ç®¡ç†Bucket æ•°ç»„ã€‚</li><li>ç›¸æ¯”æ™®é€šHashTableï¼ŒPHPçš„HashTableåŒæ—¶ç»´æŠ¤ä¸€ä¸ªåŒå‘é“¾è¡¨ã€‚åœ¨HashTable.arBuckets å­˜å‚¨çš„æ˜¯åŒ…å«å¤šä¸ªBucketæŒ‡é’ˆçš„å‘é‡ï¼Œæ¯ä¸ªæŒ‡é’ˆåˆæŒ‡å‘ä¸€ä¸ªåŒå‘é“¾è¡¨(å¤šä¸ªbucketç»„æˆ)ã€‚</li></ul><h2 id="HashTable-æºç å±•ç¤º"><a href="#HashTable-æºç å±•ç¤º" class="headerlink" title="HashTable æºç å±•ç¤º"></a>HashTable æºç å±•ç¤º</h2><p>åœ¨Zend/zend_hash.hçš„line 55~83 ä¸­å®šä¹‰äº†ç»“æ„ä½“ Bucket å’Œ HashTableã€‚æ³¨æ„ Bucket å’Œ HashTable æ˜¯åˆ«åï¼Œåˆ†åˆ«å¯¹åº”ç»“æ„ä½“ bucket å’Œ _hashtableã€‚</p><a id="more"></a><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">bucket</span> &#123;</span></span><br><span class="line">    ulong h;                        <span class="comment">/* Used for numeric indexing */</span></span><br><span class="line">    uint nKeyLength;</span><br><span class="line">    <span class="keyword">void</span> *pData;</span><br><span class="line">    <span class="keyword">void</span> *pDataPtr;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">bucket</span> *<span class="title">pListNext</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">bucket</span> *<span class="title">pListLast</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">bucket</span> *<span class="title">pNext</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">bucket</span> *<span class="title">pLast</span>;</span></span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *arKey;</span><br><span class="line">&#125; Bucket;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">hashtable</span> &#123;</span></span><br><span class="line">    uint nTableSize;</span><br><span class="line">    uint nTableMask;</span><br><span class="line">    uint nNumOfElements;</span><br><span class="line">    ulong nNextFreeElement;</span><br><span class="line">    Bucket *pInternalPointer;   <span class="comment">/* Used for element traversal */</span></span><br><span class="line">    Bucket *pListHead;</span><br><span class="line">    Bucket *pListTail;</span><br><span class="line">    Bucket **arBuckets;</span><br><span class="line">    <span class="keyword">dtor_func_t</span> pDestructor;</span><br><span class="line">    zend_bool persistent;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> nApplyCount;</span><br><span class="line">    zend_bool bApplyProtection;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> ZEND_DEBUG</span></span><br><span class="line">    <span class="keyword">int</span> inconsistent;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">&#125; HashTable;</span><br></pre></td></tr></table></figure><h2 id="Bucket-è§£æè¯´æ˜"><a href="#Bucket-è§£æè¯´æ˜" class="headerlink" title="Bucket è§£æè¯´æ˜"></a>Bucket è§£æè¯´æ˜</h2><p>å…ˆåˆ†æä¸€ä¸‹Bucket ç»“æ„ä½“æˆå‘˜å˜é‡çš„ä½œç”¨ï¼š</p><table><thead><tr><th>æˆå‘˜å˜é‡</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>ulong h;</strong></td><td>ulong ä¸­uè¡¨ç¤ºæ— ç¬¦å·ï¼Œä¿å­˜hash(key) çš„å€¼ï¼› æˆ–è€…ä¿å­˜ç”¨æˆ·æŒ‡å®šçš„æ•´æ•°ç±»å‹ç´¢å¼•å€¼ï¼› keyæ˜¯ä»€ä¹ˆï¼Ÿå°±æ˜¯å½“å‰bucketçš„ç´¢å¼•ï¼Œå­˜å‚¨åœ¨æœ€åä¸€ä¸ªæˆå‘˜arKeyä¸­;</td></tr><tr><td><strong>uint nKeyLength;</strong></td><td>ä¿å­˜ç´¢å¼• key çš„é•¿åº¦ï¼› ç´¢å¼•æ˜¯å­—ç¬¦ä¸²æ—¶ï¼Œè¯¥å€¼&gt;0ï¼Œè¡¨ç¤ºç´¢å¼•å­—ç¬¦ä¸²çš„é•¿åº¦ï¼› ç´¢å¼•æ˜¯æ•´æ•°æ—¶ï¼Œè¯¥å€¼==0ï¼›</td></tr><tr><td><strong>void *pData;</strong></td><td>æŒ‡å‘è¦ä¿å­˜çš„å†…å­˜å—åœ°å€ï¼Œä¸€èˆ¬æ˜¯é€šè¿‡mallocä¹‹ç±»çš„ç³»ç»Ÿè°ƒç”¨åˆ†é…å‡ºæ¥çš„ æŒ‡å‘Valueï¼Œä¸€èˆ¬æ˜¯ç”¨æˆ·æ•°æ®çš„å‰¯æœ¬ï¼Œå¦‚æœæ˜¯æŒ‡é’ˆæ•°æ®ï¼Œåˆ™æŒ‡å‘pDataPtr</td></tr><tr><td><strong>void *pDataPtr;</strong></td><td>ä¿å­˜æŒ‡é’ˆæ•°æ®ï¼Œå½“ä¿å­˜çš„æ•°æ®æ˜¯æŒ‡é’ˆç±»å‹ï¼Œä¸éœ€è¦mallocåˆ†é…ï¼Œå°±ç›´æ¥ä¿å­˜åˆ°pDataPträ¸­ï¼ŒpDataç›´æ¥æŒ‡å‘è¿™é‡Œ ä¿å­˜çš„æ•°æ®ä¸æ˜¯æŒ‡é’ˆç±»å‹æ—¶ï¼ŒpDataPtr=NULL</td></tr><tr><td><strong>struct bucket *pListNext;</strong></td><td>æŒ‡å‘åŒå‘é“¾è¡¨çš„ä¸‹ä¸€ä¸ªå…ƒç´ </td></tr><tr><td><strong>struct bucket *pListLast;</strong></td><td>æŒ‡å‘åŒå‘é“¾è¡¨çš„ä¸Šä¸€ä¸ªå…ƒç´ </td></tr><tr><td><strong>struct bucket *pNext;</strong></td><td>æŒ‡å‘å…·æœ‰åŒä¸€ä¸ªhashå€¼çš„ä¸‹ä¸€ä¸ªå…ƒç´ </td></tr><tr><td><strong>struct bucket *pLast;</strong></td><td>æŒ‡å‘å…·æœ‰åŒä¸€ä¸ªhashå€¼çš„ä¸Šä¸€ä¸ªå…ƒç´ ï¼Œè¿™é‡Œæ˜¯hashç¢°æ’åçš„å¤„ç†æ–¹æ³•ï¼Œæ‹‰é“¾æ³•</td></tr><tr><td><strong>const char *arKey;</strong></td><td>æ³¨æ„ï¼Œè¿™é‡Œä¹‹å‰PHPç‰ˆæœ¬æ˜¯ char arKey[1];  åœ¨PHP5.6ç‰ˆæœ¬ä¸­ï¼Œä¸é™åˆ¶ç´¢å¼•çš„é•¿åº¦äº†ï¼› ç»“æ„ä½“å˜é‡å†…å­˜ç”³è¯· sizeof(Bucket *), æ— éœ€ åŠ ä¸ŠnKeyLength é•¿åº¦äº†ã€‚</td></tr></tbody></table><h3 id="è¯´æ˜"><a href="#è¯´æ˜" class="headerlink" title="è¯´æ˜"></a><strong>è¯´æ˜</strong></h3><ol><li>pData å’Œ pDataPtr çš„å…³ç³»ï¼Œ<ul><li>pData æŒ‡å‘çš„æ˜¯ä¿å­˜æ•°æ®çš„å†…å­˜å—åœ°å€ï¼Œä¸€èˆ¬é€šè¿‡mallocç­‰åˆ†é…;</li><li>pDataPtr å¦‚æœæ˜¯æŒ‡é’ˆæ•°æ®ï¼Œæ­¤å€¼ä¼šæŒ‡å‘çœŸæ­£çš„valueï¼ŒåŒæ—¶pData ä¼šæŒ‡å‘è¯¥å€¼</li><li>ç–‘é—® å†…å­˜å—åœ°å€ï¼Œä¸ä¹Ÿæ˜¯æŒ‡é’ˆå—ï¼Ÿå’ŒpDataPträ»€ä¹ˆåŒºåˆ«ï¼Ÿï¼Ÿ</li></ul></li><li>h æˆå‘˜ä¿å­˜çš„æ˜¯HashTable key å“ˆå¸Œåçš„å€¼ï¼Œè€ŒéHashTableä¸­çš„ç´¢å¼•å€¼ï¼Œä¸ºä»€ä¹ˆï¼Ÿ<ul><li>ç´¢å¼•å€¼å’ŒHashTableçš„å®¹é‡æœ‰å…³ç³»ï¼Œå¦‚æœHashTableæ‰©å®¹ï¼Œé‚£ä¹ˆè¿™äº›ç´¢å¼•è¿˜å¾—é‡æ–°è¿›è¡Œå“ˆå¸Œï¼Œå†è¿›è¡Œç´¢å¼•æ˜ å°„</li><li>æ•°å­—ç´¢å¼•ç›´æ¥å°±å¯ä»¥ä½œä¸ºå“ˆå¸Œè¡¨çš„ç´¢å¼•ï¼Œæ•°å­—ä¹Ÿæ— éœ€è¿›è¡Œå“ˆå¸Œå¤„ç†</li></ul></li></ol><h2 id="HashTable-è§£æè¯´æ˜"><a href="#HashTable-è§£æè¯´æ˜" class="headerlink" title="HashTable è§£æè¯´æ˜"></a>HashTable è§£æè¯´æ˜</h2><table><thead><tr><th>æˆå‘˜å˜é‡</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>uint nTableSize</strong></td><td>è®°å½• Bucket æ•°ç»„çš„å¤§å°</td></tr><tr><td><strong>uint nTableMask</strong></td><td>å§‹ç»ˆç­‰äº nTableSize - 1 ç”¨åœ¨ä¸å“ˆå¸Œå€¼åšä¸è¿ç®—ï¼Œè·å¾—è¯¥å“ˆå¸Œå€¼çš„ç´¢å¼•å–å€¼ã€‚é¢ï¼Œå“ˆå¸Œå€¼æ˜¯ä»€ä¹ˆï¼Ÿï¼Ÿæ˜¯Bucketä¸­çš„ç´¢å¼•å€¼ï¼Ÿ</td></tr><tr><td><strong>uint nNumOfElements</strong></td><td>HashTableä¸­ï¼ŒBucket å…ƒç´ çš„æ•°é‡; count() å‡½æ•°ç›´æ¥è¿”å›è¯¥å€¼</td></tr><tr><td><strong>ulong nNextFreeElement</strong></td><td>è¡¨ç¤ºæ•°å­—é”®æ•°ç»„ä¸­ï¼Œä¸‹ä¸€ä¸ªæ•°å­—ç´¢å¼•çš„ä½ç½®</td></tr><tr><td><strong>Bucket *pInternalPointer</strong></td><td>Forå¾ªç¯æ—¶ç”¨äºè®°å½•å½“å‰å…ƒç´ çš„ä½ç½® å†…éƒ¨æŒ‡é’ˆï¼ŒæŒ‡å‘å½“å‰æˆå‘˜ï¼Œç”¨äºéå†å…ƒç´ </td></tr><tr><td><strong>Bucket *pListHead</strong></td><td>æŒ‡å‘HashTableçš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œä¹Ÿæ˜¯æ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚reset() æ˜¯è¿”å›è¿™ä¸ªå€¼å—ï¼Ÿä¸å®ƒæ˜¯å¦æœ‰å…³ç³»ï¼Ÿ</td></tr><tr><td><strong>Bucket *pListTail</strong></td><td>æŒ‡å‘HashTableçš„æœ€åä¸€ä¸ªå…ƒç´ ï¼Œä¹Ÿæ˜¯æ•°ç»„çš„æœ€åä¸€ä¸ªå…ƒç´ ã€‚end()æ˜¯è¿”å›è¿™ä¸ªå€¼å—ï¼Ÿä¸å®ƒæ˜¯å¦æœ‰å…³ç³»ï¼Ÿ</td></tr><tr><td><strong>Bucket \</strong>arBuckets**</td><td>Bucketç»„æˆçš„åŒå‘é“¾è¡¨çš„æ•°ç»„ï¼Œç´¢å¼•=hash(key) &amp; nTableMask</td></tr><tr><td><strong>dtor_func_t pDestructor</strong></td><td>åˆ é™¤Bucketæ•°ç»„å…ƒç´ ä½¿ç”¨çš„ææ„å‡½æ•°</td></tr><tr><td><strong>zend_bool persistent</strong></td><td>æ ‡è®°å†…å­˜åˆ†é…å‡½æ•° true ä½¿ç”¨ç³»ç»Ÿçš„å†…å­˜åˆ†é…å‡½æ•° false ä½¿ç”¨PHPå†…å­˜åˆ†é…å‡½æ•° ä¸€èˆ¬ä½¿ç”¨PHPçš„å†…å­˜åˆ†é…å‡½æ•°ï¼ŒZendå¼•æ“ä¼šç®¡ç†ç›¸åº”å†…å­˜ï¼Œé¿å…æ³„æ¼</td></tr><tr><td><strong>unsigned char nApplyCount</strong></td><td>ä¿å­˜å½“å‰Bucketè¢«é€’å½’è®¿é—®çš„æ¬¡æ•°ï¼Œé˜²æ­¢å¤šæ¬¡é€’å½’ã€‚@TODO ä»€ä¹ˆæ˜¯å¤šæ¬¡é€’å½’ï¼Ÿ</td></tr><tr><td><strong>zend_bool bApplyProtection</strong></td><td>HashTable æ˜¯å¦éœ€è¦é€’å½’æŠ¥æ•°ï¼Œé»˜è®¤æ˜¯1ï¼Œè¦ä½¿ç”¨</td></tr></tbody></table>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;è¯´ HashTable æ˜¯PHPçš„çµé­‚ï¼Œä¸€ç‚¹ä¹Ÿä¸ä¸ºè¿‡ã€‚åœ¨Zendå¼•æ“ä¸­ï¼Œæ¯”å¦‚å˜é‡è¡¨ã€å¸¸é‡è¡¨ã€å‡½æ•°è¡¨ã€æ•°ç»„ï¼Œä»¥åŠèµ„æºç®¡ç†ã€çº¿ç¨‹å®‰å…¨ç­‰ï¼Œå…¶å®ç°éƒ½æœ‰HashTableçš„èº«å½±ã€‚HashTable æ˜¯ä¸€ç§æŸ¥æ‰¾æ€§èƒ½æé«˜çš„æ•°æ®ç»“æ„ï¼Œç†æƒ³æƒ…å†µä¸‹å…¶ç®—æ³•å¤æ‚åº¦æ˜¯O(1)ã€‚&lt;/p&gt;
&lt;h3 id=&quot;PHP-HashTable-æ¦‚è¿°&quot;&gt;&lt;a href=&quot;#PHP-HashTable-æ¦‚è¿°&quot; class=&quot;headerlink&quot; title=&quot;PHP HashTable æ¦‚è¿°&quot;&gt;&lt;/a&gt;PHP HashTable æ¦‚è¿°&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;æœ‰ä¸¤éƒ¨åˆ†ç»„æˆï¼ŒBucket å’Œ HashTableï¼Œè€Œä¸”å‡ä¸ºç»“æ„ä½“(struct)ã€‚&lt;/li&gt;
&lt;li&gt;Bucket æ˜¯å­˜å‚¨æ•°æ®çš„å•å…ƒï¼Œç”¨äºä¿å­˜å…·ä½“çš„æ•°æ®å†…å®¹ï¼›HashTable ç”¨äºä¿å­˜æ•´ä¸ªå“ˆå¸Œè¡¨éœ€è¦çš„åŸºæœ¬ä¿¡æ¯ã€‚&lt;/li&gt;
&lt;li&gt;äºŒè€…å…³ç³»å¯ä»¥ç®€å•ç†è§£ä¸ºï¼šHashTable = Array(); HashTable[â€˜arBucketsâ€™] = [Bucket1, Bucket2, Bucket3, â€¦]ã€‚&lt;/li&gt;
&lt;li&gt;HashTable çš„ç›®çš„å°±æ˜¯é€šè¿‡ç´¢å¼•æŠŠæ¯ä¸ªBucketå…ƒç´ åˆ†æ•£åˆ°å”¯ä¸€çš„ä½ç½®ã€‚&lt;/li&gt;
&lt;li&gt;PHP å†…æ ¸é€šè¿‡HashTable ç»“æ„ç®¡ç†Bucket æ•°ç»„ã€‚&lt;/li&gt;
&lt;li&gt;ç›¸æ¯”æ™®é€šHashTableï¼ŒPHPçš„HashTableåŒæ—¶ç»´æŠ¤ä¸€ä¸ªåŒå‘é“¾è¡¨ã€‚åœ¨HashTable.arBuckets å­˜å‚¨çš„æ˜¯åŒ…å«å¤šä¸ªBucketæŒ‡é’ˆçš„å‘é‡ï¼Œæ¯ä¸ªæŒ‡é’ˆåˆæŒ‡å‘ä¸€ä¸ªåŒå‘é“¾è¡¨(å¤šä¸ªbucketç»„æˆ)ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;HashTable-æºç å±•ç¤º&quot;&gt;&lt;a href=&quot;#HashTable-æºç å±•ç¤º&quot; class=&quot;headerlink&quot; title=&quot;HashTable æºç å±•ç¤º&quot;&gt;&lt;/a&gt;HashTable æºç å±•ç¤º&lt;/h2&gt;&lt;p&gt;åœ¨Zend/zend_hash.hçš„line 55~83 ä¸­å®šä¹‰äº†ç»“æ„ä½“ Bucket å’Œ HashTableã€‚æ³¨æ„ Bucket å’Œ HashTable æ˜¯åˆ«åï¼Œåˆ†åˆ«å¯¹åº”ç»“æ„ä½“ bucket å’Œ _hashtableã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="å­¦ä¹ ç¬”è®°" scheme="https://akaqin.github.io/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="C" scheme="https://akaqin.github.io/tags/C/"/>
    
      <category term="PHP" scheme="https://akaqin.github.io/tags/PHP/"/>
    
  </entry>
  
  <entry>
    <title>ORMå’ŒQueryBuilderå“ªä¸ªå¥½</title>
    <link href="https://akaqin.github.io/2019/01/08/ORM%E5%92%8CQueryBuilder%E5%93%AA%E4%B8%AA%E5%A5%BD/"/>
    <id>https://akaqin.github.io/2019/01/08/ORM%E5%92%8CQueryBuilder%E5%93%AA%E4%B8%AA%E5%A5%BD/</id>
    <published>2019-01-08T10:57:21.000Z</published>
    <updated>2020-03-08T07:42:25.953Z</updated>
    
    <content type="html"><![CDATA[<h3 id="èµ·å› "><a href="#èµ·å› " class="headerlink" title="èµ·å› "></a>èµ·å› </h3><p>â€‹    æœ€è¿‘å‡†å¤‡å°†è·‘PHP5çš„è€é¡¹ç›®å‡PHP7ï¼Œç”¨çš„æ˜¯CI2.xçš„æ¡†æ¶ï¼Œçƒ‚çš„ä¸€ç¬”ã€‚ä¸»è¦éšœç¢æ˜¯php7åˆ é™¤äº†mysqliçš„ç›¸å…³å‡½æ•°ï¼Œäºæ˜¯å‡†å¤‡è‡ªå·±å°è£…ä¸€ä¸ªDAOå±‚ã€‚çœ‹äº†ä¸€ä¸‹ä¸»æµçš„ <a href="https://github.com/doctrine/orm/" target="_blank" rel="noopener">doctrine/orm</a> ORMå°è£…ï¼Œå‘ç°ç”¨æ³•ç‰¹åˆ«ç¹çï¼Œè¦åœ¨ä»£ç é‡Œæè¿°æ¯ä¸ªè¡¨çš„æ¯ä¸ªå­—æ®µï¼š</p><figure class="highlight php7"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// src/Product.php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Product</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@var</span> int</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> $id;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@var</span> string</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> $name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getId</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getName</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">setName</span><span class="params">($name)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;name = $name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><a id="more"></a><p>â€‹    æ„Ÿè§‰ç‰¹åˆ«ç¹çï¼Œä¸ç¦æ€è€ƒä¸€ä¸ªé—®é¢˜ğŸ¤”ï¼šæˆ‘ä»¬åˆ°åº•è¦ä¸è¦ç”¨ORMï¼ŒORMçœŸçš„æ¯”QueryBilderæˆ–åŸç”Ÿsqlçš„å½¢å¼å¥½å—ï¼Ÿ</p><h3 id="æ€è€ƒ"><a href="#æ€è€ƒ" class="headerlink" title="æ€è€ƒ"></a>æ€è€ƒ</h3><p>â€‹    ä»ä¸€å¼€å§‹å†™åŸç”Ÿsqlï¼Œåˆ°åæ¥ç”¨TPã€CIæ¡†æ¶é‡Œçš„QueryBuilderï¼Œç„¶åæ¥è§¦äº†Laravelå’Œå®ƒçš„Eloquentåæˆä¸ºäº†ORMçš„ç‹‚çƒ­çˆ±å¥½è€…ï¼Œå†åæ¥åˆå¼€å§‹è„±ç¦»è¿™äº›æ¡†æ¶æˆ–å·¥å…·è‡ªå·±è¯•ç€é€ è½®å­å†™ä¸œè¥¿ï¼Œç»å†è¿™äº›åï¼Œæˆ‘æ˜¯è¿™æ ·æƒ³çš„ï¼š<strong>ORMå’Œå…¶ä»–é‚£äº›æ¡†æ¶ä¸€æ ·ï¼Œå°±æ˜¯ä¸ºäº†è®©ä½ ä»åº•å±‚æ“ä½œä¸­è§£è„±å‡ºæ¥ï¼Œå»ä¸“å¿ƒåšä¸šåŠ¡é€»è¾‘</strong>ã€‚</p><p>â€‹    ä¸€å¼€å§‹æ¥è§¦Laravelçš„æ—¶å€™ï¼Œè§‰å¾—å®ƒå¥½ç‰›é€¼ï¼Œç”¨åˆ°äº†å¥½å¤šæˆ‘ä¸æ‡‚çš„é¢å‘å¯¹è±¡æ€æƒ³å’Œè®¾è®¡æ¨¡å¼ã€‚ç­‰æŠŠå®ƒåƒé€äº†åæ‰è§‰å¾—è¿™æ¡†æ¶ä¹Ÿå°±é‚£æ ·ï¼Œé›†æˆäº†å¾ˆå¤šæˆç†Ÿçš„å·¥å…·ï¼Œå¤§è€Œå…¨ï¼Œæ‹¿æ¥å­¦ç¼–ç¨‹æ€æƒ³å¾ˆä¸é”™ï¼›ä½†è¿™ä¹Ÿæ˜¯å®ƒçš„å¼Šç«¯ï¼Œå½“æˆ‘éœ€è¦å¼€å‘ä¸€äº›ç®€å•ä¼˜é›…çš„å°å·¥å…·æ—¶å°±æœ‰äº›å¤§æå°ç”¨äº†ï¼ˆè™½ç„¶å‡ºäº†lumenï¼Œä½†æ„Ÿè§‰ä¹Ÿæ˜¯ä¸å°½äººæ„ï¼‰ã€‚</p><p>â€‹    ORMä¹Ÿæ˜¯ä¸€æ ·çš„é“ç†ï¼Œæœ‰å®ƒçš„åˆ©ï¼ˆé˜²æ³¨å…¥ã€ç®€åŒ–é€»è¾‘ã€ä¸éœ€è¦è¿‡å¤šçš„sqlçŸ¥è¯†ï¼‰ï¼Œä¹Ÿæœ‰å®ƒçš„å¼Šï¼ˆä»£ç é‡å¢åŠ ã€ä¸èƒ½ç²¾ç¡®æ§åˆ¶sqlçš„æ„æˆï¼‰ã€‚æ‰€ä»¥ï¼ŒORMå’ŒQueryBuilderæ²¡æœ‰ç»å¯¹çš„å“ªä¸ªå¥½ï¼Œè€Œéœ€è¦è€ƒè™‘å…·ä½“ä½¿ç”¨åœºæ™¯ï¼š</p><ul><li><p>å¦‚æœä½ æ›´æ³¨é‡ä»£ç çš„æ€§èƒ½è€Œä¸æ˜¯å¼€å‘çš„ç®€æ˜“æ€§ï¼Œè¯·ä½¿ç”¨query builder</p></li><li><p>å¦‚æœä½ å–œæ¬¢OOPï¼Œä¸å¯¹è±¡æ‰“äº¤é“ï¼Œè¯·ä½¿ç”¨ORM</p></li><li><p>å¦‚æœä½ è¦æ‰¹é‡å¤„ç†å¤šä¸ªå®ä½“ï¼Œæœ€å¥½ç”¨query builder</p></li><li><p>å¦‚æœä½ æ˜¯mysqlæ–°æ‰‹ï¼Œæˆ–è€…ç¨‹åºä¸æ˜¯å¾ˆå¤æ‚ï¼Œå°±ç›´æ¥ç”¨ORM</p></li><li><p>å¦‚æœè¡¨ä¹‹é—´çš„ä¸šåŠ¡å…³ç³»å¾ˆå¤æ‚ï¼Œè¿˜æ˜¯ç”¨query builderå§</p></li></ul><p>  â€‹    ä»æ›´é«˜çš„å±‚é¢æ€è€ƒï¼šå·¥å…·å­˜åœ¨çš„æ„ä¹‰å°±æ˜¯ä¸ºäº†è§£å†³å®é™…é—®é¢˜ï¼Œæ¯”è¾ƒæŸæŸå·¥å…·çš„å¥½åæ²¡æœ‰æ„ä¹‰ã€‚å¤šå­¦ä¹ æå‡æŠ€æœ¯ï¼Œå½“é‡åˆ°å®é™…é—®é¢˜æ—¶æ‰èƒ½æƒ³å‡ºå¤šç§è§£å†³æ–¹æ¡ˆï¼Œå¹¶é€‰å–æœ€åˆé€‚çš„è¿›è¡Œå®è·µã€‚è¿™ä¹Ÿæ˜¯æˆ‘å–œæ¬¢åšå·¥ç¨‹å¸ˆçš„åŸå› ï¼Œåšå®äº‹ï¼Œè§£å†³å®é™…é—®é¢˜ï¼Œä¸–ç•Œæ‰ä¼šç¾å¥½ï½</p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;èµ·å› &quot;&gt;&lt;a href=&quot;#èµ·å› &quot; class=&quot;headerlink&quot; title=&quot;èµ·å› &quot;&gt;&lt;/a&gt;èµ·å› &lt;/h3&gt;&lt;p&gt;â€‹    æœ€è¿‘å‡†å¤‡å°†è·‘PHP5çš„è€é¡¹ç›®å‡PHP7ï¼Œç”¨çš„æ˜¯CI2.xçš„æ¡†æ¶ï¼Œçƒ‚çš„ä¸€ç¬”ã€‚ä¸»è¦éšœç¢æ˜¯php7åˆ é™¤äº†mysqliçš„ç›¸å…³å‡½æ•°ï¼Œäºæ˜¯å‡†å¤‡è‡ªå·±å°è£…ä¸€ä¸ªDAOå±‚ã€‚çœ‹äº†ä¸€ä¸‹ä¸»æµçš„ &lt;a href=&quot;https://github.com/doctrine/orm/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;doctrine/orm&lt;/a&gt; ORMå°è£…ï¼Œå‘ç°ç”¨æ³•ç‰¹åˆ«ç¹çï¼Œè¦åœ¨ä»£ç é‡Œæè¿°æ¯ä¸ªè¡¨çš„æ¯ä¸ªå­—æ®µï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight php7&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;&amp;lt;?php&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// src/Product.php&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Product&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;/**&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;     * &lt;span class=&quot;doctag&quot;&gt;@var&lt;/span&gt; int&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;     */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;protected&lt;/span&gt; $id;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;/**&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;     * &lt;span class=&quot;doctag&quot;&gt;@var&lt;/span&gt; string&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;     */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;protected&lt;/span&gt; $name;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;getId&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;    &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;$this&lt;/span&gt;-&amp;gt;id;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;getName&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;    &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;$this&lt;/span&gt;-&amp;gt;name;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;setName&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;($name)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;    &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;$this&lt;/span&gt;-&amp;gt;name = $name;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
      <category term="ç»éªŒåæ€" scheme="https://akaqin.github.io/categories/%E7%BB%8F%E9%AA%8C%E5%8F%8D%E6%80%9D/"/>
    
    
      <category term="MySQL" scheme="https://akaqin.github.io/tags/MySQL/"/>
    
  </entry>
  
  <entry>
    <title>å…³äºä¼˜æƒ åˆ¸èµ„é‡‘é—®é¢˜çš„åæ€</title>
    <link href="https://akaqin.github.io/2018/12/06/%E5%85%B3%E4%BA%8E%E4%BC%98%E6%83%A0%E5%88%B8%E8%B5%84%E9%87%91%E9%97%AE%E9%A2%98%E7%9A%84%E5%8F%8D%E6%80%9D/"/>
    <id>https://akaqin.github.io/2018/12/06/%E5%85%B3%E4%BA%8E%E4%BC%98%E6%83%A0%E5%88%B8%E8%B5%84%E9%87%91%E9%97%AE%E9%A2%98%E7%9A%84%E5%8F%8D%E6%80%9D/</id>
    <published>2018-12-06T08:01:03.000Z</published>
    <updated>2020-03-08T07:42:56.753Z</updated>
    
    <content type="html"><![CDATA[<ul><li><p>offlineè„šæœ¬æ¼æ‰äº†å›æ»šèµ„é‡‘é€»è¾‘ï¼š<br>è¿™å—å› ä¸ºæ˜¯ç¦»çº¿è„šæœ¬ï¼Œåªæ˜¯åœ¨æµ‹è¯•ç¯å¢ƒæ‰‹åŠ¨è°ƒç”¨æµ‹çš„èƒ½ä¸èƒ½è·‘é€šï¼Œçº¿ä¸Šå› ä¸ºä¸æ–¹ä¾¿æµ‹å°±ç›´æ¥å¯¹æ¥äº†ã€‚<br>ä»¥åè¿™å—æœ‰æ”¹åŠ¨è¿˜æ˜¯è¦å¤šreviewï¼Œä¸èƒ½ç–å¿½ã€‚</p></li><li><p>cmsè¿½åŠ ä¼˜æƒ åˆ¸æ—¶å¿½ç•¥äº†äº‹åŠ¡ä¸€è‡´æ€§é—®é¢˜<br>äº‹åŠ¡ä¸€è‡´æ€§çš„é—®é¢˜æœ¬æ¥ä¸€å¼€å§‹æ•´ç†çš„æ—¶å€™åˆ—åˆ°äº†ï¼ŒæŠŠå„é¡¹ç›®åˆ°æŸ¥äº†ä¸€éï¼Œè¿˜æ˜¯æ¼æ‰äº†ä¸€ä¸ªï¼Œæƒ­æ„§ã€‚ã€‚<br>åé¢éœ€è¦æ¨è¿›äº‹åŠ¡åè°ƒå™¨ï¼Œæ’¤æ‰è§£å†³è¿™ç§é—®é¢˜å‡ºç°çš„å¯èƒ½ã€‚</p></li><li><p>é—®é¢˜åŠæ—¶å‘ä¸Šåé¦ˆ<br>é—®é¢˜ä¸€å¼€å§‹å‡ºç°æ—¶ï¼Œåªæœ‰æˆ‘ã€æ˜¥å…‰å’Œæ½˜é™åœ¨æŸ¥è¿™ä¸ªé—®é¢˜ï¼Œå› ä¸ºå½“æ—¶ä¸çŸ¥é“é—®é¢˜2å’Œå°‘äº†30ä¸‡é¢„ç®—è¿™ä¸¤ä»¶äº‹çš„å­˜åœ¨ï¼Œ<br>æ‰€ä»¥æˆ‘å’Œæ˜¥å…‰æŸ¥äº†ä¸¤å¤©è¿™ä¸ªæ•°æ€ä¹ˆä¹Ÿå¯¹ä¸ä¸Šï¼Œå¦‚æœæ—©ç‚¹å‘ä¸Šåé¦ˆçš„è¯çŸ¥é“å°‘äº†30ä¸‡é¢„ç®—è¯´ä¸å®šè¿™ä¸ªé—®é¢˜æ—©å°±è§£å†³äº†ã€‚ã€‚</p></li><li><p>æ‰¾ä¸åˆ°é—®é¢˜åŸå› æ—¶çš„æ€è€ƒæ€è·¯<br>æ˜¨å¤©ä¸€å¤©ç”¨å„ç§æ–¹æ¡ˆç®—çš„æ•°éƒ½å¯¹ä¸ä¸Šï¼Œè¿™æ—¶å€™æˆ‘ä»¬åº”è¯¥æŠŠå·²çŸ¥å¹¶ç¡®å®šæ­£ç¡®çš„ä¿¡æ¯åˆ—å‡ºæ¥ï¼Œå’Œç°æœ‰çš„æ•°æ®åšå¯¹æ¯”ï¼Œ<br>å¦‚æœå‘ç°å¯¹ä¸ä¸Šï¼Œå¤§èƒ†çš„åˆ—å‡ºæ‰€æœ‰çš„å¯èƒ½æ€§ï¼Œå¹¶ä¸€ä¸€æ’æŸ¥éªŒè¯ï¼Œæ’é™¤æ‰ä¸å¯èƒ½çš„ï¼Œå‰©ä¸‹çš„å°±æ˜¯æ­£ç¡®ç­”æ¡ˆã€‚</p><blockquote><p>æ¯”å¦‚ ç°æœ‰å†»ç»“é‡‘é¢è¿œå°äºåº”æœ‰å†»ç»“é‡‘é¢ï¼Œé‚£ä¹ˆçŒœæµ‹å¯èƒ½çš„åŸå› ï¼š<br>è¿‡æœŸå›æ»šæ—¶å†»ç»“èµ„é‡‘æ‰£å¤šäº† ï¼ˆéªŒè¯åè¢«æ’é™¤<br>åˆ é™¤å›æ»šæ—¶å†»ç»“èµ„é‡‘æ‰£å¤šäº†ï¼ˆéªŒè¯åè¢«æ’é™¤<br>åˆ›å»ºæ—¶æ²¡æœ‰åŠ å†»ç»“èµ„é‡‘ï¼ˆéªŒè¯åè¢«æ’é™¤<br>è¿½åŠ æ—¶æ²¡æœ‰åŠ å†»ç»“èµ„é‡‘â€”â€”â€”â€”æ‰¾åˆ°æ­£ç¡®ç­”æ¡ˆ</p></blockquote></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;ul&gt;
&lt;li&gt;&lt;p&gt;offlineè„šæœ¬æ¼æ‰äº†å›æ»šèµ„é‡‘é€»è¾‘ï¼š&lt;br&gt;è¿™å—å› ä¸ºæ˜¯ç¦»çº¿è„šæœ¬ï¼Œåªæ˜¯åœ¨æµ‹è¯•ç¯å¢ƒæ‰‹åŠ¨è°ƒç”¨æµ‹çš„èƒ½ä¸èƒ½è·‘é€šï¼Œçº¿ä¸Šå› ä¸ºä¸æ–¹ä¾¿æµ‹å°±ç›´æ¥å¯¹æ¥äº†ã€‚&lt;br&gt;ä»¥åè¿™å—æœ‰æ”¹åŠ¨è¿˜æ˜¯è¦å¤šreviewï¼Œä¸èƒ½ç–å¿½ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;cmsè¿½åŠ ä¼˜æƒ åˆ¸æ—¶å¿½ç•¥äº†äº‹åŠ¡ä¸€è‡´
      
    
    </summary>
    
    
      <category term="ç»éªŒåæ€" scheme="https://akaqin.github.io/categories/%E7%BB%8F%E9%AA%8C%E5%8F%8D%E6%80%9D/"/>
    
    
      <category term="æ¶æ„" scheme="https://akaqin.github.io/tags/%E6%9E%B6%E6%9E%84/"/>
    
  </entry>
  
  <entry>
    <title>arts-13</title>
    <link href="https://akaqin.github.io/2018/11/12/arts-13/"/>
    <id>https://akaqin.github.io/2018/11/12/arts-13/</id>
    <published>2018-11-12T12:52:53.000Z</published>
    <updated>2020-03-07T12:44:27.511Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Algorithim"><a href="#Algorithim" class="headerlink" title="Algorithim"></a>Algorithim</h2><p>Given a linked list, determine if it has a cycle in it.</p><p>Follow up:<br>Can you solve it without using extra space?</p><h3 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h3><p><strong>Approach:1</strong></p><p>Imagine two runners running on a track at different speed. What happens when the track is actually a circle?</p><p>The space complexity can be reduced to O(1)O(1) by considering two pointers at <strong>different speed</strong> - a slow pointer and a fast pointer. The slow pointer moves one step at a time while the fast pointer moves two steps at a time.</p><p>If there is no cycle in the list, the fast pointer will eventually reach the end and we can return false in this case.</p><p>Now consider a cyclic list and imagine the slow and fast pointers are two runners racing around a circle track. The fast runner will eventually meet the slow runner. Why? Consider this case (we name it case A) - The fast runner is just one step behind the slow runner. In the next iteration, they both increment one and two steps respectively and meet each other.</p><p>How about other cases? For example, we have not considered cases where the fast runner is two or three steps behind the slow runner yet. This is simple, because in the next or nextâ€™s next iteration, this case will be reduced to case A mentioned above.</p><a id="more"></a><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdbool.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ListNode</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> val;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">ListNode</span> *<span class="title">next</span>;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">hasCycle</span><span class="params">(struct ListNode *head)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!head || !head-&gt;next) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">ListNode</span> *<span class="title">slow</span> = <span class="title">head</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">ListNode</span> *<span class="title">fast</span> = <span class="title">head</span>-&gt;<span class="title">next</span>;</span></span><br><span class="line">    <span class="keyword">while</span> (slow != fast) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!fast || !fast-&gt;next) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        slow = slow-&gt;next;</span><br><span class="line">        fast = fast-&gt;next-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">ListNode</span>* <span class="title">a</span> = (<span class="title">struct</span> <span class="title">ListNode</span>*) <span class="title">calloc</span>(1, <span class="title">sizeof</span>(<span class="title">struct</span> <span class="title">ListNode</span>));</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">ListNode</span>* <span class="title">b</span> = (<span class="title">struct</span> <span class="title">ListNode</span>*) <span class="title">calloc</span>(1, <span class="title">sizeof</span>(<span class="title">struct</span> <span class="title">ListNode</span>));</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">ListNode</span>* <span class="title">c</span> = (<span class="title">struct</span> <span class="title">ListNode</span>*) <span class="title">calloc</span>(1, <span class="title">sizeof</span>(<span class="title">struct</span> <span class="title">ListNode</span>));</span></span><br><span class="line">    a-&gt;val = <span class="number">1</span>;</span><br><span class="line">    a-&gt;next = b;</span><br><span class="line">    b-&gt;next = c;</span><br><span class="line">    c-&gt;next = b;</span><br><span class="line">    <span class="keyword">if</span> (hasCycle(a)) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"1"</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"0"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">free</span>(a);</span><br><span class="line">    <span class="built_in">free</span>(b);</span><br><span class="line">    <span class="built_in">free</span>(c);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ€»ç»“ï¼š</p><p>â€‹    mallocå’Œcallocéƒ½æ˜¯åœ¨å †ä¸­ç”³è¯·å†…ä»ï¼ˆä¸¤è€…çš„åŒºåˆ«æ˜¯callocå¯ä»¥æŒ‡å®šæ•°é‡ï¼Œå¹¶åˆå§‹åŒ–å†…ä»çš„å€¼ï¼Œæ€§èƒ½ä¼šæ¯”mallocæ…¢ä¸€ç‚¹ï¼Œä½†å¯å¿½ç•¥ä¸è®¡ï¼‰ï¼Œç”¨å®Œè¦ç”¨freeé‡Šæ”¾æ‰ã€‚</p><p>â€‹    cä¸­æ²¡æœ‰HashTableæˆ–Mapä¹‹ç±»çš„ç»“æ„ï¼Œåªèƒ½ç”¨è¿™ç§ç®—æ³•ï¼Œå¥½å¤„æ˜¯ç©ºé—´å¤æ‚åº¦æ˜¯O(1)ï¼Œæ—¶é—´å¤æ‚åº¦å’Œå‰è€…ä¸€æ ·æ˜¯O(n)</p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;Algorithim&quot;&gt;&lt;a href=&quot;#Algorithim&quot; class=&quot;headerlink&quot; title=&quot;Algorithim&quot;&gt;&lt;/a&gt;Algorithim&lt;/h2&gt;&lt;p&gt;Given a linked list, determine if it has a cycle in it.&lt;/p&gt;
&lt;p&gt;Follow up:&lt;br&gt;Can you solve it without using extra space?&lt;/p&gt;
&lt;h3 id=&quot;Solution&quot;&gt;&lt;a href=&quot;#Solution&quot; class=&quot;headerlink&quot; title=&quot;Solution&quot;&gt;&lt;/a&gt;Solution&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;Approach:1&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Imagine two runners running on a track at different speed. What happens when the track is actually a circle?&lt;/p&gt;
&lt;p&gt;The space complexity can be reduced to O(1)O(1) by considering two pointers at &lt;strong&gt;different speed&lt;/strong&gt; - a slow pointer and a fast pointer. The slow pointer moves one step at a time while the fast pointer moves two steps at a time.&lt;/p&gt;
&lt;p&gt;If there is no cycle in the list, the fast pointer will eventually reach the end and we can return false in this case.&lt;/p&gt;
&lt;p&gt;Now consider a cyclic list and imagine the slow and fast pointers are two runners racing around a circle track. The fast runner will eventually meet the slow runner. Why? Consider this case (we name it case A) - The fast runner is just one step behind the slow runner. In the next iteration, they both increment one and two steps respectively and meet each other.&lt;/p&gt;
&lt;p&gt;How about other cases? For example, we have not considered cases where the fast runner is two or three steps behind the slow runner yet. This is simple, because in the next or nextâ€™s next iteration, this case will be reduced to case A mentioned above.&lt;/p&gt;
    
    </summary>
    
    
      <category term="ARTS" scheme="https://akaqin.github.io/categories/ARTS/"/>
    
    
      <category term="ARTS" scheme="https://akaqin.github.io/tags/ARTS/"/>
    
  </entry>
  
  <entry>
    <title>åæ€æ€»ç»“ï¼šä¼˜æƒ åˆ¸æœåŠ¡æ‹†åˆ†</title>
    <link href="https://akaqin.github.io/2018/11/06/%E4%BC%98%E6%83%A0%E5%88%B8%E6%9C%8D%E5%8A%A1%E6%8B%86%E5%88%86-%E5%8F%8D%E6%80%9D%E6%80%BB%E7%BB%93/"/>
    <id>https://akaqin.github.io/2018/11/06/%E4%BC%98%E6%83%A0%E5%88%B8%E6%9C%8D%E5%8A%A1%E6%8B%86%E5%88%86-%E5%8F%8D%E6%80%9D%E6%80%BB%E7%BB%93/</id>
    <published>2018-11-06T10:35:09.000Z</published>
    <updated>2020-03-08T07:42:42.392Z</updated>
    
    <content type="html"><![CDATA[<h2 id="è¿‡ç¨‹ä¸­å‡ºç°çš„é—®é¢˜ï¼š"><a href="#è¿‡ç¨‹ä¸­å‡ºç°çš„é—®é¢˜ï¼š" class="headerlink" title="è¿‡ç¨‹ä¸­å‡ºç°çš„é—®é¢˜ï¼š"></a>è¿‡ç¨‹ä¸­å‡ºç°çš„é—®é¢˜ï¼š</h2><p><strong>æ€è€ƒé—®é¢˜</strong></p><p>â€‹    å®‰å…¨æ„è¯†è¿˜æ˜¯ä¸å¤Ÿï¼Œä¸èƒ½å› ä¸ºè¿™å—æ˜¯æœæ²›æ‹†çš„å°±ä¸æ€ä¹ˆçœ‹ï¼Œå¯¼è‡´è¦ä¸Šçº¿äº†æ‰å‘ç°å›æ»šé€»è¾‘æœ‰è¿™ä¹ˆå¤šé—®é¢˜ï¼Œä¸´ä¸Šçº¿åˆé‡æ„ä»£ç ï¼Œç»™æµ‹è¯•ä¹Ÿå¸¦æ¥å¾ˆå¤šéº»çƒ¦ï¼›æƒ³çš„ä¸å¤Ÿç»†ï¼Œæœ‰äº›é€»è¾‘é è¡é›·æå‡ºæ¥æ‰æƒ³åˆ°ï¼Œè¿™ä¸€ç‚¹æ„Ÿè§‰è¿˜æ˜¯å¾—é å¤šå®è·µå»æ”¹å˜ã€‚</p><p><strong>ä¹°å®¶ç«¯æ— æ³•æä¾›æœåŠ¡</strong></p><p>â€‹    è™½ç„¶ä¸æ˜¯æˆ‘çš„ä¸»è¦é—®é¢˜ï¼Œä½†å‡ºé—®é¢˜æ—¶çœ‹åˆ°nginxçš„error_logï¼šrecv() failed (104: Connection reset by peer) while reading response header from upstreamï¼Œåº”è¯¥èƒ½åŠæ—¶è”æƒ³åˆ°æ˜¯fpmçš„é—®é¢˜ï¼Œç„¶åéšæ‰‹psä¸‹çœ‹çœ‹è¿›ç¨‹å°±èƒ½åŠæ—¶å‘ç°å­è¿›ç¨‹åªæœ‰5ä¸ªï¼›ä½¿ç”¨æ–°æœºå™¨æ—¶å…ˆçœ‹ä¸‹æœºå™¨é…ç½®ã€‚</p><p><strong>ä¸€äº›è¦æ³¨æ„çš„ç‚¹ï¼š</strong></p><p>â€‹    åšæœåŠ¡è¿™å—ä¸€å®šè¦å¤šäº†è§£ä¸šåŠ¡ï¼Œå¤šæ€è€ƒå¯èƒ½å­˜åœ¨çš„é—®é¢˜ï¼Œå¿ƒæ€è¦ç¼œå¯†ï¼Œè€ƒè™‘å…¨é¢ï¼Œæƒ³çš„è¶Šå¤šï¼Œå‡ºé—®é¢˜çš„æ¦‚ç‡æ‰è¶Šå°ã€‚å°¤å…¶æ˜¯æ¶‰åŠåˆ°äº‹åŠ¡ç›¸å…³çš„éƒ¨åˆ†è¦è€ƒè™‘åˆ°æˆåŠŸå¤±è´¥çš„å„ç§æƒ…å†µã€‚</p><p>â€‹    æ¶‰åŠå¤šé¡¹ç›®çš„æœåŠ¡ä¸æ¥å£ä»£ç ä¸Šçº¿ï¼Œè¦ä¿è¯å„ç§caseéƒ½æµ‹è¿‡æ²¡é—®é¢˜äº†ï¼Œå…ˆæŠŠæœåŠ¡ä¸Šäº†ï¼Œå†é€ä¸ªä¸Šå®¢æˆ·ç«¯ã€‚å°½é‡é¿å…åæœŸæ”¹åŠ¨æœåŠ¡çš„æƒ…å†µï¼Œä¸€æ—¦æœåŠ¡æœ‰æ”¹åŠ¨ï¼Œå°±å¾—å„é¡¹ç›®éƒ½æµ‹ä¸€éï¼Œå¸¦æ¥ä¸å¿…ä¸è¦çš„æˆæœ¬ä¸é£é™©ã€‚</p><p>â€‹    ä¸Šçº¿ååŠæ—¶çš„è§‚å¯Ÿæœ‰æ²¡æœ‰å„ç§å¼‚å¸¸ï¼Œåšå¥½ç›‘æ§ã€‚</p><p>â€‹</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;è¿‡ç¨‹ä¸­å‡ºç°çš„é—®é¢˜ï¼š&quot;&gt;&lt;a href=&quot;#è¿‡ç¨‹ä¸­å‡ºç°çš„é—®é¢˜ï¼š&quot; class=&quot;headerlink&quot; title=&quot;è¿‡ç¨‹ä¸­å‡ºç°çš„é—®é¢˜ï¼š&quot;&gt;&lt;/a&gt;è¿‡ç¨‹ä¸­å‡ºç°çš„é—®é¢˜ï¼š&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;æ€è€ƒé—®é¢˜&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;â€‹    å®‰å…¨æ„è¯†è¿˜æ˜¯ä¸å¤Ÿ
      
    
    </summary>
    
    
      <category term="ç»éªŒåæ€" scheme="https://akaqin.github.io/categories/%E7%BB%8F%E9%AA%8C%E5%8F%8D%E6%80%9D/"/>
    
    
      <category term="architecture" scheme="https://akaqin.github.io/tags/architecture/"/>
    
  </entry>
  
  <entry>
    <title>ã€ŠGoè¯­è¨€åœ£ç»ã€‹ç¬”è®°æ•´ç†</title>
    <link href="https://akaqin.github.io/2018/11/01/Go%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E6%95%B4%E7%90%86/"/>
    <id>https://akaqin.github.io/2018/11/01/Go%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E6%95%B4%E7%90%86/</id>
    <published>2018-11-01T04:08:15.000Z</published>
    <updated>2020-03-08T07:38:37.945Z</updated>
    
    <content type="html"><![CDATA[<h3 id="Printf-è½¬æ¢åŠ¨è¯"><a href="#Printf-è½¬æ¢åŠ¨è¯" class="headerlink" title="Printf è½¬æ¢åŠ¨è¯"></a>Printf è½¬æ¢åŠ¨è¯</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">%dåè¿›åˆ¶æ•´æ•°</span><br><span class="line">%x, %o, %båå…­è¿›åˆ¶ï¼Œå…«è¿›åˆ¶ï¼ŒäºŒè¿›åˆ¶æ•´æ•°ã€‚</span><br><span class="line">%f, %g, %eæµ®ç‚¹æ•°: 3.141593 3.141592653589793 3.141593e+00</span><br><span class="line">%tå¸ƒå°”:trueæˆ–false</span><br><span class="line">%cå­—ç¬¦(rune) (Unicodeç ç‚¹)</span><br><span class="line">%så­—ç¬¦ä¸²</span><br><span class="line">%qå¸¦åŒå¼•å·çš„å­—ç¬¦ä¸²&quot;abc&quot;æˆ–å¸¦å•å¼•å·çš„å­—ç¬¦&#39;c&#39;</span><br><span class="line">%vå˜é‡çš„è‡ªç„¶å½¢å¼(natural format)</span><br><span class="line">%Tå˜é‡çš„ç±»å‹</span><br><span class="line">%%å­—é¢ä¸Šçš„ç™¾åˆ†å·æ ‡å¿—(æ— æ“ä½œæ•°)</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;Printf-è½¬æ¢åŠ¨è¯&quot;&gt;&lt;a href=&quot;#Printf-è½¬æ¢åŠ¨è¯&quot; class=&quot;headerlink&quot; title=&quot;Printf è½¬æ¢åŠ¨è¯&quot;&gt;&lt;/a&gt;Printf è½¬æ¢åŠ¨è¯&lt;/h3&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;tabl
      
    
    </summary>
    
    
      <category term="ã€ŠGoè¯­è¨€åœ£ç»ã€‹ç¬”è®°" scheme="https://akaqin.github.io/categories/%E3%80%8AGo%E8%AF%AD%E8%A8%80%E5%9C%A3%E7%BB%8F%E3%80%8B%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="Go" scheme="https://akaqin.github.io/tags/Go/"/>
    
  </entry>
  
  <entry>
    <title>arts-12</title>
    <link href="https://akaqin.github.io/2018/10/29/arts-12/"/>
    <id>https://akaqin.github.io/2018/10/29/arts-12/</id>
    <published>2018-10-29T02:49:32.000Z</published>
    <updated>2020-03-07T12:44:18.689Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Algorithm"><a href="#Algorithm" class="headerlink" title="Algorithm"></a>Algorithm</h2><p>Given a string, find the length of the <strong>longest substring</strong> without repeating characters.</p><p><strong>Example 1:</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Input: &quot;abcabcbb&quot;</span><br><span class="line">Output: 3</span><br><span class="line">Explanation: The answer is &quot;abc&quot;, with the length of 3.</span><br></pre></td></tr></table></figure><a id="more"></a><p><strong>Example 2:</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Input: &quot;bbbbb&quot;</span><br><span class="line">Output: 1</span><br><span class="line">Explanation: The answer is &quot;b&quot;, with the length of 1.</span><br></pre></td></tr></table></figure><p><strong>Example 3:</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Input: &quot;pwwkew&quot;</span><br><span class="line">Output: 3</span><br><span class="line">Explanation: The answer is &quot;wke&quot;, with the length of 3.</span><br><span class="line">             Note that the answer must be a substring, &quot;pwke&quot; is a subsequence and not a substring.</span><br></pre></td></tr></table></figure><h3 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h3><p><strong>Approach 1:Brute Force</strong></p><p>â€‹    æš´åŠ›ç ´è§£ï¼šä»å¤´å¼€å§‹æ£€æŸ¥æ¯ä¸€ä¸ªå¯èƒ½çš„å­æ•°ç»„ï¼Œè®°å½•å…¶ä¸­æœ€é•¿çš„ã€‚è¦æƒ³æ±‚ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­æœ€é•¿å­å­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œå°±å¾—å…ˆèƒ½åˆ¤æ–­ä¸€ä¸ªå­—ç¬¦ä¸²æ˜¯ä¸æ˜¯ä¸é‡å¤çš„å”¯ä¸€å­—ç¬¦ä¸²ï¼ˆallUniqueå‡½æ•°ï¼‰ï¼Œè€Œè¦åˆ¤æ–­å­—ç¬¦ä¸²æ˜¯ä¸æ˜¯å”¯ä¸€çš„ï¼Œé™¤äº†è¿­ä»£éå†æ¯ä¸€ä¸ªå…ƒç´ ï¼ˆcontainså‡½æ•°ï¼‰ï¼Œæˆ‘æš‚æ—¶æ²¡æƒ³åˆ°ä»€ä¹ˆåˆ«çš„å¥½åŠæ³•ï¼ˆè¿™é‡Œæ˜¯è¯´Cè¯­è¨€ï¼ŒJavaé‡Œæœ‰HashSetï¼‰ã€‚è¿™ä¸ªç®—æ³•çš„æ—¶é—´å¤æ‚åº¦æ˜¯å¾ˆå·®çš„ï¼Œå¥—äº†4å±‚forå¾ªç¯ï¼Œä½†è¿˜æ˜¯æœ‰å‡ ä¸ªå¯ä»¥ä¼˜åŒ–çš„ç‚¹ï¼Œå†™åœ¨ä¸‹é¢çš„æ³¨é‡Šé‡Œï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ¤æ–­ä¸€ä¸ªå­—ç¬¦ä¸²æ˜¯å¦åŒ…å«æŸä¸ªå­—ç¬¦</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">contains</span><span class="params">(<span class="keyword">char</span> *substr, <span class="keyword">int</span> length, <span class="keyword">char</span> c)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (; i &lt; length; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (substr[i] == c) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// åˆ¤æ–­ä¸€ä¸ªå­—ç¬¦ä¸²æ˜¯å¦æ˜¯å”¯ä¸€çš„ï¼ˆä¸é‡å¤çš„ï¼‰</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">allUnique</span><span class="params">(<span class="keyword">char</span> *substr, <span class="keyword">int</span> length)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; i &lt; length; i++) &#123;</span><br><span class="line">        <span class="comment">// iä»1å¼€å§‹ï¼Œä¹Ÿå°±æ˜¯ç¬¬äºŒä¸ªå…ƒç´ ï¼Œä¾æ¬¡åˆ¤æ–­ç¬¬iä¸ªå­—ç¬¦æ˜¯å¦åŒ…å«åœ¨iå‰é¢çš„å­å­—ç¬¦ä¸­</span></span><br><span class="line">        <span class="keyword">if</span> (contains(substr, i, substr[i])) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">lengthOfLongestSubstring</span><span class="params">(<span class="keyword">char</span> *s)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ç»™å®šçš„å­—ç¬¦ä¸²é•¿åº¦</span></span><br><span class="line">    <span class="keyword">int</span> strLength = (<span class="keyword">int</span>) <span class="built_in">strlen</span>(s);</span><br><span class="line">    <span class="keyword">if</span> (strLength == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (strLength == <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// maxLengthæ˜¯å½“å‰å·²æ±‚å‡ºæ¥çš„æœ€é•¿å­å­—ç¬¦ä¸²é•¿åº¦ï¼Œåˆå§‹å€¼ç»™1</span></span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">0</span>, maxLength = <span class="number">1</span>;</span><br><span class="line">    <span class="comment">// å½“å·²çŸ¥çš„æœ€å¤§å­å­—ç¬¦é•¿åº¦å¤§äºç­‰äºå‰©ä¸‹çš„å­—ç¬¦é•¿åº¦æ—¶ï¼Œå°±æ²¡å¿…è¦å¾ªç¯äº†ï¼Œ</span></span><br><span class="line">    <span class="comment">// å› ä¸ºå‰©ä¸‹çš„éƒ¨åˆ†å³ä½¿éƒ½æ˜¯å”¯ä¸€çš„ä¹Ÿä¸å¯èƒ½è¶…è¿‡å½“å‰çš„æœ€å¤§å­å­—ç¬¦é•¿åº¦</span></span><br><span class="line">    <span class="keyword">for</span> (; i &lt; strLength - maxLength; i++) &#123;</span><br><span class="line">        <span class="comment">// jè¡¨ç¤ºè¦è¿­ä»£æ£€æŸ¥çš„å­å­—ç¬¦ä¸²é•¿åº¦ï¼Œåˆå§‹å€¼ç›´æ¥ç”¨maxLengthï¼Œ</span></span><br><span class="line">        <span class="comment">// å› ä¸ºå°äºmaxLengthçš„é•¿åº¦æ²¡å¿…è¦æ£€æµ‹</span></span><br><span class="line">        <span class="keyword">int</span> j = maxLength;</span><br><span class="line">        <span class="keyword">for</span> (; j &lt; strLength - i; j++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (allUnique(s + i, j + <span class="number">1</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> ((j + <span class="number">1</span>) &gt; maxLength) &#123;</span><br><span class="line">                maxLength = j + <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> maxLength;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;Algorithm&quot;&gt;&lt;a href=&quot;#Algorithm&quot; class=&quot;headerlink&quot; title=&quot;Algorithm&quot;&gt;&lt;/a&gt;Algorithm&lt;/h2&gt;&lt;p&gt;Given a string, find the length of the &lt;strong&gt;longest substring&lt;/strong&gt; without repeating characters.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Example 1:&lt;/strong&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;Input: &amp;quot;abcabcbb&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Output: 3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Explanation: The answer is &amp;quot;abc&amp;quot;, with the length of 3.&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
      <category term="ARTS" scheme="https://akaqin.github.io/categories/ARTS/"/>
    
    
      <category term="ARTS" scheme="https://akaqin.github.io/tags/ARTS/"/>
    
  </entry>
  
  <entry>
    <title>æœ€è¿‘çš„é—®é¢˜åæ€</title>
    <link href="https://akaqin.github.io/2018/10/18/%E6%9C%80%E8%BF%91%E7%9A%84%E9%97%AE%E9%A2%98%E5%8F%8D%E6%80%9D/"/>
    <id>https://akaqin.github.io/2018/10/18/%E6%9C%80%E8%BF%91%E7%9A%84%E9%97%AE%E9%A2%98%E5%8F%8D%E6%80%9D/</id>
    <published>2018-10-18T10:11:07.000Z</published>
    <updated>2020-03-08T07:43:41.375Z</updated>
    
    <content type="html"><![CDATA[<p>å…³äºæœ€è¿‘çš„é—®é¢˜ï¼š</p><p>1ã€è¦è§£å†³é—®é¢˜ï¼Œé¦–å…ˆå¾—å­¦ä¼šåˆ†æä¸€ä¸ªé—®é¢˜å…·ä½“å‡ºåœ¨å“ªä¸ªç¯èŠ‚ï¼Œè¶Šç»†è¶Šå¥½</p><p>2ã€æ¯ä¸ªäººéƒ½æœ‰çŠ¯é”™çš„æœºä¼šï¼Œä½†æ˜¯çŠ¯åŒç±»çš„é”™è¯¯ä¼šé™ä½åˆ«äººå¯¹ä½ çš„ä¿¡ä»»ï¼Œä¸€å®šè¦ä¼šåæ€</p><p>3ã€ä½ å¯¹æ¯ä¸€ä¸ªé—®é¢˜çš„è´£ä»»å¿ƒå’Œæ€åº¦éƒ½ä¼šæœ‰äººè®°åœ¨å¿ƒä¸Šï¼Œå°½é‡ç»™æ¯ä¸ªå…³æ³¨é—®é¢˜çš„äººåŠæ—¶çš„åé¦ˆ</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;å…³äºæœ€è¿‘çš„é—®é¢˜ï¼š&lt;/p&gt;
&lt;p&gt;1ã€è¦è§£å†³é—®é¢˜ï¼Œé¦–å…ˆå¾—å­¦ä¼šåˆ†æä¸€ä¸ªé—®é¢˜å…·ä½“å‡ºåœ¨å“ªä¸ªç¯èŠ‚ï¼Œè¶Šç»†è¶Šå¥½&lt;/p&gt;
&lt;p&gt;2ã€æ¯ä¸ªäººéƒ½æœ‰çŠ¯é”™çš„æœºä¼šï¼Œä½†æ˜¯çŠ¯åŒç±»çš„é”™è¯¯ä¼šé™ä½åˆ«äººå¯¹ä½ çš„ä¿¡ä»»ï¼Œä¸€å®šè¦ä¼šåæ€&lt;/p&gt;
&lt;p&gt;3ã€ä½ å¯¹æ¯ä¸€ä¸ªé—®é¢˜çš„è´£ä»»å¿ƒå’Œæ€åº¦éƒ½ä¼šæœ‰äººè®°åœ¨å¿ƒä¸Šï¼Œå°½é‡ç»™æ¯ä¸ªå…³æ³¨é—®é¢˜çš„
      
    
    </summary>
    
    
      <category term="ç»éªŒåæ€" scheme="https://akaqin.github.io/categories/%E7%BB%8F%E9%AA%8C%E5%8F%8D%E6%80%9D/"/>
    
    
      <category term="work" scheme="https://akaqin.github.io/tags/work/"/>
    
  </entry>
  
  <entry>
    <title>arts-11</title>
    <link href="https://akaqin.github.io/2018/10/16/arts-11/"/>
    <id>https://akaqin.github.io/2018/10/16/arts-11/</id>
    <published>2018-10-16T04:18:52.000Z</published>
    <updated>2020-03-07T12:44:14.782Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Algorithm"><a href="#Algorithm" class="headerlink" title="Algorithm"></a>Algorithm</h2><p>You are given two <strong>non-empty</strong> linked lists representing two non-negative integers. The digits are stored in <strong>reverse order</strong> and each of their nodes contain a single digit. Add the two numbers and return it as a linked list.</p><p>You may assume the two numbers do not contain any leading zero, except the number 0 itself.</p><p><strong>Example:</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Input: (2 -&gt; 4 -&gt; 3) + (5 -&gt; 6 -&gt; 4)</span><br><span class="line">Output: 7 -&gt; 0 -&gt; 8</span><br><span class="line">Explanation: 342 + 465 &#x3D; 807.</span><br></pre></td></tr></table></figure><a id="more"></a><p><strong>Approach:</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for singly-linked list.</span></span><br><span class="line"><span class="comment"> * struct ListNode &#123;</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     struct ListNode *next;</span></span><br><span class="line"><span class="comment"> * &#125;;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"> <span class="function">struct ListNode *<span class="title">addTwoNumbers</span><span class="params">(struct ListNode *l1, struct ListNode *l2)</span> </span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">ListNode</span> *<span class="title">dummyHead</span> = (<span class="title">struct</span> <span class="title">ListNode</span>*)<span class="title">calloc</span>(1, <span class="title">sizeof</span>(<span class="title">struct</span> <span class="title">ListNode</span>));</span></span><br><span class="line">    dummyHead-&gt;val = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> carry = <span class="number">0</span>, x, y, sum;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">ListNode</span> *<span class="title">p</span> = <span class="title">l1</span>, *<span class="title">q</span> = <span class="title">l2</span>, *<span class="title">curr</span> = <span class="title">dummyHead</span>;</span></span><br><span class="line">    <span class="keyword">while</span> (p || q) &#123;</span><br><span class="line">        x = p ? p-&gt;val : <span class="number">0</span>;</span><br><span class="line">        y = q ? q-&gt;val : <span class="number">0</span>;</span><br><span class="line">        sum = x + y + carry;</span><br><span class="line">        carry = sum / <span class="number">10</span>;</span><br><span class="line">        <span class="class"><span class="keyword">struct</span> <span class="title">ListNode</span> *<span class="title">next</span> = (<span class="title">struct</span> <span class="title">ListNode</span>*)<span class="title">calloc</span>(1, <span class="title">sizeof</span>(<span class="title">struct</span> <span class="title">ListNode</span>));</span></span><br><span class="line">        next-&gt;val = sum % <span class="number">10</span>;</span><br><span class="line">        curr-&gt;next = next;</span><br><span class="line">        curr = curr-&gt;next;</span><br><span class="line">        <span class="keyword">if</span> (p) &#123;</span><br><span class="line">            p = p-&gt;next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (q) &#123;</span><br><span class="line">            q = q-&gt;next;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (carry &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="class"><span class="keyword">struct</span> <span class="title">ListNode</span> *<span class="title">next</span> = (<span class="title">struct</span> <span class="title">ListNode</span>*)<span class="title">calloc</span>(1, <span class="title">sizeof</span>(<span class="title">struct</span> <span class="title">ListNode</span>));</span>;</span><br><span class="line">        next-&gt;val = carry;</span><br><span class="line">        curr-&gt;next = next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> dummyHead-&gt;next;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;Algorithm&quot;&gt;&lt;a href=&quot;#Algorithm&quot; class=&quot;headerlink&quot; title=&quot;Algorithm&quot;&gt;&lt;/a&gt;Algorithm&lt;/h2&gt;&lt;p&gt;You are given two &lt;strong&gt;non-empty&lt;/strong&gt; linked lists representing two non-negative integers. The digits are stored in &lt;strong&gt;reverse order&lt;/strong&gt; and each of their nodes contain a single digit. Add the two numbers and return it as a linked list.&lt;/p&gt;
&lt;p&gt;You may assume the two numbers do not contain any leading zero, except the number 0 itself.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Example:&lt;/strong&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;Input: (2 -&amp;gt; 4 -&amp;gt; 3) + (5 -&amp;gt; 6 -&amp;gt; 4)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Output: 7 -&amp;gt; 0 -&amp;gt; 8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Explanation: 342 + 465 &amp;#x3D; 807.&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
      <category term="ARTS" scheme="https://akaqin.github.io/categories/ARTS/"/>
    
    
      <category term="ARTS" scheme="https://akaqin.github.io/tags/ARTS/"/>
    
  </entry>
  
  <entry>
    <title>å·¥ä½œå¿ƒå¾—æ€»ç»“</title>
    <link href="https://akaqin.github.io/2018/10/13/%E5%B7%A5%E4%BD%9C%E5%BF%83%E5%BE%97%E6%80%BB%E7%BB%93/"/>
    <id>https://akaqin.github.io/2018/10/13/%E5%B7%A5%E4%BD%9C%E5%BF%83%E5%BE%97%E6%80%BB%E7%BB%93/</id>
    <published>2018-10-13T04:09:43.000Z</published>
    <updated>2020-03-08T07:43:09.777Z</updated>
    
    <content type="html"><![CDATA[<h3 id="æ—¶é—´è¯„ä¼°"><a href="#æ—¶é—´è¯„ä¼°" class="headerlink" title="æ—¶é—´è¯„ä¼°"></a>æ—¶é—´è¯„ä¼°</h3><p>â€‹    å½“leaderç»™ä½ ä¸€ä¸ªä»»åŠ¡é—®ä½ å¤šä¹…èƒ½å®Œæˆæ—¶ï¼Œä¸è¦ç®€å•çš„çœ‹ä¸€çœ‹å°±ç»™ä¸€ä¸ªä¼°æ‘¸çš„å¤§æ¦‚çš„æ—¶é—´ï¼Œè¦åŸ¹å…»å¯¹å·¥ä½œé‡è¯„ä¼°çš„èƒ½åŠ›ï¼Œè¿™å¾ˆé‡è¦ã€‚è¯„ä¼°æ—¶è¦åšåˆ°å°½é‡å‡†ç¡®ï¼Œå…·ä½“æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š</p><ol><li>ä¸è¦æƒ³ç€ä¸‰ä¸ªå°æ—¶çš„å·¥ä½œ,æˆ‘åŠ åŠ ç­èµ¶ä¸€èµ¶ä¸¤ä¸ªå°æ—¶æå®šâ€”â€”åœ¨ä»“ä¿ƒçŠ¶æ€ä¸‹èµ¶å·¥ï¼Œè´¨é‡å¿…ç„¶ä¼šæ”¶åˆ°å½±å“ï¼Œä½ åšçš„æ¯ä¸€ä»¶äº‹çš„è´¨é‡ä»£è¡¨ç€ä½ çš„ä¸ªäººæ°´å¹³ï¼Œå®ƒç›´æ¥å½±å“ç€ä½ åœ¨åˆ«äººå¿ƒä¸­çš„çœ‹æ³•ï¼Œè€Œä¸”ä¸€æ—¦å†å‡ºä»€ä¹ˆé¢å¤–çŠ¶å†µï¼Œè¿™ä¸ªä»»åŠ¡å°±ä¼šdelayã€‚</li><li>ä¸¤ä¸ªå°æ—¶çš„å·¥ä½œé‡ï¼Œä¸è¦æƒ³ç€æˆ‘ç»™è‡ªå·±ä¼°å®½æ¾ç‚¹ï¼Œä¼°ä¸‰ä¸ªå°æ—¶â€”â€”è¯¥æ˜¯å¤šå°‘å°±æ˜¯å¤šå°‘ï¼Œè¿™ç›´æ¥å½±å“åˆ«äººå¯¹ä½ çš„ä¿¡ä»»ï¼Œå¦‚æœåŒä¸€ä»½å·¥ä½œä½ ç»™ä¼°äº†ä¸€ä¸ªæœˆï¼Œè€æ¿å»é—®å¦ä¸€ä¸ªå¼€å‘ï¼Œä»–åªä¼°äº†åŠä¸ªæœˆï¼Œé‚£è€æ¿ä»¥åå¯èƒ½å°±ä¸ä¼šå†æ‰¾ä½ åˆ†é…å·¥ä½œã€‚ä¸€å¤©å…«å°æ—¶å·¥ä½œåˆ¶ï¼Œç”±äºå„ç§å„æ ·çš„åŸå› å®é™…å¯æ”¯é…çš„æ—¶é—´å…¶å®å¹¶æ²¡æœ‰è¿™ä¹ˆå¤šï¼Œé‚£ä½ å¯ä»¥æå‰è¯´æ˜æ¯”å¦‚æˆ‘æ¯å¤©è¦ç»™åˆ«äººè§£å†³å„ç§å„æ ·çš„é—®é¢˜æˆ–è€…æ™šä¸Šæƒ³ç•™å‡ºä¸¤å°æ—¶çš„æ—¶é—´å­¦ä¹ ï¼Œæ‰€ä»¥æ¯å¤©å®é™…çš„å¼€å‘æ—¶é—´åªæœ‰5hï¼Œé‚£ä¸€ä»½40hå·¥ä½œé‡çš„ä»»åŠ¡å¯¹æˆ‘æ¥è¯´å°±éœ€è¦8dayï¼Œä½†ä¸€å®šä¸è¦æŠŠè¿™äº›é¢å¤–äº‹æƒ…çš„æ—¶é—´ç®—åˆ°è¿™ä¸ªä»»åŠ¡é‡Œã€‚</li><li>è¯„ä¼°ä»»åŠ¡å°½é‡æ‹†è§£çš„ç»†ä¸€äº›ï¼Œæƒ³çš„å…¨é¢ä¸€äº›ã€‚ä¸€ä¸ªéœ€æ±‚ä¸­å¤æ‚çš„å‘å’Œç»†èŠ‚å°½é‡ä¸€å¼€å§‹å°±è€ƒè™‘åˆ°ææ¸…æ¥šï¼Œå¹¶ç•™å‡ºç›¸åº”çš„æ—¶é—´ï¼Œä»¥é¿å…åšåˆ°ä¸€åŠå‘ç°æœ‰å‘å†delayï¼Œæ‰¿è¯ºè¿‡çš„äº‹æƒ…è¦æœ‰å¥‘çº¦ç²¾ç¥ã€‚æˆ‘çŸ¥é“è¿™å¾ˆéš¾ï¼Œä½†å°½é‡åšï¼Œå…¶å®æ¯ä¸ªä»»åŠ¡å®é™…å®Œæˆçš„æ—¶é—´æ¯”é¢„æœŸå·®ä¸ªä¸€å¤©åŠå¤©éƒ½æ˜¯æ­£å¸¸çš„ï¼Œå…³é”®æ˜¯è¦æ€»ç»“ç»éªŒï¼Œæƒ³æƒ³è¿™æ¬¡è¯„ä¼°ä¸­æœ‰å“ªäº›ä¸è¶³ï¼Œè®©ä¸‹æ¬¡çš„è¯„ä¼°å¯ä»¥æ›´å‡†ç¡®ã€‚å¦‚æœæ¯æ¬¡è¯„ä¼°éƒ½æ˜¯ç³Šå¼„äº†äº‹ï¼Œä½ ä¼šé€æ¸ä¸§å¤±æ—¶é—´è¯„ä¼°çš„èƒ½åŠ›ã€‚</li></ol><a id="more"></a><h3 id="æ—¶é—´ç®¡ç†"><a href="#æ—¶é—´ç®¡ç†" class="headerlink" title="æ—¶é—´ç®¡ç†"></a>æ—¶é—´ç®¡ç†</h3><p>â€‹       æ—¶é—´æ˜¯ä½ æœ€å®è´µçš„è´¢å¯Œï¼Œæ‰€ä»¥ä¸€å®šè¦åˆ©ç”¨å¥½ã€‚è¦å­¦ä¼šä¸»åŠ¨ç®¡ç†ï¼Œå¯¹äºå­¦ä¹ ä¸Šï¼Œæ¯å¤©ä¸€å®šè¦æŠ½å‡ºæ•´å—çš„ä¸è¢«æ‰“æ‰°çš„æ—¶é—´ç”¨æ¥å­¦ä¹ ï¼Œæå‡ä¸ªäººæŠ€æœ¯èƒ½åŠ›å’Œè‡ªèº«ä»·å€¼ï¼Œæ˜¯èµ°æŠ€æœ¯è¿™æ¡è·¯æœ€æœ€é‡è¦çš„ä¸€æ­¥ï¼Œæ´»åˆ°è€å­¦åˆ°è€ã€‚å¯¹äºå·¥ä½œä¸Šï¼Œå­¦ä¼šä½¿ç”¨ä»»åŠ¡ç®¡ç†å·¥å…·ï¼ˆå¦‚towerï¼‰ï¼Œä¸€äº›å°çš„é›¶ç¢çš„äº‹æƒ…ï¼ŒçŸ­æ—¶é—´èƒ½è§£å†³çš„ä¼˜å…ˆè§£å†³ï¼Œåˆ«ç»™è‡ªå·±æ”’å¤ªå¤šå‹åŠ›ï¼Œç„¶åé›†ä¸­ç²¾åŠ›å»åšé‚£äº›å¤§å—çš„å·¥ä½œã€‚å¦‚æœä¸€ä¸ªä»»åŠ¡çš„å·¥ä½œæ˜¯ä¸€å‘¨æˆ–ä¸¤å‘¨ï¼Œé‚£å°±æå‰æ‹†è§£å¥½æ¯å¤©è¦åšåˆ°ä»€ä¹ˆç¨‹åº¦ï¼Œæ¯æ™šreviewä¸€ä¸‹å·¥ä½œæƒ…å†µï¼Œå¯¹æ€»ä½“çš„è¿›åº¦æœ‰ä¸ªæŠŠæ§ï¼Œå¦‚æœæ„Ÿè§‰æä¸å®Œè¦delayå°±åŠ åŠ ç­æˆ–è€…æå‰å‘ä¸Šåé¦ˆï¼Œå› ä¸ºä»€ä¹ˆä»€ä¹ˆåŸå› ï¼Œè¿™ä¸ªä»»åŠ¡è¦delayå¤šä¹…ï¼Œå¹¶ç»™å‡ºè§£å†³æ–¹æ¡ˆï¼Œè¦ä¹ˆåŠ ç­ï¼Œè¦ä¹ˆæ•´ä½“å»¶æœŸã€‚ä¸€å®šä¸è¦ç­‰åˆ°deadlineäº†æ‰å‘ç°åšä¸å®Œï¼Œå½±å“æ•´ä¸ªå›¢é˜Ÿçš„è¿›åº¦ã€‚</p><h3 id="åŒäº‹ä¹‹é—´çš„äº¤å¾€"><a href="#åŒäº‹ä¹‹é—´çš„äº¤å¾€" class="headerlink" title="åŒäº‹ä¹‹é—´çš„äº¤å¾€"></a>åŒäº‹ä¹‹é—´çš„äº¤å¾€</h3><p>â€‹    å¤§å®¶ä¸€èµ·å…±äº‹éƒ½æ˜¯ç¼˜åˆ†ï¼Œä¸€ä¸ªå›¢é˜Ÿä¸­æ¯ä¸ªäººçš„æŠ€æœ¯è‚¯å®šæ˜¯æœ‰é«˜æœ‰ä½å‚å·®ä¸é½çš„ï¼Œæ€§æ ¼ä¹Ÿæ˜¯å¤šç§å¤šæ ·ã€‚ç›¸å¤„æ—¶è¦åšåˆ°è°¦è™šå’Œå°Šæ•¬ä»–äººï¼Œå­¦ä¼šå€¾å¬å’Œç«™åœ¨ä»–äººçš„è§’åº¦æ€è€ƒé—®é¢˜ï¼Œæ¯ä¸ªäººèº«ä¸Šè‚¯å®šéƒ½æœ‰æ¯”è‡ªå·±å¼ºå€¼å¾—å­¦ä¹ çš„åœ°æ–¹ï¼Œè¦å­¦ä¼šå‘ç°è¿™äº›é—ªå…‰ç‚¹ã€‚å½“åˆ«äººæ¥æ‰¾è‡ªå·±é—®é—®é¢˜çš„æ—¶å€™ï¼Œè¦æ³¨æ„è‡ªå·±çš„æ€åº¦ï¼Œå¯¹äº‹ä¸å¯¹äººï¼Œå¦‚æœä¸€ä¸ªäººå¯¹åŒä¸€ä¸ªé—®é¢˜æˆ–ç±»ä¼¼çš„é—®é¢˜æ‰¾ä½ é—®å¾ˆå¤šéï¼Œä½ å¯ä»¥è¯´è¿™ä¸ªé—®é¢˜æˆ‘ç»™ä½ è®²è¿‡å¾ˆå¤šæ¬¡äº†ï¼Œä½ å…ˆè‡ªå·±æƒ³ä¸€ä¸‹æœ‰æ²¡æœ‰æ€è·¯ï¼Œè¯¥æ€ä¹ˆè§£å†³ï¼Œæƒ³å¥½æ–¹æ¡ˆå†æ¥æ‰¾æˆ‘ï¼›ä½†å¦‚æœä»–å¸¦æ¥çš„æ˜¯ä¸ªæ–°é—®é¢˜è¿˜æ˜¯è¦è€å¿ƒè§£ç­”çš„ï¼Œä¸èƒ½å› ä¸ºä»–è€é—®é—®é¢˜å°±ä¸ç†ä»–ã€‚</p><h3 id="è´£ä»»ä¸å¿ƒæ€"><a href="#è´£ä»»ä¸å¿ƒæ€" class="headerlink" title="è´£ä»»ä¸å¿ƒæ€"></a>è´£ä»»ä¸å¿ƒæ€</h3><p>â€‹    å‡ºç°é—®é¢˜æ—¶leaderè¯¢é—®æƒ…å†µï¼Œè¦å…ˆå¿«é€Ÿå®šä½é—®é¢˜ï¼Œå¹¶ç»™å‡ºè§£å†³æ–¹æ¡ˆï¼Œåˆ†æåˆ©å¼Šï¼›å¦‚å‡ºçš„é—®é¢˜è·Ÿè‡ªå·±æ²¡å…³ç³»ï¼Œä¹Ÿå¯ä»¥å¾…å‘½çœ‹çœ‹æœ‰ä»€ä¹ˆèƒ½å¸®çš„ä¸Šå¿™çš„ï¼Œå¸®å¿™æ€è€ƒä¸‹è§£å†³æ–¹æ¡ˆï¼›é—®é¢˜è§£å†³åï¼Œæ€è€ƒé—®é¢˜æ˜¯æ€ä¹ˆé€ æˆçš„ï¼Œä»¥åæ€ä¹ˆé¿å…ï¼Œæ€»ç»“ç»éªŒï¼›å¦‚æœæ˜¯è‡ªèº«çš„åŸå› ä¸»åŠ¨æ‰¿æ‹…é”™è¯¯ï¼Œå¦‚æœæ˜¯åˆ«äººçš„åŸå› ï¼Œè‡ªå·±ä¹Ÿè¦å¼•ä»¥ä¸ºæˆ’ã€‚ä¸€å®šä¸è¦å‡ºäº†é—®é¢˜å…ˆè¯´è¿™ä»£ç æ˜¯è°è°è°å†™çš„ï¼ŒæŠŠè‡ªå·±æ’‡çš„ä¸€å¹²äºŒå‡€ï¼Œè¿™ç»™äººæ„Ÿè§‰å¾ˆä¸å¥½ï¼Œç›´æ¥å†³å®šäº†ä½ åšäº‹çš„é«˜åº¦ã€‚å‡ºé—®é¢˜æ˜¯åœ¨æ‰€éš¾å…çš„ï¼Œè¿™å¹¶ä¸å¯æ€•ï¼Œå¾ˆå¤šæ—¶å€™leaderä¹Ÿåªæ˜¯é—®é—®æƒ³ææ¸…æ¥šæƒ…å†µï¼Œå¹¶æ²¡æœ‰è¦è´£æ€ªè°çš„æ„æ€ï¼Œå…³é”®æ˜¯ä¸è¦è®©èŒƒè¿‡çš„é”™è¯¯é‡å¤çš„å‘ç”Ÿåœ¨è‡ªå·±èº«ä¸Šã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;æ—¶é—´è¯„ä¼°&quot;&gt;&lt;a href=&quot;#æ—¶é—´è¯„ä¼°&quot; class=&quot;headerlink&quot; title=&quot;æ—¶é—´è¯„ä¼°&quot;&gt;&lt;/a&gt;æ—¶é—´è¯„ä¼°&lt;/h3&gt;&lt;p&gt;â€‹    å½“leaderç»™ä½ ä¸€ä¸ªä»»åŠ¡é—®ä½ å¤šä¹…èƒ½å®Œæˆæ—¶ï¼Œä¸è¦ç®€å•çš„çœ‹ä¸€çœ‹å°±ç»™ä¸€ä¸ªä¼°æ‘¸çš„å¤§æ¦‚çš„æ—¶é—´ï¼Œè¦åŸ¹å…»å¯¹å·¥ä½œé‡è¯„ä¼°çš„èƒ½åŠ›ï¼Œè¿™å¾ˆé‡è¦ã€‚è¯„ä¼°æ—¶è¦åšåˆ°å°½é‡å‡†ç¡®ï¼Œå…·ä½“æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä¸è¦æƒ³ç€ä¸‰ä¸ªå°æ—¶çš„å·¥ä½œ,æˆ‘åŠ åŠ ç­èµ¶ä¸€èµ¶ä¸¤ä¸ªå°æ—¶æå®šâ€”â€”åœ¨ä»“ä¿ƒçŠ¶æ€ä¸‹èµ¶å·¥ï¼Œè´¨é‡å¿…ç„¶ä¼šæ”¶åˆ°å½±å“ï¼Œä½ åšçš„æ¯ä¸€ä»¶äº‹çš„è´¨é‡ä»£è¡¨ç€ä½ çš„ä¸ªäººæ°´å¹³ï¼Œå®ƒç›´æ¥å½±å“ç€ä½ åœ¨åˆ«äººå¿ƒä¸­çš„çœ‹æ³•ï¼Œè€Œä¸”ä¸€æ—¦å†å‡ºä»€ä¹ˆé¢å¤–çŠ¶å†µï¼Œè¿™ä¸ªä»»åŠ¡å°±ä¼šdelayã€‚&lt;/li&gt;
&lt;li&gt;ä¸¤ä¸ªå°æ—¶çš„å·¥ä½œé‡ï¼Œä¸è¦æƒ³ç€æˆ‘ç»™è‡ªå·±ä¼°å®½æ¾ç‚¹ï¼Œä¼°ä¸‰ä¸ªå°æ—¶â€”â€”è¯¥æ˜¯å¤šå°‘å°±æ˜¯å¤šå°‘ï¼Œè¿™ç›´æ¥å½±å“åˆ«äººå¯¹ä½ çš„ä¿¡ä»»ï¼Œå¦‚æœåŒä¸€ä»½å·¥ä½œä½ ç»™ä¼°äº†ä¸€ä¸ªæœˆï¼Œè€æ¿å»é—®å¦ä¸€ä¸ªå¼€å‘ï¼Œä»–åªä¼°äº†åŠä¸ªæœˆï¼Œé‚£è€æ¿ä»¥åå¯èƒ½å°±ä¸ä¼šå†æ‰¾ä½ åˆ†é…å·¥ä½œã€‚ä¸€å¤©å…«å°æ—¶å·¥ä½œåˆ¶ï¼Œç”±äºå„ç§å„æ ·çš„åŸå› å®é™…å¯æ”¯é…çš„æ—¶é—´å…¶å®å¹¶æ²¡æœ‰è¿™ä¹ˆå¤šï¼Œé‚£ä½ å¯ä»¥æå‰è¯´æ˜æ¯”å¦‚æˆ‘æ¯å¤©è¦ç»™åˆ«äººè§£å†³å„ç§å„æ ·çš„é—®é¢˜æˆ–è€…æ™šä¸Šæƒ³ç•™å‡ºä¸¤å°æ—¶çš„æ—¶é—´å­¦ä¹ ï¼Œæ‰€ä»¥æ¯å¤©å®é™…çš„å¼€å‘æ—¶é—´åªæœ‰5hï¼Œé‚£ä¸€ä»½40hå·¥ä½œé‡çš„ä»»åŠ¡å¯¹æˆ‘æ¥è¯´å°±éœ€è¦8dayï¼Œä½†ä¸€å®šä¸è¦æŠŠè¿™äº›é¢å¤–äº‹æƒ…çš„æ—¶é—´ç®—åˆ°è¿™ä¸ªä»»åŠ¡é‡Œã€‚&lt;/li&gt;
&lt;li&gt;è¯„ä¼°ä»»åŠ¡å°½é‡æ‹†è§£çš„ç»†ä¸€äº›ï¼Œæƒ³çš„å…¨é¢ä¸€äº›ã€‚ä¸€ä¸ªéœ€æ±‚ä¸­å¤æ‚çš„å‘å’Œç»†èŠ‚å°½é‡ä¸€å¼€å§‹å°±è€ƒè™‘åˆ°ææ¸…æ¥šï¼Œå¹¶ç•™å‡ºç›¸åº”çš„æ—¶é—´ï¼Œä»¥é¿å…åšåˆ°ä¸€åŠå‘ç°æœ‰å‘å†delayï¼Œæ‰¿è¯ºè¿‡çš„äº‹æƒ…è¦æœ‰å¥‘çº¦ç²¾ç¥ã€‚æˆ‘çŸ¥é“è¿™å¾ˆéš¾ï¼Œä½†å°½é‡åšï¼Œå…¶å®æ¯ä¸ªä»»åŠ¡å®é™…å®Œæˆçš„æ—¶é—´æ¯”é¢„æœŸå·®ä¸ªä¸€å¤©åŠå¤©éƒ½æ˜¯æ­£å¸¸çš„ï¼Œå…³é”®æ˜¯è¦æ€»ç»“ç»éªŒï¼Œæƒ³æƒ³è¿™æ¬¡è¯„ä¼°ä¸­æœ‰å“ªäº›ä¸è¶³ï¼Œè®©ä¸‹æ¬¡çš„è¯„ä¼°å¯ä»¥æ›´å‡†ç¡®ã€‚å¦‚æœæ¯æ¬¡è¯„ä¼°éƒ½æ˜¯ç³Šå¼„äº†äº‹ï¼Œä½ ä¼šé€æ¸ä¸§å¤±æ—¶é—´è¯„ä¼°çš„èƒ½åŠ›ã€‚&lt;/li&gt;
&lt;/ol&gt;
    
    </summary>
    
    
      <category term="ç»éªŒåæ€" scheme="https://akaqin.github.io/categories/%E7%BB%8F%E9%AA%8C%E5%8F%8D%E6%80%9D/"/>
    
    
      <category term="work" scheme="https://akaqin.github.io/tags/work/"/>
    
  </entry>
  
  <entry>
    <title>arts-10</title>
    <link href="https://akaqin.github.io/2018/10/07/arts-10/"/>
    <id>https://akaqin.github.io/2018/10/07/arts-10/</id>
    <published>2018-10-07T06:35:26.000Z</published>
    <updated>2020-03-07T12:44:10.193Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Algorithm"><a href="#Algorithm" class="headerlink" title="Algorithm"></a>Algorithm</h2><p>Given an integer array <code>nums</code>, find the contiguous subarray (containing at least one number) which has the largest sum and return its sum.</p><p><strong>Example:</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Input: [-2,1,-3,4,-1,2,1,-5,4],</span><br><span class="line">Output: 6</span><br><span class="line">Explanation: [4,-1,2,1] has the largest sum &#x3D; 6.</span><br></pre></td></tr></table></figure><p><strong>Follow up:</strong></p><p>If you have figured out the O(<em>n</em>) solution, try coding another solution using the divide and conquer approach, which is more subtle.</p><p><strong>Summary:</strong></p><p>æƒ³é—®é¢˜æ²¡æœ‰æ€è·¯æ—¶å¯ä»¥è¯•ç€æŠŠè´Ÿè´£çš„é—®é¢˜ç®€å•åŒ–ï¼Œæ¯”å¦‚è¿™é“é¢˜æ±‚<code>maxSubArray(int A[], int i, int j)</code>ï¼Œæˆ‘ä»¬å¯ä»¥ç®€åŒ–æˆæ±‚<code>maxSubArray(int A[], int i)</code>ï¼Œä¹Ÿå°±æ˜¯<code>A[0:i ]</code>â€”â€”ä»¥A[0]å¼€å¤´A[i]ç»“å°¾çš„æœ€å¤§å­é›†ï¼Œç„¶åå†è§‚å¯Ÿæ€»ç»“ï¼Œæˆ‘ä»¬å¾—å‡ºï¼š</p><blockquote><p>maxSubArray(A, i) = maxSubArray(A, i - 1) &gt; 0 ? maxSubArray(A, i - 1) : 0 + A[i];</p></blockquote><a id="more"></a><p><strong>Approach:</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">maxSubArray</span><span class="params">(<span class="keyword">int</span>* nums, <span class="keyword">int</span> numsSize)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> temp[numsSize];</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> <span class="built_in">max</span> = temp[<span class="number">0</span>] = nums[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">for</span> (; i&lt; numsSize; i++) &#123;</span><br><span class="line">        temp[i] = nums[i] + (temp[i<span class="number">-1</span>] &gt; <span class="number">0</span> ? temp[i<span class="number">-1</span>] : <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (; i&lt; numsSize; i++) &#123;</span><br><span class="line">        <span class="built_in">max</span> = <span class="built_in">max</span> &lt; temp[i] ? temp[i] : <span class="built_in">max</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">max</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;Algorithm&quot;&gt;&lt;a href=&quot;#Algorithm&quot; class=&quot;headerlink&quot; title=&quot;Algorithm&quot;&gt;&lt;/a&gt;Algorithm&lt;/h2&gt;&lt;p&gt;Given an integer array &lt;code&gt;nums&lt;/code&gt;, find the contiguous subarray (containing at least one number) which has the largest sum and return its sum.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Example:&lt;/strong&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;Input: [-2,1,-3,4,-1,2,1,-5,4],&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Output: 6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Explanation: [4,-1,2,1] has the largest sum &amp;#x3D; 6.&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;&lt;strong&gt;Follow up:&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;If you have figured out the O(&lt;em&gt;n&lt;/em&gt;) solution, try coding another solution using the divide and conquer approach, which is more subtle.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Summary:&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;æƒ³é—®é¢˜æ²¡æœ‰æ€è·¯æ—¶å¯ä»¥è¯•ç€æŠŠè´Ÿè´£çš„é—®é¢˜ç®€å•åŒ–ï¼Œæ¯”å¦‚è¿™é“é¢˜æ±‚&lt;code&gt;maxSubArray(int A[], int i, int j)&lt;/code&gt;ï¼Œæˆ‘ä»¬å¯ä»¥ç®€åŒ–æˆæ±‚&lt;code&gt;maxSubArray(int A[], int i)&lt;/code&gt;ï¼Œä¹Ÿå°±æ˜¯&lt;code&gt;A[0:i ]&lt;/code&gt;â€”â€”ä»¥A[0]å¼€å¤´A[i]ç»“å°¾çš„æœ€å¤§å­é›†ï¼Œç„¶åå†è§‚å¯Ÿæ€»ç»“ï¼Œæˆ‘ä»¬å¾—å‡ºï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;maxSubArray(A, i) = maxSubArray(A, i - 1) &amp;gt; 0 ? maxSubArray(A, i - 1) : 0 + A[i];&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
    
      <category term="ARTS" scheme="https://akaqin.github.io/categories/ARTS/"/>
    
    
      <category term="ARTS" scheme="https://akaqin.github.io/tags/ARTS/"/>
    
  </entry>
  
  <entry>
    <title>arts-9</title>
    <link href="https://akaqin.github.io/2018/10/06/arts-9/"/>
    <id>https://akaqin.github.io/2018/10/06/arts-9/</id>
    <published>2018-10-06T05:52:34.000Z</published>
    <updated>2020-03-07T12:43:55.379Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Algorithm"><a href="#Algorithm" class="headerlink" title="Algorithm"></a>Algorithm</h2><p>The count-and-say sequence is the sequence of integers with the first five terms as following:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1.     1</span><br><span class="line">2.     11</span><br><span class="line">3.     21</span><br><span class="line">4.     1211</span><br><span class="line">5.     111221</span><br></pre></td></tr></table></figure><p><code>1</code> is read off as <code>&quot;one 1&quot;</code> or <code>11</code>.<br><code>11</code> is read off as <code>&quot;two 1s&quot;</code> or <code>21</code>.<br><code>21</code> is read off as <code>&quot;one 2</code>, then <code>one 1&quot;</code> or <code>1211</code>.</p><p>Given an integer <em>n</em> where 1 â‰¤ <em>n</em> â‰¤ 30, generate the <em>n</em> th term of the count-and-say sequence.</p><p>Note: Each term of the sequence of integers will be represented as a string.</p><a id="more"></a><p><strong>Example 1:</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: 1</span><br><span class="line">Output: &quot;1&quot;</span><br></pre></td></tr></table></figure><p><strong>Example 2:</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: 4</span><br><span class="line">Output: &quot;1211&quot;</span><br></pre></td></tr></table></figure><p><strong>Approach</strong>:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">char</span> *<span class="title">change</span><span class="params">(<span class="keyword">char</span> *ret)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">char</span> *ret_temp = (<span class="keyword">char</span> *) <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="keyword">char</span>) * <span class="number">5000</span>);</span><br><span class="line">    <span class="keyword">int</span> count = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">char</span> flag = ret[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">int</span> j = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> bug = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; <span class="built_in">strlen</span>(ret); i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (flag == ret[i]) &#123;</span><br><span class="line">            count++;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            j += <span class="built_in">sprintf</span>(ret_temp + j, <span class="string">"%d%c"</span>, count, flag);</span><br><span class="line">            flag = ret[i];</span><br><span class="line">            count = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">sprintf</span>(ret_temp + j, <span class="string">"%d%c"</span>, count, flag);</span><br><span class="line">    <span class="built_in">free</span>(ret);</span><br><span class="line">    <span class="keyword">return</span> ret_temp;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">char</span> *<span class="title">countAndSay</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">char</span> *ret = (<span class="keyword">char</span> *) <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="keyword">char</span>) * <span class="number">5000</span>);</span><br><span class="line">    ret[<span class="number">0</span>] = <span class="string">'1'</span>;</span><br><span class="line">    ret[<span class="number">1</span>] = <span class="string">'\0'</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; n; i++) &#123;</span><br><span class="line">        ret = change(ret);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;Algorithm&quot;&gt;&lt;a href=&quot;#Algorithm&quot; class=&quot;headerlink&quot; title=&quot;Algorithm&quot;&gt;&lt;/a&gt;Algorithm&lt;/h2&gt;&lt;p&gt;The count-and-say sequence is the sequence of integers with the first five terms as following:&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1.     1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2.     11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3.     21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4.     1211&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5.     111221&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;&lt;code&gt;1&lt;/code&gt; is read off as &lt;code&gt;&amp;quot;one 1&amp;quot;&lt;/code&gt; or &lt;code&gt;11&lt;/code&gt;.&lt;br&gt;&lt;code&gt;11&lt;/code&gt; is read off as &lt;code&gt;&amp;quot;two 1s&amp;quot;&lt;/code&gt; or &lt;code&gt;21&lt;/code&gt;.&lt;br&gt;&lt;code&gt;21&lt;/code&gt; is read off as &lt;code&gt;&amp;quot;one 2&lt;/code&gt;, then &lt;code&gt;one 1&amp;quot;&lt;/code&gt; or &lt;code&gt;1211&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Given an integer &lt;em&gt;n&lt;/em&gt; where 1 â‰¤ &lt;em&gt;n&lt;/em&gt; â‰¤ 30, generate the &lt;em&gt;n&lt;/em&gt; th term of the count-and-say sequence.&lt;/p&gt;
&lt;p&gt;Note: Each term of the sequence of integers will be represented as a string.&lt;/p&gt;
    
    </summary>
    
    
      <category term="ARTS" scheme="https://akaqin.github.io/categories/ARTS/"/>
    
    
      <category term="ARTS" scheme="https://akaqin.github.io/tags/ARTS/"/>
    
  </entry>
  
  <entry>
    <title>å…³äºMacå‡çº§Mojaveåçš„ä¸€äº›å‘</title>
    <link href="https://akaqin.github.io/2018/10/04/%E5%85%B3%E4%BA%8EMac%E5%8D%87%E7%BA%A7Mojave%E5%90%8E%E7%9A%84%E4%B8%80%E4%BA%9B%E5%9D%91/"/>
    <id>https://akaqin.github.io/2018/10/04/%E5%85%B3%E4%BA%8EMac%E5%8D%87%E7%BA%A7Mojave%E5%90%8E%E7%9A%84%E4%B8%80%E4%BA%9B%E5%9D%91/</id>
    <published>2018-10-04T05:58:18.000Z</published>
    <updated>2020-03-07T12:20:26.288Z</updated>
    
    <content type="html"><![CDATA[<ol><li><p>Gitæ— æ³•ä½¿ç”¨ï¼ŒåŸå› æ˜¯æ¯æ¬¡å¤§ç‰ˆæœ¬å‡çº§åï¼ŒCommandLineToolså›è¢«å¸è½½ï¼Œè€ŒGitè¿™ç§å‘½ä»¤è¡Œå·¥å…·ä¾èµ–äºCommandLineToolsï¼Œè§£å†³æ–¹æ¡ˆæ˜¯é‡æ–°å®‰è£…CommandLineToolsã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xcode-select --install</span><br></pre></td></tr></table></figure></li><li><p>gccç¼–è¯‘æ–‡ä»¶æ—¶æ‰¾ä¸åˆ°å¤´æ–‡ä»¶ï¼ŒæŠ¥ç±»ä¼¼äº stdio.h file not found çš„é”™è¯¯ï¼Œå…·ä½“æƒ…å†µå¯ä»¥çœ‹<a href="https://stackoverflow.com/questions/52509602/cant-compile-c-program-on-a-mac-after-upgrade-to-mojave" target="_blank" rel="noopener">StackOverflow</a>ä¸Šè¿™ä¸ªæé—®ã€‚è§£å†³æ–¹æ¡ˆæ˜¯ä½¿ç”¨brewå®‰è£…æˆ–å‡çº§gccæœ€æ–°ç‰ˆæœ¬ï¼Œå¹¶åœ¨ä½ çš„IDEä¸­é…ç½®å®ƒï¼Œè¿™é‡Œç»™å‡ºCLionçš„<a href="https://www.jetbrains.com/help/clion/how-to-switch-compilers-in-clion.html" target="_blank" rel="noopener">é…ç½®æ•™ç¨‹</a>ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">brew install gcc</span><br><span class="line">brew upgrade gcc</span><br></pre></td></tr></table></figure></li></ol><p>å¦‚æœä½ é‡åˆ°äº†ä¸€äº›å…¶ä»–é—®é¢˜ï¼Œæ¬¢è¿ç»™æˆ‘ç•™è¨€è®¨è®ºã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;ol&gt;
&lt;li&gt;&lt;p&gt;Gitæ— æ³•ä½¿ç”¨ï¼ŒåŸå› æ˜¯æ¯æ¬¡å¤§ç‰ˆæœ¬å‡çº§åï¼ŒCommandLineToolså›è¢«å¸è½½ï¼Œè€ŒGitè¿™ç§å‘½ä»¤è¡Œå·¥å…·ä¾èµ–äºCommandLineToolsï¼Œè§£å†³æ–¹æ¡ˆæ˜¯é‡æ–°å®‰è£…CommandLineToolsã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight 
      
    
    </summary>
    
    
      <category term="è¸©å‘è®°å½•" scheme="https://akaqin.github.io/categories/%E8%B8%A9%E5%9D%91%E8%AE%B0%E5%BD%95/"/>
    
    
      <category term="macOS" scheme="https://akaqin.github.io/tags/macOS/"/>
    
  </entry>
  
  <entry>
    <title>arts-8</title>
    <link href="https://akaqin.github.io/2018/10/03/arts-8/"/>
    <id>https://akaqin.github.io/2018/10/03/arts-8/</id>
    <published>2018-10-03T06:30:47.000Z</published>
    <updated>2020-03-07T12:43:35.664Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Algorithm"><a href="#Algorithm" class="headerlink" title="Algorithm"></a>Algorithm</h2><p>Given a sorted array <em>nums</em>, remove the duplicates <a href="https://en.wikipedia.org/wiki/In-place_algorithm" target="_blank" rel="noopener"><strong>in-place</strong></a> such that each element appear only <em>once</em> and return the new length.</p><p>Do not allocate extra space for another array, you must do this by <strong>modifying the input array in-place</strong> with O(1) extra memory.</p><p><strong>Example 1:</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Given nums &#x3D; [1,1,2],</span><br><span class="line"></span><br><span class="line">Your function should return length &#x3D; 2, with the first two elements of nums being 1 and 2 respectively.</span><br><span class="line"></span><br><span class="line">It doesn&#39;t matter what you leave beyond the returned length.</span><br></pre></td></tr></table></figure><a id="more"></a><p><strong>Example 2:</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Given nums &#x3D; [0,0,1,1,1,2,2,3,3,4],</span><br><span class="line"></span><br><span class="line">Your function should return length &#x3D; 5, with the first five elements of nums being modified to 0, 1, 2, 3, and 4 respectively.</span><br><span class="line"></span><br><span class="line">It doesn&#39;t matter what values are set beyond the returned length.</span><br></pre></td></tr></table></figure><p><strong>Approach 1: two pointer</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">removeDuplicates</span><span class="params">(<span class="keyword">int</span>* nums, <span class="keyword">int</span> numsSize)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (numsSize ==<span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt; numsSize; j++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (nums[i] != nums[j]) &#123;</span><br><span class="line">            nums[++i] = nums[j];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ++i;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”¨åŒæŒ‡é’ˆéå†è¿™ä¸ªæ•°ç»„ï¼Œä¸€ä¸ªæŒ‡é’ˆç”¨æ¥è¿­ä»£ï¼Œå¦ä¸€ä¸ªè®°å½•ä¸é‡å¤çš„å€¼çš„ç´¢å¼•ã€‚æ—¶é—´å¤æ‚åº¦O(n)ï¼Œç©ºé—´å¤æ‚åº¦O(1)ã€‚</p><p>Given an array <em>nums</em> and a value <em>val</em>, remove all instances of that value <a href="https://en.wikipedia.org/wiki/In-place_algorithm" target="_blank" rel="noopener"><strong>in-place</strong></a> and return the new length.</p><p>Do not allocate extra space for another array, you must do this by <strong>modifying the input array in-place</strong> with O(1) extra memory.</p><p>The order of elements can be changed. It doesnâ€™t matter what you leave beyond the new length.</p><p><strong>Example 1:</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Given nums &#x3D; [3,2,2,3], val &#x3D; 3,</span><br><span class="line"></span><br><span class="line">Your function should return length &#x3D; 2, with the first two elements of nums being 2.</span><br><span class="line"></span><br><span class="line">It doesn&#39;t matter what you leave beyond the returned length.</span><br></pre></td></tr></table></figure><p><strong>Example 2:</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Given nums &#x3D; [0,1,2,2,3,0,4,2], val &#x3D; 2,</span><br><span class="line"></span><br><span class="line">Your function should return length &#x3D; 5, with the first five elements of nums containing 0, 1, 3, 0, and 4.</span><br><span class="line"></span><br><span class="line">Note that the order of those five elements can be arbitrary.</span><br><span class="line"></span><br><span class="line">It doesn&#39;t matter what values are set beyond the returned length.</span><br></pre></td></tr></table></figure><p><strong>approach 1:two pointer</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">removeElement</span><span class="params">(<span class="keyword">int</span>* nums, <span class="keyword">int</span> numsSize, <span class="keyword">int</span> val)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">0</span>, j = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (; i&lt; numsSize; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (nums[i] != val) &#123;</span><br><span class="line">            nums[j++] = nums[i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> j;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Approach-2-Two-Pointers-when-elements-to-remove-are-rare"><a href="#Approach-2-Two-Pointers-when-elements-to-remove-are-rare" class="headerlink" title="Approach 2: Two Pointers - when elements to remove are rare"></a><strong>Approach 2: Two Pointers - when elements to remove are rare</strong></h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">removeElement</span><span class="params">(<span class="keyword">int</span>[] nums, <span class="keyword">int</span> val)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> n = nums.length;</span><br><span class="line">    <span class="keyword">while</span> (i &lt; n) &#123;</span><br><span class="line">        <span class="keyword">if</span> (nums[i] == val) &#123;</span><br><span class="line">            nums[i] = nums[n - <span class="number">1</span>];</span><br><span class="line">            <span class="comment">// reduce array size by one</span></span><br><span class="line">            n--;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            i++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> n;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Intuition</strong></p><p>Now consider cases where the array contains few elements to remove. For example, nums = [1,2,3,5,4], val = 4nums=[1,2,3,5,4],val=4. The previous algorithm will do unnecessary copy operation of the first four elements. Another example is nums = [4,1,2,3,5], val = 4nums=[4,1,2,3,5],val=4. It seems unnecessary to move elements [1,2,3,5][1,2,3,5] one step left as the problem description mentions that the order of elements could be changed.</p><p><strong>Algorithm</strong></p><p>When we encounter nums[i] = valnums[i]=val, we can swap the current element out with the last element and dispose the last one. This essentially reduces the arrayâ€™s size by 1.</p><p>Note that the last element that was swapped in could be the value you want to remove itself. But donâ€™t worry, in the next iteration we will still check this element.</p><p><strong>Complexity analysis</strong></p><ul><li>Time complexity : O(n)O(n). Both ii and nn traverse at most nn steps. In this approach, the number of assignment operation is equal to the number of elements to remove. So it is more efficient if elements to remove are rare.</li><li>Space complexity : O(1)O(1).</li></ul>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;Algorithm&quot;&gt;&lt;a href=&quot;#Algorithm&quot; class=&quot;headerlink&quot; title=&quot;Algorithm&quot;&gt;&lt;/a&gt;Algorithm&lt;/h2&gt;&lt;p&gt;Given a sorted array &lt;em&gt;nums&lt;/em&gt;, remove the duplicates &lt;a href=&quot;https://en.wikipedia.org/wiki/In-place_algorithm&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;&lt;strong&gt;in-place&lt;/strong&gt;&lt;/a&gt; such that each element appear only &lt;em&gt;once&lt;/em&gt; and return the new length.&lt;/p&gt;
&lt;p&gt;Do not allocate extra space for another array, you must do this by &lt;strong&gt;modifying the input array in-place&lt;/strong&gt; with O(1) extra memory.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Example 1:&lt;/strong&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;Given nums &amp;#x3D; [1,1,2],&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Your function should return length &amp;#x3D; 2, with the first two elements of nums being 1 and 2 respectively.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;It doesn&amp;#39;t matter what you leave beyond the returned length.&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
      <category term="ARTS" scheme="https://akaqin.github.io/categories/ARTS/"/>
    
    
      <category term="ARTS" scheme="https://akaqin.github.io/tags/ARTS/"/>
    
  </entry>
  
  <entry>
    <title>å¼‚æ­¥ç½‘ç»œæ¨¡å‹</title>
    <link href="https://akaqin.github.io/2018/09/24/%E5%BC%82%E6%AD%A5%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%9E%8B/"/>
    <id>https://akaqin.github.io/2018/09/24/%E5%BC%82%E6%AD%A5%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%9E%8B/</id>
    <published>2018-09-24T07:33:38.000Z</published>
    <updated>2020-03-08T07:43:18.184Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å¼‚æ­¥ç½‘ç»œæ¨¡å‹"><a href="#å¼‚æ­¥ç½‘ç»œæ¨¡å‹" class="headerlink" title="å¼‚æ­¥ç½‘ç»œæ¨¡å‹"></a>å¼‚æ­¥ç½‘ç»œæ¨¡å‹</h1><p>å¼‚æ­¥ç½‘ç»œæ¨¡å‹åœ¨æœåŠ¡å¼€å‘ä¸­åº”ç”¨éå¸¸å¹¿æ³›ï¼Œç›¸å…³èµ„æ–™å’Œå¼€æºåº“ä¹Ÿéå¸¸å¤šã€‚é¡¹ç›®ä¸­ï¼Œä½¿ç”¨ç°æˆçš„è½®å­æé«˜äº†å¼€å‘æ•ˆç‡ï¼Œé™¤äº†èƒ½ä½¿ç”¨è½®å­ï¼Œè¿˜æ˜¯æœ‰å¿…è¦äº†è§£ä¸€ä¸‹è½®å­çš„å†…éƒ¨æ„é€ ã€‚</p><p>è¿™ç¯‡æ–‡ç« ä»æœ€åŸºç¡€çš„5ç§I/Oæ¨¡å‹åˆ‡å…¥ï¼Œåˆ°I/Oäº‹ä»¶å¤„ç†æ¨¡å‹ï¼Œå†åˆ°å¹¶å‘æ¨¡å¼ï¼Œæœ€åä»¥Swooleå¼€æºåº“æ¥åšå…·ä½“åˆ†æï¼Œé€æ­¥æ·±å…¥ã€‚æ–‡ä¸­æåˆ°çš„æ¨¡å‹éƒ½æ˜¯ä¸€äº›é€šç”¨çš„æ¨¡å‹ï¼Œåœ¨ã€Šlinuxé«˜æ€§èƒ½æœåŠ¡å™¨ç¼–ç¨‹ã€‹ä¸­ä¹Ÿéƒ½æœ‰æ¶‰åŠã€‚æ–‡ç« ä¸æ¶‰åŠæ¨¡å‹çš„å®ç°ç»†èŠ‚ï¼Œæœ€é‡è¦çš„æ˜¯å»ç†è§£å„ä¸ªæ¨¡å‹çš„å·¥ä½œæ¨¡å¼ä»¥åŠå…¶ä¼˜ç¼ºç‚¹ã€‚</p><p>è¯»åæ„Ÿï¼š</p><p>æ‰€è°“å¼‚æ­¥ï¼š</p><p>1.(fd)é˜»å¡è°ƒç”¨ + select/pool, epool  ï¼ˆIOäº‹ä»¶é€šçŸ¥æ–¹å¼ï¼šIOå¤ç”¨ï¼‰</p><p>2.(fd)éé˜»å¡è°ƒç”¨ + SIGIO ï¼ˆIOäº‹ä»¶é€šçŸ¥æ–¹å¼ï¼šSIGIO ä¿¡å·ï¼‰</p><a id="more"></a><p>æ–‡ä¸­æ¶‰åŠæ¥å£è°ƒç”¨çš„éƒ¨åˆ†ï¼Œéƒ½æ˜¯æŒ‡Linuxç³»ç»Ÿçš„æ¥å£è°ƒç”¨ã€‚å…±åˆ†ä¸º5éƒ¨åˆ†ï¼š</p><p>I/Oæ¨¡å‹</p><p>ä»åŸºç¡€çš„ç³»ç»Ÿè°ƒç”¨æ–¹æ³•å‡ºå‘ï¼Œç»™å¤§å®¶ä»å¤´å›é¡¾ä¸€ä¸‹æœ€åŸºæœ¬çš„I/Oæ¨¡å‹ï¼Œè™½ç„¶ç®€å•ï¼Œä½†æ˜¯ä¸å¯æˆ–ç¼ºçš„åŸºç¡€ï¼›</p><p>äº‹ä»¶å¤„ç†æ¨¡å‹</p><p>è¿™éƒ¨åˆ†åœ¨åŒæ­¥I/Oã€å¼‚æ­¥I/Oçš„åŸºç¡€ä¸Šåˆ†åˆ«ä»‹ç»Reactoræ¨¡å‹ä»¥åŠProactoræ¨¡å‹ï¼Œç€é‡ä¸¤ç§æ¨¡å‹çš„æ„æˆä»¥åŠäº‹ä»¶å¤„ç†æµç¨‹ã€‚Reactoræ¨¡å‹æ˜¯æˆ‘ä»¬å¸¸è§çš„ï¼›ä¸åŒå¹³å°å¯¹å¼‚æ­¥I/Oç³»ç»Ÿæ¥å£çš„æ”¯æŒåŠ›åº¦ä¸åŒï¼Œè¿™éƒ¨åˆ†è¿˜ä»‹ç»äº†ä¸€ç§ä½¿ç”¨åŒæ­¥I/Oæ¥æ¨¡æ‹ŸProactoræ¨¡å‹çš„æ–¹æ³•ã€‚</p><p>å¹¶å‘æ¨¡å¼</p><p>å°±æ˜¯å¤šçº¿ç¨‹ã€å¤šè¿›ç¨‹çš„ç¼–ç¨‹çš„æ¨¡å¼ã€‚ä»‹ç»äº†ä¸¤ç§è¾ƒä¸ºé«˜æ•ˆçš„å¹¶å‘æ¨¡å‹ï¼ŒåŠåŒæ­¥ï¼åŠå¼‚æ­¥(åŒ…æ‹¬å…¶æ¼”å˜æ¨¡å¼)ã€Followerï¼Leaderæ¨¡å¼ã€‚</p><p>Swooleå¼‚æ­¥ç½‘ç»œæ¨¡å‹åˆ†æ</p><p>è¿™éƒ¨åˆ†æ˜¯ç»“åˆå·²ä»‹ç»çš„äº‹ä»¶å¤„ç†æ¨¡å‹ã€å¹¶å‘æ¨¡å¼å¯¹Swooleçš„å¼‚æ­¥æ¨¡å‹è¿›è¡Œåˆ†æï¼›ä»åˆ†æçš„è¿‡ç¨‹æ¥çœ‹ï¼Œçœ‹ä¼¼å¤æ‚çš„ç½‘ç»œæ¨¡å‹ï¼Œå¯ä»¥æ‹†åˆ†ä¸ºç®€å•çš„æ¨¡å‹å•å…ƒï¼Œåªä¸è¿‡æˆ‘ä»¬éœ€è¦æƒè¡¡åˆ©å¼Šï¼Œé€‰å–åˆé€‚ä¸šåŠ¡éœ€æ±‚çš„æ¨¡å‹å•å…ƒè¿›è¡Œç»„åˆã€‚æˆ‘ä»¬å›¢é˜ŸåŸºäºSwoole 1.8.5ç‰ˆæœ¬ï¼Œåšäº†å¾ˆå¤šä¿®æ”¹ï¼Œéƒ¨åˆ†æ¨¡å—åšäº†é‡æ„ï¼Œè®¡åˆ’åœ¨17å¹´6æœˆåº•å°†ä¿®æ”¹åç‰ˆæœ¬å¼€æºå‡ºå»ï¼Œæ•¬è¯·æœŸå¾…ã€‚</p><p>æ”¹å–„æ€§èƒ½çš„æ–¹æ³•</p><p>æœ€åä¸€éƒ¨åˆ†æ˜¯åœ¨å¼•å…¥è¯é¢˜ï¼Œä»‹ç»çš„æ˜¯å‡ ç§å¸¸ç”¨çš„æ–¹æ³•ã€‚æ€§èƒ½ä¼˜åŒ–æ˜¯æ²¡æœ‰ç»ˆç‚¹çš„ï¼Œå¸Œæœ›å¤§å®¶èƒ½è´¡çŒ®ä¸€äº›æƒ³æ³•å’Œå…·ä½“æ–¹æ³•ã€‚</p><p>I/Oæ¨¡å‹</p><p>POSIX è§„èŒƒä¸­å®šä¹‰äº†åŒæ­¥I/O å’Œå¼‚æ­¥I/Oçš„æœ¯è¯­ï¼Œ</p><p>åŒæ­¥I/O : éœ€è¦è¿›ç¨‹å»çœŸæ­£çš„å»æ“ä½œI/Oï¼›</p><p>å¼‚æ­¥I/Oï¼šå†…æ ¸åœ¨I/Oæ“ä½œå®Œæˆåå†é€šçŸ¥åº”ç”¨è¿›ç¨‹æ“ä½œç»“æœã€‚</p><p>åœ¨ã€ŠUNIXç½‘ç»œç¼–ç¨‹ã€‹ä¸­ä»‹ç»äº†5ä¸­I/Oæ¨¡å‹ï¼šé˜»å¡I/Oã€éé˜»å¡I/Oã€I/Oå¤ç”¨ã€SIGIO ã€å¼‚æ­¥I/Oï¼›æœ¬èŠ‚å¯¹è¿™5ç§I/Oæ¨¡å‹è¿›è¡Œè¯´æ˜å’Œå¯¹æ¯”ã€‚</p><p>I/Oé˜»å¡</p><p>é€šå¸¸æŠŠé˜»å¡çš„æ–‡ä»¶æè¿°ç¬¦ï¼ˆfile descriptorï¼Œfdï¼‰ç§°ä¹‹ä¸ºé˜»å¡I/Oã€‚é»˜è®¤æ¡ä»¶ä¸‹ï¼Œåˆ›å»ºçš„socket fdæ˜¯é˜»å¡çš„ï¼Œé’ˆå¯¹é˜»å¡I/Oè°ƒç”¨ç³»ç»Ÿæ¥å£ï¼Œå¯èƒ½å› ä¸ºç­‰å¾…çš„äº‹ä»¶æ²¡æœ‰åˆ°è¾¾è€Œè¢«ç³»ç»ŸæŒ‚èµ·ï¼Œç›´åˆ°ç­‰å¾…çš„äº‹ä»¶è§¦å‘è°ƒç”¨æ¥å£æ‰è¿”å›ï¼Œä¾‹å¦‚ï¼Œtcp socketçš„connectè°ƒç”¨ä¼šé˜»å¡è‡³ç¬¬ä¸‰æ¬¡æ¡æ‰‹æˆåŠŸï¼ˆä¸è€ƒè™‘socket å‡ºé”™æˆ–ç³»ç»Ÿä¸­æ–­ï¼‰ï¼Œå¦‚å›¾1æ‰€ç¤ºã€‚å¦å¤–socket çš„ç³»ç»ŸAPI ï¼Œå¦‚ï¼Œacceptã€sendã€recvç­‰éƒ½å¯èƒ½è¢«é˜»å¡ã€‚</p><p><img src="https:////note.youdao.com/src/B7FFBB5BC3684E41BFFE7BB61A1BF09E" alt="img"></p><p>â€‹                      å›¾1I/O é˜»å¡æ¨¡å‹ç¤ºæ„å›¾</p><p>1</p><p>å¦å¤–è¡¥å……ä¸€ç‚¹ï¼Œç½‘ç»œç¼–ç¨‹ä¸­ï¼Œé€šå¸¸æŠŠå¯èƒ½æ°¸è¿œé˜»å¡çš„ç³»ç»ŸAPIè°ƒç”¨ ç§°ä¸ºæ…¢ç³»ç»Ÿè°ƒç”¨ï¼Œå…¸å‹çš„å¦‚ acceptã€recvã€selectç­‰ã€‚æ…¢ç³»ç»Ÿè°ƒç”¨åœ¨é˜»å¡æœŸé—´å¯èƒ½è¢«ä¿¡å·ä¸­æ–­è€Œè¿”å›é”™è¯¯ï¼Œç›¸åº”çš„errno è¢«è®¾ç½®ä¸ºEINTRï¼Œæˆ‘ä»¬éœ€è¦å¤„ç†è¿™ç§é”™è¯¯ï¼Œè§£å†³åŠæ³•æœ‰ï¼š</p><p>\1. é‡å¯ç³»ç»Ÿè°ƒç”¨</p><p>ç›´æ¥ä¸Šç¤ºä¾‹ä»£ç å§ï¼Œä»¥acceptä¸ºä¾‹ï¼Œè¢«ä¸­æ–­åé‡å¯accept ã€‚æœ‰ä¸ªä¾‹å¤–ï¼Œè‹¥connect ç³»ç»Ÿè°ƒç”¨åœ¨é˜»å¡æ—¶è¢«ä¸­æ–­ï¼Œæ˜¯ä¸èƒ½ç›´æ¥é‡å¯çš„ï¼ˆä¸å†…æ ¸socket çš„çŠ¶æ€æœ‰å…³)ï¼Œæœ‰å…´è¶£çš„åŒå­¦å¯ä»¥æ·±å…¥ç ”ç©¶ä¸€ä¸‹connect çš„å†…æ ¸å®ç°ã€‚ä½¿ç”¨I/Oå¤ç”¨ç­‰å¾…è¿æ¥å®Œæˆï¼Œèƒ½é¿å…connectä¸èƒ½é‡å¯çš„é—®é¢˜ã€‚</p><p>int client_fd = -1;  structsockaddr_inclient_addr;socklen_t child_addrlen;  while (1) {  call_accept:      client_fd = accept(server_fd,NULL,NULL)ï¼›    if (client_fd &lt; 0) {       if (EINTR == errno) {          goto call_accept;       } else {          sw_sysError(â€œaccept failâ€);          break;       }    }}</p><p>123456789101112131415</p><p>\2. ä¿¡å·å¤„ç†</p><p>åˆ©ç”¨ä¿¡å·å¤„ç†ï¼Œå¯ä»¥é€‰æ‹©å¿½ç•¥ä¿¡å·ï¼Œæˆ–è€…åœ¨å®‰è£…ä¿¡å·æ—¶è®¾ç½®SA_RESTARTå±æ€§ã€‚è®¾ç½®å±æ€§SA_RESTARTï¼Œä¿¡å·å¤„ç†å‡½æ•°è¿”å›åï¼Œè¢«å®‰è£…ä¿¡å·ä¸­æ–­çš„ç³»ç»Ÿè°ƒç”¨å°†è‡ªåŠ¨æ¢å¤ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ã€‚éœ€è¦çŸ¥é“çš„æ˜¯ï¼Œè®¾ç½®SA_RESTARTå±æ€§æ–¹æ³•å¹¶ä¸å®Œå…¨é€‚ç”¨ï¼Œå¯¹æŸäº›ç³»ç»Ÿè°ƒç”¨å¯èƒ½æ— æ•ˆï¼Œè¿™é‡Œåªæ˜¯æä¾›ä¸€ç§è§£å†³é—®é¢˜çš„æ€è·¯ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p><p>int client_fd = -1;  structsigactionaction,old_action;action.sa_handler = sig_handler;  sigemptyset(&amp;action.sa_mask);  action.sa_flags = 0;  action.sa_flags |= SA_RESTART;/// è‹¥ä¿¡å·å·²ç»è¢«å¿½ç•¥ï¼Œåˆ™ä¸è®¾ç½®sigaction(SIGALRM, NULL, &amp;old_action)ï¼›  if (old_action.sa_handler != SIG_IGN) {      sigaction(SIGALRM, &amp;action, NULL)ï¼›}while (1) {      client_fd = accept(server_fd,NULL,NULL)ï¼›    if (client_fd &lt; 0) {        sw_sysError(â€œaccept failâ€);        break;    }}</p><p>123456789101112131415161718192021</p><p>I/Oéé˜»å¡</p><p>æŠŠéé˜»å¡çš„æ–‡ä»¶æè¿°ç¬¦ç§°ä¸ºéé˜»å¡I/Oã€‚å¯ä»¥é€šè¿‡è®¾ç½®SOCK_NONBLOCKæ ‡è®°åˆ›å»ºéé˜»å¡çš„socket fdï¼Œæˆ–è€…ä½¿ç”¨fcntlå°†fdè®¾ç½®ä¸ºéé˜»å¡ã€‚</p><p>å¯¹éé˜»å¡fdè°ƒç”¨ç³»ç»Ÿæ¥å£æ—¶ï¼Œä¸éœ€è¦ç­‰å¾…äº‹ä»¶å‘ç”Ÿè€Œç«‹å³è¿”å›ï¼Œäº‹ä»¶æ²¡æœ‰å‘ç”Ÿï¼Œæ¥å£è¿”å›-1ï¼Œæ­¤æ—¶éœ€è¦é€šè¿‡errnoçš„å€¼æ¥åŒºåˆ†æ˜¯å¦å‡ºé”™ï¼Œæœ‰è¿‡ç½‘ç»œç¼–ç¨‹çš„ç»éªŒçš„åº”è¯¥éƒ½äº†è§£è¿™ç‚¹ã€‚ä¸åŒçš„æ¥å£ï¼Œç«‹å³è¿”å›æ—¶çš„errnoå€¼ä¸å°½ç›¸åŒï¼Œå¦‚ï¼Œrecvã€sendã€accept errnoé€šå¸¸è¢«è®¾ç½®ä¸ºEAGIN æˆ–è€…EWOULDBLOCKï¼Œconnect åˆ™ä¸ºEINPRO-GRESS ã€‚</p><p>ä»¥recvæ“ä½œéé˜»å¡å¥—æ¥å­—ä¸ºä¾‹ï¼Œå¦‚å›¾2æ‰€ç¤ºã€‚</p><p><img src="https:////note.youdao.com/src/0DF7FBEB18524D968DA0D4DC4F7ED257" alt="img"></p><p>â€‹                     å›¾2 éé˜»å¡I/Oæ¨¡å‹ç¤ºæ„å›¾</p><p>1</p><p>å½“æˆ‘ä»¬éœ€è¦è¯»å–ï¼Œåœ¨æœ‰æ•°æ®å¯è¯»çš„äº‹ä»¶è§¦å‘æ—¶ï¼Œå†è°ƒç”¨recvï¼Œé¿å…åº”ç”¨å±‚ä¸æ–­å»è½®è¯¢æ£€æŸ¥æ˜¯å¦å¯è¯»ï¼Œæé«˜ç¨‹åºçš„å¤„ç†æ•ˆç‡ã€‚é€šå¸¸éé˜»å¡I/Oä¸I/Oäº‹ä»¶å¤„ç†æœºåˆ¶ç»“åˆä½¿ç”¨ã€‚</p><p>I/Oå¤ç”¨</p><p>æœ€å¸¸ç”¨çš„I/Oäº‹ä»¶é€šçŸ¥æœºåˆ¶å°±æ˜¯I/Oå¤ç”¨(I/O multiplexing)ã€‚Linux ç¯å¢ƒä¸­ä½¿ç”¨select/poll/epoll å®ç°I/Oå¤ç”¨ï¼ŒI/Oå¤ç”¨æ¥å£æœ¬èº«æ˜¯é˜»å¡çš„ï¼Œåœ¨åº”ç”¨ç¨‹åºä¸­é€šè¿‡I/Oå¤ç”¨æ¥å£å‘å†…æ ¸æ³¨å†Œfdæ‰€å…³æ³¨çš„äº‹ä»¶ï¼Œå½“å…³æ³¨äº‹ä»¶è§¦å‘æ—¶ï¼Œé€šè¿‡I/Oå¤ç”¨æ¥å£çš„è¿”å›å€¼é€šçŸ¥åˆ°åº”ç”¨ç¨‹åºï¼Œå¦‚å›¾3æ‰€ç¤º,ä»¥recvä¸ºä¾‹ã€‚I/Oå¤ç”¨æ¥å£å¯ä»¥åŒæ—¶ç›‘å¬å¤šä¸ªI/Oäº‹ä»¶ä»¥æé«˜äº‹ä»¶å¤„ç†æ•ˆç‡ã€‚</p><p><img src="https:////note.youdao.com/src/2FE99F76417C4837A098D4D8DA4EDFCF" alt="img"></p><p>â€‹                    å›¾ 3I/Oå¤ç”¨æ¨¡å‹ç¤ºæ„å›¾</p><p>1</p><p>å…³äºselect/poll/epollçš„å¯¹æ¯”ï¼Œå¯ä»¥å‚è€ƒ[]ï¼Œepollä½¿ç”¨æ¯”è¾ƒå¤šï¼Œä½†æ˜¯åœ¨å¹¶å‘çš„æ¨¡å¼ä¸‹ï¼Œéœ€è¦å…³æ³¨æƒŠç¾¤çš„å½±å“ã€‚</p><p>SIGIO</p><p>é™¤äº†I/Oå¤ç”¨æ–¹å¼é€šçŸ¥I/Oäº‹ä»¶ï¼Œè¿˜å¯ä»¥é€šè¿‡SIGIOä¿¡å·æ¥é€šçŸ¥I/Oäº‹ä»¶ï¼Œå¦‚å›¾4æ‰€ç¤ºã€‚ä¸¤è€…ä¸åŒçš„æ˜¯ï¼Œåœ¨ç­‰å¾…æ•°æ®è¾¾åˆ°æœŸé—´ï¼ŒI/Oå¤ç”¨æ˜¯ä¼šé˜»å¡åº”ç”¨ç¨‹åºï¼Œè€ŒSIGIOæ–¹å¼æ˜¯ä¸ä¼šé˜»å¡åº”ç”¨ç¨‹åºçš„ã€‚</p><p><img src="https:////note.youdao.com/src/4EC5DCA3909E4C52910ABD33BC7FD478" alt="img"></p><p>â€‹                     å›¾ 4 ä¿¡å·é©±åŠ¨I/Oæ¨¡å‹ç¤ºæ„å›¾</p><p>1</p><p>å¼‚æ­¥I/O</p><p>POSIXè§„èŒƒå®šä¹‰äº†ä¸€ç»„å¼‚æ­¥æ“ä½œI/Oçš„æ¥å£ï¼Œä¸ç”¨å…³å¿ƒfd æ˜¯é˜»å¡è¿˜æ˜¯éé˜»å¡ï¼Œå¼‚æ­¥I/Oæ˜¯ç”±å†…æ ¸æ¥ç®¡åº”ç”¨å±‚å¯¹fdçš„I/Oæ“ä½œã€‚å¼‚æ­¥I/Oå‘åº”ç”¨å±‚é€šçŸ¥I/Oæ“ä½œå®Œæˆçš„äº‹ä»¶ï¼Œè¿™ä¸å‰é¢ä»‹ç»çš„I/O å¤ç”¨æ¨¡å‹ã€SIGIOæ¨¡å‹é€šçŸ¥äº‹ä»¶å°±ç»ªçš„æ–¹å¼æ˜æ˜¾ä¸åŒã€‚ä»¥aio_read å®ç°å¼‚æ­¥è¯»å–IOæ•°æ®ä¸ºä¾‹ï¼Œå¦‚å›¾5æ‰€ç¤ºï¼Œåœ¨ç­‰å¾…I/Oæ“ä½œå®ŒæˆæœŸé—´ï¼Œä¸ä¼šé˜»å¡åº”ç”¨ç¨‹åºã€‚</p><p><img src="https:////note.youdao.com/src/DDC1E38AE6ED40E6B1302E75DFD4F7F8" alt="img"></p><p>â€‹                      å›¾ 5 å¼‚æ­¥I/O æ¨¡å‹ç¤ºæ„å›¾</p><p>1</p><p>I/Oæ¨¡å‹å¯¹æ¯”</p><p>å‰é¢ä»‹ç»çš„5ä¸­I/Oä¸­ï¼ŒI/O é˜»å¡ã€I/Oéé˜»å¡ã€I/Oå¤ç”¨ã€SIGIO éƒ½ä¼šåœ¨ä¸åŒç¨‹åº¦ä¸Šé˜»å¡åº”ç”¨ç¨‹åºï¼Œè€Œåªæœ‰å¼‚æ­¥I/Oæ¨¡å‹åœ¨æ•´ä¸ªæ“ä½œæœŸé—´éƒ½ä¸ä¼šé˜»å¡åº”ç”¨ç¨‹åºã€‚</p><p>å¦‚å›¾6æ‰€ç¤ºï¼Œåˆ—å‡ºäº†5ç§I/Oæ¨¡å‹çš„æ¯”è¾ƒ</p><p><img src="https:////note.youdao.com/src/3F0992AC6EC74A9880DC225FF3F8EE05" alt="img"></p><p>â€‹                   å›¾6 äº”ç§I/O æ¨¡å‹æ¯”è¾ƒç¤ºæ„å›¾</p><p>1</p><p>äº‹ä»¶å¤„ç†æ¨¡å‹</p><p>ç½‘ç»œè®¾è®¡æ¨¡å¼ä¸­ï¼Œå¦‚ä½•å¤„ç†å„ç§I/Oäº‹ä»¶æ˜¯å…¶éå¸¸é‡è¦çš„ä¸€éƒ¨åˆ†ï¼ŒReactor å’ŒProactorä¸¤ç§äº‹ä»¶å¤„ç†æ¨¡å‹åº”è¿è€Œç”Ÿã€‚ä¸Šç« èŠ‚æåˆ°å°†I/Oåˆ†ä¸ºåŒæ­¥I/O å’Œ å¼‚æ­¥I/Oï¼Œå¯ä»¥ä½¿ç”¨åŒæ­¥I/Oå®ç°Reactoræ¨¡å‹ï¼Œä½¿ç”¨å¼‚æ­¥I/Oå®ç°Proactoræ¨¡å‹ã€‚</p><p>æœ¬ç« èŠ‚å°†ä»‹ç»Reactorå’ŒProactorä¸¤ç§æ¨¡å‹ï¼Œæœ€åå°†ä»‹ç»ä¸€ç§ä½¿ç”¨åŒæ­¥I/Oæ¨¡æ‹ŸProactoräº‹ä»¶å¤„ç†æ¨¡å‹ã€‚</p><p>Reactoräº‹ä»¶å¤„ç†æ¨¡å‹</p><p>Reactoræ¨¡å‹æ˜¯åŒæ­¥I/Oäº‹ä»¶å¤„ç†çš„ä¸€ç§å¸¸è§æ¨¡å‹ï¼Œå…³äºReactoræ¨¡å‹ç»“æ„çš„èµ„æ–™éå¸¸å¤šï¼Œä¸€ä¸ªå…¸å‹çš„Reactoræ¨¡å‹ç±»å›¾ç»“æ„å¦‚å›¾7æ‰€ç¤ºï¼Œ</p><p><img src="https:////note.youdao.com/src/CBD29D74325044DAB307FFCFE83D46E2" alt="img"></p><p>â€‹                   å›¾ 7 Reactor æ¨¡å‹ç±»ç»“æ„å›¾</p><p>1</p><p>Reactorçš„æ ¸å¿ƒæ€æƒ³ï¼šå°†å…³æ³¨çš„I/Oäº‹ä»¶æ³¨å†Œåˆ°å¤šè·¯å¤ç”¨å™¨ä¸Šï¼Œä¸€æ—¦æœ‰I/Oäº‹ä»¶è§¦å‘ï¼Œå°†äº‹ä»¶åˆ†å‘åˆ°äº‹ä»¶å¤„ç†å™¨ä¸­ï¼Œæ‰§è¡Œå°±ç»ªI/Oäº‹ä»¶å¯¹åº”çš„å¤„ç†å‡½æ•°ä¸­ã€‚æ¨¡å‹ä¸­æœ‰ä¸‰ä¸ªé‡è¦çš„ç»„ä»¶ï¼š</p><ul><li>å¤šè·¯å¤ç”¨å™¨ï¼šç”±æ“ä½œç³»ç»Ÿæä¾›æ¥å£ï¼ŒLinuxæä¾›çš„I/Oå¤ç”¨æ¥å£æœ‰selectã€pollã€epollï¼›</li><li>äº‹ä»¶åˆ†ç¦»å™¨ï¼šå°†å¤šè·¯å¤ç”¨å™¨è¿”å›çš„å°±ç»ªäº‹ä»¶åˆ†å‘åˆ°äº‹ä»¶å¤„ç†å™¨ä¸­ï¼›</li><li>äº‹ä»¶å¤„ç†å™¨ï¼šå¤„ç†å°±ç»ªäº‹ä»¶å¤„ç†å‡½æ•°ã€‚</li></ul><p>å›¾7æ‰€ç¤ºï¼ŒReactor ç±»ç»“æ„ä¸­åŒ…å«æœ‰å¦‚ä¸‹è§’è‰²ã€‚</p><ul><li>Handleï¼šæ ‡ç¤ºæ–‡ä»¶æè¿°ç¬¦ï¼›</li><li>Event Demultiplexerï¼šæ‰§è¡Œå¤šè·¯äº‹ä»¶åˆ†è§£æ“ä½œï¼Œå¯¹æ“ä½œç³»ç»Ÿå†…æ ¸å®ç°I/Oå¤ç”¨æ¥å£çš„å°è£…ï¼›ç”¨äºé˜»å¡ç­‰å¾…å‘ç”Ÿåœ¨å¥æŸ„é›†åˆä¸Šçš„ä¸€ä¸ªæˆ–å¤šä¸ªäº‹ä»¶ï¼ˆå¦‚select/poll/epollï¼‰ï¼›</li><li>Event Handlerï¼šäº‹ä»¶å¤„ç†æ¥å£ï¼›</li><li>Event Handler A(B)ï¼šå®ç°åº”ç”¨ç¨‹åºæ‰€æä¾›çš„ç‰¹å®šäº‹ä»¶å¤„ç†é€»è¾‘ï¼›</li><li>Reactorï¼šååº”å™¨ï¼Œå®šä¹‰ä¸€ä¸ªæ¥å£ï¼Œå®ç°ä»¥ä¸‹åŠŸèƒ½ï¼š</li></ul><p>â€‹      a)ä¾›åº”ç”¨ç¨‹åºæ³¨å†Œå’Œåˆ é™¤å…³æ³¨çš„äº‹ä»¶å¥æŸ„ï¼›      b)è¿è¡Œäº‹ä»¶å¤„ç†å¾ªç¯ï¼›      c)ç­‰å¾…çš„å°±ç»ªäº‹ä»¶è§¦å‘ï¼Œåˆ†å‘äº‹ä»¶åˆ°ä¹‹å‰æ³¨å†Œçš„å›è°ƒå‡½æ•°ä¸Šå¤„ç†.</p><p>123</p><p>æ¥ä¸‹æ¥ä»‹ç»Reactorçš„å·¥ä½œæµç¨‹ï¼Œå¦‚å›¾8æ‰€ç¤ºï¼Œä¸ºReactoræ¨¡å‹å·¥ä½œçš„ç®€åŒ–æµç¨‹ã€‚</p><p><img src="https:////note.youdao.com/src/FA1A0970047647E9BE2DC7AB66721B97" alt="img"></p><p>â€‹                  å›¾8 Reactoræ¨¡å‹ç®€åŒ–æµç¨‹ç¤ºæ„å›¾</p><p>1</p><ol><li>æ³¨å†ŒI/Oå°±ç»ªäº‹ä»¶å¤„ç†å™¨ï¼›</li><li>äº‹ä»¶åˆ†ç¦»å™¨ç­‰å¾…I/Oå°±ç»ªäº‹ä»¶ï¼›</li><li>I/Oäº‹ä»¶è§¦å‘ï¼Œæ¿€æ´»äº‹ä»¶åˆ†ç¦»å™¨ï¼Œåˆ†ç¦»å™¨è°ƒåº¦å¯¹åº”çš„äº‹ä»¶å¤„ç†å™¨ï¼›</li><li>äº‹ä»¶å¤„ç†å™¨å®ŒæˆI/Oæ“ä½œï¼Œå¤„ç†æ•°æ®.</li></ol><p>ç½‘ç»œè®¾è®¡ä¸­ï¼ŒReactorä½¿ç”¨éå¸¸å¹¿ï¼Œåœ¨å¼€æºç¤¾åŒºæœ‰å¾ˆè®¸å¤šéå¸¸æˆç†Ÿçš„ã€è·¨å¹³å°çš„ã€Reactoræ¨¡å‹çš„ç½‘ç»œåº“ï¼Œæ¯”è¾ƒå…¸å‹å¦‚libeventã€‚</p><p>Proactoräº‹ä»¶å¤„ç†æ¨¡å‹</p><p>ä¸Reactorä¸åŒçš„æ˜¯ï¼ŒProactorä½¿ç”¨å¼‚æ­¥I/Oç³»ç»Ÿæ¥å£å°†I/Oæ“ä½œæ‰˜ç®¡ç»™æ“ä½œç³»ç»Ÿï¼ŒProactoræ¨¡å‹ä¸­åˆ†å‘å¤„ç†å¼‚æ­¥I/Oå®Œæˆäº‹ä»¶ï¼Œå¹¶è°ƒç”¨ç›¸åº”çš„äº‹ä»¶å¤„ç†æ¥å£æ¥å¤„ç†ä¸šåŠ¡é€»è¾‘ã€‚Proactorç±»ç»“æ„å¦‚å›¾9æ‰€ç¤ºã€‚</p><p><img src="https:////note.youdao.com/src/541F3DEA29674188AD21BB9C12AB2508" alt="img"></p><p>â€‹                    å›¾9 Proactoræ¨¡å‹ç±»ç»“æ„å›¾</p><p>1</p><p>å›¾9æ‰€ç¤ºï¼ŒProactorç±»ç»“æ„ä¸­åŒ…å«æœ‰å¦‚ä¸‹è§’è‰²ï¼š</p><ul><li>Handleï¼š ç”¨æ¥æ ‡è¯†socketè¿æ¥æˆ–æ˜¯æ‰“å¼€æ–‡ä»¶ï¼›</li><li>Async Operation Processorï¼šå¼‚æ­¥æ“ä½œå¤„ç†å™¨ï¼›è´Ÿè´£æ‰§è¡Œå¼‚æ­¥æ“ä½œï¼Œä¸€èˆ¬ç”±æ“ä½œç³»ç»Ÿå†…æ ¸å®ç°ï¼›</li><li>Async Operationï¼šå¼‚æ­¥æ“ä½œï¼›</li><li>Completion Event Queueï¼šå®Œæˆäº‹ä»¶é˜Ÿåˆ—ï¼›å¼‚æ­¥æ“ä½œå®Œæˆçš„ç»“æœæ”¾åˆ°é˜Ÿåˆ—ä¸­ç­‰å¾…åç»­ä½¿ç”¨ï¼›</li><li>Proactorï¼šä¸»åŠ¨å™¨ï¼›ä¸ºåº”ç”¨ç¨‹åºè¿›ç¨‹æä¾›äº‹ä»¶å¾ªç¯ï¼›ä»å®Œæˆäº‹ä»¶é˜Ÿåˆ—ä¸­å–å‡ºå¼‚æ­¥æ“ä½œçš„ç»“æœï¼Œåˆ†å‘è°ƒç”¨ç›¸åº”çš„åç»­å¤„ç†é€»è¾‘ï¼›</li><li>Completion Handlerï¼šå®Œæˆäº‹ä»¶æ¥å£ï¼›ä¸€èˆ¬æ˜¯ç”±å›è°ƒå‡½æ•°ç»„æˆçš„æ¥å£ï¼›</li><li>Completion Handler A(B)ï¼šå®Œæˆäº‹ä»¶å¤„ç†é€»è¾‘ï¼›å®ç°æ¥å£å®šä¹‰ç‰¹å®šçš„åº”ç”¨å¤„ç†é€»è¾‘ã€‚</li></ul><p>Proactoræ¨¡å‹çš„ç®€åŒ–çš„å·¥ä½œæµç¨‹,å¦‚å›¾10æ‰€ç¤ºã€‚</p><p><img src="https:////note.youdao.com/src/72BA30C44C334ED28602FDA853052912" alt="img"></p><p>â€‹                 å›¾10 Proactoræ¨¡å‹ç®€åŒ–å·¥ä½œæµç¨‹ç¤ºæ„å›¾</p><p>1</p><ol><li>å‘èµ·I/Oå¼‚æ­¥æ“ä½œï¼Œæ³¨å†ŒI/Oå®Œæˆäº‹ä»¶å¤„ç†å™¨;</li><li>äº‹ä»¶åˆ†ç¦»å™¨ç­‰å¾…I/Oæ“ä½œå®Œæˆäº‹ä»¶ï¼›</li><li>å†…æ ¸å¹¶è¡Œæ‰§è¡Œå®é™…çš„I/Oæ“ä½œï¼Œå¹¶å°†ç»“æœæ•°æ®å­˜å…¥ç”¨æˆ·è‡ªå®šä¹‰ç¼“ å†²åŒºï¼›</li><li>å†…æ ¸å®ŒæˆI/Oæ“ä½œï¼Œé€šçŸ¥äº‹ä»¶åˆ†ç¦»å™¨ï¼Œäº‹ä»¶åˆ†ç¦»å™¨è°ƒåº¦å¯¹åº”çš„äº‹ä»¶å¤„ç†å™¨ï¼›</li><li>äº‹ä»¶å¤„ç†å™¨å¤„ç†ç”¨æˆ·è‡ªå®šä¹‰ç¼“å†²åŒºä¸­çš„æ•°æ®ã€‚</li></ol><p>Proactoråˆ©ç”¨å¼‚æ­¥I/Oå¹¶è¡Œèƒ½åŠ›ï¼Œå¯ç»™åº”ç”¨ç¨‹åºå¸¦æ¥æ›´é«˜çš„æ•ˆç‡ï¼Œä½†æ˜¯åŒæ—¶ä¹Ÿå¢åŠ äº†ç¼–ç¨‹çš„å¤æ‚åº¦ã€‚windowså¯¹å¼‚æ­¥I/Oæä¾›äº†éå¸¸å¥½çš„æ”¯æŒï¼Œå¸¸ç”¨Proactorçš„æ¨¡å‹å®ç°æœåŠ¡å™¨ï¼›è€ŒLinuxå¯¹å¼‚æ­¥I/Oæ“ä½œ(aioæ¥å£)çš„æ”¯æŒå¹¶ä¸æ˜¯ç‰¹åˆ«ç†æƒ³ï¼Œè€Œä¸”ä¸èƒ½ç›´æ¥å¤„ç†acceptï¼Œå› æ­¤Linuxå¹³å°ä¸Šè¿˜æ˜¯ä»¥Reactoræ¨¡å‹ä¸ºä¸»ã€‚</p><p>Boost asioé‡‡ç”¨çš„æ˜¯Proactoræ¨¡å‹ï¼Œä½†æ˜¯Linuxä¸Šï¼Œé‡‡ç”¨I/Oå¤ç”¨çš„æ–¹å¼æ¥æ¨¡æ‹ŸProactorï¼Œå¦å¯ç”¨çº¿ç¨‹æ¥å®Œæˆè¯»å†™æ“ä½œå’Œè°ƒåº¦ã€‚</p><p>åŒæ­¥I/Oæ¨¡æ‹ŸProactor</p><p>ä¸‹é¢ä¸€ç§ä½¿ç”¨åŒæ­¥I/Oæ¨¡æ‹ŸProactorçš„æ–¹æ¡ˆï¼ŒåŸç†æ˜¯ï¼š</p><p>ä¸»çº¿ç¨‹æ‰§è¡Œæ•°æ®è¯»å†™æ“ä½œï¼Œè¯»å†™æ“ä½œå®Œæˆåï¼Œä¸»çº¿ç¨‹å‘å·¥ä½œçº¿ç¨‹é€šçŸ¥I/Oæ“ä½œâ€œå®Œæˆäº‹ä»¶â€ï¼›</p><p>å·¥ä½œæµç¨‹å¦‚å›¾ 11æ‰€ç¤ºã€‚</p><p><img src="https:////note.youdao.com/src/4A797D1DFA4345A6B8CA651380814811" alt="img"></p><p>â€‹                  å›¾11 åŒæ­¥I/Oæ¨¡æ‹ŸProactoræ¨¡å‹</p><p>1</p><p>ç®€å•çš„æè¿°ä¸€ä¸‹å›¾11 çš„æ‰§è¡Œæµç¨‹ï¼š</p><ol><li>ä¸»çº¿ç¨‹å¾€ç³»ç»ŸI/Oå¤ç”¨ä¸­æ³¨å†Œæ–‡ä»¶æè¿°ç¬¦fdä¸Šçš„è¯»å°±ç»ªäº‹ä»¶ï¼›</li><li>ä¸»çº¿ç¨‹è°ƒç”¨è°ƒç”¨ç³»ç»ŸI/Oå¤ç”¨æ¥å£ç­‰å¾…æ–‡ä»¶æè¿°ç¬¦fdä¸Šæœ‰æ•°æ®å¯è¯»ï¼›</li><li>å½“fdä¸Šæœ‰æ•°æ®å¯è¯»æ—¶ï¼Œé€šçŸ¥ä¸»çº¿ç¨‹ã€‚ä¸»çº¿ç¨‹å¾ªç¯è¯»å–fdä¸Šçš„æ•°æ®ï¼Œç›´åˆ°æ²¡æœ‰æ›´å¤šæ•°æ®å¯è¯»ï¼Œç„¶åå°†è¯»å–åˆ°çš„æ•°æ®å°è£…æˆä¸€ä¸ªè¯·æ±‚å¯¹è±¡å¹¶æ’å…¥è¯·æ±‚é˜Ÿåˆ—ã€‚</li><li>ç¡çœ åœ¨è¯·æ±‚é˜Ÿåˆ—ä¸Šçš„æŸä¸ªå·¥ä½œçº¿ç¨‹è¢«å”¤é†’ï¼Œå®ƒè·å¾—è¯·æ±‚å¯¹è±¡å¹¶å¤„ç†å®¢æˆ·è¯·æ±‚ï¼Œç„¶åå‘I/Oå¤ç”¨ä¸­æ³¨å†Œfdä¸Šçš„å†™å°±ç»ªäº‹ä»¶ã€‚ä¸»çº¿ç¨‹è¿›å…¥äº‹ä»¶ç­‰å¾…å¾ªç¯ï¼Œç­‰å¾…fdå¯å†™ã€‚</li></ol><p>å¹¶å‘æ¨¡å¼</p><p>åœ¨I/Oå¯†é›†å‹çš„ç¨‹åºï¼Œé‡‡ç”¨å¹¶å‘æ–¹å¼å¯ä»¥æé«˜CPUçš„ä½¿ç”¨ç‡ï¼Œå¯é‡‡ç”¨å¤šè¿›ç¨‹å’Œå¤šçº¿ç¨‹ä¸¤ç§æ–¹å¼å®ç°å¹¶å‘ã€‚å½“å‰æœ‰é«˜æ•ˆçš„ä¸¤ç§å¹¶å‘æ¨¡å¼ï¼ŒåŠåŒæ­¥/åŠå¼‚æ­¥æ¨¡å¼ã€Follower/Leaderæ¨¡å¼ã€‚</p><p>åŠåŒæ­¥/åŠå¼‚æ­¥æ¨¡å¼</p><p>é¦–å…ˆåŒºåˆ†ä¸€ä¸ªæ¦‚å¿µï¼Œå¹¶å‘æ¨¡å¼ä¸­çš„â€œåŒæ­¥â€ã€â€œå¼‚æ­¥â€ä¸ I/Oæ¨¡å‹ä¸­çš„â€œåŒæ­¥â€ã€â€œå¼‚æ­¥â€æ˜¯ä¸¤ä¸ªä¸åŒçš„æ¦‚å¿µï¼š</p><p>å¹¶å‘æ¨¡å¼ä¸­ï¼Œâ€œåŒæ­¥â€æŒ‡ç¨‹åºæŒ‰ç…§ä»£ç é¡ºåºæ‰§è¡Œï¼Œâ€œå¼‚æ­¥â€æŒ‡ç¨‹åºä¾èµ–äº‹ä»¶é©±åŠ¨ï¼Œå¦‚å›¾12 æ‰€ç¤ºå¹¶å‘æ¨¡å¼çš„â€œåŒæ­¥â€æ‰§è¡Œå’Œâ€œå¼‚æ­¥â€æ‰§è¡Œçš„è¯»æ“ä½œï¼›</p><p>I/Oæ¨¡å‹ä¸­ï¼Œâ€œåŒæ­¥â€ã€â€œå¼‚æ­¥â€ç”¨æ¥åŒºåˆ†I/Oæ“ä½œçš„æ–¹å¼ï¼Œæ˜¯ä¸»åŠ¨é€šè¿‡I/Oæ“ä½œæ‹¿åˆ°ç»“æœï¼Œè¿˜æ˜¯ç”±å†…æ ¸å¼‚æ­¥çš„è¿”å›æ“ä½œç»“æœã€‚</p><p><img src="https:////note.youdao.com/src/C0FEC4831C074C0CB23329F010B270AD" alt="img"></p><p>â€‹                     å›¾12(a)  åŒæ­¥è¯»æ“ä½œç¤ºæ„å›¾</p><p>1</p><p><img src="https:////note.youdao.com/src/4CAE98C8589D434B95B3DFA4B94D1028" alt="img"></p><p>â€‹                     å›¾12(b) å¼‚æ­¥è¯»æ“ä½œç¤ºæ„å›¾</p><p>1</p><p>æœ¬èŠ‚ä»æœ€ç®€å•çš„åŠåŒæ­¥/åŠå¼‚æ­¥æ¨¡å¼çš„å·¥ä½œæµç¨‹å‡ºå‘ï¼Œå¹¶ç»“åˆäº‹ä»¶å¤„ç†æ¨¡å‹ä»‹ç»ä¸¤ç§æ¼”å˜çš„æ¨¡å¼ã€‚</p><p>åŠåŒæ­¥/åŠå¼‚æ­¥å·¥ä½œæµç¨‹</p><p>åŠåŒæ­¥/åŠå¼‚æ­¥æ¨¡å¼çš„å·¥ä½œæµç¨‹å¦‚å›¾13 æ‰€ç¤ºã€‚</p><p><img src="https:////note.youdao.com/src/C8F33A95D4AA432A94A9D57854FE5977" alt="img"></p><p>â€‹              å›¾13 åŠåŒæ­¥/åŠå¼‚æ­¥æ¨¡å¼çš„å·¥ä½œæµç¨‹ç¤ºæ„å›¾</p><p>1</p><p>å…¶ä¸­å¼‚æ­¥çº¿ç¨‹å¤„ç†I/Oäº‹ä»¶ï¼ŒåŒæ­¥çº¿ç¨‹å¤„ç†è¯·æ±‚å¯¹è±¡ï¼Œç®€å•çš„æ¥è¯´ï¼š</p><ol><li>å¼‚æ­¥çº¿ç¨‹ç›‘å¬åˆ°äº‹ä»¶åï¼Œå°†å…¶å°è£…ä¸ºè¯·æ±‚å¯¹è±¡æ’å…¥åˆ°è¯·æ±‚é˜Ÿåˆ—ä¸­ï¼›</li><li>è¯·æ±‚é˜Ÿåˆ—æœ‰æ–°çš„è¯·æ±‚å¯¹è±¡ï¼Œé€šçŸ¥åŒæ­¥çº¿ç¨‹è·å–è¯·æ±‚å¯¹è±¡ï¼›</li><li>åŒæ­¥çº¿ç¨‹å¤„ç†è¯·æ±‚å¯¹è±¡ï¼Œå®ç°ä¸šåŠ¡é€»è¾‘ã€‚</li></ol><p>åŠåŒæ­¥/åŠååº”å †æ¨¡å¼</p><p>è€ƒè™‘å°†ä¸¤ç§äº‹ä»¶å¤„ç†æ¨¡å‹ï¼Œå³Reactorå’ŒProactorï¼Œä¸å‡ ç§I/Oæ¨¡å‹ç»“åˆåœ¨ä¸€èµ·ï¼Œé‚£ä¹ˆåŠåŒæ­¥/åŠå¼‚æ­¥æ¨¡å¼å°±æ¼”å˜ä¸ºåŠåŒæ­¥ï¼åŠååº”å †æ¨¡å¼ã€‚å…ˆçœ‹çœ‹ä½¿ç”¨Reactorçš„æ–¹å¼ï¼Œå¦‚å›¾14 æ‰€ç¤ºã€‚</p><p><img src="https:////note.youdao.com/src/249D671B15CD43F8AC5733EB176EF31A" alt="img"></p><p>â€‹                    å›¾14 åŠåŒæ­¥ï¼åŠååº”å †æ¨¡å¼ç¤ºæ„å›¾</p><p>1</p><p>å…¶å·¥ä½œæµç¨‹ä¸ºï¼š</p><ol><li>å¼‚æ­¥çº¿ç¨‹ç›‘å¬æ‰€æœ‰fdä¸Šçš„I/Oäº‹ä»¶ï¼Œè‹¥ç›‘å¬socketæ¥å¯è¯»ï¼Œæ¥å—æ–°çš„è¿æ¥ï¼›å¹¶ç›‘å¬è¯¥è¿æ¥ä¸Šçš„è¯»å†™äº‹ä»¶ï¼›</li><li>è‹¥è¿æ¥socketä¸Šæœ‰è¯»å†™äº‹ä»¶å‘ç”Ÿï¼Œå¼‚æ­¥çº¿ç¨‹å°†è¯¥è¿æ¥socketæ’å…¥è¯·æ±‚é˜Ÿåˆ—ä¸­ï¼›</li><li>åŒæ­¥çº¿ç¨‹è¢«å”¤é†’ï¼Œå¹¶æ¥ç®¡è¿æ¥socketï¼Œä»socketä¸Šè¯»å–è¯·æ±‚å’Œå‘é€åº”ç­”ï¼›</li></ol><p>è‹¥å°†Reactoræ›¿æ¢ä¸ºProactorï¼Œé‚£ä¹ˆå…¶å·¥ä½œæµç¨‹ä¸ºï¼š</p><ol><li>å¼‚æ­¥çº¿ç¨‹å®ŒæˆI/Oæ“ä½œï¼Œå¹¶I/Oæ“ä½œçš„ç»“æœå°è£…ä¸ºä»»åŠ¡å¯¹è±¡ï¼Œæ’å…¥è¯·æ±‚é˜Ÿåˆ—ä¸­ï¼›</li><li>è¯·æ±‚é˜Ÿåˆ—é€šçŸ¥åŒæ­¥çº¿ç¨‹å¤„ç†ä»»åŠ¡ï¼›</li><li>åŒæ­¥çº¿ç¨‹æ‰§è¡Œä»»åŠ¡å¤„ç†é€»è¾‘ã€‚</li></ol><p>ä¸€ç§é«˜æ•ˆçš„æ¼”å˜æ¨¡å¼</p><p>åŠåŒæ­¥ï¼åŠååº”å †æ¨¡å¼æœ‰æ˜æ˜¾çš„ç¼ºç‚¹ï¼š</p><ol><li>å¼‚æ­¥çº¿ç¨‹å’ŒåŒæ­¥çº¿ç¨‹å…±äº«é˜Ÿåˆ—ï¼Œéœ€è¦ä¿æŠ¤ï¼Œå­˜åœ¨èµ„æºç«äº‰ï¼›</li><li>å·¥ä½œçº¿ç¨‹åŒä¸€æ—¶é—´åªèƒ½å¤„ç†ä¸€ä¸ªä»»åŠ¡ï¼Œä»»åŠ¡å¤„ç†é‡å¾ˆå¤§æˆ–è€…ä»»åŠ¡å¤„ç†å­˜åœ¨ä¸€å®šçš„é˜»å¡æ—¶ï¼Œä»»åŠ¡é˜Ÿåˆ—å°†ä¼šå †ç§¯ï¼Œä»»åŠ¡çš„æ—¶æ•ˆæ€§ä¹Ÿç­‰ä¸åˆ°ä¿è¯ï¼›ä¸èƒ½ç®€å•åœ°è€ƒè™‘å¢åŠ å·¥ä½œçº¿ç¨‹æ¥å¤„ç†è¯¥é—®é¢˜ï¼Œçº¿ç¨‹æ•°è¾¾åˆ°ä¸€å®šçš„ç¨‹åº¦ï¼Œå·¥ä½œçº¿ç¨‹çš„åˆ‡æ¢ä¹Ÿå°†ç™½ç™½æ¶ˆè€—å¤§é‡çš„CPUèµ„æºã€‚</li></ol><p>ä¸‹é¢ä»‹ç»ä¸€ç§æ”¹è¿›çš„æ–¹å¼ï¼Œå¦‚å›¾15 æ‰€ç¤ºï¼Œæ¯ä¸ªå·¥ä½œçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„äº‹ä»¶å¾ªç¯ï¼Œèƒ½åŒæ—¶ç‹¬ç«‹å¤„ç†å¤šä¸ªç”¨æˆ·è¿æ¥ã€‚</p><p><img src="https:////note.youdao.com/src/B73C3DDD172F400C9A270FAD1E69048F" alt="img"></p><p>â€‹                å›¾ 15 åŠåŒæ­¥ï¼åŠååº”å †æ¨¡å¼çš„æ¼”å˜æ¨¡å¼</p><p>1</p><p>å…¶å·¥ä½œæµç¨‹ä¸ºï¼š</p><ol><li>ä¸»çº¿ç¨‹å®ç°è¿æ¥ç›‘å¬ï¼Œåªå¤„ç†ç½‘ç»œI/Oè¿æ¥äº‹ä»¶ï¼›</li><li>æ–°çš„è¿æ¥socketåˆ†å‘è‡³å·¥ä½œçº¿ç¨‹ä¸­ï¼Œè¿™ä¸ªsocketä¸Šçš„I/Oäº‹ä»¶éƒ½ç”±è¯¥å·¥ä½œçº¿ç¨‹å¤„ç†ï¼Œå·¥ä½œçº¿ç¨‹éƒ½å¯ä»¥å¤„ç†å¤šä¸ªsocket çš„I/Oäº‹ä»¶ï¼›</li><li>å·¥ä½œçº¿ç¨‹ç‹¬ç«‹ç»´æŠ¤è‡ªå·±çš„äº‹ä»¶å¾ªç¯ï¼Œç›‘å¬ä¸åŒè¿æ¥socketçš„I/Oäº‹ä»¶ã€‚</li></ol><p>Follower/Leader æ¨¡å¼</p><p>Follower/Leaderæ˜¯å¤šä¸ªå·¥ä½œçº¿ç¨‹è½®æµè¿›è¡Œäº‹ä»¶ç›‘å¬ã€äº‹ä»¶åˆ†å‘ã€å¤„ç†äº‹ä»¶çš„æ¨¡å¼ã€‚</p><p>åœ¨Follower/Leaderæ¨¡å¼å·¥ä½œçš„ä»»ä½•ä¸€ä¸ªæ—¶é—´ç‚¹ï¼Œåªæœ‰ä¸€ä¸ªå·¥ä½œçº¿ç¨‹å¤„ç†æˆä¸ºLeader ï¼Œè´Ÿè´£I/Oäº‹ä»¶ç›‘å¬ï¼Œè€Œå…¶ä»–çº¿ç¨‹éƒ½æ˜¯Followerï¼Œå¹¶ç­‰å¾…æˆä¸ºLeaderã€‚</p><p>Follower/Leaderæ¨¡å¼çš„å·¥ä½œæµæ¦‚è¿°å¦‚ä¸‹ï¼š</p><ol><li>å½“å‰Leader Thread1ç›‘å¬åˆ°å°±ç»ªäº‹ä»¶åï¼Œä»Follower çº¿ç¨‹é›†ä¸­æ¨é€‰å‡º Thread 2æˆä¸ºæ–°çš„Leaderï¼›</li><li>æ–°çš„Leader Thread2 ç»§ç»­äº‹ä»¶I/Oç›‘å¬ï¼›</li><li>Thread1ç»§ç»­å¤„ç†I/Oå°±ç»ªäº‹ä»¶ï¼Œæ‰§è¡Œå®ŒååŠ å…¥åˆ°Follower çº¿ç¨‹é›†ä¸­ï¼Œç­‰å¾…æˆä¸ºLeaderã€‚</li></ol><p>ä»ä¸Šæè¿°ï¼ŒLeader/Followeræ¨¡å¼çš„å·¥ä½œçº¿ç¨‹å­˜åœ¨ä¸‰ç§çŠ¶æ€ï¼Œå·¥ä½œçº¿ç¨‹åŒä¸€æ—¶é—´åªèƒ½å¤„äºä¸€ç§çŠ¶æ€ï¼Œè¿™ä¸‰ç§çŠ¶æ€ä¸ºï¼š</p><ul><li>Leaderï¼šçº¿ç¨‹å¤„äºé¢†å¯¼è€…çŠ¶æ€ï¼Œè´Ÿè´£ç›‘å¬I/Oäº‹ä»¶ï¼›</li><li>Processingï¼šçº¿ç¨‹å¤„ç†å°±ç»ªI/Oäº‹ä»¶ï¼›</li><li>Followerï¼šç­‰å¾…æˆä¸ºæ–°çš„é¢†å¯¼è€…æˆ–è€…å¯èƒ½è¢«å½“å‰LeaderæŒ‡å®šå¤„ç†å°±ç»ªäº‹ä»¶ã€‚</li></ul><p>Leaderç›‘å¬åˆ°I/Oå°±ç»ªäº‹ä»¶åï¼Œæœ‰ä¸¤ç§å¤„ç†æ–¹å¼:</p><ol><li>æ¨é€‰å‡ºæ–°çš„Leaderåï¼Œå¹¶è½¬ç§»åˆ°Processingå¤„ç†è¯¥I/Oå°±ç»ªäº‹ä»¶ï¼›</li><li>æŒ‡å®šå…¶ä»–Follower çº¿ç¨‹å¤„ç†è¯¥I/Oå°±ç»ªäº‹ä»¶ï¼Œæ­¤æ—¶ä¿æŒLeaderçŠ¶æ€ä¸å˜ï¼›</li></ol><p>å¦‚å›¾16æ‰€ç¤ºä¸ºä¸Šé¢æè¿°çš„ä¸‰ç§çŠ¶æ€çš„è½¬ç§»å…³ç³»ã€‚</p><p><img src="https:////note.youdao.com/src/0300C58B6573442BA8167AC358109B97" alt="img"></p><p>â€‹              å›¾16 Follower/Leaderæ¨¡å¼çŠ¶æ€è½¬ç§»ç¤ºæ„å›¾</p><p>1</p><p>å¦‚å›¾16æ‰€ç¤ºï¼Œå¤„äºProcessingçŠ¶æ€çš„çº¿ç¨‹å¤„ç†å®ŒI/Oäº‹ä»¶åï¼Œè‹¥å½“å‰ä¸å­˜åœ¨Leaderï¼Œå°±è‡ªåŠ¨æå‡ä¸ºLeaderï¼Œå¦åˆ™è½¬å˜Followerã€‚</p><p>ä»ä»¥ä¸Šæè¿°ä¸­å¯çŸ¥ï¼ŒFollower/Leaderæ¨¡å¼ä¸­ä¸éœ€è¦åœ¨çº¿ç¨‹é—´ä¼ é€’æ•°æ®ï¼Œçº¿ç¨‹é—´ä¹Ÿä¸å­˜åœ¨å…±äº«èµ„æºã€‚ä½†å¾ˆæ˜æ˜¾Follower/Leader ä»…æ”¯æŒä¸€ä¸ªäº‹ä»¶å¤„ç†æºé›†ï¼Œæ— æ³•åšåˆ°å›¾15æ‰€ç¤ºçš„æ¯ä¸ªå·¥ä½œçº¿ç¨‹ç‹¬ç«‹ç›‘å¬I/Oäº‹ä»¶ã€‚</p><p>Swoole ç½‘ç»œæ¨¡å‹åˆ†æ</p><p>Swooleä¸ºPHPæä¾›I/Oæ‰©å±•åŠŸèƒ½ï¼Œæ”¯æŒå¼‚æ­¥I/Oã€åŒæ­¥I/Oã€å¹¶å‘é€šä¿¡ï¼Œå¹¶ä¸”ä¸ºPHPå¤šè¿›ç¨‹æ¨¡å¼æä¾›äº†å¹¶å‘æ•°æ®ç»“æ„å’ŒIPCé€šä¿¡æœºåˆ¶ï¼›Swoole æ—¢å¯ä»¥å……å½“ç½‘ç»œI/OæœåŠ¡å™¨ï¼Œä¹Ÿæ”¯æŒI/Oå®¢æˆ·ç«¯ï¼Œè¾ƒå¤§ç¨‹åº¦ä¸ºç”¨æˆ·ç®€åŒ–äº†ç½‘ç»œI/Oã€å¤šè¿›ç¨‹ï¼å¤šçº¿ç¨‹å¹¶å‘ç¼–ç¨‹çš„å·¥ä½œã€‚</p><p>Swooleä½œä¸ºserveræ—¶ï¼Œæ”¯æŒ3ç§è¿è¡Œæ¨¡å¼ï¼Œåˆ†åˆ«æ˜¯å¤šè¿›ç¨‹æ¨¡å¼ã€å¤šçº¿ç¨‹æ¨¡å¼ã€å¤šè¿›ç¨‹ï¼‹å¤šçº¿ç¨‹æ¨¡å¼ï¼›å¤šè¿›ç¨‹ï¼‹å¤šçº¿ç¨‹æ¨¡å¼æ˜¯å…¶ä¸­æœ€ä¸ºå¤æ‚çš„æ–¹å¼ï¼Œå…¶ä»–ä¸¤ç§æ–¹å¼å¯ä»¥è®¤ä¸ºæ˜¯å…¶ç‰¹ä¾‹ã€‚</p><p>æœ¬èŠ‚ç»“åˆä¹‹å‰ä»‹ç»å‡ ç§äº‹ä»¶å¤„ç†æ¨¡å‹ã€å¹¶å‘æ¨¡å¼æ¥åˆ†æSwoole serverçš„å¤šè¿›ç¨‹ï¼‹å¤šçº¿ç¨‹æ¨¡å‹ï¼Œå¦‚å›¾17ã€‚</p><p><img src="https:////note.youdao.com/src/89BFEDF8F539474881899FE905512DE7" alt="img"></p><p>â€‹             å›¾17 swoole serverå¤šè¿›ç¨‹ï¼‹å¤šçº¿ç¨‹æ¨¡å‹ç»“æ„ç¤ºæ„å›¾</p><p>1</p><p>å›¾17æ‰€ç¤ºï¼Œæ•´ä½“ä¸Šå¯ä»¥åˆ†ä¸ºMaster Processã€Manger Processã€Work Process Poolä¸‰éƒ¨åˆ†ã€‚è¿™ä¸‰éƒ¨åˆ†çš„ä¸»è¦åŠŸèƒ½ï¼š</p><ol><li>Master Processï¼šç›‘å¬æœåŠ¡ç«¯å£ï¼Œæ¥æ”¶ç”¨æˆ·è¿æ¥ï¼Œæ”¶å‘è¿æ¥æ•°æ®ï¼Œä¾é reactoræ¨¡å‹é©±åŠ¨ï¼›</li><li>Manager Processï¼šMaster Processçš„å­è¿›ç¨‹ï¼Œè´Ÿè´£fork WorkProcessï¼Œå¹¶ç›‘æ§Work Processçš„è¿è¡ŒçŠ¶æ€ï¼›</li><li>Work Process Poolï¼šå·¥ä½œè¿›ç¨‹æ± ï¼Œä¸PHPä¸šåŠ¡å±‚äº¤äº’ï¼Œå°†å®¢æˆ·ç«¯æ•°æ®æˆ–è€…äº‹ä»¶ï¼ˆå¦‚è¿æ¥å…³é—­ï¼‰å›è°ƒç»™ä¸šåŠ¡å±‚ï¼Œå¹¶å°†ä¸šåŠ¡å±‚çš„å“åº”æ•°æ®æˆ–è€…æ“ä½œï¼ˆå¦‚ä¸»åŠ¨å…³é—­è¿æ¥ï¼‰äº¤ç»™Master Processå¤„ç†ï¼›å·¥ä½œè¿›ç¨‹ä¾é reactoræ¨¡å‹é©±åŠ¨ã€‚</li></ol><p>Manager Process ç›‘æ§Work Processè¿›ç¨‹ï¼Œæœ¬èŠ‚ä¸åšè¿›ä¸€æ­¥è®²è§£ï¼Œä¸»è¦å…³æ³¨Masterå’ŒWorkã€‚</p><p>Master Process</p><p>Master Process å†…éƒ¨åŒ…æ‹¬ä¸»çº¿ç¨‹(Main Thread)å’Œå·¥ä½œçº¿ç¨‹æ± (Work Thread Pool),è¿™ä¸¤éƒ¨åˆ†ä¸»è¦åŠŸèƒ½åˆ†åˆ«æ˜¯ï¼š</p><p>ä¸»çº¿ç¨‹: ç›‘å¬æœåŠ¡ç«¯å£ï¼Œæ¥æ”¶ç½‘ç»œè¿æ¥ï¼Œå°†æˆåŠŸå»ºç«‹çš„è¿æ¥åˆ†å‘åˆ°çº¿ç¨‹æ± ä¸­ï¼›ä¾èµ–reactoræ¨¡å‹é©±åŠ¨ï¼›</p><p>å·¥ä½œçº¿ç¨‹æ± : ç‹¬ç«‹ç®¡ç†è¿æ¥ï¼Œæ”¶å‘ç½‘ç»œæ•°æ®ï¼›ä¾èµ–Reactoräº‹ä»¶å¤„ç†é©±åŠ¨ã€‚</p><p>é¡¾ä¸€ä¸‹å‰é¢ä»‹ç»çš„åŠåŒæ­¥/åŠå¼‚æ­¥å¹¶å‘æ¨¡å¼ï¼Œå¾ˆæ˜æ˜¾ï¼Œä¸»è¿›ç¨‹çš„å·¥ä½œæ–¹å¼å°±æ˜¯å›¾15æ‰€ç¤ºçš„æ–¹å¼ã€‚</p><p>Work Process</p><p>å¦‚ä¸Šæ‰€æè¿°ï¼ŒWork Processæ˜¯Master Processå’ŒPHPå±‚ä¹‹é—´çš„åª’ä»‹ï¼š</p><ol><li>Work Processæ¥æ”¶æ¥è‡ªMaster Processçš„æ•°æ®ï¼ŒåŒ…æ‹¬ç½‘ç»œæ•°æ®å’Œè¿æ¥äº‹ä»¶ï¼Œå›è°ƒè‡³PHPä¸šåŠ¡å±‚ï¼›</li><li>å°†æ¥è‡ªPHPå±‚çš„æ•°æ®å’Œè¿æ¥æ§åˆ¶ä¿¡æ¯å‘é€ç»™Master Processè¿›ç¨‹ï¼ŒMaster Processæ¥å¤„ç†ã€‚</li></ol><p>Work ProcessåŒæ ·æ˜¯ä¾èµ–Reactoräº‹ä»¶æ¨¡å‹é©±åŠ¨ï¼Œå…¶å·¥ä½œæ–¹å¼ä¸€ä¸ªå…¸å‹çš„Reactoræ¨¡å¼ã€‚</p><p>Work Processä½œä¸ºMaster Processå’ŒPHPå±‚ä¹‹é—´çš„åª’ä»‹ï¼Œå°†æ•°æ®æ”¶å‘æ“ä½œå’Œæ•°æ®å¤„ç†åˆ†ç¦»å¼€æ¥ï¼Œå³ä½¿PHPå±‚å› æ¶ˆæ¯å¤„ç†å°†Workè¿›ç¨‹é˜»å¡ä¸€æ®µæ—¶é—´ï¼Œä¹Ÿä¸ä¼šå¯¹å…¶ä»–è¿æ¥æœ‰å½±å“ã€‚</p><p>ä»æ•´ä½“å±‚é¢æ¥çœ‹ï¼ŒMaster Processå®ç°å¯¹è¿æ¥socketä¸Šæ•°æ®çš„I/Oæ“ä½œï¼Œè¿™ä¸ªè¿‡ç¨‹å¯¹äºWork Processæ˜¯å¼‚æ­¥çš„ï¼Œç»“åˆå›¾11 æ‰€æè¿°çš„åŒæ­¥I/Oæ¨¡æ‹ŸProactoræ¨¡å¼ï¼Œä¸¤ç§æ–¹å¼å¦‚å‡ºä¸€è¾™ï¼Œåªä¸è¿‡è¿™é‡Œä½¿ç”¨çš„æ˜¯å¤šè¿›ç¨‹ã€‚</p><p>è¿›ç¨‹é—´é€šä¿¡</p><p>Work Processæ˜¯Master Processå’ŒPHPå±‚ä¹‹é—´çš„åª’ä»‹ï¼Œé‚£ä¹ˆéœ€è¦çœ‹çœ‹Work Process ä¸Master Processä¹‹é—´çš„é€šä¿¡æ–¹å¼ï¼Œå¹¶åœ¨Swoole server çš„å¤šè¿›ç¨‹ï¼‹å¤šçº¿ç¨‹æ¨¡å‹è¿›ç¨‹ä¸­ï¼Œæ•´ä¸ªè¿‡ç¨‹è¿˜æ˜¯æœ‰äº›å¤æ‚ï¼Œä¸‹é¢è¯´æ˜ä¸€ä¸‹è¯¥æµç¨‹ï¼Œå¦‚å›¾18æ‰€ç¤ºã€‚</p><p><img src="https:////note.youdao.com/src/76B546B115CB4361B342121A82049291" alt="img"></p><p>â€‹                å›¾18 swoole server å¤šè¿›ç¨‹å¤šçº¿ç¨‹é€šä¿¡ç¤ºæ„å›¾</p><p>1</p><p>å…·ä½“æµç¨‹ä¸ºï¼š</p><ol><li>Master è¿›ç¨‹ä¸»çº¿ç¨‹æ¥æ”¶å®¢æˆ·ç«¯è¿æ¥ï¼Œè¿æ¥å»ºç«‹æˆåŠŸåï¼Œåˆ†å‘è‡³å·¥ä½œçº¿ç¨‹ï¼Œå·¥ä½œçº¿ç¨‹é€šè¿‡Unix Socketé€šçŸ¥Workè¿›ç¨‹è¿æ¥ä¿¡æ¯ï¼›</li><li>Work è¿›ç¨‹å°†è¿æ¥ä¿¡æ¯å›è°ƒè‡³PHPä¸šåŠ¡å±‚ï¼›</li><li>Maser è¿›ç¨‹ä¸­çš„å·¥ä½œçº¿ç¨‹æ¥æ”¶å®¢æˆ·ç«¯è¯·æ±‚æ¶ˆæ¯ï¼Œå¹¶é€šè¿‡Unix Socketæ–¹å¼å‘é€åˆ°Workè¿›ç¨‹ï¼›</li><li>Work è¿›ç¨‹å°†è¯·æ±‚æ¶ˆæ¯å›è°ƒè‡³PHPä¸šåŠ¡å±‚ï¼›</li><li>PHPä¸šåŠ¡å±‚æ„é€ å›å¤æ¶ˆæ¯ï¼Œé€šè¿‡Workè¿›ç¨‹å‘é€ï¼ŒWorkè¿›ç¨‹å°†å›å¤æ¶ˆæ¯æ‹·è´è‡³å…±äº«å†…å­˜ä¸­ï¼Œå¹¶é€šè¿‡Unix Socketé€šçŸ¥å‘é€è‡³Masterè¿›ç¨‹çš„å·¥ä½œçº¿ç¨‹æœ‰æ•°æ®éœ€è¦å‘é€ï¼›</li><li>å·¥ä½œçº¿ç¨‹ä»å…±äº«å†…å­˜ä¸­å–å‡ºéœ€å‘é€çš„æ•°æ®ï¼Œå¹¶å‘é€è‡³å®¢æˆ·ç«¯ï¼›</li><li>å®¢æˆ·ç«¯æ–­å¼€è¿æ¥ï¼Œå·¥ä½œçº¿ç¨‹å°†è¿æ¥æ–­å¼€çš„äº‹ä»¶é€šè¿‡UnixSocketå‘é€è‡³Workè¿›ç¨‹ï¼›</li><li>Workè¿›ç¨‹å°†è¿æ¥æ–­å¼€äº‹ä»¶å›è°ƒè‡³PHPä¸šåŠ¡å±‚.</li></ol><p>éœ€è¦æ³¨æ„åœ¨æ­¥éª¤5ä¸­ï¼ŒWorkè¿›ç¨‹é€šçŸ¥Masterè¿›ç¨‹æœ‰æ•°æ®éœ€è¦å‘é€ï¼Œä¸æ˜¯å°†æ•°æ®ç›´æ¥å‘é€ç»™Masterè¿›ç¨‹ï¼Œè€Œæ˜¯å°†æ•°æ®åœ°å€(åœ¨å…±äº«å†…å­˜ä¸­)å‘é€ç»™Masterè¿›ç¨‹ã€‚</p><p>æ”¹å–„æ€§èƒ½çš„æ–¹æ³•</p><p>æ€§èƒ½å¯¹äºæœåŠ¡å™¨è€Œè¨€æ˜¯éå¸¸æ•æ„Ÿå’Œé‡è¦çš„ï¼Œå½“å‰ï¼Œç¡¬ä»¶çš„å‘å±•è™½ç„¶ä¸æ˜¯æœåŠ¡å™¨æ€§èƒ½çš„ç“¶é¢ˆï¼Œä½œä¸ºè½¯ä»¶å¼€å‘äººå‘˜è¿˜æ˜¯åº”è¯¥è€ƒè™‘åœ¨è½¯ä»¶å±‚é¢æ¥ä¸Šæ”¹å–„æœåŠ¡æ€§èƒ½ã€‚å¥½çš„ç½‘ç»œæ¨¡å—ï¼Œé™¤äº†ç¨³å®šæ€§ï¼Œè¿˜æœ‰éå¸¸å¤šçš„ç»†èŠ‚ã€æŠ€å·§å¤„ç†æ¥æå‡æœåŠ¡æ€§èƒ½ï¼Œæ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥æ·±å…¥äº†è§£Ngnixæºç çš„ç»†èŠ‚ï¼Œä»¥åŠé™ˆç¡•çš„ã€ŠLinuxå¤šçº¿ç¨‹æœåŠ¡å™¨ç¼–ç¨‹ã€‹ã€‚</p><p>æ•°æ®å¤åˆ¶</p><p>å¦‚æœåº”ç”¨ç¨‹åºä¸å…³å¿ƒæ•°æ®çš„å†…å®¹ï¼Œå°±æ²¡æœ‰å¿…è¦å°†æ•°æ®æ‹·è´åˆ°åº”ç”¨ç¼“å†²åŒºï¼Œå¯ä»¥å€ŸåŠ©å†…æ ¸æ¥å£ç›´æ¥å°†æ•°æ®æ‹·è´åˆ°å†…æ ¸ç¼“å†²åŒºå¤„ç†ï¼Œå¦‚åœ¨æä¾›æ–‡ä»¶ä¸‹è½½æœåŠ¡æ—¶ï¼Œä¸éœ€è¦å°†æ–‡ä»¶å†…å®¹å…ˆè¯»åˆ°åº”ç”¨ç¼“å†²åŒºï¼Œåœ¨è°ƒç”¨sendæ¥å£å‘é€å‡ºå»ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨sendfile ï¼ˆé›¶æ‹·è´ï¼‰æ¥å£ç›´æ¥å‘é€å‡ºå»ã€‚</p><p>åº”ç”¨ç¨‹åºçš„å·¥ä½œæ¨¡å—ä¹‹é—´ä¹Ÿåº”è¯¥é¿å…æ•°æ®æ‹·è´ï¼Œå¦‚ï¼š</p><ol><li>å½“ä¸¤ä¸ªå·¥ä½œè¿›ç¨‹ä¹‹é—´éœ€è¦ä¼ é€’æ•°æ®ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨å…±äº«å†…å­˜çš„æ–¹å¼å®ç°æ•°æ®å…±äº«ï¼›</li><li>åœ¨æµåª’ä½“çš„åº”ç”¨ä¸­ï¼Œå¯¹å¸§æ•°æ®çš„éå¿…è¦æ‹·è´ä¼šå¯¹ç¨‹åºæ€§èƒ½çš„å½±å“ï¼Œç‰¹å¤‡æ˜¯åœ¨åµŒå…¥å¼ç¯å¢ƒä¸­å½±å“éå¸¸æ˜æ˜¾ã€‚é€šå¸¸é‡‡ç”¨çš„åŠæ³•æ˜¯ï¼Œç»™æ¯å¸§æ•°æ®åˆ†é…å†…å­˜ï¼ˆä¸‹é¢ç»Ÿç§°ä¸ºbufferï¼‰ï¼Œå½“éœ€è¦ä½¿ç”¨è¯¥bufferæ—¶ï¼Œä¼šå¢åŠ è¯¥bufferçš„å¼•ç”¨è®¡æ•°ï¼Œbufferçš„å¼•ç”¨è®¡æ•°ä¸º0æ—¶æ‰ä¼šé‡Šæ”¾å¯¹åº”çš„å†…å­˜ã€‚è¿™ç§æ–¹å¼é€‚åˆåœ¨è¿›ç¨‹å†…æ•°æ®æ— æ‹·è´ä¼ é€’ï¼Œå¹¶ä¸”ä¸ä¼šç»™é‡Šæ”¾bufferå¸¦æ¥å›°æ‰°ã€‚</li></ol><p>èµ„æºæ± </p><p>åœ¨æœåŠ¡è¿è¡ŒæœŸé—´ï¼Œéœ€è¦ä½¿ç”¨ç³»ç»Ÿè°ƒç”¨ä¸ºç”¨æˆ·åˆ†é…èµ„æºï¼Œé€šå¸¸ç³»ç»Ÿèµ„æºçš„åˆ†é…éƒ½æ˜¯æ¯”è¾ƒè€—æ—¶çš„ï¼Œå¦‚åŠ¨æ€åˆ›å»ºè¿›ç¨‹ï¼çº¿ç¨‹ã€‚å¯ä»¥è€ƒè™‘åœ¨æœåŠ¡å¯åŠ¨æ—¶é¢„å…ˆåˆ†é…èµ„æºï¼Œå³åˆ›å»ºèµ„æºæ± ï¼Œå½“éœ€è¦èµ„æºï¼Œä»èµ„æºæ± ä¸­è·å–å³å¯ï¼Œè‹¥èµ„æºæ± ä¸å¤Ÿç”¨æ—¶ï¼Œå†åŠ¨æ€çš„åˆ†é…ï¼Œä½¿ç”¨å®Œæˆåäº¤è¿˜åˆ°èµ„æºæ± ä¸­ã€‚è¿™å®é™…ä¸Šæ˜¯ç”¨ç©ºé—´æ¢å–æ—¶é—´ï¼Œåœ¨æœåŠ¡è¿è¡ŒæœŸé—´å¯ä»¥èŠ‚çœéå¿…è¦çš„èµ„æºåˆ›å»ºè¿‡ç¨‹ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä½¿ç”¨èµ„æºæ± è¿˜éœ€è¦æ ¹æ®ä¸šåŠ¡å’Œç¡¬ä»¶ç¯å¢ƒå¯¹èµ„æºæ± çš„å¤§å°è¿›è¡Œé™åˆ¶ã€‚</p><p>èµ„æºæ± æ˜¯ä¸€ä¸ªæŠ½è±¡çš„æ¦‚å¿µï¼Œå¸¸è§çš„åŒ…æ‹¬è¿›ç¨‹æ± ã€çº¿ç¨‹æ± ã€ å†…å­˜æ± ã€è¿æ¥æ± ï¼›è¿™äº›èµ„æºæ± çš„ç›¸å…³èµ„æ–™éå¸¸å¤šï¼Œè¿™é‡Œå°±ä¸ä¸€ä¸€ä»‹ç»äº†ã€‚</p><p>é”/ä¸Šä¸‹æ–‡åˆ‡æ¢</p><p>1.å…³äºé”</p><p>å¯¹å…±äº«èµ„æºçš„æ“ä½œæ˜¯å¹¶å‘ç¨‹åºä¸­ç»å¸¸è¢«æèµ·çš„ä¸€ä¸ªè¯é¢˜ï¼Œéƒ½çŸ¥é“åœ¨ä¸šåŠ¡é€»è¾‘ä¸Šæ— æ³•ä¿è¯åŒæ­¥æ“ä½œå…±äº«èµ„æºæ—¶ï¼Œéœ€è¦å¯¹å…±äº«èµ„æºåŠ é”ä¿æŠ¤ï¼Œä½†æ˜¯é”ä¸ä»…ä¸èƒ½å¤„ç†ä»»ä½•ä¸šåŠ¡é€»è¾‘ï¼Œè€Œä¸”è¿˜å­˜åœ¨ä¸€å®šçš„ç³»ç»Ÿå¼€é”€ã€‚å¹¶ä¸”å¯¹é”çš„ä¸æ°å½“ä½¿ç”¨ï¼Œå¯èƒ½æˆä¸ºæœåŠ¡æœŸæ€§èƒ½çš„ç“¶é¢ˆã€‚</p><p>é’ˆå¯¹é”çš„ä½¿ç”¨æœ‰å¦‚ä¸‹å»ºè®®ï¼š</p><ol><li>å¦‚æœèƒ½å¤Ÿåœ¨è®¾è®¡å±‚é¢é¿å…å…±äº«èµ„æºç«äº‰ï¼Œå°±å¯ä»¥é¿å…é”ï¼Œå¦‚å›¾15æè¿°çš„æ¨¡å¼;</li><li>è‹¥æ— æ³•é¿å…å¯¹å…±äº«èµ„æºçš„ç«äº‰ï¼Œä¼˜å…ˆè€ƒè™‘ä½¿ç”¨æ— é”é˜Ÿåˆ—çš„æ–¹å¼å®ç°å…±äº«èµ„æºï¼›</li><li>ä½¿ç”¨é”æ—¶ï¼Œä¼˜å…ˆè€ƒè™‘ä½¿ç”¨è¯»å†™é”ï¼›æ­¤å¤–ï¼Œé”çš„èŒƒå›´ä¹Ÿè¦è€ƒè™‘ï¼Œå°½é‡è¾ƒå°‘é”çš„é¢—ç²’åº¦ï¼Œé¿å…å…¶ä»–çº¿ç¨‹æ— è°“çš„ç­‰å¾…ã€‚</li></ol><p>2.ä¸Šä¸‹æ–‡åˆ‡æ¢</p><p>å¹¶å‘ç¨‹åºéœ€è¦è€ƒè™‘ä¸Šä¸‹æ–‡åˆ‡æ¢çš„é—®é¢˜ï¼Œå†…æ ¸è°ƒåº¦çº¿ç¨‹(è¿›ç¨‹)æ‰§è¡Œæ˜¯å­˜åœ¨ç³»ç»Ÿå¼€é”€çš„ï¼Œè‹¥çº¿ç¨‹(è¿›ç¨‹)è°ƒåº¦å ç”¨CPUçš„æ—¶é—´æ¯”é‡è¿‡å¤§ï¼Œé‚£å¤„ç†ä¸šåŠ¡é€»è¾‘å ç”¨çš„CPUæ—¶é—´å°±ä¼šä¸è¶³ã€‚åœ¨é¡¹ç›®ä¸­ï¼Œçº¿ç¨‹(è¿›ç¨‹)æ•°é‡è¶Šå¤šï¼Œä¸Šä¸‹æ–‡åˆ‡æ¢ä¼šå¾ˆé¢‘ç¹ï¼Œå› æ­¤æ˜¯ä¸å»ºè®®ä¸ºæ¯ä¸ªç”¨æˆ·è¿æ¥åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œå¦‚å›¾15æ‰€ç¤ºçš„å¹¶å‘æ¨¡å¼ï¼Œä¸€ä¸ªçº¿ç¨‹å¯åŒæ—¶å¤„ç†å¤šä¸ªç”¨æˆ·è¿æ¥ï¼Œæ˜¯æ¯”è¾ƒåˆç†çš„è§£å†³æ–¹æ¡ˆã€‚</p><p>å¤šæ ¸çš„æœºå™¨ä¸Šï¼Œå¹¶å‘ç¨‹åºçš„ä¸åŒçº¿ç¨‹å¯ä»¥è¿è¡Œåœ¨ä¸åŒçš„CPUä¸Šï¼Œåªè¦çº¿ç¨‹æ•°é‡ä¸å¤§äºCPUæ•°ç›®ï¼Œä¸Šä¸‹æ–‡åˆ‡æ¢ä¸ä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Œåœ¨å®é™…çš„å¹¶å‘ç½‘ç»œæ¨¡å—ä¸­ï¼Œçº¿ç¨‹(è¿›ç¨‹)çš„ä¸ªæ•°ä¹Ÿæ˜¯æ ¹æ®CPUæ•°ç›®æ¥ç¡®å®šçš„ã€‚åœ¨å¤šæ ¸æœºå™¨ä¸Šï¼Œå¯ä»¥è®¾ç½®CPUäº²å’Œæ€§ï¼Œå°†è¿›ç¨‹ï¼çº¿ç¨‹ä¸CPUç»‘å®šï¼Œæé«˜CPU cacheçš„å‘½ä¸­ç‡ï¼Œå»ºå¥½å†…å­˜è®¿é—®æŸè€—ã€‚</p><p>æœ‰é™çŠ¶æ€æœºå™¨</p><p>æœ‰é™çŠ¶æ€æœºæ˜¯ä¸€ç§é«˜æ•ˆçš„é€»è¾‘å¤„ç†æ–¹å¼ï¼Œåœ¨ç½‘ç»œåè®®å¤„ç†ä¸­åº”ç”¨éå¸¸å¹¿æ³›ï¼Œæœ€å…¸å‹çš„æ˜¯å†…æ ¸åè®®æ ˆä¸­TCPçŠ¶æ€è½¬ç§»ã€‚æœ‰é™çŠ¶æ€æœºä¸­æ¯ç§ç±»å‹å¯¹åº”æ‰§è¡Œé€»è¾‘å•å…ƒçš„çŠ¶æ€ï¼Œå¯¹é€»è¾‘äº‹åŠ¡çš„å¤„ç†éå¸¸æœ‰æ•ˆã€‚æœ‰é™çŠ¶æ€æœºåŒ…æ‹¬ä¸¤ç§ï¼Œä¸€ç§æ˜¯æ¯ä¸ªçŠ¶æ€éƒ½æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼ŒçŠ¶æ€é—´ä¸å­˜åœ¨è½¬ç§»ï¼›å¦ä¸€ç§å°±æ˜¯çŠ¶æ€é—´å­˜åœ¨è½¬ç§»ã€‚æœ‰é™çŠ¶æ€æœºæ¯”è¾ƒå®¹æ˜“ç†è§£ï¼Œä¸‹é¢ç»™å‡ºä¸¤ç§æœ‰é™çŠ¶æ€æœºçš„ç¤ºä¾‹ä»£ç ã€‚</p><p>ä¸å­˜åœ¨çŠ¶æ€è½¬ç§»</p><p>typedefenum _tag_state_enum{      A_STATE,    B_STATE,    C_STATE,    D_STATE}state_enum;voidSTATE_MACHINE_HANDLER(state_enum cur_state){    switch (cur_state){    case A_STATE:         process_A_STATE();         break;    case B_STATE:         process_B_STATE();         break;    case C_STATE:         process_C_STATE();         break;    default:         break;    }    return ;}</p><p>1234567891011121314151617181920212223242526</p><p>å­˜åœ¨çŠ¶æ€è½¬ç§»</p><p>voidTRANS_STATE_MACHINE_HANDLER(state_enum cur_state){    while (C_STATE != cur_state) {        switch (cur_state) {        case A_STATE:            process_A_STATE();            cur_state = B_STATE;            break;        case B_STATE:            process_B_STATE();            cur_state = C_STATE;            break;        case C_STATE:            process_C_STATE();            cur_state = D_STATE;            break;        default:            return ;      }   }   return ;}</p><p>123456789101112131415161718192021222324252627</p><p>æ—¶é—´è½®</p><p>ç»å¸¸ä¼šé¢ä¸´ä¸€äº›ä¸šåŠ¡å®šæ—¶è¶…æ—¶çš„éœ€æ±‚ï¼Œç”¨ä¾‹å­æ¥è¯´æ˜å§ã€‚</p><p>åŠŸèƒ½éœ€æ±‚ï¼šæœåŠ¡å™¨éœ€è¦ç»´æŠ¤æ¥è‡ªå¤§é‡å®¢æˆ·ç«¯çš„TCPè¿æ¥ï¼ˆå‡è®¾å•æœºæœåŠ¡å™¨éœ€è¦æ”¯æŒçš„æœ€å¤§TCPè¿æ¥æ•°åœ¨10Wçº§åˆ«ï¼‰ï¼Œå¦‚æœæŸè¿æ¥ä¸Š60så†…æ²¡æœ‰æ•°æ®åˆ°è¾¾ï¼Œå°±è®¤ä¸ºç›¸åº”çš„å®¢æˆ·ç«¯ä¸‹çº¿ã€‚</p><p>å…ˆä»‹ç»ä¸€ä¸‹ä¸¤ç§å®¹æ˜“æƒ³åˆ°çš„è§£å†³æ–¹æ¡ˆ,</p><p>æ–¹æ¡ˆaè½®è¯¢æ‰«æ</p><p>å¤„ç†è¿‡ç¨‹ä¸ºï¼š</p><ol><li>ç»´æŠ¤ä¸€ä¸ªmap è®°å½•å®¢æˆ·ç«¯æœ€è¿‘ä¸€æ¬¡çš„è¯·æ±‚æ—¶é—´ï¼›</li><li>å½“client_idå¯¹åº”è¿æ¥æœ‰æ•°æ®åˆ°è¾¾æ—¶ï¼Œæ›´æ–°last_update_timeï¼›</li><li>å¯åŠ¨ä¸€ä¸ªå®šæ—¶å™¨ï¼Œè½®è¯¢æ‰«æmap ä¸­client_id å¯¹åº”çš„last_update_timeï¼Œè‹¥è¶…è¿‡ 60sï¼Œåˆ™è®¤ä¸ºå¯¹åº”çš„å®¢æˆ·ç«¯ä¸‹çº¿ã€‚</li></ol><p>è½®è¯¢æ‰«æï¼Œåªå¯åŠ¨ä¸€ä¸ªå®šæ—¶å™¨ï¼Œä½†è½®è¯¢æ•ˆç‡ä½ï¼Œç‰¹åˆ«æ˜¯æœåŠ¡å™¨ç»´æŠ¤çš„è¿æ¥æ•°å¾ˆå¤§æ—¶ï¼Œéƒ¨åˆ†è¿æ¥è¶…æ—¶äº‹ä»¶å¾—ä¸åˆ°åŠæ—¶å¤„ç†ã€‚</p><p>æ–¹æ¡ˆbå¤šå®šæ—¶å™¨è§¦å‘</p><p>å¤„ç†è¿‡ç¨‹ä¸ºï¼š</p><ol><li>ç»´æŠ¤ä¸€ä¸ªmap è®°å½•å®¢æˆ·ç«¯æœ€è¿‘ä¸€æ¬¡çš„è¯·æ±‚æ—¶é—´ï¼›</li><li>å½“æŸclient_id å¯¹åº”è¿æ¥æœ‰æ•°æ®åˆ°è¾¾æ—¶ï¼Œæ›´æ–°last_update_timeï¼ŒåŒæ—¶ä¸ºclient_idå¯ç”¨ä¸€ä¸ªå®šæ—¶å™¨ï¼Œ60såè§¦å‘;</li><li>å½“client_idå¯¹åº”çš„å®šæ—¶å™¨è§¦å‘åï¼ŒæŸ¥çœ‹mapä¸­client_idå¯¹åº”çš„last_update_timeæ˜¯å¦è¶…è¿‡60sï¼Œè‹¥è¶…æ—¶åˆ™è®¤ä¸ºå¯¹åº”å®¢æˆ·ç«¯ä¸‹çº¿ã€‚</li></ol><p>å¤šå®šæ—¶å™¨è§¦å‘ï¼Œæ¯æ¬¡è¯·æ±‚éƒ½è¦å¯åŠ¨ä¸€ä¸ªå®šæ—¶å™¨ï¼Œå¯ä»¥æƒ³è±¡ï¼Œæ¶ˆæ¯è¯·æ±‚éå¸¸é¢‘ç¹æ˜¯ï¼Œå®šæ—¶å™¨çš„æ•°é‡å°†ä¼šå¾ˆåºå¤§ï¼Œæ¶ˆè€—å¤§é‡çš„ç³»ç»Ÿèµ„æºã€‚</p><p>æ–¹æ¡ˆc æ—¶é—´è½®æ–¹æ¡ˆ</p><p>ä¸‹é¢ä»‹ç»ä¸€ä¸‹åˆ©ç”¨æ—¶é—´è½®çš„æ–¹å¼å®ç°çš„ä¸€ç§é«˜æ•ˆã€èƒ½æ‰¹é‡çš„å¤„ç†æ–¹æ¡ˆï¼Œå…ˆè¯´ä¸€ä¸‹éœ€è¦çš„æ•°æ®ç»“æ„ï¼š</p><ol><li>åˆ›å»º0~60çš„æ•°æ®ï¼Œæ„æˆç¯å½¢é˜Ÿåˆ—time_wheelï¼Œcurrent_indexç»´æŠ¤ç¯å½¢é˜Ÿåˆ—çš„å½“å‰æ¸¸æ ‡ï¼Œå¦‚å›¾19æ‰€ç¤ºï¼›</li><li>æ•°ç»„å…ƒç´ æ˜¯slot ç»“æ„ï¼Œslotæ˜¯ä¸€ä¸ªsetï¼Œæ„æˆä»»åŠ¡é›†ï¼›</li><li>ç»´æŠ¤ä¸€ä¸ªmapï¼Œè®°å½•client_id è½åœ¨å“ªä¸ªslotä¸Šã€‚</li></ol><p><img src="https:////note.youdao.com/src/C5981CB237A048868220D6C27354F990" alt="img"></p><p>â€‹                     å›¾19 æ—¶é—´è½®ç¯å½¢é˜Ÿåˆ—ç¤ºæ„å›¾</p><p>1</p><p>æ‰§è¡Œè¿‡ç¨‹ä¸ºï¼š</p><ol><li>å¯ç”¨ä¸€ä¸ªå®šæ—¶å™¨ï¼Œè¿è¡Œé—´éš”1sï¼Œæ›´æ–°current_indexï¼ŒæŒ‡å‘ç¯å½¢é˜Ÿåˆ—ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œ0-&gt;1-&gt;2-&gt;3â€¦-&gt;58-&gt;59-&gt;60â€¦0ï¼›</li><li>è¿æ¥ä¸Šæ•°æ®åˆ°è¾¾æ—¶ï¼Œä»mapä¸­è·å–client_idæ‰€åœ¨çš„slotï¼Œåœ¨slotçš„setä¸­åˆ é™¤è¯¥client_idï¼›</li><li>å°†client_idåŠ å…¥åˆ°current_index - 1é”æ ‡è®°çš„slotä¸­ï¼›</li><li>æ›´æ–°mapä¸­client_id ä¸ºcurrent_id-1 ã€‚</li></ol><p>ä¸aã€bä¸¤ç§æ–¹æ¡ˆç›¸æ¯”ï¼Œæ–¹æ¡ˆcå…·æœ‰å¦‚ä¸‹ä¼˜åŠ¿ï¼š</p><ol><li>åªéœ€è¦ä¸€ä¸ªå®šæ—¶å™¨ï¼Œè¿è¡Œé—´éš”1sï¼ŒCPUæ¶ˆè€—éå¸¸å°‘ï¼›</li><li>current_index æ‰€æ ‡è®°çš„slotä¸­çš„setä¸ä¸ºç©ºæ—¶ï¼Œsetä¸­çš„æ‰€æœ‰client_idå¯¹åº”çš„å®¢æˆ·ç«¯å‡è®¤ä¸ºä¸‹çº¿ï¼Œå³æ‰¹é‡è¶…æ—¶ã€‚</li></ol><p>ä¸Šé¢æè¿°çš„æ—¶é—´è½®å¤„ç†æ–¹å¼ä¼šå­˜åœ¨1sä»¥å†…çš„è¯¯å·®ï¼Œè‹¥è€ƒè™‘å®æ—¶æ€§ï¼Œå¯ä»¥æé«˜å®šæ—¶å™¨çš„è¿è¡Œé—´éš”ï¼Œå¦å¤–è¯¥æ–¹æ¡ˆå¯ä»¥æ ¹æ®å®é™…ä¸šåŠ¡éœ€æ±‚æ‰©å±•åˆ°åº”ç”¨ä¸­ã€‚æˆ‘ä»¬å¯¹Swooleçš„ä¿®æ”¹ä¸­ï¼ŒåŒ…æ‹¬å¯¹å®šæ—¶å™¨è¿›è¡Œäº†é‡æ„ï¼Œå…¶ä¸­è¶…æ—¶å®šæ—¶å™¨é‡‡ç”¨çš„å°±æ˜¯å¦‚ä¸Šæ‰€æè¿°çš„æ—¶é—´è½®æ–¹æ¡ˆï¼Œå¹¶ä¸”ç²¾åº¦å¯æ§ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;å¼‚æ­¥ç½‘ç»œæ¨¡å‹&quot;&gt;&lt;a href=&quot;#å¼‚æ­¥ç½‘ç»œæ¨¡å‹&quot; class=&quot;headerlink&quot; title=&quot;å¼‚æ­¥ç½‘ç»œæ¨¡å‹&quot;&gt;&lt;/a&gt;å¼‚æ­¥ç½‘ç»œæ¨¡å‹&lt;/h1&gt;&lt;p&gt;å¼‚æ­¥ç½‘ç»œæ¨¡å‹åœ¨æœåŠ¡å¼€å‘ä¸­åº”ç”¨éå¸¸å¹¿æ³›ï¼Œç›¸å…³èµ„æ–™å’Œå¼€æºåº“ä¹Ÿéå¸¸å¤šã€‚é¡¹ç›®ä¸­ï¼Œä½¿ç”¨ç°æˆçš„è½®å­æé«˜äº†å¼€å‘æ•ˆç‡ï¼Œé™¤äº†èƒ½ä½¿ç”¨è½®å­ï¼Œè¿˜æ˜¯æœ‰å¿…è¦äº†è§£ä¸€ä¸‹è½®å­çš„å†…éƒ¨æ„é€ ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ç¯‡æ–‡ç« ä»æœ€åŸºç¡€çš„5ç§I/Oæ¨¡å‹åˆ‡å…¥ï¼Œåˆ°I/Oäº‹ä»¶å¤„ç†æ¨¡å‹ï¼Œå†åˆ°å¹¶å‘æ¨¡å¼ï¼Œæœ€åä»¥Swooleå¼€æºåº“æ¥åšå…·ä½“åˆ†æï¼Œé€æ­¥æ·±å…¥ã€‚æ–‡ä¸­æåˆ°çš„æ¨¡å‹éƒ½æ˜¯ä¸€äº›é€šç”¨çš„æ¨¡å‹ï¼Œåœ¨ã€Šlinuxé«˜æ€§èƒ½æœåŠ¡å™¨ç¼–ç¨‹ã€‹ä¸­ä¹Ÿéƒ½æœ‰æ¶‰åŠã€‚æ–‡ç« ä¸æ¶‰åŠæ¨¡å‹çš„å®ç°ç»†èŠ‚ï¼Œæœ€é‡è¦çš„æ˜¯å»ç†è§£å„ä¸ªæ¨¡å‹çš„å·¥ä½œæ¨¡å¼ä»¥åŠå…¶ä¼˜ç¼ºç‚¹ã€‚&lt;/p&gt;
&lt;p&gt;è¯»åæ„Ÿï¼š&lt;/p&gt;
&lt;p&gt;æ‰€è°“å¼‚æ­¥ï¼š&lt;/p&gt;
&lt;p&gt;1.(fd)é˜»å¡è°ƒç”¨ + select/pool, epool  ï¼ˆIOäº‹ä»¶é€šçŸ¥æ–¹å¼ï¼šIOå¤ç”¨ï¼‰&lt;/p&gt;
&lt;p&gt;2.(fd)éé˜»å¡è°ƒç”¨ + SIGIO ï¼ˆIOäº‹ä»¶é€šçŸ¥æ–¹å¼ï¼šSIGIO ä¿¡å·ï¼‰&lt;/p&gt;
    
    </summary>
    
    
      <category term="çŸ¥è¯†ç‚¹æ€»ç»“" scheme="https://akaqin.github.io/categories/%E7%9F%A5%E8%AF%86%E7%82%B9%E6%80%BB%E7%BB%93/"/>
    
    
      <category term="I/O" scheme="https://akaqin.github.io/tags/I-O/"/>
    
  </entry>
  
  <entry>
    <title>arts-7.md</title>
    <link href="https://akaqin.github.io/2018/09/23/arts-7/"/>
    <id>https://akaqin.github.io/2018/09/23/arts-7/</id>
    <published>2018-09-23T06:57:22.000Z</published>
    <updated>2020-03-07T12:43:30.673Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Algorithm"><a href="#Algorithm" class="headerlink" title="Algorithm"></a>Algorithm</h2><p>Merge two sorted linked lists and return it as a new list. The new list should be made by splicing together the nodes of the first two lists.</p><p><strong>Example:</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: 1-&gt;2-&gt;4, 1-&gt;3-&gt;4</span><br><span class="line">Output: 1-&gt;1-&gt;2-&gt;3-&gt;4-&gt;4</span><br></pre></td></tr></table></figure><a id="more"></a><h4 id="Approach-1-Recursion"><a href="#Approach-1-Recursion" class="headerlink" title="Approach 1: Recursion"></a>Approach 1: Recursion</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for singly-linked list.</span></span><br><span class="line"><span class="comment"> * struct ListNode &#123;</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     struct ListNode *next;</span></span><br><span class="line"><span class="comment"> * &#125;;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">struct ListNode *<span class="title">mergeTwoLists</span><span class="params">(struct ListNode *l1, struct ListNode *l2)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (l1 == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> l2;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (l2 == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> l1;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (l1-&gt;val &lt; l2-&gt;val) &#123;</span><br><span class="line">        l1-&gt;next = mergeTwoLists(l1-&gt;next, l2);</span><br><span class="line">        <span class="keyword">return</span> l1;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        l2-&gt;next = mergeTwoLists(l1, l2-&gt;next);</span><br><span class="line">        <span class="keyword">return</span> l2;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹    ç”¨é€’å½’çš„æ€æƒ³ä¸€ç‚¹ä¸€ç‚¹åœ°åˆå¹¶ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯O(n+m)ï¼Œç©ºé—´å¤æ‚çš„ä¹Ÿæ˜¯O(n+m) ã€‚å†™çš„æ—¶å€™é‡åˆ°ä¸€ä¸ªä»¥å‰æ²¡æœ‰æ³¨æ„åˆ°çš„å°å‘ï¼Œå°±æ˜¯Cè¯­è¨€é‡Œæ˜¯æ²¡æœ‰elseifè¿™ä¸ªå…³é”®å­—çš„ï¼Œesleå’Œifä¹‹é—´å¿…é¡»æœ‰ç©ºæ ¼ï¼Œä¸ç„¶ä¼šç¼–è¯‘å¤±è´¥ï¼Œ</p><h4 id="Approach-2-Iteration"><a href="#Approach-2-Iteration" class="headerlink" title="Approach 2: Iteration"></a>Approach 2: Iteration</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for singly-linked list.</span></span><br><span class="line"><span class="comment"> * struct ListNode &#123;</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     struct ListNode *next;</span></span><br><span class="line"><span class="comment"> * &#125;;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">struct ListNode *<span class="title">mergeTwoLists</span><span class="params">(struct ListNode *l1, struct ListNode *l2)</span> </span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">ListNode</span> *<span class="title">prehead</span> = (<span class="title">struct</span> <span class="title">ListNode</span> *)<span class="title">malloc</span>(<span class="title">sizeof</span>(<span class="title">struct</span> <span class="title">ListNode</span>));</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">ListNode</span> *<span class="title">prev</span> = <span class="title">prehead</span>;</span></span><br><span class="line">    <span class="keyword">while</span> (l1 != <span class="literal">NULL</span> &amp;&amp; l2 != <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (l1-&gt;val &lt; l2-&gt;val) &#123;</span><br><span class="line">            prev-&gt;next = l1;</span><br><span class="line">            l1 = l1-&gt;next;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            prev-&gt;next = l2;</span><br><span class="line">            l2 = l2-&gt;next;</span><br><span class="line">        &#125;</span><br><span class="line">        prev = prev-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">    prev-&gt;next = l1 == <span class="literal">NULL</span> ? l2 : l1;</span><br><span class="line">    <span class="keyword">return</span> prehead-&gt;next;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹    è¿­ä»£l1å’Œl2å¤´ä¸Šçš„å…ƒç´ è¿›è¡Œæ¯”è¾ƒï¼Œæ¯æ¬¡å–å‡ºè¾ƒå°çš„ä¸€ä¸ªæ”¾å…¥ä¸€ä¸ªæ–°é“¾è¡¨ï¼Œå¹¶æ›´æ–°è¾ƒå°çš„é‚£ä¸ªå…ƒç´ æ‰€åœ¨çš„é“¾è¡¨çš„æŒ‡é’ˆï¼Œä½¿å…¶æŒ‡å‘ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œé‡å¤ä¸Šä¸€æ­¥éª¤ï¼Œç›´è‡³å…¶ä¸­ä¸€ä¸ªé“¾è¡¨ä¸ºç©ºï¼ŒæŠŠå¦ä¸€ä¸ªé“¾è¡¨å‰©ä¸‹çš„éƒ¨åˆ†æ‹¼åˆ°æ–°é“¾è¡¨åé¢ï¼Œå¹¶è¿”å›æ–°é“¾è¡¨ã€‚</p><p>â€‹    æ—¶é—´å¤æ‚åº¦ä¸ºO(n+m)ï¼Œå› ä¸ºwhileå¾ªç¯çš„æ¬¡æ•°ç›¸å½“äºä¸¤ä¸ªé“¾è¡¨çš„é•¿åº¦ä¹‹å’Œï¼ˆå¿½ç•¥å‰©ä½™çš„éƒ¨åˆ†ï¼‰ï¼Œæ˜¯çº¿æ€§çš„ã€‚</p><p>â€‹    ç©ºé—´å¤æ‚åº¦æ˜¯O(1)ï¼Œè¿­ä»£ç®—æ³•åªæ˜¯åˆ†é…äº†å‡ ä¸ªæŒ‡é’ˆï¼Œå…·æœ‰æ’å®šçš„æ€»å†…å­˜å ç”¨é‡ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;Algorithm&quot;&gt;&lt;a href=&quot;#Algorithm&quot; class=&quot;headerlink&quot; title=&quot;Algorithm&quot;&gt;&lt;/a&gt;Algorithm&lt;/h2&gt;&lt;p&gt;Merge two sorted linked lists and return it as a new list. The new list should be made by splicing together the nodes of the first two lists.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Example:&lt;/strong&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;Input: 1-&amp;gt;2-&amp;gt;4, 1-&amp;gt;3-&amp;gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Output: 1-&amp;gt;1-&amp;gt;2-&amp;gt;3-&amp;gt;4-&amp;gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
      <category term="ARTS" scheme="https://akaqin.github.io/categories/ARTS/"/>
    
    
      <category term="ARTS" scheme="https://akaqin.github.io/tags/ARTS/"/>
    
  </entry>
  
  <entry>
    <title>arts-6.md</title>
    <link href="https://akaqin.github.io/2018/09/16/arts-6/"/>
    <id>https://akaqin.github.io/2018/09/16/arts-6/</id>
    <published>2018-09-16T01:55:29.000Z</published>
    <updated>2020-03-07T12:43:22.600Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Algorithm"><a href="#Algorithm" class="headerlink" title="Algorithm"></a>Algorithm</h2><p>Given a string containing just the characters <code>&#39;(&#39;</code>, <code>&#39;)&#39;</code>, <code>&#39;{&#39;</code>, <code>&#39;}&#39;</code>, <code>&#39;[&#39;</code> and <code>&#39;]&#39;</code>, determine if the input string is valid.</p><p>An input string is valid if:</p><ol><li>Open brackets must be closed by the same type of brackets.</li><li>Open brackets must be closed in the correct order.</li></ol><p>Note that an empty string is also considered valid.</p><p><strong>Example 1:</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: &quot;()&quot;</span><br><span class="line">Output: true</span><br></pre></td></tr></table></figure><p><strong>Example 2:</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: &quot;()[]&#123;&#125;&quot;</span><br><span class="line">Output: true</span><br></pre></td></tr></table></figure><p><strong>Example 3:</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: &quot;(]&quot;</span><br><span class="line">Output: false</span><br></pre></td></tr></table></figure><a id="more"></a><p><strong>Example 4:</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: &quot;([)]&quot;</span><br><span class="line">Output: false</span><br></pre></td></tr></table></figure><p><strong>Example 5:</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: &quot;&#123;[]&#125;&quot;</span><br><span class="line">Output: true</span><br></pre></td></tr></table></figure><h3 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdbool.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">isValid</span><span class="params">(<span class="keyword">char</span> *s)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> len = <span class="built_in">strlen</span>(s);</span><br><span class="line">    <span class="keyword">if</span> (len % <span class="number">2</span> != <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> limit = len / <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">char</span> *<span class="built_in">stack</span> = <span class="built_in">malloc</span>(limit);</span><br><span class="line">    <span class="keyword">int</span> idx = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">char</span> cur;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">        cur = s[i];</span><br><span class="line">        <span class="keyword">if</span> ((cur == <span class="string">'('</span>) || (cur == <span class="string">'['</span>) || (cur == <span class="string">'&#123;'</span>)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (idx == limit) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">stack</span>[idx++] = cur;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (idx == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> ((cur == <span class="string">'&#125;'</span> &amp;&amp; <span class="built_in">stack</span>[idx - <span class="number">1</span>] == <span class="string">'&#123;'</span>)</span><br><span class="line">                || (cur == <span class="string">']'</span> &amp;&amp; <span class="built_in">stack</span>[idx - <span class="number">1</span>] == <span class="string">'['</span>)</span><br><span class="line">                || (cur == <span class="string">')'</span> &amp;&amp; <span class="built_in">stack</span>[idx - <span class="number">1</span>] == <span class="string">'('</span>))</span><br><span class="line">            &#123;</span><br><span class="line">                idx--;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">free</span>(<span class="built_in">stack</span>);</span><br><span class="line">    <span class="keyword">return</span> idx == <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">char</span> *s = <span class="string">"(([]))"</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, <span class="built_in">isValid</span>(s));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">isValid</span><span class="params">(s <span class="keyword">string</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">    parentheses := <span class="keyword">map</span>[<span class="keyword">rune</span>]<span class="keyword">rune</span>&#123;<span class="string">')'</span>: <span class="string">'('</span>, <span class="string">']'</span>: <span class="string">'['</span>, <span class="string">'&#125;'</span>: <span class="string">'&#123;'</span>&#125;</span><br><span class="line">    <span class="keyword">var</span> stack []<span class="keyword">rune</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> _, char := <span class="keyword">range</span> s &#123;</span><br><span class="line">        <span class="keyword">if</span> char == <span class="string">'('</span> || char == <span class="string">'['</span> || char == <span class="string">'&#123;'</span> &#123;</span><br><span class="line">            stack = <span class="built_in">append</span>(stack, char)</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> <span class="built_in">len</span>(stack) &gt; <span class="number">0</span> &amp;&amp; parentheses[char] == stack[<span class="built_in">len</span>(stack) - <span class="number">1</span>] &#123;</span><br><span class="line">            stack = stack[:<span class="built_in">len</span>(stack) - <span class="number">1</span>]</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">len</span>(stack) == <span class="number">0</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é“é¢˜æ¯”è¾ƒç®€å•ï¼Œè§£é¢˜æ€è·¯æ¯”è¾ƒå•ä¸€ï¼ˆä¹Ÿå¯èƒ½æ˜¯æˆ‘æ²¡çœ‹åˆ°åˆ«çš„æ€è·¯ï¼‰ï¼Œç”¨ä¸€ä¸ªæ ˆå»ä»å·¦åˆ°å³çš„è¯»å–å­—ç¬¦ä¸²ï¼Œé‡åˆ°å·¦æ‹¬å·å°±å…¥æ ˆï¼Œå³æ‹¬å·å°±åˆ¤æ–­ä¸å‰ä¸€ä¸ªæ˜¯å¦å¯¹åº”ï¼Œæ˜¯çš„è¯å°±å‡ºæ ˆï¼Œå¦çš„è¯å°±æŠ¥é”™ï¼Œç›´è‡³è¯»å–å®Œæ²¡æœ‰é‡åˆ°é”™è¯¯çš„è¯idxçš„å€¼åº”è¯¥ç­‰äº0ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;Algorithm&quot;&gt;&lt;a href=&quot;#Algorithm&quot; class=&quot;headerlink&quot; title=&quot;Algorithm&quot;&gt;&lt;/a&gt;Algorithm&lt;/h2&gt;&lt;p&gt;Given a string containing just the characters &lt;code&gt;&amp;#39;(&amp;#39;&lt;/code&gt;, &lt;code&gt;&amp;#39;)&amp;#39;&lt;/code&gt;, &lt;code&gt;&amp;#39;{&amp;#39;&lt;/code&gt;, &lt;code&gt;&amp;#39;}&amp;#39;&lt;/code&gt;, &lt;code&gt;&amp;#39;[&amp;#39;&lt;/code&gt; and &lt;code&gt;&amp;#39;]&amp;#39;&lt;/code&gt;, determine if the input string is valid.&lt;/p&gt;
&lt;p&gt;An input string is valid if:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Open brackets must be closed by the same type of brackets.&lt;/li&gt;
&lt;li&gt;Open brackets must be closed in the correct order.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Note that an empty string is also considered valid.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Example 1:&lt;/strong&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;Input: &amp;quot;()&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Output: true&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;&lt;strong&gt;Example 2:&lt;/strong&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;Input: &amp;quot;()[]&amp;#123;&amp;#125;&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Output: true&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;&lt;strong&gt;Example 3:&lt;/strong&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;Input: &amp;quot;(]&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Output: false&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
      <category term="ARTS" scheme="https://akaqin.github.io/categories/ARTS/"/>
    
    
      <category term="ARTS" scheme="https://akaqin.github.io/tags/ARTS/"/>
    
  </entry>
  
  <entry>
    <title>æŒ‡é’ˆå­¦ä¹ ç¬”è®°</title>
    <link href="https://akaqin.github.io/2018/09/09/%E6%8C%87%E9%92%88%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    <id>https://akaqin.github.io/2018/09/09/%E6%8C%87%E9%92%88%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</id>
    <published>2018-09-09T02:36:27.000Z</published>
    <updated>2020-03-08T07:43:29.416Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Cè¯­è¨€æŒ‡é’ˆçš„æ€»ç»“"><a href="#Cè¯­è¨€æŒ‡é’ˆçš„æ€»ç»“" class="headerlink" title="Cè¯­è¨€æŒ‡é’ˆçš„æ€»ç»“"></a>Cè¯­è¨€æŒ‡é’ˆçš„æ€»ç»“</h1><p>åŸæ–‡å‡ºè‡ªxx_cc</p><p>é“¾æ¥ï¼š<a href="https://www.jianshu.com/p/63f3bfb58687" target="_blank" rel="noopener">https://www.jianshu.com/p/63f3bfb58687</a></p><h2 id="1-å˜é‡"><a href="#1-å˜é‡" class="headerlink" title="1. å˜é‡"></a>1. å˜é‡</h2><ol><li>ä¸åŒç±»å‹çš„å˜é‡åœ¨å†…å­˜ä¸­å æ®ä¸åŒçš„å­—èŠ‚ç©ºé—´ã€‚</li><li>å†…å­˜ä¸­å­˜å‚¨æ•°æ®çš„æœ€å°åŸºæœ¬å•ä½æ˜¯å­—èŠ‚ï¼Œæ¯ä¸€ä¸ªå­—èŠ‚éƒ½æœ‰ä¸€ä¸ªå†…å­˜åœ°å€ï¼Œè¿™ä¸ªåœ°å€æ˜¯ä¸€ä¸ªåå…­è¿›åˆ¶çš„æ•°ã€‚</li><li>å£°æ˜ä¸€ä¸ªå˜é‡ï¼Œåœ¨å†…å­˜ä¸­æ˜¯ä»é«˜å­—èŠ‚å‘ä½å­—èŠ‚åˆ†é…è¿ç»­çš„æŒ‡å®šå­—èŠ‚æ•°çš„ç©ºé—´ã€‚</li><li>ä»»ä½•æ•°æ®åœ¨å†…å­˜ä¸­éƒ½æ˜¯ä»¥å…¶äºŒè¿›åˆ¶çš„è¡¥ç å½¢å¼å­˜å‚¨çš„ï¼Œä½ä½å­˜å‚¨åœ¨ä½å­—èŠ‚ï¼Œé«˜ä½å­˜å‚¨åœ¨é«˜å­—èŠ‚ã€‚</li><li>å˜é‡çš„å€¼ï¼šå­˜å‚¨åœ¨å˜é‡ä¸­çš„æ•°æ®ï¼Œå«åšå˜é‡çš„å€¼ã€‚</li><li>å˜é‡çš„åœ°å€ï¼šä¸€ä¸ªå˜é‡æ˜¯ç”±ä¸€ä¸ªæˆ–è€…å¤šä¸ªå­—èŠ‚ç»„æˆçš„ï¼Œç»„æˆè¿™ä¸ªå˜é‡çš„ä½å­—èŠ‚çš„åœ°å€ï¼Œå°±æ˜¯è¿™ä¸ªå˜é‡çš„åœ°å€ã€‚</li><li>å¦‚ä½•å–å‡ºå˜é‡çš„åœ°å€ï¼šä½¿ç”¨&amp;ï¼ˆå–åœ°å€è¿ç®—ç¬¦ï¼‰è¿ç®—ç¬¦ï¼Œ&amp;å˜é‡åï¼›è¿™ä¸ªè¡¨è¾¾å¼çš„å€¼å°±æ˜¯è¿™ä¸ªå˜é‡çš„åœ°å€ã€‚ä½¿ç”¨%pæ§åˆ¶åº¦è¾“å‡ºå˜é‡çš„åœ°å€ã€‚</li><li>ä»€ä¹ˆæ˜¯æŒ‡é’ˆï¼šå˜é‡çš„åœ°å€å«åšæŒ‡é’ˆï¼ŒæŒ‡é’ˆå°±æ˜¯åœ°å€ï¼Œåœ°å€å°±æ˜¯æŒ‡é’ˆã€‚</li></ol><p>ä¸‹é¢é€šè¿‡ä¸€å¼ å›¾å¯ä»¥æ›´ç›´è§‚çš„ç†è§£å†…å­˜ä¸­çš„åœ°å€</p><p><img src="https:////upload-images.jianshu.io/upload_images/1434508-3146d4e4c4362be7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/925/format/webp" alt="img"></p><p>å†…å­˜ä¸­çš„åœ°å€æ¼”ç¤ºå›¾</p><a id="more"></a><h2 id="2-æŒ‡é’ˆ"><a href="#2-æŒ‡é’ˆ" class="headerlink" title="2. æŒ‡é’ˆ"></a>2. æŒ‡é’ˆ</h2><ol><li>æŒ‡é’ˆæ˜¯Cè¯­è¨€çš„çµé­‚ã€‚æŒ‡é’ˆå˜é‡å æ®8ä¸ªå­—èŠ‚ã€‚</li><li>å˜é‡åœ¨å†…å­˜ä¸­çš„å­˜å‚¨ã€‚<br> å˜é‡çš„å€¼ï¼šå­˜å‚¨åœ¨å˜é‡ä¸­çš„æ•°æ®ï¼Œå«åšå˜é‡çš„å€¼ã€‚<br> å˜é‡çš„åœ°å€ï¼šç»„æˆè¿™ä¸ªå˜é‡çš„ä½å­—èŠ‚çš„åœ°å€ï¼Œå°±æ˜¯è¿™ä¸ªå˜é‡çš„åœ°å€ã€‚</li><li>å–å‡ºå˜é‡çš„åœ°å€ï¼Œç”¨&amp;è¿ç®—ç¬¦ %pè¾“å‡ºå˜é‡çš„åœ°å€ã€‚</li><li>å˜é‡çš„åœ°å€å°±å«åšæŒ‡é’ˆï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ªæŒ‡é’ˆå˜é‡æ¥å­˜å‚¨å˜é‡çš„åœ°å€ã€‚</li></ol><h5 id="æŒ‡é’ˆå˜é‡ï¼š"><a href="#æŒ‡é’ˆå˜é‡ï¼š" class="headerlink" title="æŒ‡é’ˆå˜é‡ï¼š"></a>æŒ‡é’ˆå˜é‡ï¼š</h5><ol><li>æŒ‡é’ˆå˜é‡å°±æ˜¯ä¸“é—¨ç”¨æ¥å­˜å‚¨ <strong>åœ°å€</strong> çš„å˜é‡ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±è¯´æŒ‡é’ˆå˜é‡æŒ‡å‘äº†å¦å¤–ä¸€ä¸ªå˜é‡ï¼Œå­˜å‚¨ç€å¦å¤–ä¸€ä¸ªå˜é‡çš„åœ°å€ã€‚</li><li>æŒ‡é’ˆå¯ä»¥ä½¿è®¿é—®ä¸€ä¸ªå˜é‡çš„æ–¹å¼åˆ†ä¸ºä¸¤ç§ã€‚<br> a. ç›´æ¥è®¿é—®<br> b. å¯ä»¥é€šè¿‡æŒ‡é’ˆå˜é‡ï¼Œæ‰¾åˆ°è¿™ä¸ªæŒ‡é’ˆæŒ‡å‘çš„å˜é‡<br> æ‰€ä»¥é€šè¿‡æŒ‡é’ˆå˜é‡å¯ä»¥é—´æ¥çš„è®¿é—®æŒ‡é’ˆå˜é‡æŒ‡å‘çš„å¦å¤–ä¸€ä¸ªå˜é‡ã€‚</li><li><strong>å¦‚ä½•å£°æ˜ä¸€ä¸ªä¸“é—¨ç”¨æ¥å­˜å‚¨åœ°å€çš„æŒ‡é’ˆå˜é‡</strong><br> æ•°æ®ç±»å‹  <code>*</code> æŒ‡é’ˆå˜é‡çš„åç§°   â€” <code>int * p1;</code><br> æŒ‡é’ˆå˜é‡çš„åå­—å«åšp1ï¼Œè¿™ä¸ªæŒ‡é’ˆå˜é‡çš„ç±»å‹æ˜¯<code>int*</code> è¯»ä½œintæŒ‡é’ˆã€‚<br> <code>*</code>è¡¨ç¤ºè¿™ä¸ªå˜é‡ä¸æ˜¯ä¸€ä¸ªæ™®é€šå˜é‡ï¼Œè€Œæ˜¯ä¸€ä¸ªä¸“é—¨ç”¨æ¥å­˜å‚¨åœ°å€çš„æŒ‡é’ˆå˜é‡ï¼Œæ‰€ä»¥æœ‰å“ªäº›æ™®é€šçš„æ•°æ®ç±»å‹ï¼Œå°±å¯ä»¥æœ‰å“ªäº›ç±»å‹çš„æŒ‡é’ˆã€‚<br> å£°æ˜çš„æ—¶å€™æ³¨æ„ï¼Œ<code>*</code>çš„ä½ç½® å»ºè®®  <code>int* p</code>è¿™æ ·æé†’æˆ‘ä»¬è¿™æ˜¯ä¸€ä¸ª<code>int*</code>ç±»å‹çš„æŒ‡é’ˆã€‚<br> ** ä¸€ä¸ªæŒ‡é’ˆå˜é‡å¹¶ä¸æ˜¯å¯ä»¥å­˜å‚¨ä»»æ„ç±»å‹çš„å˜é‡çš„åœ°å€ï¼Œè€Œæ˜¯æœ‰é™å®šçš„ï¼Œåªèƒ½å­˜å‚¨å’Œè¿™ä¸ªæŒ‡é’ˆç±»å‹ç›¸åŒçš„æ™®é€šå˜é‡çš„åœ°å€ã€‚** æ‰€ä»¥<code>p</code> æŒ‡é’ˆå˜é‡ä¸­åªèƒ½å­˜å‚¨<code>int</code>ç±»å‹å˜é‡çš„åœ°å€ã€‚</li><li>æŒ‡é’ˆå˜é‡çš„åˆå§‹åŒ–</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">int num &#x3D; 10;</span><br><span class="line">int *p &#x3D;  &amp;num; å»ºè®®int* p &#x3D; &amp;num;è¿™æ ·å†™</span><br></pre></td></tr></table></figure><p>pæŒ‡é’ˆæŒ‡å‘äº†numå˜é‡ã€‚å› ä¸ºpæŒ‡é’ˆçš„å€¼å°±æ˜¯numå˜é‡çš„åœ°å€ï¼Œä¸èƒ½ç›´æ¥èµ‹å€¼ä¸€ä¸ªéåœ°å€ç±»å‹çš„å¸¸é‡æ•°æ®ï¼Œä¹Ÿä¸èƒ½ç›´æ¥èµ‹å€¼ä¸€ä¸ªå˜é‡ç»™æŒ‡é’ˆã€‚</p><ol><li>pæŒ‡é’ˆè‡ªå·±ä¹Ÿæœ‰åœ°å€ï¼Œ å› ä¸ºæŒ‡é’ˆå˜é‡ä¹Ÿæ˜¯ä¸€ä¸ªå˜é‡ï¼Œ&amp;på–åˆ°æŒ‡é’ˆpçš„åœ°å€ã€‚</li><li>pæ“ä½œçš„æ˜¯pè¿™ä¸ªæŒ‡é’ˆå˜é‡ï¼Œå¯ä»¥å–på¾—å€¼ï¼Œä¹Ÿå¯ä»¥ä¸ºpèµ‹å€¼</li><li><strong>æŒ‡é’ˆå˜é‡çš„ä½¿ç”¨</strong><br> å¯ä»¥ä½¿ç”¨æŒ‡é’ˆé—´æ¥çš„æ“ä½œæŒ‡é’ˆæŒ‡å‘çš„å˜é‡ã€‚<br> <code>*p</code> ä»£è¡¨ <code>p</code> æŒ‡é’ˆæŒ‡å‘çš„å˜é‡ã€‚<br> <code>*p</code> å®Œå…¨ç­‰ä»·äº<code>num</code> å³ <code>*p = 100</code> å®Œå…¨ç­‰ä»·äº <code>num = 100</code>ã€‚<br> <code>*p = 100;</code> è¡¨ç¤ºå°†100èµ‹å€¼ç»™pæŒ‡é’ˆæŒ‡å‘çš„å˜é‡ï¼Œä¹Ÿå°±æ˜¯numå˜é‡</li></ol><p>ä½¿ç”¨æŒ‡é’ˆå˜é‡çš„æ—¶å€™æ³¨æ„ç‚¹<br> <code>int* p1 ,p2, p3 ;</code> æ­¤æ—¶<code>p1</code>æ˜¯<code>int *</code>æŒ‡é’ˆï¼Œè€Œ<code>p2,p3</code>æ˜¯<code>int</code>ç±»å‹æ•°æ® å¦‚æœå¸Œæœ›å…¨éƒ¨éƒ½æ˜¯æŒ‡é’ˆéœ€è¦ <code>int *p1, * p2, * p3;</code></p><ol><li><strong>é‡æŒ‡é’ˆ</strong><br> æˆ‘ä»¬å£°æ˜ä¸€ä¸ªæŒ‡é’ˆå˜é‡ï¼Œå¦‚æœæ²¡æœ‰ä¸ºå…¶åˆå§‹åŒ–ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™è¿™ä¸ªæŒ‡é’ˆå˜é‡ä¸­æ˜¯æœ‰å€¼çš„ï¼Œæ˜¯<strong>åƒåœ¾å€¼ï¼Œéšæœºæ•°</strong>ã€‚å› ä¸ºè¿™ä¸ªæ—¶å€™ï¼Œè¿™ä¸ªæŒ‡é’ˆå˜é‡æœ‰å¯èƒ½æŒ‡å‘äº†ä¸€å—<strong>éšæœºçš„ç©ºé—´</strong>ï¼Œè¿™ä¸ªç©ºé—´å¯èƒ½æ— äººä½¿ç”¨ï¼Œä¹Ÿå¯èƒ½åˆ«çš„ç¨‹åºåœ¨ç”¨ï¼Œä¹Ÿå¯èƒ½ç³»ç»Ÿåœ¨ç”¨ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œå»è®¿é—®æŒ‡é’ˆæŒ‡å‘çš„çš„å˜é‡çš„æ—¶å€™ï¼Œå°±ä¼šæŠ¥é”™ã€‚<strong>BAD_ACCESS</strong>ååœ°å€è®¿é—®é”™è¯¯ï¼Œåƒè¿™æ ·çš„æŒ‡é’ˆæˆ‘ä»¬å°±å«åšé‡æŒ‡é’ˆã€‚</li><li>NULLå€¼ å®Œå…¨ç­‰ä»·äº0<br> ä¸ºäº†é˜²æ­¢é‡æŒ‡é’ˆçš„äº§ç”Ÿï¼Œå»ºè®®å£°æ˜ä¸€ä¸ªæŒ‡é’ˆå˜é‡åï¼Œæœ€å¥½ä¸ºå…¶åˆå§‹åŒ–ï¼Œå¦‚æœæ²¡æœ‰å˜é‡çš„åœ°å€åˆå§‹åŒ–ç»™è¿™ä¸ªæŒ‡é’ˆå˜é‡ã€‚é‚£ä¹ˆå°±åˆå§‹åŒ–ä¸€ä¸ª<strong>NULL</strong>å€¼ã€‚NULLå€¼ä»£è¡¨æŒ‡é’ˆå˜é‡ä¸æŒ‡å‘å†…å­˜ä¸­çš„ä»»ä½•åœ°å€ï¼Œè¿™æ ·å°±ä¸ä¼šå‡ºç°é‡æŒ‡é’ˆï¼Œ<strong>NULLå®Œå…¨ç­‰ä»·äº0</strong>ï¼Œæ‰€ä»¥ä¹Ÿå¯ä»¥ç›´æ¥èµ‹å€¼ç»™ä¸€ä¸ªæŒ‡é’ˆå˜é‡0ã€‚<br> å¦‚æœä¸€ä¸ªæŒ‡é’ˆå˜é‡çš„å€¼æ˜¯NULLï¼Œé‚£ä¹ˆå»è®¿é—®è¿™ä¸ªæŒ‡é’ˆæŒ‡å‘çš„å˜é‡çš„æ—¶å€™ä¸€å®šä¼šæŠ¥é”™ã€‚</li><li>å¤šä¸ªæŒ‡é’ˆæŒ‡å‘åŒä¸€ä¸ªå˜é‡ï¼Œä¿®æ”¹å…¶ä¸­ä¸€ä¸ªæ‰€æœ‰æŒ‡é’ˆæŒ‡å‘çš„å€¼éƒ½ä¼šæ”¹å˜ã€‚å› ä¸ºå¤šä¸ªä¸ªæŒ‡é’ˆæŒ‡å‘çš„æ˜¯åŒä¸€å—åœ°å€ã€‚å³ <code>*</code> ä¼šä½¿æŒ‡é’ˆé—´æ¥çš„æ“ä½œæŒ‡é’ˆæŒ‡å‘çš„å˜é‡ã€‚</li><li><strong>æŒ‡é’ˆä½œä¸ºå‡½æ•°çš„å‚æ•°</strong><br> å¦‚æœå‡½æ•°çš„å‚æ•°æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œé‚£ä¹ˆå°±å¿…é¡»è¦ä¸ºè¿™ä¸ª<strong>æŒ‡é’ˆ</strong>ä¼ é€’ä¸€ä¸ªå’Œ<strong>æŒ‡é’ˆç±»å‹ç›¸åŒçš„æ™®é€šå˜é‡çš„åœ°å€</strong>ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œåœ¨å‡½æ•°çš„å†…éƒ¨å»è®¿é—®å‚æ•°æŒ‡é’ˆçš„å˜é‡çš„æ—¶å€™ï¼Œå…¶å®è®¿é—®çš„å°±æ˜¯å®å‚å˜é‡</li><li><strong>æŒ‡é’ˆä½œä¸ºå‡½æ•°çš„å‚æ•°ï¼Œå¯ä»¥å®ç°ä»€ä¹ˆæ•ˆæœï¼Ÿ</strong><br> å‡½æ•°çš„å†…éƒ¨å¯ä»¥ä¿®æ”¹å®å‚å˜é‡çš„å€¼ã€‚é‚£ä¹ˆä»€ä¹ˆæ—¶å€™ä½¿ç”¨æŒ‡é’ˆä½œä¸ºå‚æ•°å‘¢ï¼Ÿ<br> ä¸€èˆ¬å‡½æ•°åªèƒ½è¿”å›ä¸€ä¸ªæ•°æ®ï¼Œé‚£ä¹ˆå½“å‡½æ•°éœ€è¦è¿”å›<strong>å¤šä¸ªæ•°æ®</strong>çš„æ—¶å€™å°±å¯ä»¥ä½¿ç”¨<strong>æŒ‡é’ˆä½œä¸ºå‚æ•°</strong>ï¼Œè®©<strong>è°ƒç”¨è€…å°†è‡ªå·±çš„å˜é‡çš„åœ°å€ä¼ é€’ç»™å‡½æ•°å†…éƒ¨ï¼Œå‡½æ•°å†…éƒ¨é€šè¿‡æŒ‡é’ˆå°±å¯ä»¥ä¿®æ”¹å‚æ•°</strong>ï¼Œå‡½æ•°æ— éœ€å°†æ•°å€¼ä¼ å›æ¥ï¼Œå°±å·²ç»ä¿®æ”¹äº†å‚æ•°çš„å€¼ã€‚å…¶å®scanfå‡½æ•°ä¼ é€’çš„å°±æ˜¯æŒ‡é’ˆï¼Œ<strong>å› æ­¤å½“å‡½æ•°éœ€è¦å¤šä¸ªè¿”å›å€¼çš„æ—¶å€™å°±å¯ä»¥ä½¿ç”¨æŒ‡é’ˆä½œä¸ºå‚æ•°ã€‚</strong></li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; ä»ä¸‹é¢ä»£ç ä¸­å°±å¯ä»¥çœ‹å‡ºï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨å‡½æ•°ä¸­ä¿®æ”¹ä¸¤ä¸ªå˜é‡çš„å€¼ã€‚ç›¸å½“äºå‡½æ•°æœ‰ä¸¤ä¸ªè¿”å›å€¼ã€‚</span><br><span class="line">void  changeValue (int* p1 ,int* p2)&#123;</span><br><span class="line">    *p1 &#x3D; 100;</span><br><span class="line">    *p2 &#x3D; 200;</span><br><span class="line">&#125;</span><br><span class="line">int main(int argc, const char * argv[]) &#123;</span><br><span class="line">    int num1 &#x3D; 1;</span><br><span class="line">    int num2 &#x3D; 2;</span><br><span class="line">    changeValue(&amp;num1, &amp;num2);</span><br><span class="line">    printf(&quot;num1 &#x3D; %d\n&quot;,num1);</span><br><span class="line">    printf(&quot;num2 &#x3D; %d&quot;,num2);</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li><strong>æŒ‡é’ˆä¸ºä»€ä¹ˆè¦åˆ†ç±»å‹</strong><br> <strong>æŒ‡é’ˆå˜é‡æ—¢ç„¶æ˜¯ä¸€ä¸ªå˜é‡å°±è¦åœ¨å†…å­˜ä¸­å ç”¨å­—èŠ‚ç©ºé—´</strong><br> æŒ‡é’ˆå˜é‡åœ¨å†…å­˜ä¸­å æ®å¤šå°‘å­—èŠ‚æ•°ï¼Ÿ<br> <strong>æ— è®ºæŒ‡é’ˆæ˜¯ä»€ä¹ˆç±»å‹åœ¨å†…å­˜ä¸­éƒ½æ˜¯å æ®8ä¸ªå­—èŠ‚ã€‚</strong><br> é‚£ä¸ºä»€ä¹ˆæŒ‡é’ˆè¿˜è¦åˆ†ç±»å‘¢ï¼Ÿ<br> pæŒ‡é’ˆå˜é‡ä¸­å­˜å‚¨çš„æ˜¯numå˜é‡çš„åœ°å€ï¼Œä¹Ÿå°±æ˜¯numå˜é‡ä½å­—èŠ‚çš„åœ°å€ï¼Œ<strong>é€šè¿‡pæŒ‡é’ˆåªèƒ½æ‰¾åˆ°è¿™ä¸ªåœ°å€çš„å­—èŠ‚</strong>ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œé€šè¿‡pæŒ‡é’ˆæ‰¾åˆ°è¿™ä¸ªå­—èŠ‚ï¼Œæ“ä½œçš„æ—¶å€™ï¼Œæ“ä½œå¤šå°‘ä¸ªå­—èŠ‚æ˜¯åˆ™æ˜¯æ ¹æ®<strong>æŒ‡é’ˆçš„ç±»å‹</strong>æ¥å†³å®šçš„ã€‚<br> <strong>æ‰€ä»¥æŒ‡é’ˆå˜é‡çš„ç±»å‹å†³å®šäº†é€šè¿‡è¿™ä¸ªæŒ‡é’ˆæ‰¾åˆ°å­—èŠ‚ä»¥åï¼Œè¿ç»­æ“ä½œå¤šå°‘ä¸ªå­—èŠ‚ç©ºé—´ã€‚</strong><br> int æŒ‡é’ˆ è¿ç»­æ“ä½œ4ä¸ªå­—èŠ‚ç©ºé—´<br> double æŒ‡é’ˆ è¿ç»­æ“ä½œ8ä¸ªå­—èŠ‚ç©ºé—´<br> float æŒ‡é’ˆ  è¿ç»­æ“ä½œ4ä¸ªå­—èŠ‚ç©ºé—´<br> char æŒ‡é’ˆ  è¿ç»­æ“ä½œ1ä¸ªå­—èŠ‚ç©ºé—´<br> å› æ­¤ï¼ŒæŒ‡é’ˆçš„ç±»å‹å¦‚æœä¸å’ŒæŒ‡å‘çš„å˜é‡çš„ç±»å‹ç›¸åŒçš„è¯ï¼Œé‚£ä¹ˆé€šè¿‡æŒ‡é’ˆå°±æ— æ³•æ­£ç¡®çš„æ“ä½œæŒ‡å‘çš„å˜é‡ï¼Œæ‰€ä»¥ï¼Œ<strong>æŒ‡é’ˆçš„å˜é‡ä¸€å®šè¦æŒ‡å‘ä¸€ä¸ªå’Œè‡ªå·±ç±»å‹ç›¸åŒçš„æ™®é€šå˜é‡æ‰å¯ä»¥ã€‚</strong></li></ol><p>   <img src="https:////upload-images.jianshu.io/upload_images/1434508-a35b6912864b9740.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/676/format/webp" alt="img"></p><p>   æŒ‡é’ˆä¸ºä»€ä¹ˆè¦åˆ†ç±»å‹ï¼Ÿ</p><ol start="2"><li><p>å¤šçº§æŒ‡é’ˆ<br> ä¸€ä¸ªæŒ‡é’ˆå˜é‡ä¸­å­˜å‚¨çš„æ˜¯ä¸€ä¸ªä¸€çº§æŒ‡é’ˆçš„åœ°å€ï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯äºŒçº§æŒ‡é’ˆï¼Œä¸€ä¸ªæŒ‡é’ˆå˜é‡ä¸­å­˜å‚¨çš„æ˜¯ä¸€ä¸ªäºŒçº§æŒ‡é’ˆçš„åœ°å€ï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯ä¸‰çº§æŒ‡é’ˆã€‚<br> äºŒçº§æŒ‡é’ˆï¼š<code>æ•°æ®ç±»å‹ ** æŒ‡é’ˆå</code><br> äºŒçº§æŒ‡é’ˆåªèƒ½å­˜å‚¨ä¸€çº§æŒ‡é’ˆå˜é‡çš„åœ°å€ã€‚<br> å¤šçº§æŒ‡é’ˆåœ¨å¼€å‘ä¸­å¾ˆå°‘ç”¨åˆ°ï¼Œé‡åˆ°å¤šçº§æŒ‡é’ˆè€å¿ƒåˆ†æä¸€å®šå¯ä»¥ç†æ¸…å…¶ä¸­çš„å…³ç³»ã€‚</p></li><li><p>æŒ‡é’ˆä¸æ•´æ•°çš„åŠ å‡æ³•<br> æŒ‡é’ˆå¯ä»¥å’Œæ•´æ•°è¿›è¡ŒåŠ å‡è¿ç®—ï¼ŒæŒ‡é’ˆ+1å¹¶ä¸æ˜¯åœ¨æŒ‡é’ˆåœ°å€çš„åŸºç¡€ä¹‹ä¸ŠåŠ ä¸€ä¸ªå­—èŠ‚çš„åœ°å€ï¼Œè€Œæ˜¯åœ¨è¿™ä¸ª<strong>æŒ‡é’ˆåœ°å€çš„åŸºç¡€ä¹‹ä¸ŠåŠ ä¸€ä¸ªå•ä½å˜é‡å ç”¨çš„å­—èŠ‚æ•°</strong>ï¼Œä¾‹å¦‚ï¼šå¦‚æœæŒ‡é’ˆç±»å‹æ˜¯<code>int *</code> åˆ™+1ä»£è¡¨åŠ 4ä¸ªå­—èŠ‚åœ°å€ï¼Œä»¥æ­¤ç±»æ¨ã€‚</p></li><li><p><strong>æŒ‡é’ˆä¸æ•°ç»„</strong><br> æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æŒ‡é’ˆæ¥éå†æ•°ç»„ï¼Œå› ä¸ºæ•°ç»„çš„æœ¬è´¨å…¶å®å°±æ˜¯æŒ‡é’ˆï¼Œå½“æˆ‘ä»¬åˆ›å»ºæ•°ç»„çš„æ—¶å€™ï¼Œç³»ç»Ÿä¼šåœ¨å†…å­˜ä¸­ç”±é«˜åœ°å€å‘ä½åœ°å€åˆ†é…è¿ç»­çš„ç±»å‹æ‰€å çš„ç©ºé—´å­—èŠ‚æ•° * æ•°ç»„å†…å…ƒç´ çš„ä¸ªæ•°çš„å­—èŠ‚æ§ä»¶ã€‚è€Œæ•°ç»„ååˆ™ä»£è¡¨äº†æ•°ç»„çš„ä½å­—èŠ‚åœ°å€ï¼Œä¹Ÿå°±æ˜¯æ•°ç»„çš„åœ°å€ã€‚<br> 1). ä½¿ç”¨æŒ‡é’ˆéå†æ•°ç»„çš„ç¬¬ä¸€ç§æ–¹å¼.<br> int arr[7] = {10,20,30,40,50,60,70}; //åœ¨å†…å­˜ä¸­é«˜åœ°å€å‘ä½åœ°å€åˆ†é…è¿ç»­çš„ ç±»å‹æ‰€å çš„ç©ºé—´å­—èŠ‚æ•° * æ•°ç»„å†…å…ƒç´ çš„ä¸ªæ•° 7 * 4 = 28 ä¸ªå­—èŠ‚ç©ºé—´<br> int* p1 = arr;    //p1æŒ‡é’ˆæŒ‡å‘äº†æ•°ç»„çš„ç¬¬0ä¸ªå…ƒç´ .<br> for(int i = 0; i &lt; 7; i++)<br> {<br> printf(â€œ%d\nâ€,*(p1+i));<br> }</p><p>2). ä½¿ç”¨æŒ‡é’ˆéå†æ•°ç»„çš„ç¬¬äºŒç§æ–¹å¼.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">int arr[7] &#x3D; &#123;10,20,30,40,50,60,70&#125;;</span><br><span class="line">for(int i &#x3D; 0; i &lt; 7; i++)</span><br><span class="line">&#123;</span><br><span class="line">   printf(&quot;%d\n&quot;,*(arr+i));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3). ä½¿ç”¨æŒ‡é’ˆéå†æ•°ç»„çš„ç¬¬ä¸‰ç§æ–¹å¼.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">int arr[7] &#x3D; &#123;10,20,30,40,50,60,70&#125;;</span><br><span class="line">int* p1 &#x3D; arr;</span><br><span class="line">for(int i &#x3D; 0; i &lt; 7; i++)</span><br><span class="line">&#123;</span><br><span class="line">   printf(&quot;%d\n&quot;,*(p1++));</span><br><span class="line">&#125;</span><br><span class="line">æ³¨æ„çš„åœ°æ–¹,æ¯æ¬¡å¾ªç¯,p1çš„å€¼éƒ½ä¼šå˜åŒ–ã€‚</span><br><span class="line">æœ€å1æ¬¡æ‰§è¡Œå®Œæ¯•ä¹‹å,p1æŒ‡é’ˆæŒ‡å‘æ•°ç»„å¤–é¢å»äº†,p1å°±ä¸å†æ‰§è¡Œæ•°ç»„ä¸­çš„ä»»ä½•å…ƒç´ äº†ã€‚</span><br></pre></td></tr></table></figure><p>æ³¨æ„: æ•°ç»„åä»£è¡¨æ•°ç»„çš„åœ°å€ï¼Œè€Œæ•°ç»„ä¸€æ—¦åˆ›å»ºï¼Œæ•°ç»„çš„åœ°å€å°±ç¡®å®šäº†ï¼Œä¸èƒ½æ”¹å˜ã€‚<br> æ‰€ä»¥ï¼Œæˆ‘ä»¬ä¸èƒ½ä¸ºæ•°ç»„åèµ‹å€¼ä¹Ÿä¸èƒ½ä¿®æ”¹æ•°ç»„åçš„å€¼ï¼Œä½†æ˜¯å¯ä»¥ä½¿ç”¨æ•°ç»„åçš„å€¼ã€‚<br> <strong>arræ˜¯æ•°ç»„çš„åœ°å€ï¼Œä¹Ÿæ˜¯æ•°ç»„ä¸­ç¬¬0ä¸ªå…ƒç´ çš„åœ°å€ï¼Œarr+1å°±æ˜¯æ•°ç»„ä¸­ç¬¬ä¸€ä¸ªå…ƒç´ çš„åœ°å€ï¼Œæ•°æ®åå°±æ˜¯ä¸€ä¸ªåœ°å€å¸¸é‡ï¼Œæ— æ³•æ”¹å˜ã€‚</strong></p></li><li><p><strong>æ•°ç»„ä½œä¸ºå‡½æ•°çš„å‚æ•°çš„æœ¬è´¨</strong><br> å½“æ•°ç»„ä½œä¸ºå‡½æ•°çš„å‚æ•°çš„æ—¶å€™ï¼Œåœ¨å£°æ˜è¿™ä¸ªå‚æ•°æ•°ç»„çš„æ—¶å€™ï¼Œå¹¶ä¸æ˜¯å»åˆ›å»ºä¸€ä¸ªæ•°ç»„ï¼Œè€Œæ˜¯å»åˆ›å»ºä¸€ä¸ªç”¨æ¥å­˜å‚¨åœ°å€çš„æŒ‡é’ˆå˜é‡ï¼Œå¦‚æœæˆ‘ä»¬ä¸ºå‡½æ•°å†™äº†ä¸€ä¸ªæ•°ç»„ä½œä¸ºå‚æ•°ï¼Œå…¶å®ç¼–è¯‘å™¨åœ¨ç¼–è¯‘çš„æ—¶å€™ï¼Œå·²ç»æŠŠè¿™ä¸ªæ•°ç»„å˜æˆäº†æŒ‡é’ˆï¼Œè¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬é€šè¿‡sizeofè®¡ç®—å‚æ•°æ•°ç»„å¾—åˆ°çš„æ°¸è¿œéƒ½æ˜¯8ï¼Œæ‰€ä»¥ä»¥åæˆ‘ä»¬çš„å‡½æ•°å¦‚æœå¸¦äº†ä¸€ä¸ªæ•°ç»„å‚æ•°ï¼Œå»ºè®®ç›´æ¥å†™ä¸€ä¸ªæŒ‡å‘æ•°ç»„çš„ç¬¬0ä¸ªå…ƒç´ çš„æŒ‡é’ˆï¼Œåœ¨ä¼ å…¥æ•°ç»„çš„é•¿åº¦</p></li><li><p><strong>ç´¢å¼•çš„æœ¬è´¨</strong><br> <strong>æŒ‡é’ˆå˜é‡åé¢å¯ä»¥ä½¿ç”¨ä¸­æ‹¬å·ï¼Œåœ¨ä¸­æ‹¬å¼§ä¸­å†™ä¸Šä¸‹æ ‡æ¥è®¿é—®æ•°æ®ã€‚</strong><br> <code>p[n];</code>å‰æ<code>p</code>æ˜¯ä¸€ä¸ªæŒ‡é’ˆå˜é‡ï¼Œå®Œå…¨ç­‰ä»·äº<code>*(p + n);</code><br> æ‰€ä»¥<code>arr[0]</code> å°±ç­‰ä»·äº <code>* [arr + 0]</code>ã€‚<br> æ“ä½œæ•°ç»„æˆ‘ä»¬è™½ç„¶ä½¿ç”¨ä¸­æ‹¬å¼§ä¸‹æ ‡æ¥æ“ä½œï¼Œå®é™…ä¸Šå†…éƒ¨æœ¬è´¨ä»ç„¶æ˜¯ä½¿ç”¨çš„æŒ‡é’ˆæ¥æ“ä½œã€‚</p></li><li><p>å­˜å‚¨æŒ‡é’ˆçš„æ•°ç»„<br> å¦‚æœä¸€ä¸ªæ•°ç»„æ˜¯ç”¨æ¥å­˜å‚¨æŒ‡é’ˆç±»å‹çš„æ•°æ®çš„è¯ï¼Œé‚£ä¹ˆè¿™ä¸ªæ•°ç»„å°±å«åšå­˜å‚¨æŒ‡é’ˆçš„æ•°ç»„<br> æ ¼å¼ ï¼š<code>å…ƒç´ ç±»å‹ æ•°ç»„å[æ•°ç»„é•¿åº¦];</code> <code>int * arr[3];</code><br> arræ•°ç»„é‡Œé¢å­˜å‚¨intæŒ‡é’ˆæ•°æ®ï¼Œæœ€å¤šå­˜å‚¨3ä¸ªã€‚</p></li><li><p>æŒ‡é’ˆä¸æŒ‡é’ˆä¹‹é—´çš„å‡æ³•è¿ç®—<br> æŒ‡é’ˆä¸æŒ‡é’ˆä¹‹é—´å¯ä»¥åšå‡æ³•è¿ç®—ï¼Œç»“æœæ˜¯ä¸€ä¸ªlongç±»å‹çš„æ•°æ®ï¼Œ<br> ç»“æœçš„æ„ä¹‰ä»£è¡¨ä¸¤ä¸ªæŒ‡é’ˆæŒ‡å‘çš„å˜é‡ä¹‹é—´ç›¸å·®å¤šå°‘ä¸ªå•ä½å˜é‡ï¼Œç»å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ç”¨åœ¨åˆ¤æ–­æ•°ç»„çš„ä¸¤ä¸ªå…ƒç´ ä¹‹é—´ç›¸å·®å¤šå°‘ä¸ªå…ƒç´ <br> å¦‚æœå‚ä¸å‡æ³•è¿ç®—çš„ä¸¤ä¸ªæŒ‡é’ˆä¸æŒ‡å‘åŒä¸€ä¸ªæ•°ç»„ï¼Œç»“æœå°±ä¼šå‡ºç°é—®é¢˜<br> <strong>ç»“æœ = ä¸¤ä¸ªæŒ‡é’ˆçš„å·® / æ¯ä¸€ä¸ªæŒ‡é’ˆå˜é‡å¯¹åº”çš„æ™®é€šå˜é‡å ç”¨çš„å­—èŠ‚æ•°ã€‚</strong><br> å¹¶ä¸”åªèƒ½åšå‡æ³•è¿ç®—ï¼Œ<strong>ç”¨åœ¨æ•°ç»„å½“ä¸­åˆ¤æ–­ä¸¤ä¸ªå…ƒç´ ä¹‹é—´ç›¸å·®å¤šå°‘ä¸ªå…ƒç´ ã€‚</strong></p></li><li><p>æŒ‡é’ˆä¸æŒ‡é’ˆåœ¨ä¹‹é—´çš„æ¯”è¾ƒè¿ç®— <code>&lt;, &lt;=, &gt;, &gt;=, ==, !=</code>éƒ½å¯ä»¥ä½¿ç”¨<br> å¯ä»¥ç”¨æ¥åˆ¤æ–­ä¸¤ä¸ªæŒ‡é’ˆæŒ‡å‘çš„å˜é‡çš„å­—èŠ‚ï¼Œè°åœ¨é«˜å­—èŠ‚ï¼Œè°åœ¨ä½å­—èŠ‚ã€‚æˆ–è€…ä¸¤ä¸ªæŒ‡é’ˆçš„åœ°å€æ˜¯ä¸æ˜¯åŒä¸€ä¸ªåœ°å€ã€‚</p></li><li><p><strong>æŒ‡é’ˆå’Œå­—ç¬¦å˜é‡</strong><br> <code>char *name = &quot;jack&quot;;</code>è¡¨ç¤ºç›´æ¥å°†ä¸€ä¸ªå­—ç¬¦ä¸²æ•°æ®åˆå§‹åŒ–ç»™ä¸€ä¸ªå­—ç¬¦æŒ‡é’ˆã€‚</p><p><strong>å­—ç¬¦æŒ‡é’ˆå­˜å‚¨å’Œå­—ç¬¦æ•°ç»„å­˜å‚¨çš„åŒºåˆ«</strong></p></li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; å­—ç¬¦æ•°ç»„å­˜å‚¨ï¼šå°†å­—ç¬¦ä¸²æ•°æ®çš„æ¯ä¸€ä¸ªå­—ç¬¦å­˜å‚¨åˆ°å­—ç¬¦æ•°ç»„çš„å…ƒç´ ä¸­ï¼Œå¹¶è¿½åŠ ä¸€ä¸ª \n è¡¨ç¤ºç»“æŸ</span><br><span class="line">char name[5] &#x3D; &quot;jack&quot;;</span><br><span class="line">&#x2F;&#x2F; ç›´æ¥ä¸ºå­—ç¬¦æŒ‡é’ˆåˆå§‹åŒ–ä¸€ä¸ªå­—ç¬¦ä¸²æ•°æ®</span><br><span class="line">char *name &#x3D; &quot;jack&quot;;</span><br><span class="line">1.) å½“ä»–ä»¬éƒ½æ˜¯å±€éƒ¨å˜é‡çš„æ—¶å€™</span><br></pre></td></tr></table></figure><p><strong>å­—ç¬¦æ•°ç»„</strong>æ˜¯ç”³è¯·åœ¨æ ˆåŒºçš„ï¼Œå­—ç¬¦ä¸²çš„æ¯ä¸€ä¸ªå­—ç¬¦å­˜å‚¨åœ¨å­—ç¬¦æ•°ç»„çš„æ¯ä¸€ä¸ªå…ƒç´ ä¸­ã€‚<br> <strong>æŒ‡é’ˆå˜é‡</strong>æ˜¯å£°æ˜åœ¨æ ˆåŒºçš„ã€‚ä½†æ˜¯æ­¤æ—¶å­—ç¬¦ä¸²æ•°æ®æ˜¯ä»¥å­—ç¬¦æ•°ç»„çš„å½¢å¼å­˜å‚¨åœ¨<strong>å¸¸é‡åŒº</strong>çš„ã€‚æ­¤æ—¶<strong>æŒ‡é’ˆå˜é‡ä¸­å­˜å‚¨çš„æ˜¯å­—ç¬¦ä¸²åœ¨å¸¸é‡åŒºçš„åœ°å€</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2.) å½“ä»–ä»¬ä½œä¸ºå…¨å±€å˜é‡çš„æ—¶å€™</span><br></pre></td></tr></table></figure><p><strong>å­—ç¬¦æ•°ç»„</strong>æ˜¯å­˜å‚¨åœ¨å¸¸é‡åŒºçš„ï¼Œå­—ç¬¦ä¸²çš„æ¯ä¸€ä¸ªå­—ç¬¦å­˜å‚¨åœ¨è¿™ä¸ªæ•°ç»„ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ ä¸­ã€‚<br> <strong>å­—ç¬¦æŒ‡é’ˆ</strong>ä¹Ÿæ˜¯å­˜å‚¨åœ¨å¸¸é‡åŒºï¼Œå­—ç¬¦ä¸²ä¹Ÿæ˜¯ä»¥å­—ç¬¦æ•°ç»„çš„å½¢å¼å­˜å‚¨åœ¨å¸¸é‡åŒºï¼Œ<strong>æŒ‡é’ˆä¸­å­˜å‚¨çš„æ˜¯å­—ç¬¦ä¸²åœ¨å¸¸é‡åŒºçš„åœ°å€ã€‚</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">**ä»¥å­—ç¬¦æ•°ç»„å­˜å‚¨çš„å­—ç¬¦ä¸²æ•°æ®ï¼Œå¯ä»¥ä¿®æ”¹å­—ç¬¦æ•°ç»„çš„å…ƒç´ ã€‚å¯å˜</span><br><span class="line">ä»¥å­—ç¬¦æŒ‡é’ˆçš„å½¢å¼å­˜å‚¨å­—ç¬¦ä¸²æ•°æ®ï¼Œè¿™ä¸ªæ—¶å€™å­—ç¬¦æŒ‡é’ˆæŒ‡å‘çš„å­—ç¬¦ä¸²æ•°æ®æ˜¯æ— æ³•ä¿®æ”¹çš„ï¼Œä¸å¯å˜**</span><br></pre></td></tr></table></figure><ol><li><p><strong>å­—ç¬¦ä¸²çš„æ’å®šå‹</strong><br> å‰æï¼š<strong>ä»¥å­—ç¬¦æŒ‡é’ˆå½¢å¼å­˜å‚¨çš„å­—ç¬¦ä¸²</strong><br> 1.) å½“æˆ‘ä»¬ä»¥å­—ç¬¦æŒ‡é’ˆçš„å½¢å¼å­˜å‚¨å­—ç¬¦ä¸²çš„æ—¶å€™ï¼Œæ— è®ºå¦‚ä½•ï¼Œå­—ç¬¦ä¸²æ•°æ®æ˜¯å­˜å‚¨åœ¨å¸¸é‡åŒºçš„ï¼Œå¹¶ä¸”ï¼Œä¸€æ—¦å­˜å‚¨åˆ°å¸¸é‡å»ä¸­å»ï¼Œè¿™ä¸ªå­—ç¬¦ä¸²æ•°æ®å°±æ— æ³•æ›´æ”¹ã€‚</p><p>2.) å½“æˆ‘ä»¬ä»¥å­—ç¬¦æŒ‡é’ˆçš„å½¢å¼è¦å°†å­—ç¬¦ä¸²æ•°æ®å­˜å‚¨åˆ°å¸¸é‡åŒºçš„æ—¶å€™ï¼Œå¹¶ä¸æ˜¯ç›´æ¥å°†å­—ç¬¦ä¸²å­˜å‚¨åˆ°å¸¸é‡åŒºï¼Œè€Œæ˜¯å…ˆæ£€æŸ¥å¸¸é‡åŒºä¸­æ˜¯å¦æœ‰ç›¸åŒå†…å®¹çš„å­—ç¬¦ä¸²ï¼Œå¦‚æœæœ‰ï¼Œç›´æ¥å°†è¿™ä¸ªå­—ç¬¦ä¸²çš„åœ°å€æ‹¿è¿‡æ¥è¿”å›ï¼Œå¦‚æœæ²¡æœ‰ï¼Œæ‰ä¼šå°†è¿™ä¸ªå­—ç¬¦ä¸²æ•°æ®å­˜å‚¨åˆ°å¸¸é‡åŒºä¸­ã€‚</p><p>3.) å½“æˆ‘ä»¬é‡æ–°ä¸ºå­—ç¬¦æŒ‡é’ˆåˆå§‹åŒ–ä¸€ä¸ªå­—ç¬¦ä¸²çš„æ—¶å€™ï¼Œå¹¶ä¸æ˜¯ä¿®æ”¹åŸæ¥çš„å­—ç¬¦ä¸²ï¼Œå› ä¸ºåŸæ¥çš„å­—ç¬¦ä¸²æ•°æ®æ˜¯ä¸å¯æ›´æ”¹çš„ï¼Œè€Œæ˜¯é‡æ–°çš„åˆ›å»ºäº†ä¸€ä¸ªå­—ç¬¦ä¸²ï¼ŒæŠŠè¿™ä¸ªæ–°çš„å­—ç¬¦ä¸²çš„åœ°å€èµ‹ç»™ä»–ã€‚å»ºè®®ä½¿ç”¨å­—ç¬¦æŒ‡é’ˆæ¥å­˜å‚¨å­—ç¬¦ä¸²æ•°æ®ã€‚ä¼˜åŠ¿ï¼šé•¿åº¦ä»»æ„ã€‚</p></li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">char *name &#x3D; &quot;jack&quot;;</span><br><span class="line">nsme &#x3D; &quot;rose&quot;;</span><br><span class="line">&#x2F;&#x2F; è¿™æ ·å¯ä»¥ ä½†æ˜¯å¹¶ä¸æ˜¯æŠŠjackæ”¹æˆäº†roseï¼Œè€Œæ˜¯é‡æ–°åˆ›å»ºäº†ä¸€ä¸ª&quot;rose&quot;,æŠŠroseåœ°å€èµ‹å€¼ç»™name</span><br></pre></td></tr></table></figure><ol><li>å­—ç¬¦ä¸²æ•°ç»„<br> <code>char *names[4] = {&quot;aa&quot;,&quot;bb&quot;,&quot;cc&quot;,&quot;dd&quot;};</code><br> namesæ•°ç»„çš„å…ƒç´ çš„ç±»å‹æ˜¯charæŒ‡é’ˆï¼Œåˆå§‹åŒ–ç»™å…ƒç´ çš„å­—ç¬¦ä¸²æ•°æ®æ˜¯å­˜å‚¨åœ¨å¸¸é‡åŒºçš„ã€‚å…ƒç´ ä¸­å­˜å‚¨çš„æ˜¯<strong>å­—ç¬¦ä¸²åœ¨å¸¸é‡åŒºçš„åœ°å€</strong><br> å› æ­¤è¿™æ˜¯ä¸€ä¸ªå­˜å‚¨æŒ‡é’ˆçš„æ•°ç»„ï¼Œæ¯ä¸€ä¸ªå…ƒç´ çš„ç±»å‹æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œå ç”¨å¾—å†…å­˜ä¸º8ä¸ªå­—èŠ‚ã€‚</li><li>æŒ‡å‘å‡½æ•°çš„æŒ‡é’ˆã€‚<br> ç¨‹åºåœ¨è¿è¡Œçš„æ—¶å€™ï¼Œä¼šå°†ç¨‹åºåŠ è½½åˆ°å†…å­˜ï¼Œå†…å­˜çš„ä»£ç æ®µä¸­ä¸»è¦å­˜å‚¨çš„å°±æ˜¯ç¨‹åºçš„ä»£ç ï¼Œè€Œç¨‹åºçš„ä»£ç å°±åŒ…æ‹¬å‡½æ•°ã€‚<strong>æ—¢ç„¶å‡½æ•°è¦å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œé‚£ä¹ˆè‚¯å®šè¦ç”¨1å—ç©ºé—´æ¥å­˜å‚¨ï¼Œé‚£ä¹ˆè¿™ä¸ªå—ç©ºé—´ä¸€å®šæœ‰1ä¸ªåœ°å€ã€‚</strong><br> å› æ­¤æˆ‘ä»¬å°±å¯ä»¥<strong>å£°æ˜1ä¸ªæŒ‡é’ˆç”¨æ¥å­˜å‚¨è¿™ä¸ªå‡½æ•°çš„åœ°å€</strong>ï¼Œä¹Ÿå°±æ˜¯è¯´è®©è¿™ä¸ªæŒ‡é’ˆæŒ‡å‘è¿™ä¸ªå‡½æ•°ã€‚è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨<strong>æŒ‡é’ˆæ¥é—´æ¥çš„è°ƒç”¨å‡½æ•°</strong>ã€‚<br> ä¼˜åŠ¿: è°ƒç”¨å‡½æ•°æœ‰äº†ä¸¤ç§æ–¹å¼ã€‚<br> 1.) ç›´æ¥ä½¿ç”¨å‡½æ•°åè°ƒç”¨<br> 2.) ä½¿ç”¨æŒ‡å‘å‡½æ•°çš„æŒ‡é’ˆé—´æ¥è°ƒç”¨.</li><li>æŒ‡å‘å‡½æ•°çš„æŒ‡é’ˆçš„å£°æ˜<br> ä¸€ä¸ªæŒ‡å‘å‡½æ•°çš„æŒ‡é’ˆï¼Œå¹¶ä¸æ˜¯ä»»æ„çš„å‡½æ•°éƒ½å¯ä»¥æŒ‡å‘ï¼Œè€Œæ˜¯æœ‰é™å®šçš„ï¼Œè¦æ±‚æŒ‡å‘çš„<strong>å‡½æ•°çš„è¿”å›å€¼ç±»å‹å’Œå‚æ•°æè¿°å¿…é¡»è¦ä¸æŒ‡é’ˆçš„æè¿°ä¸€æ ·</strong>ã€‚<br> å£°æ˜è¯­æ³•</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">è¿”å›å€¼ç±»å‹ (*æŒ‡é’ˆå)([å‚æ•°åˆ—è¡¨]);</span><br><span class="line">void (*pFunction)();</span><br><span class="line">&#x2F;&#x2F; è¡¨ç¤ºå£°æ˜äº†1ä¸ªæŒ‡å‘å‡½æ•°çš„æŒ‡é’ˆ,åå­—å«åšpFunctionã€‚</span><br><span class="line">&#x2F;&#x2F; è¿™ä¸ªæŒ‡é’ˆåªèƒ½æŒ‡å‘æ²¡æœ‰è¿”å›å€¼,å¹¶ä¸”æ²¡æœ‰å‚æ•°çš„å‡½æ•°ã€‚</span><br><span class="line">int (*pFun)(int num1,int num2);</span><br><span class="line">&#x2F;&#x2F; è¡¨ç¤ºå£°æ˜äº†1ä¸ªæŒ‡å‘å‡½æ•°çš„æŒ‡é’ˆ,åå­—å«åšpFun.</span><br><span class="line">&#x2F;&#x2F; è¿™ä¸ªæŒ‡é’ˆåªèƒ½æŒ‡å‘è¿”å›å€¼ä¸ºintç±»å‹ å¹¶ä¸”æœ‰ä¸¤ä¸ªæ•´å‹çš„å‚æ•°çš„å‡½æ•°.</span><br></pre></td></tr></table></figure><ol><li><strong>æŒ‡å‘å‡½æ•°çš„æŒ‡é’ˆçš„åˆå§‹åŒ–</strong><br><strong>å‡½æ•°çš„åç§°å°±ä»£è¡¨å‡½æ•°çš„åœ°å€ï¼Œå› æ­¤æˆ‘ä»¬ç›´æ¥å°†ç¬¦åˆæ¡ä»¶çš„å‡½æ•°çš„åç§°èµ‹å€¼ç»™è¿™ä¸ªæŒ‡é’ˆã€‚</strong><br>å¹¶ä¸”æˆ‘ä»¬æœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥é€šè¿‡æŒ‡é’ˆæ¥è°ƒç”¨è¿™ä¸ªå‡½æ•°ã€‚</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">int MaxValue (int a, int b)&#123;</span><br><span class="line">       return a &gt; b ? a : b;</span><br><span class="line">&#125;</span><br><span class="line">int main(int argc, const char * argv[]) &#123;    </span><br><span class="line">       int(*pMaxValue)(int a, int b) &#x3D; MaxValue; &#x2F;&#x2F; åˆ›å»ºä¸€ä¸ªè¿”å›int å¹¶ä¸”æœ‰ä¸¤ä¸ªintå‹å‚æ•°çš„å‡½æ•°æŒ‡é’ˆï¼Œå¹¶èµ‹å€¼ã€‚</span><br><span class="line">       printf(&quot;%d\n&quot;, pMaxValue(5,10)); &#x2F;&#x2F; é€šè¿‡æŒ‡é’ˆè°ƒç”¨å‡½æ•°æ–¹æ³•1</span><br><span class="line">       printf(&quot;%d\n&quot;,(*pMaxValue)(6,9)); &#x2F;&#x2F; é€šè¿‡æŒ‡é’ˆè°ƒç”¨å‡½æ•°æ–¹æ³•2</span><br><span class="line">       printf(&quot;%d\n&quot;,MaxValue(9, 13)); &#x2F;&#x2F; è°ƒç”¨å‡½æ•°</span><br><span class="line">       printf(&quot;%p\n&quot;,MaxValue); &#x2F;&#x2F; è¾“å‡ºå‡½æ•°çš„åœ°å€</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;Cè¯­è¨€æŒ‡é’ˆçš„æ€»ç»“&quot;&gt;&lt;a href=&quot;#Cè¯­è¨€æŒ‡é’ˆçš„æ€»ç»“&quot; class=&quot;headerlink&quot; title=&quot;Cè¯­è¨€æŒ‡é’ˆçš„æ€»ç»“&quot;&gt;&lt;/a&gt;Cè¯­è¨€æŒ‡é’ˆçš„æ€»ç»“&lt;/h1&gt;&lt;p&gt;åŸæ–‡å‡ºè‡ªxx_cc&lt;/p&gt;
&lt;p&gt;é“¾æ¥ï¼š&lt;a href=&quot;https://www.jianshu.com/p/63f3bfb58687&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://www.jianshu.com/p/63f3bfb58687&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;1-å˜é‡&quot;&gt;&lt;a href=&quot;#1-å˜é‡&quot; class=&quot;headerlink&quot; title=&quot;1. å˜é‡&quot;&gt;&lt;/a&gt;1. å˜é‡&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;ä¸åŒç±»å‹çš„å˜é‡åœ¨å†…å­˜ä¸­å æ®ä¸åŒçš„å­—èŠ‚ç©ºé—´ã€‚&lt;/li&gt;
&lt;li&gt;å†…å­˜ä¸­å­˜å‚¨æ•°æ®çš„æœ€å°åŸºæœ¬å•ä½æ˜¯å­—èŠ‚ï¼Œæ¯ä¸€ä¸ªå­—èŠ‚éƒ½æœ‰ä¸€ä¸ªå†…å­˜åœ°å€ï¼Œè¿™ä¸ªåœ°å€æ˜¯ä¸€ä¸ªåå…­è¿›åˆ¶çš„æ•°ã€‚&lt;/li&gt;
&lt;li&gt;å£°æ˜ä¸€ä¸ªå˜é‡ï¼Œåœ¨å†…å­˜ä¸­æ˜¯ä»é«˜å­—èŠ‚å‘ä½å­—èŠ‚åˆ†é…è¿ç»­çš„æŒ‡å®šå­—èŠ‚æ•°çš„ç©ºé—´ã€‚&lt;/li&gt;
&lt;li&gt;ä»»ä½•æ•°æ®åœ¨å†…å­˜ä¸­éƒ½æ˜¯ä»¥å…¶äºŒè¿›åˆ¶çš„è¡¥ç å½¢å¼å­˜å‚¨çš„ï¼Œä½ä½å­˜å‚¨åœ¨ä½å­—èŠ‚ï¼Œé«˜ä½å­˜å‚¨åœ¨é«˜å­—èŠ‚ã€‚&lt;/li&gt;
&lt;li&gt;å˜é‡çš„å€¼ï¼šå­˜å‚¨åœ¨å˜é‡ä¸­çš„æ•°æ®ï¼Œå«åšå˜é‡çš„å€¼ã€‚&lt;/li&gt;
&lt;li&gt;å˜é‡çš„åœ°å€ï¼šä¸€ä¸ªå˜é‡æ˜¯ç”±ä¸€ä¸ªæˆ–è€…å¤šä¸ªå­—èŠ‚ç»„æˆçš„ï¼Œç»„æˆè¿™ä¸ªå˜é‡çš„ä½å­—èŠ‚çš„åœ°å€ï¼Œå°±æ˜¯è¿™ä¸ªå˜é‡çš„åœ°å€ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚ä½•å–å‡ºå˜é‡çš„åœ°å€ï¼šä½¿ç”¨&amp;amp;ï¼ˆå–åœ°å€è¿ç®—ç¬¦ï¼‰è¿ç®—ç¬¦ï¼Œ&amp;amp;å˜é‡åï¼›è¿™ä¸ªè¡¨è¾¾å¼çš„å€¼å°±æ˜¯è¿™ä¸ªå˜é‡çš„åœ°å€ã€‚ä½¿ç”¨%pæ§åˆ¶åº¦è¾“å‡ºå˜é‡çš„åœ°å€ã€‚&lt;/li&gt;
&lt;li&gt;ä»€ä¹ˆæ˜¯æŒ‡é’ˆï¼šå˜é‡çš„åœ°å€å«åšæŒ‡é’ˆï¼ŒæŒ‡é’ˆå°±æ˜¯åœ°å€ï¼Œåœ°å€å°±æ˜¯æŒ‡é’ˆã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä¸‹é¢é€šè¿‡ä¸€å¼ å›¾å¯ä»¥æ›´ç›´è§‚çš„ç†è§£å†…å­˜ä¸­çš„åœ°å€&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https:////upload-images.jianshu.io/upload_images/1434508-3146d4e4c4362be7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/925/format/webp&quot; alt=&quot;img&quot;&gt;&lt;/p&gt;
&lt;p&gt;å†…å­˜ä¸­çš„åœ°å€æ¼”ç¤ºå›¾&lt;/p&gt;
    
    </summary>
    
    
      <category term="çŸ¥è¯†ç‚¹æ€»ç»“" scheme="https://akaqin.github.io/categories/%E7%9F%A5%E8%AF%86%E7%82%B9%E6%80%BB%E7%BB%93/"/>
    
    
      <category term="C" scheme="https://akaqin.github.io/tags/C/"/>
    
      <category term="pointer" scheme="https://akaqin.github.io/tags/pointer/"/>
    
  </entry>
  
  <entry>
    <title>arts-5</title>
    <link href="https://akaqin.github.io/2018/08/12/arts-5/"/>
    <id>https://akaqin.github.io/2018/08/12/arts-5/</id>
    <published>2018-08-12T11:20:52.000Z</published>
    <updated>2020-03-07T12:43:13.185Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Algorithm"><a href="#Algorithm" class="headerlink" title="Algorithm"></a>Algorithm</h2><h3 id="Description"><a href="#Description" class="headerlink" title="Description"></a>Description</h3><p>Write a function to find the longest common prefix string amongst an array of strings.</p><p>If there is no common prefix, return an empty string <code>&quot;&quot;</code>.</p><p><strong>Example 1:</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: [&quot;flower&quot;,&quot;flow&quot;,&quot;flight&quot;]</span><br><span class="line">Output: &quot;fl&quot;</span><br></pre></td></tr></table></figure><p><strong>Example 2:</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Input: [&quot;dog&quot;,&quot;racecar&quot;,&quot;car&quot;]</span><br><span class="line">Output: &quot;&quot;</span><br><span class="line">Explanation: There is no common prefix among the input strings.</span><br></pre></td></tr></table></figure><p><strong>Note:</strong></p><p>All given inputs are in lowercase letters <code>a-z</code>.</p><a id="more"></a><p><strong>Solution:</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Created by akaQin on 2018/8/26.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">char</span> *<span class="title">longestCommonPrefix</span><span class="params">(<span class="keyword">char</span> **strs, <span class="keyword">int</span> strsSize)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (strsSize &lt; <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">""</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//    å…ˆé€šè¿‡æŠŠç¬¬ä¸€ä¸ªå­—ç¬¦ä¸²è·Ÿæ¯ä¸ªå­—ç¬¦ä¸²æ¯”è¾ƒçš„æ–¹å¼è®¡ç®—å‡ºå…¬å…±å‰ç¼€çš„é•¿åº¦</span></span><br><span class="line">    <span class="keyword">int</span> index = <span class="built_in">strlen</span>(strs[<span class="number">0</span>]); <span class="keyword">int</span> tempIndex = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; strsSize; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (tempIndex = <span class="number">0</span>; tempIndex &lt; index; tempIndex++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (strs[<span class="number">0</span>][tempIndex] != strs[i][tempIndex]) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (tempIndex == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">""</span>;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//        å½“tempIndex &lt; Indexæ—¶ï¼Œå¯ä»¥æ›´æ–°Indexæ¥çœå»å¤šä½™çš„è®¡ç®—</span></span><br><span class="line">        <span class="keyword">if</span> (tempIndex &lt; index) &#123;</span><br><span class="line">            index = tempIndex;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//è®¡ç®—å‡ºå‰ç¼€é•¿åº¦åï¼Œå­—ç¬¦ä¸²æ•°æ®æ˜¯å­˜å‚¨åœ¨å¸¸é‡åŒºçš„ï¼Œä¸èƒ½ç›´æ¥æ›´æ”¹ï¼Œæ‰€ä»¥è¦ä¸ºå‰ç¼€ç”³è¯·å†…å­˜ç©ºé—´å¹¶ä»˜å€¼ï¼Œ+1æ˜¯ä¸ºäº†ç•™å‡º'\0'çš„ä½ç½®</span></span><br><span class="line">    <span class="keyword">char</span> *prefix = <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="keyword">char</span>) * (index + <span class="number">1</span>));</span><br><span class="line">    <span class="built_in">strncpy</span>(prefix, strs[<span class="number">0</span>], index);</span><br><span class="line">    prefix[index] = <span class="string">'\0'</span>;</span><br><span class="line">    <span class="keyword">return</span> prefix;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">char</span> *arr[] = &#123;<span class="string">""</span>&#125;;</span><br><span class="line">    <span class="keyword">char</span> *p = longestCommonPrefix(arr, <span class="number">4</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%lu\n"</span>, <span class="built_in">strlen</span>(p));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%s\n"</span>, p);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Summary:</strong></p><p>è¿™æ˜¯ä¸€ä¸ªæ¯”è¾ƒå®¹æ˜“æƒ³åˆ°çš„æ€è·¯ï¼Œæ—¶é—´å¤æ‚åº¦çš„æ˜¯O(n^2)ï¼Œä¸ç®—å¿«ï¼›ç©ºé—´å¤æ‚åº¦æ˜¯O(1)ã€‚å¯ä»¥ä¼˜åŒ–çš„ç‚¹æœ‰ä¸¤ä¸ªï¼štempIndexå°äºIndexæ—¶æ›´æ–°Indexï¼Œå‡å°‘ä¸å¿…è¦çš„æ¯”è¾ƒï¼›è®¡ç®—å‡ºå‰ç¼€çš„é•¿åº¦å†å»ä¸ºå˜é‡ç”³è¯·ç©ºé—´ï¼Œä¼šæ¯”ä¸€ä¸Šæ¥å°±ç”³è¯·strs[0]å¤§å°çš„ç©ºé—´ä¹‹åå†æˆªæ–­çš„æ–¹å¼å¥½ä¸€äº›ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">longestCommonPrefix</span><span class="params">(strs []<span class="keyword">string</span>)</span> <span class="title">string</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(strs) == <span class="number">0</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">""</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(strs) == <span class="number">1</span> &#123;</span><br><span class="line"><span class="keyword">return</span> strs[<span class="number">0</span>]</span><br><span class="line">&#125;</span><br><span class="line">fst := strs[<span class="number">0</span>]</span><br><span class="line"><span class="keyword">var</span> carry <span class="keyword">string</span></span><br><span class="line">L0:</span><br><span class="line"><span class="keyword">for</span> i := <span class="keyword">range</span> fst &#123;</span><br><span class="line">t := fst[<span class="number">0</span> : i+<span class="number">1</span>]</span><br><span class="line"><span class="keyword">for</span> _, v := <span class="keyword">range</span> strs &#123;</span><br><span class="line"><span class="keyword">if</span> !strings.HasPrefix(v, t) &#123;</span><br><span class="line"><span class="keyword">break</span> L0</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(t) &gt; <span class="built_in">len</span>(carry) &#123;</span><br><span class="line">carry = t</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> carry</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Review"><a href="#Review" class="headerlink" title="Review"></a>Review</h2><p>åŸæ–‡ï¼š<a href="https://angular.io/guide/architecture-services" target="_blank" rel="noopener">Angular:Introduction to services and dependency injection</a></p><p>Components consume services; that is, you can inject a service into a component, giving the component access to that service class.</p><p>ç»„ä»¶ä½¿ç”¨æœåŠ¡ã€‚æ¢å¥è¯è¯´ï¼Œä½ å¯ä»¥æŠŠæŸä¸ªæœåŠ¡æ³¨å…¥åˆ°ç»„ä»¶ä¸­ï¼Œä»è€Œä½¿å¾—è¿™ä¸ªç»„ä»¶å¯ä»¥è®¿é—®åˆ°è¯¥æœåŠ¡ã€‚</p><p>Dependency injection (often called DI) is wired into the Angular framework and used everywhere to provide new components with the services or other things they need.</p><p>ä¾èµ–æ³¨å…¥ï¼Œç»å¸¸è¢«ç®€ç§°ä¸ºDIï¼Œåœ¨Angularä¸­è¢«å¹¿æ³›ä½¿ç”¨ã€‚ä½ å‡ ä¹å¯ä»¥åœ¨ä»»ä½•åœ°æ–¹ï¼Œçœ‹è§ä»–ä»¬ä¸ºå„ç±»ç»„ä»¶æä¾›æ‰€éœ€çš„æœåŠ¡ã€‚</p><p>The injector maintains a container of dependency instances that it has already created, and reuses them if possible.</p><p>æ³¨å…¥å™¨ç»´æŠ¤ç€ä¸€ä¸ªå®¹å™¨ï¼Œè¿™ä¸ªå®¹å™¨ä¸­æ˜¯å„ç±»å·²ç»è¢«åˆ›å»ºè¿‡çš„ä¾èµ–çš„å®ä¾‹ã€‚å¦‚æœå¯èƒ½çš„è¯ï¼Œæ³¨å…¥å™¨ä¼šä¼˜å…ˆå¤ç”¨è¿™äº›å®ä¾‹ã€‚</p><p>A provider is a recipe for creating a dependency. For a service, this is typically the service class itself. For any dependency you need in your app, you must register a provider with the appâ€™s injector, so that the injector can use it to create new instances.</p><p>â€œæä¾›è€…â€æ˜¯åˆ›å»ºä¾èµ–æ—¶æ‰€ä½¿ç”¨çš„æœºåˆ¶ã€‚å¯¹äºæ™®é€šæœåŠ¡æ¥è¯´ï¼Œâ€œæä¾›è€…â€é€šå¸¸å°±æ˜¯æœåŠ¡ç±»æœ¬èº«ã€‚ä½†å¯¹äºåº”ç”¨ä¸­æ‰€éœ€çš„å…¶ä»–ä¾èµ–æ¥è¯´ï¼Œä½ å¿…é¡»é€šè¿‡â€œæ³¨å…¥å™¨â€æ³¨å†Œä¸€ä¸ªâ€œæä¾›è€…â€ï¼Œä»¥ä¾¿æ³¨å…¥å™¨å¯ä»¥ä½¿ç”¨è¯¥â€œæä¾›è€…â€åˆ›å»ºæ–°çš„å®ä¾‹ã€‚</p><p>When Angular discovers that a component depends on a service, it first checks if the injector already has any existing instances of that service.</p><p>å½“Angularå‘ç°ä¸€ä¸ªç»„ä»¶ä¾èµ–äºæŸä¸ªæœåŠ¡æ—¶ï¼Œå®ƒä¼šå…ˆå»æ£€æŸ¥â€œæ³¨å…¥å™¨â€ä¸­æ˜¯å¦å·²ç»æœ‰äº†è¿™ä¸ªæœåŠ¡çš„å®ä¾‹ã€‚</p><p>If a requested service instance does not yet exist, the injector makes one using the registered provider, and adds it to the injector before returning the service to Angular.</p><p>å¦‚æœè¢«è¯·æ±‚çš„æœåŠ¡å®ä¾‹ä¸å­˜åœ¨ï¼Œé‚£ä¹ˆâ€œæ³¨å…¥å™¨â€å°±ä¼šç”¨æ³¨å†Œè¿‡çš„â€œæä¾›è€…â€åˆ›å»ºä¸€ä¸ªæ–°çš„å®ä¾‹ï¼Œç„¶åæŠŠå®ƒåŠ å…¥åˆ°â€œæ³¨å…¥å™¨â€ä¸­ï¼Œå¹¶æŠŠè¿™ä¸ªå®ä¾‹è¿”å›ç»™Angularã€‚</p><h2 id="SHARE"><a href="#SHARE" class="headerlink" title="SHARE"></a>SHARE</h2><h3 id="å…³äº-typedef-çš„ä¸€äº›ç†è§£"><a href="#å…³äº-typedef-çš„ä¸€äº›ç†è§£" class="headerlink" title="å…³äº typedef çš„ä¸€äº›ç†è§£"></a>å…³äº typedef çš„ä¸€äº›ç†è§£</h3><ol><li>è¡¨è¾¾æ–¹å¼ç®€æ´ã€‚</li><li>å¯ä»¥ä½¿ç¨‹åºå‚æ•°åŒ–ï¼Œæé«˜ç¨‹åºçš„å¯ç§»æ¤æ€§ã€‚å¦‚æœ typedef å£°æ˜çš„æ•°æ®ç±»å‹åŒæœºå™¨æœ‰å…³ï¼Œé‚£ä¹ˆï¼Œå½“ç¨‹åºç§»æ¤åˆ°å…¶ä»–æœºå™¨ä¸Šæ—¶ï¼Œåªéœ€è¦æ”¹å˜ typedef ç±»å‹å®šä¹‰å°±å¯ä»¥äº†ã€‚</li><li>ä¸ºç¨‹åºæä¾›æ›´å¥½çš„è¯´æ˜æ€§â€”â€”Treeptr ç±»å‹æ˜¾ç„¶æ¯”ä¸€ä¸ªå£°æ˜ä¸ºæŒ‡å‘å¤æ‚ç»“æ„çš„æŒ‡é’ˆæ›´å®¹æ˜“è®©äººç†è§£ã€‚</li></ol>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;Algorithm&quot;&gt;&lt;a href=&quot;#Algorithm&quot; class=&quot;headerlink&quot; title=&quot;Algorithm&quot;&gt;&lt;/a&gt;Algorithm&lt;/h2&gt;&lt;h3 id=&quot;Description&quot;&gt;&lt;a href=&quot;#Description&quot; class=&quot;headerlink&quot; title=&quot;Description&quot;&gt;&lt;/a&gt;Description&lt;/h3&gt;&lt;p&gt;Write a function to find the longest common prefix string amongst an array of strings.&lt;/p&gt;
&lt;p&gt;If there is no common prefix, return an empty string &lt;code&gt;&amp;quot;&amp;quot;&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Example 1:&lt;/strong&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;Input: [&amp;quot;flower&amp;quot;,&amp;quot;flow&amp;quot;,&amp;quot;flight&amp;quot;]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Output: &amp;quot;fl&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;&lt;strong&gt;Example 2:&lt;/strong&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;Input: [&amp;quot;dog&amp;quot;,&amp;quot;racecar&amp;quot;,&amp;quot;car&amp;quot;]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Output: &amp;quot;&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Explanation: There is no common prefix among the input strings.&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;All given inputs are in lowercase letters &lt;code&gt;a-z&lt;/code&gt;.&lt;/p&gt;
    
    </summary>
    
    
      <category term="ARTS" scheme="https://akaqin.github.io/categories/ARTS/"/>
    
    
      <category term="ARTS" scheme="https://akaqin.github.io/tags/ARTS/"/>
    
  </entry>
  
  <entry>
    <title>arts-4</title>
    <link href="https://akaqin.github.io/2018/08/04/arts-4/"/>
    <id>https://akaqin.github.io/2018/08/04/arts-4/</id>
    <published>2018-08-04T11:07:58.000Z</published>
    <updated>2020-03-07T12:43:05.684Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Algorithm"><a href="#Algorithm" class="headerlink" title="Algorithm"></a>Algorithm</h2><h3 id="Description"><a href="#Description" class="headerlink" title="Description"></a>Description</h3><p>Roman numerals are represented by seven different symbols: <code>I</code>, <code>V</code>, <code>X</code>, <code>L</code>, <code>C</code>, <code>D</code> and <code>M</code>.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Symbol       Value</span><br><span class="line">I             1</span><br><span class="line">V             5</span><br><span class="line">X             10</span><br><span class="line">L             50</span><br><span class="line">C             100</span><br><span class="line">D             500</span><br><span class="line">M             1000</span><br></pre></td></tr></table></figure><p>For example, two is written as <code>II</code> in Roman numeral, just two oneâ€™s added together. Twelve is written as, <code>XII</code>, which is simply <code>X</code> + <code>II</code>. The number twenty seven is written as <code>XXVII</code>, which is <code>XX</code> + <code>V</code> + <code>II</code>.</p><p>Roman numerals are usually written largest to smallest from left to right. However, the numeral for four is not <code>IIII</code>. Instead, the number four is written as <code>IV</code>. Because the one is before the five we subtract it making four. The same principle applies to the number nine, which is written as <code>IX</code>. There are six instances where subtraction is used:</p><ul><li><code>I</code> can be placed before <code>V</code> (5) and <code>X</code> (10) to make 4 and 9.</li><li><code>X</code> can be placed before <code>L</code> (50) and <code>C</code> (100) to make 40 and 90.</li><li><code>C</code> can be placed before <code>D</code> (500) and <code>M</code> (1000) to make 400 and 900.</li></ul><p>Given a roman numeral, convert it to an integer. Input is guaranteed to be within the range from 1 to 3999.</p><a id="more"></a><p><strong>Example 1:</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: &quot;III&quot;</span><br><span class="line">Output: 3</span><br></pre></td></tr></table></figure><p><strong>Example 2:</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: &quot;IV&quot;</span><br><span class="line">Output: 4</span><br></pre></td></tr></table></figure><p><strong>Example 3:</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: &quot;IX&quot;</span><br><span class="line">Output: 9</span><br></pre></td></tr></table></figure><p><strong>Example 4:</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Input: &quot;LVIII&quot;</span><br><span class="line">Output: 58</span><br><span class="line">Explanation: C &#x3D; 100, L &#x3D; 50, XXX &#x3D; 30 and III &#x3D; 3.</span><br></pre></td></tr></table></figure><p><strong>Example 5:</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Input: &quot;MCMXCIV&quot;</span><br><span class="line">Output: 1994</span><br><span class="line">Explanation: M &#x3D; 1000, CM &#x3D; 900, XC &#x3D; 90 and IV &#x3D; 4.</span><br></pre></td></tr></table></figure><h3 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h3><p>Approach 1</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">convert</span><span class="params">(<span class="keyword">char</span> c)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">switch</span> (c) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'I'</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'V'</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">5</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'X'</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">10</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'L'</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">50</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'C'</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">100</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'D'</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">500</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'M'</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1000</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">romanToInt</span><span class="params">(<span class="keyword">char</span>* s)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> temp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> value1 = <span class="number">0</span>, value2 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> result = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> len = <span class="built_in">strlen</span>(s);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; i += temp) &#123;</span><br><span class="line">        temp = <span class="number">1</span>;</span><br><span class="line">        value1 = convert(s[i]);</span><br><span class="line">        value2 = convert(s[i+<span class="number">1</span>]);</span><br><span class="line">        <span class="keyword">if</span> (value1 &lt; value2 &amp;&amp; value2 != <span class="number">0</span>) &#123;</span><br><span class="line">            result += value2 - value1;</span><br><span class="line">            temp = <span class="number">2</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            result += value1;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Review"><a href="#Review" class="headerlink" title="Review"></a>Review</h2><p>åŸæ–‡ï¼š<a href="https://www.kernel.org/doc/html/latest/userspace-api/unshare.html" target="_blank" rel="noopener">The Linux Kernel</a></p><p>Most legacy operating system kernels support an abstraction of threads as multiple execution contexts within a process.</p><p>å¾ˆå¤šè€æ—§çš„æ“ä½œç³»ç»Ÿå†…æ ¸ä»¥è¿™æ ·çš„æ–¹å¼æ¥æ”¯æŒçº¿ç¨‹ï¼šå®ƒä»¬æŠŠçº¿ç¨‹æŠ½è±¡æˆäº†åŒä¸€è¿›ç¨‹å†…çš„å¤šä¸ªæ‰§è¡Œä¸Šä¸‹æ–‡ã€‚</p><p>These kernels provide special resources and mechanisms to maintain these â€œthreadsâ€.</p><p>è¿™äº›ç³»ç»Ÿå†…æ ¸æä¾›äº†ç‰¹æ®Šçš„èµ„æºå’Œç®¡ç†æœºåˆ¶æ¥æ”¯æŒè¿™ç±»çº¿ç¨‹ã€‚</p><p>The Linux kernel, in a clever and simple manner, does not make distinction between processes and â€œthreadsâ€.</p><p>è€ŒLinuxå†…æ ¸ï¼Œåˆ™é‡‡ç”¨äº†ä¸€ç§èªæ˜è€Œä¸”ç®€å•çš„æ–¹å¼â€”â€”åœ¨å†…æ ¸å±‚é¢ä¸Šï¼Œå®ƒå¹¶ä¸åŒºåˆ†è¿›ç¨‹å’Œçº¿ç¨‹ã€‚</p><p>The kernel allows processes to share resources and thus they can achieve legacy â€œthreadsâ€ behavior without requiring additional data structures and mechanisms in the kernel.</p><p>Linuxå†…æ ¸å…è®¸å¤šæ¡è¿›ç¨‹å…±äº«èµ„æºã€‚è¿™æ ·åšçš„å¥½å¤„åœ¨äºï¼Œå³ä½¿å†…æ ¸ä¸å†æä¾›é¢å¤–çš„æ•°æ®ç»“æ„å’Œç®¡ç†æœºåˆ¶ï¼Œå’Œä¼ ç»Ÿçº¿ç¨‹ç±»ä¼¼çš„è¡Œä¸ºä¹Ÿèƒ½è¢«å®ç°å‡ºæ¥ã€‚</p><p>The power of implementing threads in this manner comes not only from its simplicity but also from allowing application programmers to work outside the confinement of all-or-nothing shared resources of legacy threads.</p><p>ä»¥è¿™æ ·çš„å®ç°æ–¹å¼æ¥æ”¯æŒçº¿ç¨‹ï¼Œä¸ä»…ç®€å•ï¼Œè€Œä¸”ä¹Ÿå¯ä»¥å¸®åŠ©ç¨‹åºå‘˜ä»¬æ‘†è„±æ›¾ç»è®©ä»–ä»¬æ„Ÿåˆ°çƒ¦æ¼çš„ä¸€ä¸ªé™åˆ¶ï¼šåœ¨ä¼ ç»Ÿçš„çº¿ç¨‹æ¨¡å‹ä¸­ï¼Œè¦ä¹ˆå°±ä¸èƒ½å…±äº«èµ„æºï¼Œè¦ä¹ˆå°±å¾—å…¨å±€å…±äº«èµ„æºã€‚</p><p>On Linux, at the time of thread creation using the clone system call, applications can selectively choose which resources to share between threads.</p><p>åœ¨Linuxä¸­ï¼Œç¨‹åºåœ¨ä½¿ç”¨cloneè¿™ä¸ªç³»ç»ŸæŒ‡ä»¤å»åˆ›å»ºçº¿ç¨‹æ—¶ï¼Œå¯ä»¥é€‰æ‹©æ€§åœ°æŒ‡å®šå“ªéƒ¨åˆ†èµ„æºä¼šè¢«å…¶ä»–çº¿ç¨‹æ‰€å…±äº«ï¼Œè€Œæ— éœ€å°†æ‰€æœ‰èµ„æºéƒ½å…±äº«å‡ºå»ã€‚</p><p>unshare() system call adds a primitive to the Linux thread model that allows threads to selectively â€˜unshareâ€™ any resources that were being shared at the time of their creation.</p><p>unshareè¿™ä¸ªç³»ç»ŸæŒ‡ä»¤ï¼Œä¸ºLinuxçš„çº¿ç¨‹æ¨¡å‹å¢åŠ äº†ä¸€ä¸ªåŸºæœ¬åŠŸèƒ½ï¼šå³ä¾¿ä¸€äº›èµ„æºåœ¨çº¿ç¨‹åˆ›å»ºæ—¶è¢«è®¾ç½®ä¸ºå¯å…±äº«äº†ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨unshareæŒ‡ä»¤å°†è¿™äº›èµ„æºé‡æ–°æ”¶å½’ç§æœ‰ã€‚</p><p>OSI and TCP/IP are the most used models to abstract the computer network.</p><p>OSIå’ŒTCP/IPæ˜¯åœ¨æŠ½è±¡è®¡ç®—æœºç½‘ç»œæ—¶æœ€å¸¸ç”¨çš„ä¸¤ç§æ¨¡å‹ã€‚</p><p>OSI, the theoretically better abstraction of the network model, failed to be widely adopted due to its complexity.</p><p>OSIï¼Œè¿™ç§åœ¨ç†è®ºä¸Šçœ‹ä¼¼æ›´ä¼˜çš„ç½‘ç»œæ¨¡å‹çš„æŠ½è±¡æ–¹å¼ï¼Œç”±äºè¿‡äºå¤æ‚è€Œæ²¡æœ‰è¢«å·¥ä¸šç•Œå¤§è§„æ¨¡é‡‡ç”¨ã€‚</p><h3 id="Technique"><a href="#Technique" class="headerlink" title="Technique"></a>Technique</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAXLINES 5000 <span class="comment">/* max #lines to be sorted */</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">char</span> *lineptr[MAXLINES]; <span class="comment">/* pointers to text lines */</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">readlines</span><span class="params">(<span class="keyword">char</span> *lineptr[], <span class="keyword">int</span> nlines)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">writelines</span><span class="params">(<span class="keyword">char</span> *lineptr[], <span class="keyword">int</span> nlines)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">qsort</span><span class="params">(<span class="keyword">char</span> *lineptr[], <span class="keyword">int</span> left, <span class="keyword">int</span> right)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ALLOCSIZE 10000 <span class="comment">/* size of available space */</span></span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">char</span> allocbuf[ALLOCSIZE]; <span class="comment">/* storage for alloc */</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">char</span> *allocp = allocbuf; <span class="comment">/* next free position */</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">char</span> *<span class="title">alloc</span><span class="params">(<span class="keyword">int</span> n)</span> <span class="comment">/* return pointer to n characters */</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (allocbuf + ALLOCSIZE - allocp &gt;= n) &#123; <span class="comment">/* it fits */</span> allocp += n;</span><br><span class="line">        <span class="keyword">return</span> allocp - n; <span class="comment">/* old p */</span> &#125; <span class="keyword">else</span> <span class="comment">/* not enough room */</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">afree</span><span class="params">(<span class="keyword">char</span> *p)</span> <span class="comment">/* free storage pointed to by p */</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (p &gt;= allocbuf &amp;&amp; p &lt; allocbuf + ALLOCSIZE) allocp = p;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getline2</span><span class="params">(<span class="keyword">char</span> s[], <span class="keyword">int</span> lim)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> c, i;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; lim - <span class="number">1</span> &amp;&amp; (c = getchar()) != EOF &amp;&amp; c != <span class="string">'\n'</span>; ++i)</span><br><span class="line">        s[i] = c;</span><br><span class="line">    <span class="keyword">if</span> (c == <span class="string">'\n'</span>) &#123;</span><br><span class="line">        s[i] = c;</span><br><span class="line">        ++i;</span><br><span class="line">    &#125;</span><br><span class="line">    s[i] = <span class="string">'\0'</span>;</span><br><span class="line">    <span class="keyword">return</span> i;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* sort input lines */</span></span><br><span class="line">main() &#123;</span><br><span class="line">    <span class="keyword">int</span> nlines; <span class="comment">/* number of input lines read */</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ((nlines = readlines(lineptr, nlines)) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        qsort(lineptr, <span class="number">0</span>, nlines - <span class="number">1</span>);</span><br><span class="line">        writelines(lineptr, nlines);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"error: input too big to sort\n"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAXLEN 1000 <span class="comment">/* max length of any input line */</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">readlines</span><span class="params">(<span class="keyword">char</span> *lineptr[], <span class="keyword">int</span> maxlines)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> len, nlines;</span><br><span class="line">    <span class="keyword">char</span> *p, <span class="built_in">line</span>[MAXLEN];</span><br><span class="line">    nlines = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> ((len = getline2(<span class="built_in">line</span>, MAXLEN)) &gt; <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">if</span> (nlines &gt;= maxlines || (p = alloc(len)) == <span class="literal">NULL</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">line</span>[len - <span class="number">1</span>] = <span class="string">'\0'</span>; <span class="comment">/* delete newline */</span></span><br><span class="line">            <span class="built_in">strcpy</span>(p, <span class="built_in">line</span>);</span><br><span class="line">            lineptr[nlines++] = p;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">return</span> nlines;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">writelines</span><span class="params">(<span class="keyword">char</span> *lineptr[], <span class="keyword">int</span> nlines)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; nlines; i++)</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%s\n"</span>, lineptr[i]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* qsort: sort v[left]...v[right] into increasing order */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">qsort</span><span class="params">(<span class="keyword">char</span> *v[], <span class="keyword">int</span> left, <span class="keyword">int</span> right)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i, last;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">swap</span><span class="params">(<span class="keyword">char</span> *v[], <span class="keyword">int</span> i, <span class="keyword">int</span> j)</span></span>;</span><br><span class="line">    <span class="keyword">if</span> (left &gt;= right) <span class="comment">/* do nothing if array contains */</span></span><br><span class="line">        <span class="keyword">return</span>; <span class="comment">/* fewer than two elements */</span></span><br><span class="line">    swap(v, left, (left + right) / <span class="number">2</span>);</span><br><span class="line">    last = left;</span><br><span class="line">    <span class="keyword">for</span> (i = left + <span class="number">1</span>; i &lt;= right; i++)</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">strcmp</span>(v[i], v[left]) &lt; <span class="number">0</span>) swap(v, ++last, i);</span><br><span class="line">    swap(v, left, last);</span><br><span class="line">    qsort(v, left, last - <span class="number">1</span>);</span><br><span class="line">    qsort(v, last + <span class="number">1</span>, right);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* swap: interchange v[i] and v[j] */</span> <span class="function"><span class="keyword">void</span> <span class="title">swap</span><span class="params">(<span class="keyword">char</span> *v[], <span class="keyword">int</span> i, <span class="keyword">int</span> j)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">char</span> *temp;</span><br><span class="line">    temp = v[i];</span><br><span class="line">    v[i] = v[j];</span><br><span class="line">    v[j] = temp;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Share"><a href="#Share" class="headerlink" title="Share"></a>Share</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Created by akaQin on 2018/8/11.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ALLOCSIZE 10000</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">char</span> allocbuf[ALLOCSIZE];</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">char</span> *allocp = allocbuf;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">char</span> *<span class="title">alloc</span><span class="params">(<span class="keyword">int</span> n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (allocbuf + ALLOCSIZE - allocp &gt;= n) &#123;</span><br><span class="line">        allocp += n;</span><br><span class="line">        <span class="keyword">return</span> allocp - n;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">afree</span><span class="params">(<span class="keyword">char</span> *p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (p &gt;= allocbuf &amp;&amp; p &lt; allocbuf + ALLOCSIZE) &#123;</span><br><span class="line">        allocp = p;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">char</span> *a = alloc(<span class="number">1</span>);</span><br><span class="line">    *(a<span class="number">-1</span>) = <span class="string">'b'</span>;</span><br><span class="line">    *a = <span class="string">'a'</span>;</span><br><span class="line">    *(a+<span class="number">1</span>) = <span class="string">'b'</span>;</span><br><span class="line"><span class="comment">//    *(a+2) = '\0';</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%p\n"</span>, a<span class="number">-1</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%s\n"</span>, a<span class="number">-1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; Created by akaQin on 2018&#x2F;8&#x2F;11.</span><br><span class="line">&#x2F;&#x2F;</span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line"></span><br><span class="line">char *strcat(char *s, char *t) &#123;</span><br><span class="line">    char *se &#x3D; s;</span><br><span class="line">&#x2F;&#x2F;    for (; *se; ++se);</span><br><span class="line">        while (*se !&#x3D; &#39;\0&#39;) &#123;</span><br><span class="line">            se++;</span><br><span class="line">        &#125;</span><br><span class="line">    while ((*se++ &#x3D; *t++) !&#x3D; &#39;\0&#39;);</span><br><span class="line"></span><br><span class="line">    return s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">char s[] &#x3D; &quot;ab&quot;;</span><br><span class="line"></span><br><span class="line">char t[] &#x3D; &quot;cd&quot;;</span><br><span class="line"></span><br><span class="line">main() &#123;</span><br><span class="line">    printf(&quot;%s&quot;, strcat(s, t));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;Algorithm&quot;&gt;&lt;a href=&quot;#Algorithm&quot; class=&quot;headerlink&quot; title=&quot;Algorithm&quot;&gt;&lt;/a&gt;Algorithm&lt;/h2&gt;&lt;h3 id=&quot;Description&quot;&gt;&lt;a href=&quot;#Description&quot; class=&quot;headerlink&quot; title=&quot;Description&quot;&gt;&lt;/a&gt;Description&lt;/h3&gt;&lt;p&gt;Roman numerals are represented by seven different symbols: &lt;code&gt;I&lt;/code&gt;, &lt;code&gt;V&lt;/code&gt;, &lt;code&gt;X&lt;/code&gt;, &lt;code&gt;L&lt;/code&gt;, &lt;code&gt;C&lt;/code&gt;, &lt;code&gt;D&lt;/code&gt; and &lt;code&gt;M&lt;/code&gt;.&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;Symbol       Value&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;I             1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;V             5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;X             10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;L             50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;C             100&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;D             500&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;M             1000&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;For example, two is written as &lt;code&gt;II&lt;/code&gt; in Roman numeral, just two oneâ€™s added together. Twelve is written as, &lt;code&gt;XII&lt;/code&gt;, which is simply &lt;code&gt;X&lt;/code&gt; + &lt;code&gt;II&lt;/code&gt;. The number twenty seven is written as &lt;code&gt;XXVII&lt;/code&gt;, which is &lt;code&gt;XX&lt;/code&gt; + &lt;code&gt;V&lt;/code&gt; + &lt;code&gt;II&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Roman numerals are usually written largest to smallest from left to right. However, the numeral for four is not &lt;code&gt;IIII&lt;/code&gt;. Instead, the number four is written as &lt;code&gt;IV&lt;/code&gt;. Because the one is before the five we subtract it making four. The same principle applies to the number nine, which is written as &lt;code&gt;IX&lt;/code&gt;. There are six instances where subtraction is used:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;I&lt;/code&gt; can be placed before &lt;code&gt;V&lt;/code&gt; (5) and &lt;code&gt;X&lt;/code&gt; (10) to make 4 and 9.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;X&lt;/code&gt; can be placed before &lt;code&gt;L&lt;/code&gt; (50) and &lt;code&gt;C&lt;/code&gt; (100) to make 40 and 90.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;C&lt;/code&gt; can be placed before &lt;code&gt;D&lt;/code&gt; (500) and &lt;code&gt;M&lt;/code&gt; (1000) to make 400 and 900.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Given a roman numeral, convert it to an integer. Input is guaranteed to be within the range from 1 to 3999.&lt;/p&gt;
    
    </summary>
    
    
      <category term="ARTS" scheme="https://akaqin.github.io/categories/ARTS/"/>
    
    
      <category term="ARTS" scheme="https://akaqin.github.io/tags/ARTS/"/>
    
  </entry>
  
  <entry>
    <title>arts-3</title>
    <link href="https://akaqin.github.io/2018/07/29/arts-3/"/>
    <id>https://akaqin.github.io/2018/07/29/arts-3/</id>
    <published>2018-07-29T13:07:26.000Z</published>
    <updated>2020-03-07T12:42:59.524Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Algorithm"><a href="#Algorithm" class="headerlink" title="Algorithm"></a>Algorithm</h1><h2 id="Description"><a href="#Description" class="headerlink" title="Description"></a>Description</h2><p>Determine whether an integer is a palindrome. An integer is a palindrome when it reads the same backward as forward.</p><p><strong>Example 1:</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: 121</span><br><span class="line">Output: true</span><br></pre></td></tr></table></figure><h2 id="Example-2"><a href="#Example-2" class="headerlink" title="Example 2:"></a><strong>Example 2:</strong></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Input: -121</span><br><span class="line">Output: false</span><br><span class="line">Explanation: From left to right, it reads -121. From right to left, it becomes 121-. Therefore it is not a palindrome.</span><br></pre></td></tr></table></figure><h2 id="Example-3"><a href="#Example-3" class="headerlink" title="Example 3:"></a><strong>Example 3:</strong></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Input: 10</span><br><span class="line">Output: false</span><br><span class="line">Explanation: Reads 01 from right to left. Therefore it is not a palindrome.</span><br></pre></td></tr></table></figure><a id="more"></a><h3 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h3><p>Approach 1</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">isPalindrome</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> hold = x;</span><br><span class="line">    <span class="keyword">int</span> val = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (x) &#123;</span><br><span class="line">        val = val * <span class="number">10</span> + x % <span class="number">10</span>;</span><br><span class="line">        x /= <span class="number">10</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> val == hold ? <span class="literal">true</span> : <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Review"><a href="#Review" class="headerlink" title="Review"></a>Review</h2><p>åŸæ–‡ï¼š<a href="https://dev.mysql.com/doc/mysql-replication-excerpt/5.5/en/replication-implementation.html" target="_blank" rel="noopener">MySQL Replication Implementation</a></p><p>Replication is based on the master server keeping track of all changes to its databases (updates, deletes, and so on) in its binary log.</p><p>å¤åˆ¶æ˜¯é€šè¿‡å°†æ‰€æœ‰æ•°æ®åº“ä¿®æ”¹æ“ä½œè®°å½•ï¼ˆæ›´æ–°ï¼Œåˆ é™¤ç­‰ï¼‰åˆ°äº†æ—¥å¿—æ–‡ä»¶ä¸­çš„ä¸»æœåŠ¡å™¨å®ç°çš„ã€‚</p><p>The binary log serves as a written record of all events that modify database structure or content (data) from the moment the server was started.</p><p>æ—¥å¿—æœåŠ¡å™¨æ‹…è´Ÿç€å°†å„ç±»ä¿®æ”¹è®°å½•å†™å…¥æ—¥å¿—æ–‡ä»¶çš„èŒè´£ã€‚ä»æ—¥å¿—æœåŠ¡å™¨è¢«å¯åŠ¨çš„é‚£ä¸€åˆ»èµ·ï¼Œæ‰€æœ‰ä¿®æ”¹äº†æ•°æ®åº“ç»“æ„æˆ–è€…æ•°æ®çš„äº‹ä»¶ï¼Œéƒ½ä¼šè¢«å®ƒè®°å½•ä¸‹æ¥ã€‚</p><p>Typically, SELECT statements are not recorded because they modify neither database structure nor content.</p><p>ä¸€èˆ¬æ¥è¯´ï¼ŒSELECTè¯­å¥ä¸ä¼šè¢«è®°å½•ä¸‹æ¥ï¼Œå› ä¸ºä»–ä»¬æ—¢ä¸ä¼šå½±å“æ•°æ®åº“çš„ç»“æ„ï¼Œä¹Ÿä¸ä¼šå½±å“æ•°æ®åº“çš„æ•°æ®ã€‚</p><p>Each slave that connects to the master requests a copy of the binary log.</p><p>æ¯å°æ¥ä¸Šäº†ä¸»æœåŠ¡å™¨çš„ä»æœåŠ¡å™¨éƒ½ä¼šè¯·æ±‚ä¸€ä»½äºŒè¿›åˆ¶æ—¥å¿—çš„æ‹·è´æ–‡ä»¶ã€‚</p><p>That is, it pulls the data from the master, rather than the master pushing the data to the slave.</p><p>é‚£å°±æ˜¯ï¼Œâ€œä»æœåŠ¡å™¨â€ä»â€œä¸»æœåŠ¡å™¨â€é‚£é‡Œå°†æ—¥å¿—æ‹‰å–å›æ¥ï¼Œè€Œéä¸»æœåŠ¡å™¨å‘ä»æœåŠ¡å™¨æ¨é€æ—¥å¿—ã€‚</p><p>The slave also executes the events from the binary log that it receives. This has the effect of repeating the originalchanges just as they were made on the master.</p><p>ä»æœåŠ¡å™¨ä¼šå°†å®ƒæ”¶åˆ°çš„äºŒè¿›åˆ¶æ—¥å¿—ä¸­æ‰€è®°å½•çš„äº‹ä»¶å†æ‰§è¡Œä¸€éï¼Œè¿™æ ·å°±èµ·åˆ°äº†é‡å¤è¿™äº›æ“ä½œçš„æ•ˆæœï¼Œå°±å¥½åƒè¿™äº›æ“ä½œåœ¨ä¸»æœåŠ¡å™¨ä¸Šè¢«æ‰§è¡Œæ—¶ä¸€æ ·ã€‚</p><p>Tables are created or their structure modified, and data is inserted, deleted, and updated according to the changes that were originally made on the master.</p><p>æ ¹æ®ä¸»æœåŠ¡å™¨å¯¹äºå„ç±»æ“ä½œçš„è®°å½•ï¼Œä»æœåŠ¡å™¨ä¸Šçš„æ•°æ®è¡¨ä¼šç›¸åº”åœ°è¢«åˆ›å»ºæˆ–ä¿®æ”¹ã€è€Œä»æœåŠ¡å™¨ä¸Šçš„æ•°æ®ä¹Ÿä¼šè¢«ç›¸åº”åœ°æ’å…¥ã€åˆ é™¤æˆ–æ›´æ–°ã€‚</p><h2 id="Technique"><a href="#Technique" class="headerlink" title="Technique"></a>Technique</h2><p>é€†æ³¢å…°è®¡ç®—å™¨</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAXOP 100 <span class="comment">/* max size of operand or operator */</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> NUMBER <span class="meta-string">'0'</span> <span class="comment">/* signal that a number was found */</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getop</span><span class="params">(<span class="keyword">char</span> [])</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">push</span><span class="params">(<span class="keyword">double</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">pop</span><span class="params">(<span class="keyword">void</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">main() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> type;</span><br><span class="line">    <span class="keyword">double</span> op2;</span><br><span class="line">    <span class="keyword">char</span> s[MAXOP];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> ((type = getop(s)) != EOF) &#123;</span><br><span class="line">        <span class="keyword">switch</span> (type) &#123;</span><br><span class="line">            <span class="keyword">case</span> NUMBER:</span><br><span class="line">                push(atof(s));</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">'+'</span>:</span><br><span class="line">                push(pop() + pop());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">'-'</span>:</span><br><span class="line">                op2 = pop();</span><br><span class="line">                push(op2 - pop());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">'*'</span>:</span><br><span class="line">                push(pop() * pop());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">'/'</span>:</span><br><span class="line">                op2 = pop();</span><br><span class="line">                op2 == <span class="number">0.0</span> ? <span class="built_in">printf</span>(<span class="string">"zero divisor\n"</span>) : push(pop() / op2);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">'\n'</span>:</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">"\t%.8g\n"</span>, pop());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">"error: unknown command %s\n"</span>, s);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAXVAL 100 <span class="comment">/* maximum depth of val stack */</span></span></span><br><span class="line"><span class="keyword">int</span> sp = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">double</span> val[MAXVAL];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">push</span><span class="params">(<span class="keyword">double</span> f)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (sp &lt; MAXVAL) &#123;</span><br><span class="line">        val[sp++] = f;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"error: stack full, can't push %g\n"</span>, f);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">pop</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (sp &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> val[--sp];</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"error: stack empty\n"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0.0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;ctype.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getch</span><span class="params">(<span class="keyword">void</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ungetch</span><span class="params">(<span class="keyword">int</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* getop: get next character or numeric operand */</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getop</span><span class="params">(<span class="keyword">char</span> s[])</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i, c;</span><br><span class="line">    <span class="keyword">while</span> ((s[<span class="number">0</span>] = c = getch()) == <span class="string">' '</span> || c == <span class="string">'\t'</span>) &#123; ;</span><br><span class="line">    &#125;</span><br><span class="line">    s[<span class="number">1</span>] = <span class="string">'\0'</span>;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">isdigit</span>(c) &amp;&amp; c != <span class="string">'.'</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> c;</span><br><span class="line">    &#125;</span><br><span class="line">    i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">isdigit</span>(c)) &#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">isdigit</span>(s[++i] = c = getch())) &#123; ;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (c == <span class="string">'.'</span>) &#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">isdigit</span>(s[++i] = c = getch())) &#123; ;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    s[i] = <span class="string">'\0'</span>;</span><br><span class="line">    <span class="keyword">if</span> (c != EOF) &#123;</span><br><span class="line">        ungetch(c);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> NUMBER;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> BUFSIZE 100</span></span><br><span class="line"><span class="keyword">char</span> buf[BUFSIZE]; <span class="comment">/* buffer for ungetch */</span></span><br><span class="line"><span class="keyword">int</span> bufp = <span class="number">0</span>; <span class="comment">/* next free position in buf */</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getch</span><span class="params">(<span class="keyword">void</span>)</span> <span class="comment">/* get a (possibly pushed-back) character */</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (bufp &gt; <span class="number">0</span>) ? buf[--bufp] : getchar();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ungetch</span><span class="params">(<span class="keyword">int</span> c)</span> <span class="comment">/* push character back on input */</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (bufp &gt;= BUFSIZE)</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"ungetch: too many characters\n"</span>);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        buf[bufp++] = c;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;Algorithm&quot;&gt;&lt;a href=&quot;#Algorithm&quot; class=&quot;headerlink&quot; title=&quot;Algorithm&quot;&gt;&lt;/a&gt;Algorithm&lt;/h1&gt;&lt;h2 id=&quot;Description&quot;&gt;&lt;a href=&quot;#Description&quot; class=&quot;headerlink&quot; title=&quot;Description&quot;&gt;&lt;/a&gt;Description&lt;/h2&gt;&lt;p&gt;Determine whether an integer is a palindrome. An integer is a palindrome when it reads the same backward as forward.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Example 1:&lt;/strong&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;Input: 121&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Output: true&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;



&lt;h2 id=&quot;Example-2&quot;&gt;&lt;a href=&quot;#Example-2&quot; class=&quot;headerlink&quot; title=&quot;Example 2:&quot;&gt;&lt;/a&gt;&lt;strong&gt;Example 2:&lt;/strong&gt;&lt;/h2&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;Input: -121&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Output: false&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Explanation: From left to right, it reads -121. From right to left, it becomes 121-. Therefore it is not a palindrome.&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;



&lt;h2 id=&quot;Example-3&quot;&gt;&lt;a href=&quot;#Example-3&quot; class=&quot;headerlink&quot; title=&quot;Example 3:&quot;&gt;&lt;/a&gt;&lt;strong&gt;Example 3:&lt;/strong&gt;&lt;/h2&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;Input: 10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Output: false&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Explanation: Reads 01 from right to left. Therefore it is not a palindrome.&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
      <category term="ARTS" scheme="https://akaqin.github.io/categories/ARTS/"/>
    
    
      <category term="ARTS" scheme="https://akaqin.github.io/tags/ARTS/"/>
    
  </entry>
  
  <entry>
    <title>arts-2</title>
    <link href="https://akaqin.github.io/2018/07/09/arts-2/"/>
    <id>https://akaqin.github.io/2018/07/09/arts-2/</id>
    <published>2018-07-09T03:25:45.000Z</published>
    <updated>2020-03-07T12:42:47.677Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Algorithm"><a href="#Algorithm" class="headerlink" title="Algorithm"></a>Algorithm</h1><h2 id="Description"><a href="#Description" class="headerlink" title="Description"></a>Description</h2><p>Given a 32-bit signed integer, reverse digits of an integer.</p><p><strong>Example 1:</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: 123</span><br><span class="line">Output: 321</span><br></pre></td></tr></table></figure><p><strong>Example 2:</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: -123</span><br><span class="line">Output: -321</span><br></pre></td></tr></table></figure><p><strong>Example 3:</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: 120</span><br><span class="line">Output: 21</span><br></pre></td></tr></table></figure><a id="more"></a><p><strong>Note:</strong></p><p>Assume we are dealing with an environment which could only store integers within the 32-bit signed integer range: [âˆ’231,  231 âˆ’ 1]. For the purpose of this problem, assume that your function returns 0 when the reversed integer overflows.</p><h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><h3 id="Approach-1"><a href="#Approach-1" class="headerlink" title="Approach 1"></a>Approach 1</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">reverse</span><span class="params">(x <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">minInt32, maxInt32 := <span class="number">-2147483648</span>, <span class="number">2147483647</span></span><br><span class="line">result := <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> ; x != <span class="number">0</span>; x = x/<span class="number">10</span> &#123;</span><br><span class="line">result = (result * <span class="number">10</span>) + x % <span class="number">10</span></span><br><span class="line"><span class="keyword">if</span> result &gt; maxInt32 || result &lt; minInt32  &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h2><p>â€‹    é¦–å…ˆæƒ³åˆ°çš„æ˜¯æŠŠintè½¬æˆå­—ç¬¦ä¸²æˆ–ç ç‚¹æ•°ç»„ï¼Œä½†æ²¡æˆåŠŸï¼Œæ€è€ƒåæ²¡æœ‰æƒ³åˆ°åˆ«çš„æ€è·¯ã€‚åæ¥çœ‹Discussä½¿ç”¨å¯¹10å–ä½™ï¼Œpop&amp;pushçš„æ–¹å¼ï¼Œæ„Ÿè§‰è±ç„¶å¼€æœ—ï¼Œäºæ˜¯è‡ªå·±å°è¯•å†™ä¸‹äº†è¿™ç§è§£æ³•ï¼Œç¾ä¸­ä¸è¶³æ˜¯maxInt32å’ŒminInt32éƒ½æ˜¯æ‰‹åŠ¨å¡«å†™çš„ï¼Œgoè¯­è¨€é‡Œè²Œä¼¼æ²¡æœ‰ç°æˆçš„å¸¸é‡ï¼ˆä¹Ÿå¯èƒ½æ˜¯æˆ‘æ²¡æ‰¾åˆ°ï¼‰ï¼Œä½†è‚¯å®šæœ‰èƒ½è®¡ç®—è¿™ä¸ªæ•°çš„è¡¨è¾¾å¼ï¼Œç°åœ¨è¿˜ä¸çŸ¥é“è¯¥æ€ä¹ˆå†™ï¼Œä»¥åå›æ¥å¡«å‘ã€‚</p><h1 id="Review"><a href="#Review" class="headerlink" title="Review"></a>Review</h1><p>åŸæ–‡ï¼š<a href="https://97-things-every-x-should-know.gitbooks.io/97-things-every-programmer-should-know/content/en/thing_01/index.html" target="_blank" rel="noopener">Act with Prudence</a></p><blockquote><p>*â€Whatever you undertake, act with prudence and consider the consequencesâ€ Anon*</p></blockquote><p>â€‹    æºè‡ªè€—å­å”ä¸“æ æ¨èæ–‡ç«  <a href="https://legacy.gitbook.com/book/97-things-every-x-should-know/97-things-every-programmer-should-know/details" target="_blank" rel="noopener">97 Things Every Programmer Should Know</a> ä¸­çš„ç¬¬ä¸€ç¯‡ï¼Œè¿™ä¸ªç³»åˆ—æ–‡ç« æ¯è¿‡æ®µæ—¶é—´çœ‹æ€»ä¼šæœ‰æ–°çš„è®¤çŸ¥ï¼Œæ˜¯éš¾å¾—çš„ç¨‹åºå‘˜ç”¨æ¥å­¦ä¹ å¹¶é”»ç‚¼è‹±æ–‡é˜…è¯»èƒ½åŠ›çš„å¥½æ–‡ï¼Œæ¨èç»™å¤§å®¶ã€‚</p><p>â€‹    æˆ‘ä»¬åœ¨å®é™…é¡¹ç›®ä¸­ç»å¸¸é‡åˆ°â€doing it rightâ€ or â€œdoing it quickâ€çš„é—®é¢˜ï¼Œæˆ‘çš„ä¹ æƒ¯æ˜¯åšäº‹åŠ›æ±‚å®Œç¾ï¼Œä½†æœ‰äº›æ—¶å€™è¿˜æ˜¯ä¸å¤Ÿè°¨æ…ï¼Œè¿™æ˜¯æˆ‘æ—¥åéœ€è¦æ³¨æ„çš„ã€‚å†å°±æ˜¯ä¸€ä¸ªé¡¹ç›®ç¬¬ä¸€ç‰ˆçš„è´¨é‡éå¸¸é‡è¦ï¼Œå®ƒå†³å®šäº†åé¢çš„è¿­ä»£å¼€å‘å’Œç»´æŠ¤çš„æˆæœ¬å’Œæ•ˆç‡ï¼Œæ‰€ä»¥ç¬¬ä¸€ç‰ˆå°¤å…¶è¦å†™çš„ä»”ç»†ï¼Œå¤šæ€è€ƒï¼Œå³ä½¿æ˜¯ä¸€äº›å°çš„ä¸åˆé€‚çš„åœ°æ–¹ä¹Ÿè¦ç«‹å³æ”¹æ­£ã€‚ä¸è¿‡æˆ‘ä»¬ä¹Ÿéš¾å…é‡åˆ°å› ä¸ºæ’æœŸå‹åŠ›å¦¥åï¼Œé—ç•™æŠ€æœ¯å€ºåŠ¡çš„æƒ…å†µï¼Œè¿™æ—¶å€™ä¸€å®šè¦è®°å½•é¡¹ç›®ä¸­é—ç•™äº†å“ªäº›å‘ï¼Œè¿˜æœ‰å“ªäº›åœ°æ–¹æ˜¯éœ€è¦å®Œå–„çš„ï¼Œå¹¶å°½å¿«å¤„ç†è¿™äº›é€»è¾‘ã€‚æ‹–çš„è¶Šä¹…ï¼Œè¶Šéš¾ä¿®å¤ï¼Œæœ€å¯æ€•çš„æ˜¯æ‹–åˆ°é‡æ„çš„ä»£ä»·å·²ç»è¶…è¿‡é‡å†™ï¼Œä½†ä¸ºäº†æœåŠ¡åœ¨çº¿è¿˜è¦ç»§ç»­ç»´æŠ¤ï¼Œé‚£å‰©ä¸‹çš„åªæœ‰æ— å°½çš„ç—›è‹¦ï¼Œå´©æºƒã€‚ã€‚</p><h1 id="Technique"><a href="#Technique" class="headerlink" title="Technique"></a>Technique</h1><p>è®¡ç®—æ–æ³¢çº³åˆ‡æ•°åˆ—</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">fibonacci1</span><span class="params">(i <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> i &lt; <span class="number">2</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> fibonacci1(i<span class="number">-2</span>) + fibonacci1(i<span class="number">-1</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">fibonacci2</span><span class="params">(j <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">a, b := <span class="number">0</span>, <span class="number">1</span></span><br><span class="line"><span class="keyword">for</span> i := <span class="number">1</span>; i &lt;= j; i++ &#123;</span><br><span class="line">a, b = b, a+b</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> b</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">t1 := time.Now()</span><br><span class="line"><span class="keyword">for</span> i := <span class="number">1</span>; i &lt; <span class="number">40</span>; i++ &#123;</span><br><span class="line">wg.Add(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">(i <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line"><span class="keyword">defer</span> wg.Done()</span><br><span class="line">fibonacci1(i)</span><br><span class="line">&#125;(i)</span><br><span class="line">&#125;</span><br><span class="line">wg.Wait()</span><br><span class="line">fmt.Printf(<span class="string">"fibonacci1 done: %v \n"</span>, time.Since(t1))</span><br><span class="line"></span><br><span class="line">t2 := time.Now()</span><br><span class="line"><span class="keyword">for</span> i := <span class="number">1</span>; i &lt; <span class="number">40</span>; i++ &#123;</span><br><span class="line">wg.Add(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">(i <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line"><span class="keyword">defer</span> wg.Done()</span><br><span class="line">fibonacci2(i)</span><br><span class="line">&#125;(i)</span><br><span class="line">&#125;</span><br><span class="line">wg.Wait()</span><br><span class="line">fmt.Printf(<span class="string">"fibonacci2 done: %v \n"</span>, time.Since(t2))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹    å­¦ä¹ çš„è¿‡ç¨‹ä¸­åšåšè¿™ç§å°ç»ƒä¹ è¿˜æ˜¯è›®æœ‰æ„æ€çš„ï¼Œä¸Šé¢çš„ä»£ç åˆ†åˆ«ç”¨é€’å½’ï¼ˆä»å¤§åˆ°å°ï¼‰å’ŒåŠ¨æ€è§„åˆ’ï¼ˆä»å°åˆ°å¤§ï¼‰çš„æ€è·¯è¿›è¡Œå®ç°ã€‚å°¤å…¶æ˜¯ç¬¬äºŒç§ä»å°åˆ°å¤§è®¡ç®—çš„ç®—æ³•ï¼Œâ€œa, b = b, a+bâ€ å› ä¸ºæˆ‘ä¹‹å‰æ²¡å†™è¿‡pythonï¼Œçœ‹åˆ°åç»™æˆ‘çœ¼å‰ä¸€äº®çš„æ„Ÿè§‰ã€‚å†™å®Œåå‘ç°æ•ˆç‡å¾ˆå·®ï¼Œå¼€å§‹ç”¨goroutineå»ä¼˜åŒ–æ€§èƒ½ï¼Œå†™çš„è¿‡ç¨‹ä¸­å‘è¿˜æ˜¯è›®å¤šçš„ï¼š</p><ul><li><p>å¯¹è®¡æ•°å™¨çš„åº”ç”¨ï¼Œå¦‚æœé¡ºåºå†™çš„ä¸å¯¹ä¼šå¯¼è‡´wg.Doneæ‰§è¡Œå¤šæ¬¡æŠŠæ•°è®¡æˆè´Ÿçš„æŠ¥ä¸€ä¸ªpanicå¼‚å¸¸ï¼›</p></li><li><p>è¿˜æœ‰åœ¨forå¾ªç¯ä¸­ç”¨goroutine è°ƒç”¨é—­åŒ…æ—¶ï¼Œè¿™ä¸ªå•ç‹¬çš„å˜é‡iæ˜¯è¢«æ‰€æœ‰ çš„åŒ¿åå‡½æ•°å€¼æ‰€å…±äº«ï¼Œä¸”ä¼šè¢«è¿ç»­çš„å¾ªç¯è¿­ä»£æ‰€æ›´æ–°çš„ã€‚å½“æ–°çš„goroutineå¼€å§‹æ‰§è¡Œå­—é¢å‡½æ•°æ—¶ï¼Œforå¾ªç¯å¯èƒ½å·²ç»æ›´æ–°äº†iå¹¶ä¸”å¼€å§‹äº†å¦ä¸€è½®çš„è¿­ä»£æˆ–è€…(æ›´æœ‰å¯èƒ½çš„)å·²ç»ç»“æŸäº†æ•´ä¸ªå¾ªç¯ï¼Œæ‰€ä»¥å½“è¿™äº›goroutineå¼€å§‹è¯»å–içš„å€¼æ—¶ï¼Œå®ƒä»¬æ‰€çœ‹åˆ°çš„å€¼å·²ç»æ˜¯sliceçš„æœ€åä¸€ä¸ªå…ƒç´ äº†ã€‚ æ˜¾å¼åœ°æ·»åŠ è¿™ä¸ªå‚æ•°ï¼Œæˆ‘ä»¬èƒ½å¤Ÿç¡®ä¿ä½¿ç”¨çš„iæ˜¯å½“goè¯­å¥æ‰§è¡Œæ—¶çš„â€œå½“å‰â€é‚£ä¸ªiã€‚</p></li></ul><p>  å†™å®Œåä¼šå‘ç°ç¬¬äºŒç§è§£æ³•ä¼šæ¯”ç¬¬ä¸€ç§å¿«å¾ˆå¤šå¾ˆå¤šã€‚</p><h1 id="Share"><a href="#Share" class="headerlink" title="Share"></a>Share</h1><p><a href="https://laravel-china.org/topics/9991/20-laravel-eloquent-necessary-practical-skills" target="_blank" rel="noopener">20 ä¸ª Laravel Eloquent å¿…å¤‡çš„å®ç”¨æŠ€å·§</a></p><p>â€‹    ä¸€äº›ä½ å¯èƒ½è¿˜ä¸çŸ¥é“çš„Larvelå®ç”¨æŠ€å·§ï¼Œå­¦ä¹ äº†ï½</p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;Algorithm&quot;&gt;&lt;a href=&quot;#Algorithm&quot; class=&quot;headerlink&quot; title=&quot;Algorithm&quot;&gt;&lt;/a&gt;Algorithm&lt;/h1&gt;&lt;h2 id=&quot;Description&quot;&gt;&lt;a href=&quot;#Description&quot; class=&quot;headerlink&quot; title=&quot;Description&quot;&gt;&lt;/a&gt;Description&lt;/h2&gt;&lt;p&gt;Given a 32-bit signed integer, reverse digits of an integer.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Example 1:&lt;/strong&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;Input: 123&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Output: 321&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;&lt;strong&gt;Example 2:&lt;/strong&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;Input: -123&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Output: -321&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;&lt;strong&gt;Example 3:&lt;/strong&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;Input: 120&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Output: 21&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
      <category term="ARTS" scheme="https://akaqin.github.io/categories/ARTS/"/>
    
    
      <category term="ARTS" scheme="https://akaqin.github.io/tags/ARTS/"/>
    
  </entry>
  
  <entry>
    <title>arts-1</title>
    <link href="https://akaqin.github.io/2018/06/26/arts-1/"/>
    <id>https://akaqin.github.io/2018/06/26/arts-1/</id>
    <published>2018-06-26T08:52:41.000Z</published>
    <updated>2020-03-07T12:42:34.731Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Algorithm"><a href="#Algorithm" class="headerlink" title="Algorithm"></a>Algorithm</h1><h2 id="Description"><a href="#Description" class="headerlink" title="Description"></a>Description</h2><p>Given an array of integers, return <strong>indices</strong> of the two numbers such that they add up to a specific target.</p><p>You may assume that each input would have <strong>exactly</strong> one solution, and you may not use the <em>same</em> element twice.</p><p><strong>Example:</strong></p><blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Given nums &#x3D; [2, 7, 11, 15], target &#x3D; 9,</span><br><span class="line"></span><br><span class="line">Because nums[0] + nums[1] &#x3D; 2 + 7 &#x3D; 9,</span><br><span class="line">return [0, 1].</span><br></pre></td></tr></table></figure></blockquote><h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><h3 id="Approach-1"><a href="#Approach-1" class="headerlink" title="Approach 1"></a>Approach 1</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">twoSum</span><span class="params">(nums []<span class="keyword">int</span>, target <span class="keyword">int</span>)</span> []<span class="title">int</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> k1, v1 := <span class="keyword">range</span> nums &#123;</span><br><span class="line">        <span class="keyword">for</span> k2, v2 := <span class="keyword">range</span> nums[k1+<span class="number">1</span>:] &#123;</span><br><span class="line">            <span class="keyword">if</span> v1 + v2 == target &#123;</span><br><span class="line">                <span class="keyword">return</span> []<span class="keyword">int</span>&#123;k1, k1 + k2 + <span class="number">1</span>&#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> []<span class="keyword">int</span>&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><a id="more"></a><h3 id="Approach-2"><a href="#Approach-2" class="headerlink" title="Approach 2"></a>Approach 2</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">twoSum</span><span class="params">(nums []<span class="keyword">int</span>, target <span class="keyword">int</span>)</span> []<span class="title">int</span></span> &#123;</span><br><span class="line">    m := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">int</span>)</span><br><span class="line">    <span class="keyword">for</span> i, v := <span class="keyword">range</span> nums &#123;</span><br><span class="line">        <span class="keyword">if</span> j, ok := m[target-v]; ok &#123;</span><br><span class="line">            <span class="keyword">return</span> []<span class="keyword">int</span>&#123;i, j&#125;</span><br><span class="line">        &#125;</span><br><span class="line">        m[v] = i</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> []<span class="keyword">int</span>&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Complexity-Analysis"><a href="#Complexity-Analysis" class="headerlink" title="Complexity Analysis"></a><strong>Complexity Analysis</strong></h3><ul><li>Time complexity : O(n^2)O(n2). For each element, we try to find its complement by looping through the rest of array which takes O(n)O(n) time. Therefore, the time complexity is O(n^2)O(n2).</li><li>Space complexity : O(1)O(1).</li></ul><h3 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h3><p>â€‹    Approach 1 is the simplest and low-grade arithmetic which I came up with first.Due to it is my first time to solving problem on leetcode, I have no other ideas.I found the approach 2 in Solution tag, it has a much faster time complexity than the other one and itâ€™s an extension of my thinking.</p><h1 id="Review"><a href="#Review" class="headerlink" title="Review"></a>Review</h1><p>â€‹    ç”±äºæˆ‘çš„è‹±è¯­å®åœ¨å¤ªæ¸£äº†ï¼Œæš‚æ—¶æ²¡æ‰¾åˆ°å•¥åˆé€‚çš„è‹±æ–‡æ–‡ç« åšåæ€æ€»ç»“ï¼Œæ‰€ä»¥ç¬¬ä¸€å‘¨çš„Reviewå…ˆç”¨ä¸­æ–‡çš„ä»£æ›¿ï¼Œä¸‹å‘¨å¼€å§‹ä¸€å®šæ›¿æ¢æˆè‹±æ–‡ã€‚</p><blockquote><p><a href="https://studygolang.com/articles/2216" target="_blank" rel="noopener">ä¸ºä»€ä¹ˆ Go è¯­è¨€æŠŠç±»å‹æ”¾åœ¨åé¢ï¼Ÿ</a></p></blockquote><p>â€‹    ç›¸ä¿¡å¤§å®¶åœ¨å­¦goè¯­è¨€çš„æ—¶å€™ï¼Œå°¤å…¶æ˜¯æœ‰cè¯­è¨€åŸºç¡€çš„äººï¼Œä¸€å®šä¼šæœ‰å’Œæˆ‘ä¸€æ ·çš„ç–‘é—®ï¼Œgoä½œä¸ºä¸€é—¨ç±»cè¯­è¨€ï¼Œå…¶ä»–åœ°æ–¹éƒ½å’Œcå¾ˆåƒï¼Œå”¯ç‹¬ç±»å‹ä¸ºä»€ä¹ˆè¦æ”¾åœ¨å˜é‡ååé¢ï¼Ÿè¿™ä¹ˆå¥‡è‘©ï¼Ÿåæ¥çœ‹åˆ°è€—å­å”çš„è§£é‡Šï¼ŒçŠ¹å¦‚é†é†çŒé¡¶ï¼Œä¸èƒ½è®¤åŒæ›´å¤šï¼š</p><blockquote><p>Goçš„è¯­æ³•å¹¶ä¸å¥‡è‘©ï¼ŒGoçš„ä½œè€…ä¹Ÿæ˜¯Cçš„é‡åº¦ä½¿ç”¨è€…ç”šè‡³Cçš„ä½œè€…ï¼Œå½“ä½ è§‰å¾—å®ƒå¥‡è‘©ï¼Œé€šå¸¸æ¥è¯´æ˜¯è‡ªå·±æ²¡æœ‰ç†è§£ï¼Œå‡¡äº‹éƒ½é—®å‡ ä¸ªä¸ºä»€ä¹ˆï¼Œä½ ä¼šæ˜ç™½æ›´å¤šã€‚</p></blockquote><p>â€‹    çœ‹äº†ä¸Šé¢å¼•ç”¨çš„æ–‡ç« ï¼Œå¯¹Goè¯­è¨€ä¸ºä»€ä¹ˆè¦æŠŠç±»å‹æ”¾åœ¨åé¢æœ‰äº†åˆæ­¥çš„ç†è§£ï¼šCè¯­è¨€çš„å†™æ³•åœ¨å£°æ˜ä¸€äº›æ¯”è¾ƒå¤æ‚çš„å‡½æ•°ï¼Œå°¤å…¶æ˜¯å¸¦æœ‰æŒ‡é’ˆçš„å‚æ•°æ—¶ï¼Œä¼šå˜å¾—éå¸¸éš¾æ‡‚ï¼Œå®¹æ˜“å¼•èµ·æ··æ·†ã€‚ç”±äºæˆ‘æ²¡æœ‰Cçš„åŸºç¡€ï¼Œæ„Ÿè§‰ç†è§£çš„è¿˜ä¸å¤Ÿé€å½»ï¼Œæ‰“ç®—ç­‰å­¦å®ŒCå†æ¥çœ‹ä¸€éï¼Œç›¸ä¿¡ä¸€å®šä¼šæœ‰æ›´æ·±åˆ»çš„ç†è§£ã€‚</p><h1 id="Technique"><a href="#Technique" class="headerlink" title="Technique"></a>Technique</h1><p>â€‹    ç”¨ä¸€ä¸ªäºŒå‰æ ‘å®ç°æ’å…¥æ’åº</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> tree <span class="keyword">struct</span> &#123;</span><br><span class="line">value       <span class="keyword">int</span></span><br><span class="line">left, right *tree</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Sort sorts values in place.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Sort</span><span class="params">(values []<span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> root *tree</span><br><span class="line"><span class="keyword">for</span> _, v := <span class="keyword">range</span> values &#123;</span><br><span class="line">root = add(root, v)</span><br><span class="line">&#125;</span><br><span class="line">appendValues(values[:<span class="number">0</span>], root)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// appendValues appends the elements of t to values in order</span></span><br><span class="line"><span class="comment">// and returns the resulting slice.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">appendValues</span><span class="params">(values []<span class="keyword">int</span>, t *tree)</span> []<span class="title">int</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> t != <span class="literal">nil</span> &#123;</span><br><span class="line">values = appendValues(values, t.left)</span><br><span class="line">values = <span class="built_in">append</span>(values, t.value)</span><br><span class="line">values = appendValues(values, t.right)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> values</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">add</span><span class="params">(t *tree, value <span class="keyword">int</span>)</span> *<span class="title">tree</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> t == <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="comment">// Equivalent to return &amp;tree&#123;value: value&#125;.</span></span><br><span class="line">t = <span class="built_in">new</span>(tree)</span><br><span class="line">t.value = value</span><br><span class="line"><span class="keyword">return</span> t</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> value &lt; t.value &#123;</span><br><span class="line">t.left = add(t.left, value)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">t.right = add(t.right, value)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> t</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;Algorithm&quot;&gt;&lt;a href=&quot;#Algorithm&quot; class=&quot;headerlink&quot; title=&quot;Algorithm&quot;&gt;&lt;/a&gt;Algorithm&lt;/h1&gt;&lt;h2 id=&quot;Description&quot;&gt;&lt;a href=&quot;#Description&quot; class=&quot;headerlink&quot; title=&quot;Description&quot;&gt;&lt;/a&gt;Description&lt;/h2&gt;&lt;p&gt;Given an array of integers, return &lt;strong&gt;indices&lt;/strong&gt; of the two numbers such that they add up to a specific target.&lt;/p&gt;
&lt;p&gt;You may assume that each input would have &lt;strong&gt;exactly&lt;/strong&gt; one solution, and you may not use the &lt;em&gt;same&lt;/em&gt; element twice.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Example:&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;Given nums &amp;#x3D; [2, 7, 11, 15], target &amp;#x3D; 9,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Because nums[0] + nums[1] &amp;#x3D; 2 + 7 &amp;#x3D; 9,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;return [0, 1].&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;Solution&quot;&gt;&lt;a href=&quot;#Solution&quot; class=&quot;headerlink&quot; title=&quot;Solution&quot;&gt;&lt;/a&gt;Solution&lt;/h2&gt;&lt;h3 id=&quot;Approach-1&quot;&gt;&lt;a href=&quot;#Approach-1&quot; class=&quot;headerlink&quot; title=&quot;Approach 1&quot;&gt;&lt;/a&gt;Approach 1&lt;/h3&gt;&lt;figure class=&quot;highlight go&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;twoSum&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(nums []&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt;, target &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt;)&lt;/span&gt; []&lt;span class=&quot;title&quot;&gt;int&lt;/span&gt;&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; k1, v1 := &lt;span class=&quot;keyword&quot;&gt;range&lt;/span&gt; nums &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; k2, v2 := &lt;span class=&quot;keyword&quot;&gt;range&lt;/span&gt; nums[k1+&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;:] &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; v1 + v2 == target &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; []&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt;&amp;#123;k1, k1 + k2 + &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; []&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt;&amp;#123;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
      <category term="ARTS" scheme="https://akaqin.github.io/categories/ARTS/"/>
    
    
      <category term="ARTS" scheme="https://akaqin.github.io/tags/ARTS/"/>
    
  </entry>
  
  <entry>
    <title>arts</title>
    <link href="https://akaqin.github.io/2018/06/26/arts/"/>
    <id>https://akaqin.github.io/2018/06/26/arts/</id>
    <published>2018-06-26T08:43:13.000Z</published>
    <updated>2020-03-07T12:44:38.575Z</updated>
    
    <content type="html"><![CDATA[<p>ARTS is a learning activity initiated by <a href="https://weibo.com/haoel?profile_ftype=1&is_all=1#_0" target="_blank" rel="noopener">Chen Hao</a></p><blockquote><p>A: Algorithm example which I learned on <a href="https://leetcode.com/" target="_blank" rel="noopener">leetcode</a>;</p><p>R: Review an English blog or essay;</p><p>T: Technical skills which I learned;</p><p>S: Share something which I learn from a classic computer book;</p></blockquote><p>In the next year, I will write a ARTS note every week;</p><p>If you have suggestions or inspirationï¼Œ welcome to communicate with me</p><a id="more"></a><p>e-mail: <a href="mailto:qinlong@akaqin.me">qinlong@akaqin.me</a></p><p>June 24, 2018</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ARTS is a learning activity initiated by &lt;a href=&quot;https://weibo.com/haoel?profile_ftype=1&amp;is_all=1#_0&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Chen Hao&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;A: Algorithm example which I learned on &lt;a href=&quot;https://leetcode.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;leetcode&lt;/a&gt;;&lt;/p&gt;
&lt;p&gt;R: Review an English blog or essay;&lt;/p&gt;
&lt;p&gt;T: Technical skills which I learned;&lt;/p&gt;
&lt;p&gt;S: Share something which I learn from a classic computer book;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;In the next year, I will write a ARTS note every week;&lt;/p&gt;
&lt;p&gt;If you have suggestions or inspirationï¼Œ welcome to communicate with me&lt;/p&gt;
    
    </summary>
    
    
      <category term="ARTS" scheme="https://akaqin.github.io/categories/ARTS/"/>
    
    
  </entry>
  
  <entry>
    <title>ã€Šæ·±å…¥ç†è§£è®¡ç®—æœºç³»ç»Ÿã€‹ç¬¬1ç« </title>
    <link href="https://akaqin.github.io/2018/06/23/%E3%80%8A%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F%E3%80%8B%E7%AC%AC1%E7%AB%A0/"/>
    <id>https://akaqin.github.io/2018/06/23/%E3%80%8A%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F%E3%80%8B%E7%AC%AC1%E7%AB%A0/</id>
    <published>2018-06-23T07:33:38.000Z</published>
    <updated>2020-04-14T01:23:03.621Z</updated>
    
    <content type="html"><![CDATA[<h1 id="è®¡ç®—æœºç³»ç»Ÿæ¼«æ¸¸"><a href="#è®¡ç®—æœºç³»ç»Ÿæ¼«æ¸¸" class="headerlink" title="è®¡ç®—æœºç³»ç»Ÿæ¼«æ¸¸"></a>è®¡ç®—æœºç³»ç»Ÿæ¼«æ¸¸</h1><h2 id="ä¿¡æ¯å°±æ˜¯ä½-ä¸Šä¸‹æ–‡"><a href="#ä¿¡æ¯å°±æ˜¯ä½-ä¸Šä¸‹æ–‡" class="headerlink" title="ä¿¡æ¯å°±æ˜¯ä½ + ä¸Šä¸‹æ–‡"></a>ä¿¡æ¯å°±æ˜¯ä½ + ä¸Šä¸‹æ–‡</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"hello, world\n"</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹    helloç¨‹åºçš„ç”Ÿå‘½å‘¨æœŸæ˜¯ä»ä¸€ä¸ªæºç¨‹åºå¼€å§‹çš„ã€‚æºç¨‹åºæ˜¯ä¸€ä¸ªç”±å€¼0å’Œ1ç»„æˆçš„ä½ï¼ˆåˆç§°æ¯”ç‰¹ï¼‰åºåˆ—ï¼Œ8ä¸ªä½ç»„æˆä¸€ç»„ï¼Œç§°ä¸ºå­—èŠ‚ã€‚æ¯ä¸ªå­—èŠ‚å¿…ä¿æ¹¿ç¨‹åºä¸­çš„æŸäº›ç‰¹æ®Šæ–‡æœ¬å­—ç¬¦ã€‚å¤§éƒ¨åˆ†è®¡ç®—æœºç³»ç»Ÿä½¿ç”¨ASCIIæ ‡å‡†æ¥è¡¨ç¤ºæ–‡æœ¬å­—ç¬¦ï¼Œè¿™ç§æ–¹å¼å®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªå”¯ä¸€çš„å•å­—èŠ‚å¤§å°çš„æ•´æ•°å€¼æ¥è¡¨ç¤ºæ¯ä¸ªå­—ç¬¦ï¼ˆå…¥ä¸‹å›¾ï¼‰ã€‚</p><p><img src="http://pfjta0ejx.bkt.clouddn.com/hello-ASCII.png" alt="ASCII"></p><p>â€‹    hello.cç¨‹åºæ˜¯ä»¥å­—èŠ‚åºåˆ—çš„æ–¹å¼å­˜å‚¨åœ¨æ–‡æœ¬æ–‡ä»¶ä¸­çš„ã€‚æ¯ä¸ªå­—èŠ‚éƒ½æœ‰ä¸€ä¸ªæ•´æ•°å€¼ï¼Œå¯¹åº”æŸäº›å­—ç¬¦ã€‚è¿™ç§è¡¨ç¤ºæ–¹æ³•è¯´æ˜äº†ä¸€ä¸ªèŠ‚æœ¬æ€æƒ³ï¼šç³»ç»Ÿä¸­æ‰€æœ‰ä¿¡æ¯â€”â€”åŒ…æ‹¬ç£ç›˜æ–‡ä»¶ï¼Œå†…å­˜ä¸­çš„ç¨‹åºï¼Œå†…å­˜ä¸­å­˜æ”¾çš„ç”¨æˆ·æ•°æ®ä»¥åŠç½‘ç»œä¸Šä¼ è¾“çš„æ•°æ®ï¼Œéƒ½æ˜¯ç”±ä¸€ä¸²æ¯”ç‰¹è¡¨ç¤ºçš„ï¼ŒåŒºåˆ«ä¸åŒæ•°æ®å¯¹è±¡çš„å”¯ä¸€æ–¹å¼æ˜¯æˆ‘ä»¬è¯»åˆ°è¿™äº›æ•°æ®å¯¹è±¡æ—¶çš„ä¸Šä¸‹æ–‡ã€‚</p><h2 id="ç¨‹åºè¢«å…¶ä»–ç¨‹åºç¿»è¯‘æˆä¸åŒçš„æ ¼å¼"><a href="#ç¨‹åºè¢«å…¶ä»–ç¨‹åºç¿»è¯‘æˆä¸åŒçš„æ ¼å¼" class="headerlink" title="ç¨‹åºè¢«å…¶ä»–ç¨‹åºç¿»è¯‘æˆä¸åŒçš„æ ¼å¼"></a>ç¨‹åºè¢«å…¶ä»–ç¨‹åºç¿»è¯‘æˆä¸åŒçš„æ ¼å¼</h2><p>â€‹    helloç¨‹åºçš„ç”Ÿå‘½å‘¨æœŸæ˜¯ä»ä¸€ä¸ªé«˜çº§Cè¯­è¨€å¼€å§‹çš„ï¼Œå› ä¸ºè¿™ç§å½¢å¼è¢«äººè¯»æ‡‚ã€‚ç„¶è€Œä¸ºäº†åœ¨ç³»ç»Ÿä¸Šè¿è¡Œï¼Œæ¯æ¡Cè¯­å¥è¢«å…¶ä»–ç¨‹åºè½¬åŒ–ä¸ºä¸€ç³»åˆ—ä½çº§æœºå™¨è¯­è¨€æŒ‡ä»¤ã€‚ç„¶åè¿™äº›æŒ‡ä»¤æŒ‰ç…§ä¸€ç§ç§°ä¸ºå¯æ‰§è¡Œç›®æ ‡ç¨‹åºçš„æ ¼å¼æ‰“å¥½åŒ…ï¼Œå¹¶ä»¥äºŒè¿›åˆ¶ç£ç›˜æ–‡ä»¶çš„å½¢å¼å­˜èµ·æ¥ã€‚ä¸‹é¢æ˜¯GCCç¼–è¯‘é©±åŠ¨å™¨æŠŠæºæ–‡ä»¶ç¿»è¯‘æˆå¯æ‰§è¡Œæ–‡ä»¶çš„å››ä¸ªé˜¶æ®µã€‚</p><p><img src="http://pfjta0ejx.bkt.clouddn.com/compile-system.png" alt=""></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;è®¡ç®—æœºç³»ç»Ÿæ¼«æ¸¸&quot;&gt;&lt;a href=&quot;#è®¡ç®—æœºç³»ç»Ÿæ¼«æ¸¸&quot; class=&quot;headerlink&quot; title=&quot;è®¡ç®—æœºç³»ç»Ÿæ¼«æ¸¸&quot;&gt;&lt;/a&gt;è®¡ç®—æœºç³»ç»Ÿæ¼«æ¸¸&lt;/h1&gt;&lt;h2 id=&quot;ä¿¡æ¯å°±æ˜¯ä½-ä¸Šä¸‹æ–‡&quot;&gt;&lt;a href=&quot;#ä¿¡æ¯å°±æ˜¯ä½-ä¸Šä¸‹æ–‡&quot; class=&quot;header
      
    
    </summary>
    
    
      <category term="ã€ŠCSAPPã€‹ç¬”è®°" scheme="https://akaqin.github.io/categories/%E3%80%8ACSAPP%E3%80%8B%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="CS" scheme="https://akaqin.github.io/tags/CS/"/>
    
  </entry>
  
  <entry>
    <title>ã€ŠLinuxç§æˆ¿èœã€‹å­¦ä¹ ç¬”è®°</title>
    <link href="https://akaqin.github.io/2018/03/24/Linux%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    <id>https://akaqin.github.io/2018/03/24/Linux%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</id>
    <published>2018-03-24T03:14:08.000Z</published>
    <updated>2020-03-08T07:52:34.903Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Linuxå­¦ä¹ ç¬”è®°"><a href="#Linuxå­¦ä¹ ç¬”è®°" class="headerlink" title="Linuxå­¦ä¹ ç¬”è®°"></a>Linuxå­¦ä¹ ç¬”è®°</h1><h2 id="Linuxä¸­ï¼ŒCtrlç»„åˆé”®"><a href="#Linuxä¸­ï¼ŒCtrlç»„åˆé”®" class="headerlink" title="Linuxä¸­ï¼ŒCtrlç»„åˆé”®"></a>Linuxä¸­ï¼ŒCtrlç»„åˆé”®</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">Ctrl+c ç»“æŸæ­£åœ¨è¿è¡Œçš„ç¨‹åº</span><br><span class="line"></span><br><span class="line">Ctrl+d ç»“æŸè¾“å…¥æˆ–é€€å‡ºshell</span><br><span class="line"></span><br><span class="line">Ctrl+s æš‚åœå±å¹•è¾“å‡ºã€é”ä½ç»ˆç«¯ã€‘</span><br><span class="line"></span><br><span class="line">Ctrl+q æ¢å¤å±å¹•è¾“å‡ºã€è§£é”ç»ˆç«¯ã€‘</span><br><span class="line"></span><br><span class="line">Ctrl+l æ¸…å±ï¼Œã€æ˜¯å­—æ¯Lçš„å°å†™ã€‘ç­‰åŒäºClear</span><br><span class="line"></span><br><span class="line">Ctrl+a åˆ‡æ¢åˆ°å‘½ä»¤è¡Œå¼€å§‹</span><br><span class="line"></span><br><span class="line">trl+e åˆ‡æ¢åˆ°å‘½ä»¤è¡Œæœ«å°¾</span><br><span class="line"></span><br><span class="line">Ctrl+u æ¸…é™¤å‰ªåˆ‡å…‰æ ‡ä¹‹å‰çš„å†…å®¹</span><br><span class="line"></span><br><span class="line">Ctrl+k æ¸…é™¤å‰ªåˆ‡å…‰æ ‡åŠå…‰æ ‡ä¹‹åçš„å†…å®¹</span><br><span class="line"></span><br><span class="line">Ctrl+y åœ¨å…‰æ ‡å¤„ç²˜è´´å‰ªåˆ‡çš„å†…å®¹</span><br><span class="line"></span><br><span class="line">Ctrl+r æŸ¥æ‰¾å†å²å‘½ä»¤ã€è¾“å…¥å…³é”®å­—ï¼Œå°±èƒ½è°ƒå‡ºä»¥å‰æ‰§è¡Œè¿‡çš„å‘½ä»¤ã€‘</span><br><span class="line"></span><br><span class="line">Ctrl+t è°ƒæ¢å…‰æ ‡æ‰€åœ¨å¤„ä¸å…¶ä¹‹å‰å­—ç¬¦ä½ç½®ï¼Œå¹¶æŠŠå…‰æ ‡ç§»åˆ°ä¸‹ä¸ªå­—ç¬¦</span><br><span class="line"></span><br><span class="line">Ctrl+x+u æ’¤é”€æ“ä½œ</span><br></pre></td></tr></table></figure><h2 id="ç¬¬å››ç« ã€åŸºç¡€æ“ä½œå…¥é—¨"><a href="#ç¬¬å››ç« ã€åŸºç¡€æ“ä½œå…¥é—¨" class="headerlink" title="ç¬¬å››ç« ã€åŸºç¡€æ“ä½œå…¥é—¨"></a>ç¬¬å››ç« ã€åŸºç¡€æ“ä½œå…¥é—¨</h2><h3 id="å…³æœºæˆ–é‡å¯"><a href="#å…³æœºæˆ–é‡å¯" class="headerlink" title="å…³æœºæˆ–é‡å¯"></a>å…³æœºæˆ–é‡å¯</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">æ•°æ®åŒæ­¥å†™å…¥ç£ç›˜ï¼š</span><br><span class="line">sync</span><br><span class="line"></span><br><span class="line">å…³æœºï¼š</span><br><span class="line">shutdown</span><br><span class="line">halt</span><br><span class="line">poweroff</span><br><span class="line"></span><br><span class="line">é‡å¯ï¼š</span><br><span class="line">reboot</span><br></pre></td></tr></table></figure><h3 id="åŸºç¡€æŒ‡ä»¤"><a href="#åŸºç¡€æŒ‡ä»¤" class="headerlink" title="åŸºç¡€æŒ‡ä»¤"></a>åŸºç¡€æŒ‡ä»¤</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">æ—¥æœŸå’Œæ—¶é—´ï¼šdate</span><br><span class="line">æ—¥å†ï¼šcal</span><br><span class="line">è®¡ç®—å™¨ï¼šbc</span><br></pre></td></tr></table></figure><h3 id="çƒ­é”®"><a href="#çƒ­é”®" class="headerlink" title="çƒ­é”®"></a>çƒ­é”®</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[Tab]:å‘½ä»¤è¡¥å…¨æˆ–æ–‡ä»¶è¡¥é½</span><br><span class="line">[Ctrl]-c:ä¸­æ–­ç›®å‰ç¨‹åº</span><br><span class="line">[Ctrl]-d:ï¼ˆé”®ç›˜è¾“å…¥ç»“æŸï¼ŒEnd Of Fileï¼ŒEOF æˆ– End Of Inputï¼‰ï¼Œç›¸å½“äºè¾“å…¥exit</span><br><span class="line">[shift]+&#123;[PageUP]|[Page Down]&#125;:ç¿»é¡µ</span><br></pre></td></tr></table></figure><h3 id="å¸®åŠ©"><a href="#å¸®åŠ©" class="headerlink" title="å¸®åŠ©"></a>å¸®åŠ©</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">--help</span><br><span class="line">man page</span><br><span class="line">info page</span><br></pre></td></tr></table></figure><h2 id="ç¬¬äº”ç« ã€æ–‡ä»¶æƒé™ä¸ç›®å½•é…ç½®"><a href="#ç¬¬äº”ç« ã€æ–‡ä»¶æƒé™ä¸ç›®å½•é…ç½®" class="headerlink" title="ç¬¬äº”ç« ã€æ–‡ä»¶æƒé™ä¸ç›®å½•é…ç½®"></a>ç¬¬äº”ç« ã€æ–‡ä»¶æƒé™ä¸ç›®å½•é…ç½®</h2><h3 id="ä¿®æ”¹æ–‡ä»¶æˆ–ç›®å½•å±ç»„"><a href="#ä¿®æ”¹æ–‡ä»¶æˆ–ç›®å½•å±ç»„" class="headerlink" title="ä¿®æ”¹æ–‡ä»¶æˆ–ç›®å½•å±ç»„"></a>ä¿®æ”¹æ–‡ä»¶æˆ–ç›®å½•å±ç»„</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">chgrp [-R] group dirname&#x2F;filename   </span><br><span class="line">chown [-R] user dirname&#x2F;filename    </span><br><span class="line">chown [-R] user:group dirname&#x2F;filename</span><br></pre></td></tr></table></figure><h3 id="ä¿®æ”¹æ–‡ä»¶æˆ–ç›®å½•æƒé™"><a href="#ä¿®æ”¹æ–‡ä»¶æˆ–ç›®å½•æƒé™" class="headerlink" title="ä¿®æ”¹æ–‡ä»¶æˆ–ç›®å½•æƒé™"></a>ä¿®æ”¹æ–‡ä»¶æˆ–ç›®å½•æƒé™</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chmod [-R] [ugoa][+-&#x3D;][rwx] dirname&#x2F;filename</span><br><span class="line">chmod [-R] [xyz] dirname&#x2F;filename (xyzä¸º0-7çš„æ•°å­—)</span><br></pre></td></tr></table></figure><h3 id="æ“ä½œä¸æƒé™çš„å…³ç³»"><a href="#æ“ä½œä¸æƒé™çš„å…³ç³»" class="headerlink" title="æ“ä½œä¸æƒé™çš„å…³ç³»"></a>æ“ä½œä¸æƒé™çš„å…³ç³»</h3><p> <img src="http://note.youdao.com/yws/public/resource/91f49489e63185046c6483d6ca66c85a/xmlnote/DB45115B20484E5D93435C808DEA4B6C/31" alt="image"></p><h3 id="æ–‡ä»¶ç§ç±»"><a href="#æ–‡ä»¶ç§ç±»" class="headerlink" title="æ–‡ä»¶ç§ç±»"></a>æ–‡ä»¶ç§ç±»</h3><ul><li>æ­£è§„æ–‡ä»¶ï¼ˆregular file)ï¼šç¬¬ä¸€ä¸ªå­—ç¬¦ä¸º[-],åŒ…æ‹¬çº¯æ–‡æœ¬æ–‡æ¡£ï¼ˆASCIIï¼‰ï¼ŒäºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆbinaryï¼‰ï¼Œæ•°æ®æ ¼å¼æ–‡ä»¶ï¼ˆdataï¼‰ï¼›</li><li>ç›®å½•ï¼ˆdirectoryï¼‰ï¼šç¬¬ä¸€ä¸ªå­—ç¬¦ä¸º[d]ï¼›</li><li>è¿æ¥æ¡£ï¼ˆlinkï¼‰ï¼šç¬¬ä¸€ä¸ªå­—ç¬¦ä¸º[l]ï¼›</li><li>è®¾å¤‡ä¸è£…ç½®æ–‡ä»¶ï¼ˆdeviceï¼‰ï¼šé€šå¸¸éƒ½é›†ä¸­åœ¨/devç›®å½•ä¸‹ï¼Œåˆ†ä¸ºåŒºå—(block)è®¾å¤‡æ¡£[b]å’Œå­—ç¬¦(character)è®¾å¤‡æ–‡ä»¶[c];</li><li>èµ„æ–™æ¥å£æ–‡ä»¶ï¼ˆsocketsï¼‰ï¼šç¬¬ä¸€ä¸ªå­—ç¬¦ä¸º[s]ï¼›</li><li>æ•°æ®ä¼ è¾“æ–‡ä»¶ï¼ˆFIFOï¼Œpipeï¼‰ï¼šç¬¬ä¸€ä¸ªå­—ç¬¦ä¸º[p];<h3 id="ç›®å½•é…ç½®"><a href="#ç›®å½•é…ç½®" class="headerlink" title="ç›®å½•é…ç½®"></a>ç›®å½•é…ç½®</h3></li><li>/ï¼ˆrootï¼Œæ ¹ç›®å½•ï¼‰ï¼šä¸å¼€æœºç³»ç»Ÿæœ‰å…³ï¼›</li><li>/usr(unix software recourse):ä¸è½¯ä»¶å®‰è£…ï¼æ‰§è¡Œæœ‰å…³</li><li>/var(variable):ä¸ç³»ç»Ÿè¿ä½œè¿‡ç¨‹æœ‰å…³ï¼›</li><li>/bin:å¾ˆå¤šé…ç½®æ–‡ä»¶å’ŒæŒ‡ä»¤çš„ç›®å½•ï¼›</li><li>/boot:å¼€æœºç”¨åˆ°çš„æ–‡ä»¶ï¼›</li><li>/dev:è£…ç½®ä¸æ¥å£è®¾å¤‡ï¼›</li><li>/etc:ç³»ç»Ÿä¸»è¦é…ç½®æ–‡ä»¶ï¼›</li><li>/lib:ç³»ç»Ÿå‡½æ•°åº“ï¼›</li><li>/media:å¯ç§»é™¤è£…ç½®ï¼Œå¦‚å…‰ç›˜ï¼Œè½¯ç›˜ï¼ŒDVDï¼›</li><li>/opt:ç¬¬ä¸‰æ–¹ååŠ›è½¯ä»¶ç›®å½•ï¼›</li><li>/run:æ—©èµ·çš„FHSè§„å®šç³»ç»Ÿå¼€æœºåæ‰€äº§ç”Ÿçš„å„é¡¹ä¿¡æ¯æ”¾ç½®ç›®å½•;</li><li>/sbin:è®¾å®šç³»ç»Ÿç¯å¢ƒçš„æŒ‡ä»¤;</li><li>/srv:ä¸€äº›ç½‘ç»œæœåŠ¡å¯åŠ¨åï¼Œéœ€è¦å–ç”¨çš„æ•°æ®ç›®å½•;</li><li>/tmp:ä¸´æ—¶æ–‡ä»¶ç›®å½•;</li><li>/home:å®¶ç›®å½•;</li><li>/lost+found:ç³»ç»Ÿå‘ç”Ÿé”™è¯¯æ—¶ï¼Œé—å¤±ç‰‡æ®µæ”¾ç½®ç›®å½•ï¼›</li></ul><h2 id="ç¬¬å…­ç« ã€æ–‡ä»¶ä¸ç›®å½•ç®¡ç†"><a href="#ç¬¬å…­ç« ã€æ–‡ä»¶ä¸ç›®å½•ç®¡ç†" class="headerlink" title="ç¬¬å…­ç« ã€æ–‡ä»¶ä¸ç›®å½•ç®¡ç†"></a>ç¬¬å…­ç« ã€æ–‡ä»¶ä¸ç›®å½•ç®¡ç†</h2><h3 id="ç›®å½•ç®¡ç†"><a href="#ç›®å½•ç®¡ç†" class="headerlink" title="ç›®å½•ç®¡ç†"></a>ç›®å½•ç®¡ç†</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#æ˜¾ç¤ºå½“å‰ç›®å½•</span><br><span class="line">pwd [-P]    </span><br><span class="line">-P:æ˜¾ç¤ºçœŸå®è·¯å¾„ï¼Œè€Œéé“¾æ¥ï¼ˆlinkï¼‰è·¯å¾„</span><br><span class="line"></span><br><span class="line">#å»ºç«‹æ–°ç›®å½•</span><br><span class="line">mkdir ã€-mp] dirname    </span><br><span class="line">-m:é…ç½®æ–‡ä»¶æƒé™</span><br><span class="line">-pï¼šé€’å½’å»ºç«‹</span><br><span class="line"></span><br><span class="line">#åˆ é™¤ç©ºç›®å½•</span><br><span class="line">rmdir [-p] dirname  </span><br><span class="line">-pï¼šè¿åŒä¸Šå±‚çš„ç©ºç›®å½•ä¸€èµ·åˆ é™¤</span><br></pre></td></tr></table></figure><h3 id="æ‰§è¡Œæ–‡ä»¶æ‰€åœ¨è·¯å¾„çš„å˜é‡-PATH"><a href="#æ‰§è¡Œæ–‡ä»¶æ‰€åœ¨è·¯å¾„çš„å˜é‡-PATH" class="headerlink" title="æ‰§è¡Œæ–‡ä»¶æ‰€åœ¨è·¯å¾„çš„å˜é‡$PATH"></a>æ‰§è¡Œæ–‡ä»¶æ‰€åœ¨è·¯å¾„çš„å˜é‡$PATH</h3><p>åªæœ‰åœ¨$PATHä¸­çš„æŒ‡ä»¤æ‰å¯ä»¥åœ¨ä»»æ„åœ°æ–¹æ‰§è¡Œ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">echo $PATH  #æŸ¥çœ‹</span><br><span class="line"></span><br><span class="line">PATH&#x3D;&quot;$PATH:&#x2F;root&quot;  #æŠŠ&#x2F;rootåŠ å…¥åˆ°$PATHä¸­</span><br></pre></td></tr></table></figure><h3 id="æ–‡ä»¶ç®¡ç†"><a href="#æ–‡ä»¶ç®¡ç†" class="headerlink" title="æ–‡ä»¶ç®¡ç†"></a>æ–‡ä»¶ç®¡ç†</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">#æŸ¥çœ‹</span><br><span class="line">ls [-aAdfFhilnrRSt] filename&#x2F;dirname    </span><br><span class="line">ls [--color&#x3D;&#123;never,auto,always&#125;] filename&#x2F;dirname</span><br><span class="line">ls [--full-time] filename&#x2F;dirname</span><br><span class="line">-a : å…¨éƒ¨æ–‡ä»¶ï¼ŒåŒ…æ‹¬éšè—æ–‡ä»¶ï¼ˆ.å¼€å¤´)</span><br><span class="line">-d : ä»…åˆ—å‡ºç›®å½•æœ¬èº«ï¼Œè€Œä¸æ˜¯ç›®å½•å†…æ–‡ä»¶</span><br><span class="line">-l : é•¿æ•°æ®ä¸²è¾“å‡ºï¼ŒåŒ…å«æ–‡ä»¶å±æ€§ã€æƒé™ç­‰æ•°æ®</span><br><span class="line"></span><br><span class="line">#å¤åˆ¶</span><br><span class="line">cp [-adfilprsu] æ¥æºæ–‡ä»¶(source) ç›®æ ‡æ–‡ä»¶(destination)  </span><br><span class="line">cp [options] source1 source2 source3 .... directory</span><br><span class="line">-a : ç›¸å½“äº-dr --preserve&#x3D;allçš„æ„æ€</span><br><span class="line">-d : è‹¥æºæ–‡ä»¶ä¸ºé“¾æ¥æ–‡ä»¶å±æ€§(link file),åˆ™å¤åˆ¶é“¾æ¥æ–‡ä»¶å±æ€§ï¼Œè€Œéæ–‡ä»¶æœ¬èº«</span><br><span class="line">-f : å¼ºåˆ¶ï¼ˆforce),è‹¥æ–‡ä»¶å·²å­˜åœ¨ï¼Œåˆ é™¤åå†å°è¯•ä¸€æ¬¡</span><br><span class="line">-i ï¼šè‹¥ç›®æ ‡æ–‡ä»¶å·²å­˜åœ¨ï¼Œè¦†ç›–å‰å…ˆè¯¢é—®</span><br><span class="line">-l : å»ºç«‹ç¡¬è¿æ¥ï¼Œè€Œéå¤åˆ¶æ–‡ä»¶æœ¬èº«</span><br><span class="line">-p : è¿åŒå±æ€§ï¼ˆæƒé™ï¼Œç”¨æˆ·ï¼Œæ—¶é—´ï¼‰ä¸€èµ·å¤åˆ¶ï¼Œè€Œéä½¿ç”¨é»˜è®¤å±æ€§</span><br><span class="line">-r : é€’å½’</span><br><span class="line">-s ï¼šè½¯é“¾</span><br><span class="line">-u : destination æ¯” sourceæ—§æ‰æ›´æ–°ï¼Œæˆ–destinationä¸å­˜åœ¨æ‰å¤åˆ¶</span><br><span class="line"></span><br><span class="line">#ç§»é™¤</span><br><span class="line">rm [-fir] filename&#x2F;dirname</span><br><span class="line">-f : force,å¿½ç•¥ä¸å­˜åœ¨çš„æ–‡ä»¶ï¼Œä¸æŠ¥é”™</span><br><span class="line">-i : äº’åŠ¨æ¨¡å¼ï¼Œåˆ å‰ç¡®è®¤</span><br><span class="line">-r ï¼šé€’å½’</span><br><span class="line"></span><br><span class="line">#ç§»åŠ¨</span><br><span class="line">mv [-fiu] source destination</span><br><span class="line">mv [options] source1 source2 source3 ... directory</span><br><span class="line">-f : force</span><br><span class="line">-i : è‹¥ç›®æ ‡æ–‡ä»¶å·²å­˜åœ¨ï¼Œè¯¢é—®æ˜¯å¦è¦†ç›–</span><br><span class="line">-u : è‹¥ç›®æ ‡å·²å­˜åœ¨ï¼Œä¸”sourceæ¯”è¾ƒæ–°ï¼Œæ‰ä¼šæ›´æ–°</span><br></pre></td></tr></table></figure><h3 id="å–å¾—è·¯å¾„å’Œæ–‡ä»¶å"><a href="#å–å¾—è·¯å¾„å’Œæ–‡ä»¶å" class="headerlink" title="å–å¾—è·¯å¾„å’Œæ–‡ä»¶å"></a>å–å¾—è·¯å¾„å’Œæ–‡ä»¶å</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#è·¯å¾„</span><br><span class="line">basename &#x2F;a&#x2F;b&#x2F;c     #c</span><br><span class="line">#æ–‡ä»¶å</span><br><span class="line">dirname &#x2F;a&#x2F;b&#x2F;c      #&#x2F;a&#x2F;b</span><br></pre></td></tr></table></figure><h3 id="æ–‡ä»¶å†…å®¹æŸ¥é˜…"><a href="#æ–‡ä»¶å†…å®¹æŸ¥é˜…" class="headerlink" title="æ–‡ä»¶å†…å®¹æŸ¥é˜…"></a>æ–‡ä»¶å†…å®¹æŸ¥é˜…</h3><ul><li>cat(con++cat++enate)<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cat [-AbEnTv]</span><br><span class="line">-n : æ‰“å°è¡Œå·</span><br></pre></td></tr></table></figure></li><li>tac(åå‘çš„cat)</li><li>nl</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nl [-bnw] filename</span><br></pre></td></tr></table></figure><ul><li>more(ä¸€é¡µä¸€é¡µç¿»åŠ¨)</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">more filename</span><br><span class="line">ç©ºæ ¼ï¼ˆspaceï¼‰ï¼šå‘ä¸‹ç¿»ä¸€é¡µ</span><br><span class="line">å›è½¦ï¼ˆEnterï¼‰ï¼šå‘ä¸‹ç¿»ä¸€è¡Œ</span><br><span class="line">&#x2F;å­—ç¬¦ä¸²ï¼šæŸ¥æ‰¾</span><br><span class="line">:f ï¼šæ˜¾ç¤ºæ–‡ä»¶åå’Œç›®å‰æ˜¾ç¤ºè¡Œæ•°</span><br><span class="line">qï¼šç¦»å¼€</span><br><span class="line">bï¼šå¾€å›ç¿»é¡µ</span><br></pre></td></tr></table></figure><ul><li><p>lessï¼ˆä¸€é¡µä¸€é¡µååŠ¨ï¼‰</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">less filename</span><br><span class="line">ç©ºæ ¼ï¼ˆspaceï¼‰ï¼šå‘ä¸‹ç¿»ä¸€é¡µ</span><br><span class="line">å›è½¦ï¼ˆEnterï¼‰ï¼šå‘ä¸‹ç¿»ä¸€è¡Œ</span><br><span class="line">&#x2F;å­—ç¬¦ä¸²ï¼šå‘ä¸‹æŸ¥æ‰¾</span><br><span class="line">?å­—ç¬¦ä¸²ï¼šå‘ä¸ŠæŸ¥æ‰¾</span><br><span class="line">nï¼šé‡å¤å‰ä¸€ä¸ªæœå¯»</span><br><span class="line">Nï¼šåå‘é‡å¤å‰ä¸€ä¸ªæœå¯»</span><br><span class="line">gï¼šå»ç¬¬ä¸€è¡Œ</span><br><span class="line">Gï¼šå»æœ€åä¸€è¡Œ</span><br><span class="line">:f ï¼šæ˜¾ç¤ºæ–‡ä»¶åå’Œç›®å‰æ˜¾ç¤ºè¡Œæ•°</span><br><span class="line">qï¼šç¦»å¼€</span><br><span class="line">[pagedown]:ä¸‹ä¸€é¡µ</span><br><span class="line">[pageup]:ä¸Šä¸€é¡µ</span><br></pre></td></tr></table></figure></li><li><p>headï¼ˆå–å‡ºå‰é¢å‡ è¡Œï¼‰</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">head [-n number] file</span><br><span class="line">head [-n +number] file  #å–åï¼Œånè¡Œä¸æ˜¾ç¤º</span><br></pre></td></tr></table></figure></li><li><p>tailï¼ˆå–åé¢å‡ è¡Œï¼‰</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tail [-n number] [-f] file</span><br><span class="line">head [-n -number] file  #å–åï¼Œå‰nè¡Œä¸æ˜¾ç¤º</span><br><span class="line">-fï¼šåŠ¨æ€è¾“å‡º</span><br></pre></td></tr></table></figure></li><li><p>odï¼ˆéçº¯æ–‡æœ¬æ–‡æ¡£ï¼‰</p></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">od [-t TYPE] file</span><br></pre></td></tr></table></figure><h3 id="æ–°å»ºæ–‡æ¡£æˆ–ä¿®æ”¹æ–‡ä»¶æ—¶é—´"><a href="#æ–°å»ºæ–‡æ¡£æˆ–ä¿®æ”¹æ–‡ä»¶æ—¶é—´" class="headerlink" title="æ–°å»ºæ–‡æ¡£æˆ–ä¿®æ”¹æ–‡ä»¶æ—¶é—´"></a>æ–°å»ºæ–‡æ¡£æˆ–ä¿®æ”¹æ–‡ä»¶æ—¶é—´</h3><ul><li>mtimeï¼ˆmodification timeï¼‰ï¼šæ–‡ä»¶å†…å®¹å˜æ›´æ—¶é—´(lsé»˜è®¤æ—¶é—´)</li><li>ctimeï¼ˆstatus timeï¼‰ï¼šæ–‡ä»¶çŠ¶æ€ï¼ˆæƒé™ã€å±æ€§ï¼‰å˜æ›´æ—¶é—´</li><li>atimeï¼ˆaccess timeï¼‰ï¼šæ–‡ä»¶è¯»å–æ—¶é—´</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">touch [-acdmt] file #å»ºç«‹ä¸€ä¸ªæ–°æ–‡ä»¶æˆ–æ›´æ–°æ–‡ä»¶çš„mtimeå’Œatime</span><br></pre></td></tr></table></figure><h3 id="é»˜è®¤æƒé™å’Œéšè—æƒé™"><a href="#é»˜è®¤æƒé™å’Œéšè—æƒé™" class="headerlink" title="é»˜è®¤æƒé™å’Œéšè—æƒé™"></a>é»˜è®¤æƒé™å’Œéšè—æƒé™</h3><ul><li>æ–‡ä»¶é¢„è®¾æƒé™<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">umask</span><br></pre></td></tr></table></figure></li><li>æ–‡ä»¶éšè—å±æ€§<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chattr [+-&#x3D;][ASacdistu] file&#x2F;dir    #é…ç½®æ–‡ä»¶æˆ–ç›®å½•éšè—å±æ€§</span><br><span class="line">lsattr [-adR] file&#x2F;dir  #æŸ¥çœ‹éšè—å±æ€§</span><br></pre></td></tr></table></figure></li><li>æ–‡ä»¶ç‰¹æ®Šæƒé™ï¼šSUIDï¼ŒSGIDï¼ŒSBIT</li><li>è§‚å¯Ÿæ–‡ä»¶ç±»å‹ï¼šfie</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file filename</span><br></pre></td></tr></table></figure><h3 id="æŒ‡ä»¤ä¸æ–‡ä»¶çš„æœå¯»"><a href="#æŒ‡ä»¤ä¸æ–‡ä»¶çš„æœå¯»" class="headerlink" title="æŒ‡ä»¤ä¸æ–‡ä»¶çš„æœå¯»"></a>æŒ‡ä»¤ä¸æ–‡ä»¶çš„æœå¯»</h3><ul><li>whichï¼ˆå¯»æ‰¾ã€æŒ‡ä»¤æ–‡ä»¶ã€‘ï¼‰<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">which [-a] command</span><br></pre></td></tr></table></figure></li><li>whereis(åœ¨ç‰¹å®šç›®å½•æœå¯»ç³»ç»Ÿæ–‡ä»¶ï¼Œä¸å®ç”¨)<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">whereis [-bmsu] file&#x2F;dir</span><br></pre></td></tr></table></figure></li><li>locate/updatedbï¼ˆä¾é dbå¿«é€ŸæŸ¥è¯¢ï¼‰<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">locate [-ir] keyword</span><br><span class="line">updatedb    #locateæ˜¯é dbå¿«é€ŸæŸ¥è¯¢ï¼Œæ‰€ä»¥æŸ¥è¯¢è¾ƒæ–°æ–‡ä»¶æ—¶éœ€è¦æ‰‹åŠ¨updatedb</span><br></pre></td></tr></table></figure>find(å¼ºå¤§ï¼Œä½†æ¯”è¾ƒåƒç¡¬ç›˜ï¼Œå½±å“é€Ÿåº¦)<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">find [PATH] [option] [action]</span><br><span class="line">1.time(-atime,-ctime,-mtime)</span><br><span class="line">    -mtime n : nå¤©å‰ï¼ˆä¸€å¤©å†…ï¼‰è¢«æ”¹åŠ¨è¿‡çš„æ–‡ä»¶</span><br><span class="line">    -mtime +n : nå¤©å‰ï¼ˆä¸å«næœ¬èº«ï¼‰è¢«æ”¹åŠ¨è¿‡çš„æ–‡ä»¶</span><br><span class="line">    -mtime -n : nå¤©å†…ï¼ˆå«næœ¬èº«ï¼‰è¢«æ”¹åŠ¨è¿‡çš„æ–‡ä»¶</span><br><span class="line">2.å±ç»„ç›¸å…³å‚æ•°</span><br><span class="line">    -uid n</span><br><span class="line">    -gid n</span><br><span class="line">    -user name</span><br><span class="line">    -group name</span><br><span class="line">    -nouser</span><br><span class="line">    -nogroup</span><br><span class="line">3.æƒé™åŠåç§°</span><br><span class="line">    -name filename</span><br><span class="line">    -size [+-]SIZE:cä»£è¡¨byteï¼Œkä»£è¡¨kb</span><br><span class="line">    -type TYPE ï¼š [f,b,c,d,l,s,p]</span><br><span class="line">    -perm mode</span><br><span class="line">    -perm -mode</span><br><span class="line">    -perm &#x2F;mode</span><br><span class="line">4.é¢å¤–å‚æ•°</span><br><span class="line">    -exec command : commandè§ä¸‹å›¾</span><br><span class="line">    -print</span><br><span class="line">    -a : andçš„æ„æ€ï¼Œç”¨äºè¿æ¥ä¸¤ä¸ªæ¡ä»¶ï¼Œå¦‚find &#x2F;etc -size +50k -a -size -60k</span><br><span class="line">    ! : å–åçš„æ„æ€ï¼Œå¦‚find &#x2F;etc -size +50k -a ! -user root</span><br></pre></td></tr></table></figure><img src="http://note.youdao.com/yws/public/resource/91f49489e63185046c6483d6ca66c85a/xmlnote/85FEA75CCD8E4D0CAA94260B98089A1E/431" alt="image"></li></ul><h2 id="ç¬¬ä¸ƒç« ã€Linux-ç£ç›˜ä¸æ–‡ä»¶ç³»ç»Ÿç®¡ç†"><a href="#ç¬¬ä¸ƒç« ã€Linux-ç£ç›˜ä¸æ–‡ä»¶ç³»ç»Ÿç®¡ç†" class="headerlink" title="ç¬¬ä¸ƒç« ã€Linux ç£ç›˜ä¸æ–‡ä»¶ç³»ç»Ÿç®¡ç†"></a>ç¬¬ä¸ƒç« ã€Linux ç£ç›˜ä¸æ–‡ä»¶ç³»ç»Ÿç®¡ç†</h2><h3 id="æ–‡ä»¶ç³»ç»Ÿç‰¹æ€§"><a href="#æ–‡ä»¶ç³»ç»Ÿç‰¹æ€§" class="headerlink" title="æ–‡ä»¶ç³»ç»Ÿç‰¹æ€§"></a>æ–‡ä»¶ç³»ç»Ÿç‰¹æ€§</h3><p>æ“ä½œç³»ç»Ÿçš„æ–‡ä»¶æ•°æ®é™¤äº†æ–‡ä»¶å®é™…å†…å®¹å¤–ï¼Œè¿˜æœ‰éå¸¸å¤šçš„å±æ€§ï¼ˆæƒé™ï¼Œå±ç»„ï¼Œæ—¶é—´å‚æ•°ï¼‰ã€‚æ–‡ä»¶ç³»ç»Ÿä¼šå°†è¿™ä¸¤éƒ¨åˆ†æ•°æ®å­˜æ”¾åœ¨ä¸åŒçš„åŒºå—ï¼Œæƒé™ä¸å±æ€§æ”¾åˆ°inodeä¸­ï¼Œå®é™…æ•°æ®æ”¾åˆ°data blockä¸­ã€‚å¦å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªè¶…çº§åŒºå—ï¼ˆsuperblockï¼‰ä¼šè®°å½•æ•´ä¸ªæ–‡ä»¶ç³»ç»Ÿçš„æ•´ä½“ä¿¡æ¯ï¼ŒåŒ…æ‹¬inodeå’Œblockæ€»é‡ã€ä½¿ç”¨é‡ã€å‰©ä½™é‡ç­‰ã€‚</p><ul><li>superblockï¼šè®°å½•æ­¤filesystemçš„æ•´ä½“ä¿¡æ¯ï¼ŒåŒ…æ‹¬inode/blockçš„æ€»é‡ã€ä½¿ç”¨é‡ã€å‰©ä½™é‡ï¼Œä»¥åŠæ–‡ä»¶ç³»ç»Ÿçš„æ ¼å¼ä¸ç›¸å…³ä¿¡æ¯ç­‰ï¼›</li><li>inodeï¼šè®°å½•æ–‡ä»¶çš„å±æ€§ï¼Œä¸€ä¸ªæ–‡ä»¶å ç”¨ä¸€ä¸ªinodeï¼ŒåŒæ—¶è®°å½•æ­¤æ–‡ä»¶çš„æ•°æ®æ‰€åœ¨blockå·ç ï¼›</li><li>blockï¼šå®é™…è®°å½•æ–‡ä»¶çš„å†…å®¹ï¼Œè‹¥æ–‡ä»¶å¤ªå¤§æ—¶ï¼Œä¼šå ç”¨å¤šä¸ªblockï¼›</li></ul><p>æ¯ä¸ªinodeä¸blockéƒ½æœ‰ç¼–å·ï¼Œæ¯ä¸ªæ–‡ä»¶éƒ½ä¼šå ç”¨ä¸€ä¸ªinodeï¼Œinodeå†…åˆ™æœ‰æ–‡ä»¶æ•°æ®æ”¾ç½®çš„blockå·ç ã€‚è¿™ç§æ•°æ®å­˜å–æ–¹æ³•æˆ‘ä»¬ç§°ä¸ºç´¢å¼•å¼æ–‡ä»¶ç³»ç»Ÿï¼ˆindexed allocationï¼‰ï¼ˆä¸‹å›¾ï¼‰ã€‚<br><img src="http://note.youdao.com/yws/public/resource/91f49489e63185046c6483d6ca66c85a/xmlnote/EE38F1F9F8A54CB185593EC9E07B2AAA/489" alt="image"><br><img src="http://note.youdao.com/yws/public/resource/91f49489e63185046c6483d6ca66c85a/xmlnote/561C779757124369BE8A8F997D760FBE/501" alt="image"><br>ä¸Šå›¾ä¸ºé—ªå­˜ç”¨çš„FATæ ¼å¼ï¼Œæ²¡æœ‰inodeå­˜åœ¨ï¼Œæ‰€ä»¥FATæ²¡æœ‰åŠæ³•å°†è¿™ä¸ªæ–‡ä»¶çš„æ‰€æœ‰blockå†ä¸€å¼€å§‹å°±è¯»å–å‡ºæ¥ã€‚æ¯ä¸ªblockå·ç éƒ½è®°å½•å†å‰ä¸€ä¸ªblockå½“ä¸­ã€‚å¦‚æœåŒä¸€ä¸ªæ–‡ä»¶æ•°æ®å†™å…¥çš„blockåˆ†æ•£çš„å¤ªè¿‡å‰å®³ï¼Œæ— æ³•åœ¨ç£ç›˜è½¬ä¸€åœˆå°±è¯»åˆ°æ‰€æœ‰æ•°æ®ï¼Œå°±éœ€è¦å¤šè½¬å¥½å‡ åœˆã€‚<br>ç¢ç‰‡æ•´ç†çš„åŸå› å°±æ˜¯æ–‡ä»¶å†™å…¥çš„blockè¿‡äºåˆ†æ•£ï¼Œè¯»å–æ–‡ä»¶çš„æ•ˆç‡ä¼šå˜å¾—å¾ˆå·®ï¼Œè¿™æ—¶å€™å¯ä»¥é€è¿‡ ç¢ç‰‡æ•´ç†å°†åŒä¸€ä¸ªæ–‡ä»¶çš„blcokæ±‡æ•´åˆ°ä¸€èµ·ï¼Œè¿™æ ·è¯»å–ä¼šæ¯”è¾ƒå®¹æ˜“ã€‚Ext2æ˜¯ç´¢å¼•å¼æ–‡ä»¶ç³»ç»Ÿï¼Œä¸éœ€è¦æ•´ç†ã€‚</p><h3 id="Linuxçš„EXT2æ–‡ä»¶ç³»ç»Ÿï¼ˆinodeï¼‰"><a href="#Linuxçš„EXT2æ–‡ä»¶ç³»ç»Ÿï¼ˆinodeï¼‰" class="headerlink" title="Linuxçš„EXT2æ–‡ä»¶ç³»ç»Ÿï¼ˆinodeï¼‰"></a>Linuxçš„EXT2æ–‡ä»¶ç³»ç»Ÿï¼ˆinodeï¼‰</h3><p>æ–‡ä»¶ç³»ç»Ÿä¸€å¼€å§‹å°±å°†inodeä¸blockè§„åˆ’å¥½äº†ï¼Œé™¤éé‡æ–°æ ¼å¼åŒ–ï¼ˆæˆ–è€…åˆ©ç”¨resize2fsç­‰æŒ‡ä»¤å˜æ›´æ–‡ä»¶ç³»ç»Ÿå¤§å°ï¼‰ï¼Œå¦åˆ™inodeä¸blockå›ºå®šåå°±ä¸å†å˜åŠ¨ã€‚</p><h3 id="7-2-æ–‡ä»¶ç³»ç»Ÿçš„ç®€å•æ“ä½œ"><a href="#7-2-æ–‡ä»¶ç³»ç»Ÿçš„ç®€å•æ“ä½œ" class="headerlink" title="7.2 æ–‡ä»¶ç³»ç»Ÿçš„ç®€å•æ“ä½œ"></a>7.2 æ–‡ä»¶ç³»ç»Ÿçš„ç®€å•æ“ä½œ</h3><h4 id="7-2-1-ç£ç›˜ä¸ç›®å½•çš„å®¹é‡"><a href="#7-2-1-ç£ç›˜ä¸ç›®å½•çš„å®¹é‡" class="headerlink" title="7.2.1 ç£ç›˜ä¸ç›®å½•çš„å®¹é‡"></a>7.2.1 ç£ç›˜ä¸ç›®å½•çš„å®¹é‡</h4><p>df:åˆ—å‡ºæ–‡ä»¶ç³»ç»Ÿçš„æ•´ä½“ç£ç›˜ä½¿ç”¨é‡ï¼›</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Linuxå­¦ä¹ ç¬”è®°&quot;&gt;&lt;a href=&quot;#Linuxå­¦ä¹ ç¬”è®°&quot; class=&quot;headerlink&quot; title=&quot;Linuxå­¦ä¹ ç¬”è®°&quot;&gt;&lt;/a&gt;Linuxå­¦ä¹ ç¬”è®°&lt;/h1&gt;&lt;h2 id=&quot;Linuxä¸­ï¼ŒCtrlç»„åˆé”®&quot;&gt;&lt;a href=&quot;#Linuxä¸­ï¼ŒCtrl
      
    
    </summary>
    
    
      <category term="ã€ŠLinuxç§æˆ¿èœã€‹ç¬”è®°" scheme="https://akaqin.github.io/categories/%E3%80%8ALinux%E7%A7%81%E6%88%BF%E8%8F%9C%E3%80%8B%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="Linux" scheme="https://akaqin.github.io/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>Cè¯­è¨€ç¼–ç¨‹å¿ƒå¾—</title>
    <link href="https://akaqin.github.io/2018/02/23/C%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A8%8B%E5%BF%83%E5%BE%97/"/>
    <id>https://akaqin.github.io/2018/02/23/C%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A8%8B%E5%BF%83%E5%BE%97/</id>
    <published>2018-02-23T09:01:38.000Z</published>
    <updated>2020-03-08T07:36:45.119Z</updated>
    
    <content type="html"><![CDATA[<ol><li><p>å­—ç¬¦â€™0â€™ ä¸ç­‰äº0ï¼Œ æˆªæ–­å­—ç¬¦ä¸²æ—¶ï¼Œa[n] = 0 ä¸ a[n] = â€˜\0â€™æ•ˆæœç›¸åŒ;</p></li><li><p>å‡½æ•°é‡Œç›´æ¥å£°æ˜ç»“æ„ä½“æ¯”å£°æ˜ç»“æ„ä½“æŒ‡é’ˆæ–¹ä¾¿ï¼Œå› ä¸ºæŒ‡é’ˆè¦æ‰‹åŠ¨ä¸ºå®ƒåˆ†é…ç©ºé—´ï¼Œä¸ç”¨åè¿˜éœ€è¦æ‰‹åŠ¨é‡Šæ”¾ï¼›ç»“æ„ä½“è‡ªåŠ¨åˆ†é…ï¼Œå‡½æ•°è¿”å›åè‡ªåŠ¨é‡Šæ”¾</p></li><li><p>å£°æ˜å˜é‡åä¸€å®šè¦è®°å¾—èµ‹åˆè¯†å€¼ï¼Œå°¤å…¶æ˜¯æ•°ç»„</p></li><li><p>å˜é‡å°±è¿‘å£°æ˜</p></li><li><p>æ–‡ä»¶å†…ä½¿ç”¨çš„å‡½æ•°è¦ä¹ æƒ¯å£°æ˜static</p></li><li><p>char *a = â€œacâ€; æŒ‡é’ˆå£°æ˜çš„å­—ç¬¦ä¸²å­˜åœ¨å¯æ‰§è¡Œæ–‡ä»¶çš„åªè¯»æ®µï¼Œä¿®æ”¹ä¼šäº§ç”Ÿæ®µé”™è¯¯ã€‚</p></li></ol>]]></content>
    
    <summary type="html">
    
      
      
        &lt;ol&gt;
&lt;li&gt;&lt;p&gt;å­—ç¬¦â€™0â€™ ä¸ç­‰äº0ï¼Œ æˆªæ–­å­—ç¬¦ä¸²æ—¶ï¼Œa[n] = 0 ä¸ a[n] = â€˜\0â€™æ•ˆæœç›¸åŒ;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;å‡½æ•°é‡Œç›´æ¥å£°æ˜ç»“æ„ä½“æ¯”å£°æ˜ç»“æ„ä½“æŒ‡é’ˆæ–¹ä¾¿ï¼Œå› ä¸ºæŒ‡é’ˆè¦æ‰‹åŠ¨ä¸ºå®ƒåˆ†é…ç©ºé—´ï¼Œä¸ç”¨åè¿˜éœ€è¦æ‰‹åŠ¨é‡Šæ”¾ï¼›ç»“æ„ä½“è‡ªåŠ¨åˆ†é…ï¼Œå‡½æ•°è¿”å›åè‡ªåŠ¨é‡Šæ”¾&lt;
      
    
    </summary>
    
    
      <category term="ç»éªŒæ€»ç»“" scheme="https://akaqin.github.io/categories/%E7%BB%8F%E9%AA%8C%E6%80%BB%E7%BB%93/"/>
    
    
      <category term="C" scheme="https://akaqin.github.io/tags/C/"/>
    
  </entry>
  
  <entry>
    <title>first post</title>
    <link href="https://akaqin.github.io/2017/02/23/first-post/"/>
    <id>https://akaqin.github.io/2017/02/23/first-post/</id>
    <published>2017-02-23T07:26:11.000Z</published>
    <updated>2020-03-07T12:22:32.934Z</updated>
    
    <content type="html"><![CDATA[<p>I love you, Joyce!</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;I love you, Joyce!&lt;/p&gt;

      
    
    </summary>
    
    
    
  </entry>
  
</feed>
